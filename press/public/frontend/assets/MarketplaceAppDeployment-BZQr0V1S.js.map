{"version":3,"file":"MarketplaceAppDeployment-BZQr0V1S.js","sources":["../../../../dashboard/src/components/MarketplaceAppReleaseList.vue","../../../../dashboard/src/views/marketplace/MarketplaceAppDeployment.vue"],"sourcesContent":["<template>\n\t<Card title=\"App Releases\">\n\t\t<div v-if=\"sources.length\">\n\t\t\t<div class=\"flex flex-row items-baseline\">\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"select\"\n\t\t\t\t\tv-if=\"sources.length > 1\"\n\t\t\t\t\tv-model=\"selectedSource\"\n\t\t\t\t\t:options=\"\n\t\t\t\t\t\tsources.map(s => ({\n\t\t\t\t\t\t\tlabel: `${s.source_information.repository}:${s.source_information.branch}`,\n\t\t\t\t\t\t\tvalue: s.source\n\t\t\t\t\t\t}))\n\t\t\t\t\t\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"!sources.length\">\n\t\t\t<p class=\"mt-3 text-center text-lg text-gray-600\">\n\t\t\t\tNo published source exist for this app. Please contact support to\n\t\t\t\tpublish a version of this app.\n\t\t\t</p>\n\t\t</div>\n\t\t<div\n\t\t\tv-else-if=\"releasesList.length === 0 && !$resources.releases.list.loading\"\n\t\t>\n\t\t\t<p class=\"mt-3 text-center text-lg text-gray-600\">\n\t\t\t\tNo app releases have been created for this version.\n\t\t\t</p>\n\t\t</div>\n\n\t\t<div v-else>\n\t\t\t<div class=\"divide-y\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"grid grid-cols-3 items-center gap-x-8 py-4 text-base text-gray-600 md:grid-cols-6\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"md:col-span-2\">Commit Message</span>\n\t\t\t\t\t<span class=\"hidden md:inline\">Tag</span>\n\t\t\t\t\t<span class=\"hidden md:inline\">Author</span>\n\t\t\t\t\t<span>Status</span>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"release in releasesList\"\n\t\t\t\t\t:key=\"release.name\"\n\t\t\t\t\tclass=\"grid grid-cols-3 items-center gap-x-8 py-4 text-base text-gray-900 md:grid-cols-6\"\n\t\t\t\t>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"max-w-md truncate text-base font-medium text-gray-700 md:col-span-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ release.message }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<CommitTag\n\t\t\t\t\t\tclass=\"hidden md:flex\"\n\t\t\t\t\t\t:tag=\"release.tag || release.hash.slice(0, 6)\"\n\t\t\t\t\t\t:link=\"getCommitUrl(release.hash)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"hidden text-gray-600 md:inline\">\n\t\t\t\t\t\t{{ release.author }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<Badge v-if=\"release.status != 'Draft'\" :label=\"release.status\" />\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"text-right\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tv-if=\"isPublishable(release)\"\n\t\t\t\t\t\t\t:loading=\"\n\t\t\t\t\t\t\t\t$resources.createApprovalRequest.loading ||\n\t\t\t\t\t\t\t\t$resources.latestApproved.loading\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t@click=\"confirmApprovalRequest(release.name)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tPublish\n\t\t\t\t\t\t</Button>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tv-else-if=\"release.status == 'Awaiting Approval'\"\n\t\t\t\t\t\t\t@click=\"confirmCancelRequest(release.name)\"\n\t\t\t\t\t\t\t>Cancel</Button\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tv-else-if=\"release.status == 'Rejected'\"\n\t\t\t\t\t\t\t@click=\"showFeedback(release)\"\n\t\t\t\t\t\t\t>View Feedback</Button\n\t\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<Dialog\n\t\t\t\t\t:options=\"{ title: 'Reason for Rejection' }\"\n\t\t\t\t\tv-model=\"showRejectionFeedbackDialog\"\n\t\t\t\t>\n\t\t\t\t\t<template v-slot:body-content>\n\t\t\t\t\t\t<div class=\"prose text-lg\" v-html=\"rejectionFeedback\"></div>\n\t\t\t\t\t</template>\n\t\t\t\t</Dialog>\n\n\t\t\t\t<div class=\"py-3\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t@click=\"$resources.releases.next()\"\n\t\t\t\t\t\tv-if=\"$resources.releases.hasNextPage\"\n\t\t\t\t\t\t:loading=\"$resources.releases.list.loading\"\n\t\t\t\t\t\tloadingText=\"Loading...\"\n\t\t\t\t\t\t>Load More</Button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</Card>\n</template>\n\n<script>\nimport CommitTag from './utils/CommitTag.vue';\nimport { notify } from '@/utils/toast';\n\nexport default {\n\tprops: {\n\t\tapp: {\n\t\t\ttype: Object\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tshowRejectionFeedbackDialog: false,\n\t\t\trejectionFeedback: '',\n\t\t\tselectedSource: null\n\t\t};\n\t},\n\tmounted() {\n\t\tthis.$socket.emit('doctype_subscribe', 'App Release');\n\t\tthis.$socket.on('list_update', this.releaseStateUpdate);\n\t\tif (this.sources.length > 0) {\n\t\t\tthis.selectedSource = this.sources[0].source;\n\t\t}\n\t},\n\tbeforeMount() {\n\t\tthis.$socket.emit('doctype_unsubscribe', 'App Release');\n\t\tthis.$socket.off('list_update', this.releaseStateUpdate);\n\t},\n\tresources: {\n\t\treleases() {\n\t\t\treturn {\n\t\t\t\ttype: 'list',\n\t\t\t\tdoctype: 'App Release',\n\t\t\t\turl: 'press.api.marketplace.releases',\n\t\t\t\tfilters: {\n\t\t\t\t\tapp: this.app.app,\n\t\t\t\t\tsource: this.selectedSource\n\t\t\t\t},\n\t\t\t\tstart: 0,\n\t\t\t\tpageLength: 15,\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tappSource() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.marketplace.get_app_source',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.selectedSource\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlatestApproved() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.marketplace.latest_approved_release',\n\t\t\t\tparams: {\n\t\t\t\t\tsource: this.selectedSource\n\t\t\t\t},\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tcreateApprovalRequest() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.marketplace.create_approval_request',\n\t\t\t\tonSuccess() {\n\t\t\t\t\tthis.resetReleaseListState();\n\t\t\t\t},\n\t\t\t\tonError(err) {\n\t\t\t\t\tconst requestAlreadyExists = err.messages.some(msg =>\n\t\t\t\t\t\tmsg.includes('already awaiting approval')\n\t\t\t\t\t);\n\n\t\t\t\t\tif (requestAlreadyExists)\n\t\t\t\t\t\tnotify({\n\t\t\t\t\t\t\ttitle: 'Request already exists',\n\t\t\t\t\t\t\tmessage: err.messages.join('\\n'),\n\t\t\t\t\t\t\tcolor: 'red',\n\t\t\t\t\t\t\ticon: 'x'\n\t\t\t\t\t\t});\n\t\t\t\t\telse\n\t\t\t\t\t\tnotify({\n\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\tmessage: err.messages.join('\\n'),\n\t\t\t\t\t\t\tcolor: 'red',\n\t\t\t\t\t\t\ticon: 'x'\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcancelApprovalRequest() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.marketplace.cancel_approval_request',\n\t\t\t\tonSuccess() {\n\t\t\t\t\tthis.resetReleaseListState();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\tmethods: {\n\t\tisPublishable(release) {\n\t\t\treturn (\n\t\t\t\trelease.status == 'Draft' &&\n\t\t\t\t(!this.latestApprovedOn ||\n\t\t\t\t\tthis.$date(release.creation) > this.latestApprovedOn)\n\t\t\t);\n\t\t},\n\t\tcreateApprovalRequest(appRelease) {\n\t\t\tlet { app } = this.app;\n\t\t\tthis.$resources.createApprovalRequest.submit({\n\t\t\t\tname: app,\n\t\t\t\tapp_release: appRelease\n\t\t\t});\n\t\t},\n\t\tcancelApprovalRequest(appRelease) {\n\t\t\tlet { app } = this.app;\n\t\t\tthis.$resources.cancelApprovalRequest.submit({\n\t\t\t\tmarketplace_app: app,\n\t\t\t\tapp_release: appRelease\n\t\t\t});\n\t\t},\n\t\tresetReleaseListState() {\n\t\t\tthis.$resources.releases.reload();\n\t\t\tthis.$resources.latestApproved.reload();\n\t\t},\n\t\tshowFeedback(appRelease) {\n\t\t\tthis.showRejectionFeedbackDialog = true;\n\t\t\tthis.rejectionFeedback = appRelease.reason_for_rejection;\n\t\t},\n\t\tconfirmApprovalRequest(appRelease) {\n\t\t\tthis.$confirm({\n\t\t\t\ttitle: 'Publish Release',\n\t\t\t\tmessage:\n\t\t\t\t\t'Are you sure you want to publish this release to marketplace? Upon confirmation, the release will be sent for approval by the review team.',\n\t\t\t\tactionLabel: 'Publish',\n\t\t\t\taction: closeDialog => {\n\t\t\t\t\tcloseDialog();\n\t\t\t\t\tthis.createApprovalRequest(appRelease);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tconfirmCancelRequest(appRelease) {\n\t\t\tthis.$confirm({\n\t\t\t\ttitle: 'Cancel Release Approval Request',\n\t\t\t\tmessage:\n\t\t\t\t\t'Are you sure you want to <strong>cancel</strong> the publish request for this release?',\n\t\t\t\tactionLabel: 'Proceed',\n\t\t\t\tactionColor: 'red',\n\t\t\t\taction: closeDialog => {\n\t\t\t\t\tcloseDialog();\n\t\t\t\t\tthis.cancelApprovalRequest(appRelease);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tgetCommitUrl(releaseHash) {\n\t\t\treturn this.repoUrl ? `${this.repoUrl}/commit/${releaseHash}` : '';\n\t\t},\n\t\treleaseStateUpdate(data) {\n\t\t\tif (this.selectedSource && data.source == this.selectedSource) {\n\t\t\t\tthis.resetReleaseListState();\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\treleasesList() {\n\t\t\tif (!this.$resources.releases.data) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn this.$resources.releases.data;\n\t\t},\n\t\tlatestApprovedOn() {\n\t\t\tif (\n\t\t\t\tthis.$resources.latestApproved.data &&\n\t\t\t\t!this.$resources.latestApproved.loading\n\t\t\t) {\n\t\t\t\treturn this.$date(this.$resources.latestApproved.data.creation);\n\t\t\t}\n\t\t},\n\t\tsources() {\n\t\t\t// Return only the unique sources\n\t\t\tlet tempArray = [];\n\t\t\tfor (let source of this.app.sources) {\n\t\t\t\tif (!tempArray.find(x => x.source === source.source)) {\n\t\t\t\t\ttempArray.push(source);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn tempArray;\n\t\t},\n\t\trepoUrl() {\n\t\t\treturn this.$resources.appSource?.data?.repository_url;\n\t\t}\n\t},\n\twatch: {\n\t\tselectedSource(value) {\n\t\t\tif (value) {\n\t\t\t\tthis.resetReleaseListState();\n\t\t\t\tthis.$resources.appSource.submit({ name: value });\n\t\t\t}\n\t\t}\n\t},\n\tcomponents: { CommitTag }\n};\n</script>\n","<template>\n\t<div v-if=\"app\">\n\t\t<MarketplaceAppReleaseList :app=\"app\" />\n\t</div>\n</template>\n\n<script>\nimport MarketplaceAppReleaseList from '@/components/MarketplaceAppReleaseList.vue';\n\nexport default {\n\tname: 'MarketplaceAppDeployment',\n\tprops: {\n\t\tapp: Object\n\t},\n\tcomponents: {\n\t\tMarketplaceAppReleaseList\n\t}\n};\n</script>\n"],"names":["_sfc_main","msg","notify","err","appRelease","app","closeDialog","tempArray","source","value","CommitTag","_hoisted_2","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_withCtx","$options","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","$data","_cache","$event","_createCommentVNode","_hoisted_4","_hoisted_5","_Fragment","_renderList","release","_toDisplayString","_createTextVNode","_ctx","_hoisted_3"],"mappings":"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"}