var b=(e,t,n)=>new Promise((g,s)=>{var i=m=>{try{o(n.next(m))}catch(h){s(h)}},l=m=>{try{o(n.throw(m))}catch(h){s(h)}},o=m=>m.done?g(m.value):Promise.resolve(m.value).then(i,l);o((n=n.apply(e,t)).next())});import{x as S,V as C,ad as z,q as d,o as a,j as r,u,A as c,a9 as v,n as k,aj as R,w as p,Y as f,X as B,h as y,r as w,t as A,a8 as O,F as I}from"./main-Dpl-JOF2.js";import{S as F}from"./StripeLogo-BRF2qIyd.js";import{l as V}from"./stripe.esm-D4yu_pm0.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5d497603-4987-4c5d-9509-dbd90a20211e",e._sentryDebugIdIdentifier="sentry-dbid-5d497603-4987-4c5d-9509-dbd90a20211e")}catch(n){}})();{var P=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};P._sentryModuleMetadata=P._sentryModuleMetadata||{},P._sentryModuleMetadata[new Error().stack]=Object.assign({},P._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const N={name:"BuyPrepaidCreditsStripe",components:{StripeLogo:F},props:{amount:{default:0},minimumAmount:{default:0}},data(){return{step:"Get Amount",clientSecret:null,cardErrorMessage:null,errorMessage:null,paymentInProgress:!1}},resources:{createPaymentIntent(){return{url:"press.api.billing.create_payment_intent_for_buying_credits",params:{amount:this.amount},validate(){if(this.amount<this.minimumAmount&&!this.$team.doc.erpnext_partner)throw new z(`Amount must be greater than or equal to ${this.minimumAmount}`)},onSuccess(t){return b(this,null,function*(){this.step="Setting up Stripe";let{publishable_key:n,client_secret:g}=t;this.clientSecret=g,this.stripe=yield V(n),this.elements=this.stripe.elements();let s=this.$theme,i={base:{color:s.colors.black,fontFamily:s.fontFamily.sans.join(", "),fontSmoothing:"antialiased",fontSize:"13px","::placeholder":{color:s.colors.gray[400]}},invalid:{color:s.colors.red[600],iconColor:s.colors.red[600]}};this.card=this.elements.create("card",{hidePostalCode:!0,style:i,classes:{complete:"",focus:"bg-gray-100"}}),this.step="Add Card Details",this.$nextTick(()=>{this.card.mount(this.$refs["card-element"])}),this.card.addEventListener("change",l=>{var o;this.cardErrorMessage=((o=l.error)==null?void 0:o.message)||null}),this.card.addEventListener("ready",()=>{this.ready=!0})})}}}},methods:{setupStripe(){this.$resources.createPaymentIntent.submit()},onBuyClick(){return b(this,null,function*(){this.paymentInProgress=!0;let e=yield this.stripe.confirmCardPayment(this.clientSecret,{payment_method:{card:this.card}});e.error?(this.errorMessage=e.error.message,this.paymentInProgress=!1):(C.success("Payment processed successfully, we will update your account shortly on confirmation from Stripe"),this.paymentInProgress=!1,this.$emit("success"),this.errorMessage=null)})}},computed:{totalAmount(){let{currency:e,billing_info:t}=this.$account?this.$account.team:this.$team.doc;return e==="INR"?Number((this.amount+this.amount*(t.gst_percentage||0)).toFixed(2)):this.amount}}},x={class:"form-input mt-2 block w-full pl-3",ref:"card-element"},E={key:0,class:"mt-8 flex justify-center"},G={class:"mt-4 flex w-full justify-between"},M={key:0},D={key:1};function T(e,t,n,g,s,i){const l=v,o=R,m=B;return a(),d("div",null,[r("label",{class:k(["block",{"pointer-events-none h-0.5 opacity-0":s.step!="Add Card Details","mt-4":s.step=="Add Card Details"}])},[t[1]||(t[1]=r("span",{class:"text-sm leading-4 text-gray-700"}," Credit or Debit Card ",-1)),r("div",x,null,512),c(l,{class:"mt-1",message:s.cardErrorMessage},null,8,["message"])],2),s.step=="Setting up Stripe"?(a(),d("div",E,[c(o,{class:"h-4 w-4 text-gray-600"})])):u("",!0),c(l,{class:"mt-2",message:e.$resources.createPaymentIntent.error||s.errorMessage},null,8,["message"]),r("div",G,[t[4]||(t[4]=r("div",null,null,-1)),s.step=="Get Amount"?(a(),d("div",M,[c(m,{variant:"solid",onClick:t[0]||(t[0]=h=>e.$resources.createPaymentIntent.submit()),loading:e.$resources.createPaymentIntent.loading},{default:p(()=>t[2]||(t[2]=[f(" Proceed to payment using Stripe ")])),_:1},8,["loading"])])):u("",!0),s.step=="Add Card Details"?(a(),d("div",D,[c(m,{class:"ml-2",variant:"solid",onClick:i.onBuyClick,loading:s.paymentInProgress},{default:p(()=>t[3]||(t[3]=[f(" Make payment via Stripe ")])),_:1},8,["onClick","loading"])])):u("",!0)])])}const j=S(N,[["render",T]]),W={name:"BuyPrepaidCreditsRazorpay",props:{amount:{default:0},minimumAmount:{default:0},isOnboarding:{default:!1}},data(){return{isPaymentComplete:!1,isVerifyingPayment:!1}},mounted(){this.razorpayCheckoutJS=document.createElement("script"),this.razorpayCheckoutJS.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),this.razorpayCheckoutJS.async=!0,document.head.appendChild(this.razorpayCheckoutJS)},resources:{createRazorpayOrder(){return{url:"press.api.billing.create_razorpay_order",params:{amount:this.amount},onSuccess(e){this.processOrder(e)},validate(){if(this.amount<this.minimumAmount)throw new z("Amount less than minimum amount required")}}},handlePaymentFailed(){return{url:"press.api.billing.handle_razorpay_payment_failed",onSuccess(){console.log("Payment Failed.")}}}},methods:{buyCreditsWithRazorpay(){this.$resources.createRazorpayOrder.submit()},processOrder(e){const t={key:e.key_id,order_id:e.order_id,name:"Easytouch Cloud",image:"/assets/press/images/frappe-cloud-logo.png",prefill:{email:this.$team.doc.user},handler:this.handlePaymentSuccess,theme:{color:"#171717"}},n=new Razorpay(t);n.open(),n.on("payment.failed",this.handlePaymentFailed)},handlePaymentFailed(e){this.$resources.handlePaymentFailed.submit({response:e}),C.error("Payment failed")},handlePaymentSuccess(){this.isPaymentComplete=!0,this.isOnboarding?this.checkForOnboardingPaymentCompletion():(this.$emit("success"),C.success("Payment successful"))},checkForOnboardingPaymentCompletion(){return b(this,null,function*(){this.isVerifyingPayment=!0,yield this.$team.reload(),this.$team.doc.payment_mode?(this.isVerifyingPayment=!1,this.$emit("success")):setTimeout(this.checkForOnboardingPaymentCompletion,2e3)})}},beforeUnmount(){var e;(e=this.razorpayCheckoutJS)==null||e.remove()}},J={key:0,class:"mt-3 text-p-sm"},U={class:"mt-4 flex w-full justify-between"};function L(e,t,n,g,s,i){const l=v,o=B;return a(),d("div",null,[e.$team.doc.currency==="INR"?(a(),d("p",J," If you select Razorpay, you can pay using Credit Card, Debit Card, Net Banking, UPI, Wallets, etc. If you are using Net Banking, it may take upto 5 days for balance to reflect. ")):u("",!0),c(l,{class:"mt-3",message:e.$resources.createRazorpayOrder.error},null,8,["message"]),r("div",U,[t[2]||(t[2]=r("div",null,null,-1)),s.isPaymentComplete?(a(),y(o,{key:1,variant:"solid",loading:s.isVerifyingPayment},{default:p(()=>t[1]||(t[1]=[f("Confirming payment")])),_:1},8,["loading"])):(a(),y(o,{key:0,variant:"solid",loading:e.$resources.createRazorpayOrder.loading,onClick:i.buyCreditsWithRazorpay},{default:p(()=>t[0]||(t[0]=[f(" Proceed to payment using Razorpay ")])),_:1},8,["loading","onClick"]))])])}const q=S(W,[["render",L]]),K={name:"BuyPrepaidCreditsBiti",props:{amount:{default:0},minimumAmount:{default:0},isOnboarding:{default:!1}},data(){return{isPaymentComplete:!1,isVerifyingPayment:!1}},mounted(){this.razorpayCheckoutJS=document.createElement("script"),this.razorpayCheckoutJS.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),this.razorpayCheckoutJS.async=!0,document.head.appendChild(this.razorpayCheckoutJS)},resources:{createRazorpayOrder(){return{url:"press.api.billing.create_biti_order",params:{amount:this.amount},onSuccess(e){this.processOrder(e)},validate(){if(this.amount<this.minimumAmount)throw new z("Amount less than minimum amount required")}}},handlePaymentFailed(){return{url:"press.api.billing.handle_razorpay_payment_failed",onSuccess(){console.log("Payment Failed.")}}}},methods:{buyCreditsWithRazorpay(){this.$resources.createRazorpayOrder.submit()},processOrder(e){const t={key:e.key_id,order_id:e.order_id,name:"Easytouch Cloud",image:"/assets/press/images/frappe-cloud-logo.png",prefill:{email:this.$team.doc.user},handler:this.handlePaymentSuccess,theme:{color:"#171717"}},n=new Razorpay(t);n.open(),n.on("payment.failed",this.handlePaymentFailed)},handlePaymentFailed(e){this.$resources.handlePaymentFailed.submit({response:e}),C.error("Payment failed")},handlePaymentSuccess(){this.isPaymentComplete=!0,this.isOnboarding?this.checkForOnboardingPaymentCompletion():(this.$emit("success"),C.success("Payment successful"))},checkForOnboardingPaymentCompletion(){return b(this,null,function*(){this.isVerifyingPayment=!0,yield this.$team.reload(),this.$team.doc.payment_mode?(this.isVerifyingPayment=!1,this.$emit("success")):setTimeout(this.checkForOnboardingPaymentCompletion,2e3)})}},beforeUnmount(){var e;(e=this.razorpayCheckoutJS)==null||e.remove()}},X={key:0,class:"mt-3 text-p-sm"},Y={class:"mt-4 flex w-full justify-between"};function H(e,t,n,g,s,i){const l=v,o=B;return a(),d("div",null,[e.$team.doc.currency==="INR"?(a(),d("p",X," If you select Razorpay, you can pay using Credit Card, Debit Card, Net Banking, UPI, Wallets, etc. If you are using Net Banking, it may take upto 5 days for balance to reflect. ")):u("",!0),c(l,{class:"mt-3",message:e.$resources.createRazorpayOrder.error},null,8,["message"]),r("div",Y,[t[2]||(t[2]=r("div",null,null,-1)),s.isPaymentComplete?(a(),y(o,{key:1,variant:"solid",loading:s.isVerifyingPayment},{default:p(()=>t[1]||(t[1]=[f("Confirming payment")])),_:1},8,["loading"])):(a(),y(o,{key:0,variant:"solid",loading:e.$resources.createRazorpayOrder.loading,onClick:i.buyCreditsWithRazorpay},{default:p(()=>t[0]||(t[0]=[f(" Proceed to payment using Razorpay ")])),_:1},8,["loading","onClick"]))])])}const Q=S(K,[["render",H]]),Z={name:"BuyPrepaidCreditsForm",components:{BuyPrepaidCreditsStripe:j,BuyPrepaidCreditsRazorpay:q,BuyPrepaidCreditsBiti:Q},data(){return{paymentGateway:null,creditsToBuy:this.minimumAmount}},mounted(){this.$team.doc.currency==="USD"&&!this.$team.doc.razorpay_enabled&&(this.paymentGateway="Stripe")},props:{modelValue:{default:!1},minimumAmount:{type:Number,default:0},isOnboarding:{type:Boolean,default:!1}},emits:["success"],methods:{onSuccess(){this.$emit("success")}},computed:{totalAmount(){let e=this.creditsToBuy||0;return this.$team.doc.currency==="INR"?(e+e*(this.$team.doc.billing_info.gst_percentage||0)).toFixed(2):e}}},ee={class:"grid w-4 place-items-center text-sm text-gray-700"},te={class:"grid w-4 place-items-center text-sm text-gray-700"},se={class:"mt-4"},ne={class:"mt-1.5 grid grid-cols-1 gap-2 sm:grid-cols-2"};function re(e,t,n,g,s,i){var $;const l=O,o=w("BuyPrepaidCreditsStripe"),m=w("BuyPrepaidCreditsRazorpay"),h=w("BuyPrepaidCreditsBiti");return a(),d(I,null,[r("div",null,[c(l,{label:`Amount (Minimum Amount: ${n.minimumAmount})`,class:"mb-3",modelValue:s.creditsToBuy,"onUpdate:modelValue":t[0]||(t[0]=_=>s.creditsToBuy=_),modelModifiers:{number:!0},name:"amount",autocomplete:"off",type:"number",min:n.minimumAmount},{prefix:p(()=>[r("div",ee,A(e.$team.doc.currency==="INR"?"₹":"$"),1)]),_:1},8,["label","modelValue","min"]),e.$team.doc.currency==="INR"?(a(),y(l,{key:0,label:`Total Amount + GST (${(($=e.$team.doc)==null?void 0:$.billing_info.gst_percentage)*100}%)`,disabled:"",modelValue:i.totalAmount,name:"total",autocomplete:"off",type:"number"},{prefix:p(()=>[r("div",te,A(e.$team.doc.currency==="INR"?"₹":"$"),1)]),_:1},8,["label","modelValue"])):u("",!0)]),r("div",se,[t[7]||(t[7]=r("div",{class:"text-xs text-gray-600"},"Select Payment Gateway",-1)),r("div",ne,[e.$team.doc.currency==="INR"||e.$team.doc.razorpay_enabled?(a(),d("button",{key:0,onClick:t[1]||(t[1]=_=>s.paymentGateway="Razorpay"),label:"Razorpay",class:k(["flex h-10 items-center justify-center rounded border",{"border-gray-300":s.paymentGateway!=="Razorpay","border-gray-900 ring-1 ring-gray-900":s.paymentGateway==="Razorpay"}])},t[4]||(t[4]=[r("img",{class:"w-24",src:"/assets/press/images/razorpay-logo.svg",alt:"Razorpay Logo"},null,-1)]),2)):u("",!0),r("button",{onClick:t[2]||(t[2]=_=>s.paymentGateway="BitiWallet"),label:"BitiWallet",class:k(["flex h-10 items-center justify-center rounded border",{"border-gray-300":s.paymentGateway!=="BitiWallet","border-gray-900 ring-1 ring-gray-900":s.paymentGateway==="BitiWallet"}])},t[5]||(t[5]=[r("img",{class:"h-7 w-24",src:"/assets/press/images/biti-logo.svg",alt:"BitiWallet"},null,-1)]),2),r("button",{onClick:t[3]||(t[3]=_=>s.paymentGateway="Stripe"),label:"Stripe",class:k(["flex h-10 items-center justify-center rounded border",{"border-gray-300":s.paymentGateway!=="Stripe","border-gray-900 ring-1 ring-gray-900":s.paymentGateway==="Stripe"}])},t[6]||(t[6]=[r("img",{class:"h-7 w-24",src:"/assets/press/images/stripe-logo.svg",alt:"Stripe Logo"},null,-1)]),2)])]),s.paymentGateway==="Stripe"?(a(),y(o,{key:0,amount:s.creditsToBuy,minimumAmount:n.minimumAmount,onSuccess:i.onSuccess,onCancel:e.onCancel},null,8,["amount","minimumAmount","onSuccess","onCancel"])):u("",!0),s.paymentGateway==="Razorpay"?(a(),y(m,{key:1,amount:s.creditsToBuy,minimumAmount:n.minimumAmount,isOnboarding:n.isOnboarding,onSuccess:i.onSuccess,onCancel:e.onCancel},null,8,["amount","minimumAmount","isOnboarding","onSuccess","onCancel"])):u("",!0),s.paymentGateway==="BitiWallet"?(a(),y(h,{key:2,amount:s.creditsToBuy,minimumAmount:n.minimumAmount,isOnboarding:n.isOnboarding,onSuccess:i.onSuccess,onCancel:e.onCancel},null,8,["amount","minimumAmount","isOnboarding","onSuccess","onCancel"])):u("",!0)],64)}const me=S(Z,[["render",re]]);export{me as default};
//# sourceMappingURL=BuyPrepaidCreditsForm-TYMK1T5x.js.map
