import{x as _,h as m,o as d,w as p,A as i,X as y,j as o,as as B,Y as r,q as V,a8 as L,ak as R,t as D,a9 as U,aA as F,aI as v,ad as u}from"./main-Dpl-JOF2.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="3be0dee6-f63f-42b0-927c-52be7b0118f7",s._sentryDebugIdIdentifier="sentry-dbid-3be0dee6-f63f-42b0-927c-52be7b0118f7")}catch(f){}})();{var n=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};n._sentryModuleMetadata=n._sentryModuleMetadata||{},n._sentryModuleMetadata[new Error().stack]=Object.assign({},n._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const S={name:"SiteDatabaseRestoreDialog",props:{site:{type:String,required:!0}},data(){return{siteURL:"",email:"",password:"",selectedFiles:{database:null,public:null,private:null},showRestoreDialog:!0,skipFailingPatches:!1}},resources:{getBackupLinks(){return{url:"press.api.site.get_backup_links",params:{url:this.siteURL,email:this.email,password:this.password},validate(){if(!this.siteURL)throw new u("Site URL is required");if(!this.email)throw new u("Email is required");if(!this.password)throw new u("Password is required")},onSuccess(s){for(let e of s)this.selectedFiles[e.type]=e.remote_file}}},restoreBackup(){return{url:"press.api.site.restore",params:{name:this.site,files:this.selectedFiles,skip_failing_patches:this.skipFailingPatches},validate(){if(!this.selectedFiles.database)throw new u("Something went wrong while fetching the backups from the site")},onSuccess(){this.siteURL="",this.email="",this.password="",this.showRestoreDialog=!1,this.$router.push({name:"Site Jobs",params:{name:this.site}})}}}},computed:{fetchedBackupFileTimestamp(){if(!this.$resources.getBackupLinks.data)return"";let e=this.$resources.getBackupLinks.data[0].file_name.split("-")[0].split("_").join("T");return v(e)}}},$={class:"mb-6 flex items-center rounded border border-gray-200 bg-gray-100 p-4 text-sm text-gray-600"},E={class:"space-y-4"},I={key:0,class:"flex text-base"},P={class:"mt-3"};function C(s,e,f,q,t,g){const k=B,l=L,b=R,c=y,h=U,w=F;return d(),m(w,{options:{title:"Restore from an existing site"},modelValue:t.showRestoreDialog,"onUpdate:modelValue":e[5]||(e[5]=a=>t.showRestoreDialog=a)},{"body-content":p(()=>[o("div",$,[i(k,{class:"mr-4 inline-block h-6 w-6"}),e[6]||(e[6]=o("div",null,[r(" This operation will replace the current "),o("b",null,"data"),r(" & "),o("b",null,"apps"),r(" in your site with those from the backup ")],-1))]),o("div",E,[i(l,{label:"Site URL",modelValue:t.siteURL,"onUpdate:modelValue":e[0]||(e[0]=a=>t.siteURL=a)},null,8,["modelValue"]),i(l,{label:"Email",modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=a=>t.email=a)},null,8,["modelValue"]),i(l,{label:"Password",type:"password",modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=a=>t.password=a)},null,8,["modelValue"]),s.$resources.getBackupLinks.data?(d(),V("div",I,[i(b,{class:"mr-2 w-4"}),r(" Found latest backups from "+D(g.fetchedBackupFileTimestamp),1)])):(d(),m(c,{key:1,onClick:e[3]||(e[3]=a=>s.$resources.getBackupLinks.submit()),loading:s.$resources.getBackupLinks.loading},{default:p(()=>e[7]||(e[7]=[r(" Get Backups ")])),_:1},8,["loading"]))]),o("div",P,[i(l,{label:"Skip failing patches (if any patch fails)",type:"checkbox",modelValue:t.skipFailingPatches,"onUpdate:modelValue":e[4]||(e[4]=a=>t.skipFailingPatches=a)},null,8,["modelValue"])]),i(h,{class:"mt-2",message:s.$resources.restoreBackup.error||s.$resources.getBackupLinks.error},null,8,["message"])]),actions:p(()=>[i(c,{class:"w-full",label:"Restore",variant:"solid",theme:"red",loading:s.$resources.restoreBackup.loading,disabled:!s.$resources.getBackupLinks.data,onClick:s.$resources.restoreBackup.submit},null,8,["loading","disabled","onClick"])]),_:1},8,["modelValue"])}const T=_(S,[["render",C]]);export{T as default};
//# sourceMappingURL=SiteDatabaseRestoreFromURLDialog-BFyX8bzt.js.map
