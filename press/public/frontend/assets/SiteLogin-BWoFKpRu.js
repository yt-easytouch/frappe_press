import{W as z,ab as W,J as V,l as _,ac as w,ad as R,q as u,o as l,A as i,w as T,j as o,h as j,u as E,Z as a,X,B as H,t as p,ae as Q,a8 as G,n as ee,Y as $,af as te,F as se,v as oe,a9 as ae,V as y,aa as O}from"./main-Dpl-JOF2.js";import{L as ne}from"./LoginBox-qd4moaUa.js";import"./YooltechLogo-DH5Linvn.js";import"./ETLogo-Ziye5dPH.js";(function(){try{var b=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},c=new Error().stack;c&&(b._sentryDebugIds=b._sentryDebugIds||{},b._sentryDebugIds[c]="cab130ab-2449-4ac7-b51c-337f5ef94c72",b._sentryDebugIdIdentifier="sentry-dbid-cab130ab-2449-4ac7-b51c-337f5ef94c72")}catch(B){}})();{var C=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};C._sentryModuleMetadata=C._sentryModuleMetadata||{},C._sentryModuleMetadata[new Error().stack]=Object.assign({},C._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const le={class:"h-screen overflow-hidden sm:bg-gray-50"},ie={key:0},re={key:0},ue={class:"flex items-center justify-center space-x-2 text-base"},de={class:"mx-4 mt-4 space-x-4"},ce={key:1,class:"mt-8 flex flex-col items-center justify-center space-x-2 text-base"},fe={class:"flex items-center justify-center space-x-2 text-base"},me={class:"font-semibold"},ge={class:"mx-4 mt-8 space-x-4"},ve={key:1,class:"mx-auto flex items-center justify-center space-x-2 text-base"},_e={key:2},pe={key:1},ye={key:3},be={class:"mt-8 flex items-center justify-center space-x-2 text-base"},he={class:"flex flex-col gap-2"},we={class:"font-semibold"},ke={class:"mt-8 flex w-full justify-center space-x-4"},xe={key:4,class:"mt-10"},Se={key:0},Pe={class:"text-center text-base leading-6 text-gray-700"},Ce={key:1,class:"space-y-2"},Ve=["onClick"],Te={class:"flex min-h-[40px] w-full items-center justify-between"},$e={class:"space-y-2"},Le={class:"text-base text-gray-800"},je={class:"flex w-full flex-col items-center justify-center space-y-2 pb-8"},Me={__name:"SiteLogin",setup(b){z("team");const c=z("session"),B=W(),r=V(()=>B.query.site),I=_(!1),n=_(localStorage.getItem("product_site_user")||""),m=_(""),h=_(!1),D=_(!1),g=_(0);setInterval(()=>{g.value>0&&(g.value-=1)},1e3);const Z=()=>{s.reset(),h.value=!1},M=w({url:"press.api.site_login.check_session_id",auto:!c.user,onSuccess:t=>{t&&(n.value=t,s.submit({user:t}))}}),s=w({url:"press.api.site_login.get_product_sites_of_user",doctype:"Site",auto:c.user,params:{user:n.value||c.user},onSuccess:t=>{r.value&&(t.find(e=>e.name===r.value)||t.find(e=>e.host_name===r.value))&&(I.value=!0)}}),k=w({url:"press.api.site_login.login_to_site",onSuccess:t=>{const e=r.value?"_self":"_blank";window.open(t,e)}});function L(t){if(!t){y.error("Please select a site");return}r.value?k.submit({email:n.value||c.user,site:t}):y.promise(k.submit({email:n.value||c.user,site:t}),{loading:"Logging in ...",success:"Logged in",error:e=>{D.value=!0,O(e)}})}const v=w({url:"press.api.site_login.send_otp",validate:t=>{if(!t.email)throw new R("Please enter email");if(!t.email.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/))throw new R("Please enter a valid email")},onSuccess:()=>{h.value=!0,g.value=30,n.value&&localStorage.setItem("site_login_email",n.value)}});function A(){if(!n.value){y.error("Please enter email");return}y.promise(v.submit({email:n.value}),{loading:"Sending OTP ...",success:`OTP sent to ${n.value}`,error:t=>O(t)})}const x=w({url:"press.api.site_login.verify_otp",onSuccess:()=>{s.submit({user:n.value}),m.value="",v.error=""}});function N(){if(!m.value){y.error("Please enter OTP");return}y.promise(x.submit({email:n.value,otp:m.value}),{loading:"Verifying OTP ...",success:"OTP verified",error:t=>O(t)})}const q=V(()=>r.value&&s.fetched&&s.data.length!==0?"":s.fetched&&s.data.length!==0?`Pick a site to log in to as ${n.value||c.user}`:!s.fetched&&!(s.loading||M.loading||c.loading)?"Enter your email to access your site":""),S=V(()=>r.value&&s.fetched&&s.data.length!==0?s.data.find(t=>t.name===r.value||t.host_name===r.value):!1),U=V(()=>S.value?S.value.host_name||S.value.name:"");return(t,e)=>{const P=H,f=X,Y=Q,F=G,J=te,K=ae;return l(),u("div",le,[i(ne,{title:"Log in to your site on Easytouch Cloud",subtitle:q.value},{default:T(()=>[o("div",null,[S.value?(l(),u("div",ie,[D.value?(l(),u("div",re,[o("div",ue,[i(P,{name:"alert-triangle",class:"mr-2 h-4 w-4"}),e[7]||(e[7]=o("p",null," Something went wrong while attempting to log in to your site ",-1))]),o("div",de,[i(f,{label:"Try again","icon-left":"refresh-cw",loading:a(k).loading,onClick:e[0]||(e[0]=d=>L(r.value))},null,8,["loading"]),i(f,{label:"View your sites","icon-left":"list",route:{name:"Site Login"}})])])):I.value?(l(),u("div",ce,[o("div",fe,[i(P,{name:"alert-circle",class:"mr-2 h-4 w-4"}),o("div",null,[e[8]||(e[8]=o("p",null,"You are about to log in to your site",-1)),o("span",me,p(U.value),1)])]),o("div",ge,[i(f,{label:"Log in","icon-left":"log-in",variant:"solid",loading:a(k).loading,onClick:e[1]||(e[1]=d=>L(r.value))},null,8,["loading"])])])):E("",!0)])):t.$session.loading||a(M).loading||a(s).loading?(l(),u("div",ve,[i(Y)])):a(s).fetched?r.value?(l(),u("div",ye,[o("div",be,[i(P,{name:"alert-triangle",class:"mr-2 h-4 w-4"}),o("div",he,[o("p",null,[$(p(n.value||a(c).user)+" is not a user of the site ",1),o("span",we,p(r.value),1)])])]),o("div",ke,[i(f,{label:"View your sites","icon-left":"list",onClick:e[5]||(e[5]=()=>{t.$router.push({name:"Site Login"})})})])])):(l(),u("div",xe,[a(s).data.length===0?(l(),u("div",Se,[o("div",Pe,[o("div",null,"No sites found for "+p(n.value),1),i(J,{to:{name:"Signup"}},{default:T(()=>e[9]||(e[9]=[$("Sign up")])),_:1}),e[10]||(e[10]=$(" to create a new site "))])])):(l(),u("div",Ce,[(l(!0),u(se,null,oe(a(s).data,d=>(l(),u("div",{key:d.name,class:"flex items-center justify-between rounded-md px-3 py-2 hover:cursor-pointer hover:bg-gray-100",onClick:Ee=>L(d.name)},[o("div",Te,[o("div",$e,[o("div",Le,p(d.host_name||d.name),1)]),i(P,{name:"external-link",class:"h-4 w-4"})])],8,Ve))),128))]))])):(l(),u("form",_e,[i(F,{label:"Email",type:"email",class:ee(["w-full",{"pointer-events-none":h.value}]),modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=d=>n.value=d),placeholder:"johndoe@mail.com"},null,8,["class","modelValue"]),h.value?(l(),j(F,{key:0,label:"Verification Code",modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=d=>m.value=d),placeholder:"123456",class:"mt-2"},null,8,["modelValue"])):E("",!0),h.value?(l(),u("div",pe,[i(f,{label:"Verify",disabled:m.value.length!==6,loading:a(s).loading||a(v).loading||a(x).loading,variant:"solid",class:"mt-4 w-full",onClick:N},null,8,["disabled","loading"]),i(f,{variant:"outline",class:"mt-2 w-full",disabled:g.value>0,onClick:e[4]||(e[4]=d=>A()),loading:a(v).loading},{default:T(()=>[$(" Resend verification code "+p(g.value>0?`in ${g.value} seconds`:""),1)]),_:1},8,["disabled","loading"])])):(l(),j(f,{key:2,label:"Submit",disabled:n.value.length===0,loading:a(s).loading||a(v).loading||a(x).loading,variant:"solid",class:"mt-4 w-full",onClick:A},null,8,["disabled","loading"]))])),i(K,{class:"mt-4",message:a(s).error||a(v).error||a(x).error},null,8,["message"])])]),footer:T(()=>[o("div",je,[a(s).fetched?(l(),j(f,{key:0,class:"mt-4",onClick:Z,"icon-right":"log-out",variant:"ghost",label:"Log out"})):E("",!0),i(f,{class:"mt-4",onClick:e[6]||(e[6]=d=>t.$router.push({name:"Login"})),"icon-right":"arrow-right",variant:"ghost",label:"Go to Easytouch Cloud dashboard"})])]),_:1},8,["subtitle"])])}}};export{Me as default};
//# sourceMappingURL=SiteLogin-BWoFKpRu.js.map
