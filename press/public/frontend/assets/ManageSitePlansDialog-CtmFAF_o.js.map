{"version":3,"file":"ManageSitePlansDialog-CtmFAF_o.js","sources":["../../../../dashboard/src2/components/ManageSitePlansDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\t:options=\"{\n\t\t\ttitle: showSetupSubscription ? 'Setup Subscription' : 'Change Plan',\n\t\t\tsize: step === 'site-plans' ? '3xl' : '3xl',\n\t\t}\"\n\t\tv-model=\"show\"\n\t>\n\t\t<template #body-content>\n\t\t\t<!-- steps are for users without payment method added, \n\t\t otherwise user will only go through just the initial step to change plan  -->\n\n\t\t\t<div v-if=\"step === 'site-plans'\">\n\t\t\t\t<!-- doing this weird thing because progress with intervals doesn't rerender on moving to new step for some reason -->\n\t\t\t\t<!-- TODO: fix it in frappe-ui -->\n\t\t\t\t<Progress\n\t\t\t\t\tv-if=\"showSetupSubscription\"\n\t\t\t\t\tclass=\"my-8\"\n\t\t\t\t\tsize=\"md\"\n\t\t\t\t\t:label=\"progressLabel\"\n\t\t\t\t\t:interval-count=\"3\"\n\t\t\t\t\t:intervals=\"true\"\n\t\t\t\t\t:value=\"32\"\n\t\t\t\t/>\n\t\t\t\t<SitePlansCards\n\t\t\t\t\tv-model=\"plan\"\n\t\t\t\t\t:isPrivateBenchSite=\"!$site.doc.group_public\"\n\t\t\t\t\t:isDedicatedServerSite=\"$site.doc.is_dedicated_server\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"mt-4 text-xs text-gray-700\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex items-center rounded bg-gray-50 p-2 text-p-base font-medium text-gray-800\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i-lucide-badge-check class=\"mr-2 h-5 w-12 text-gray-600\" />\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<strong>Support</strong> covers only issues of Frappe apps and not\n\t\t\t\t\t\t\tfunctional queries. You can raise a support ticket for Frappe\n\t\t\t\t\t\t\tCloud issues for all plans.\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<ErrorMessage class=\"mt-2\" :message=\"$site.setPlan.error\" />\n\t\t\t</div>\n\n\t\t\t<div v-else-if=\"step === 'billing-details'\">\n\t\t\t\t<Progress\n\t\t\t\t\tclass=\"my-8\"\n\t\t\t\t\tsize=\"md\"\n\t\t\t\t\t:label=\"progressLabel\"\n\t\t\t\t\t:interval-count=\"3\"\n\t\t\t\t\t:intervals=\"true\"\n\t\t\t\t\t:value=\"65\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"mb-5 inline-flex gap-1.5 text-base text-gray-700\">\n\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t\t<span> Add billing details to your account before proceeding.</span>\n\t\t\t\t</div>\n\t\t\t\t<BillingDetails ref=\"billingRef\" @success=\"step = 'add-payment-mode'\" />\n\t\t\t</div>\n\n\t\t\t<div v-else-if=\"step === 'add-payment-mode'\">\n\t\t\t\t<Progress\n\t\t\t\t\tclass=\"my-8\"\n\t\t\t\t\t:label=\"progressLabel\"\n\t\t\t\t\tsize=\"md\"\n\t\t\t\t\t:interval-count=\"3\"\n\t\t\t\t\t:intervals=\"true\"\n\t\t\t\t\t:value=\"99\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"mb-5 flex w-full flex-row gap-2 rounded-md border p-1 text-p-base text-gray-800\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"w-1/2 cursor-pointer rounded-[7px] py-1.5 text-center transition-all\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'bg-gray-100': isAutomatedBilling,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@click=\"isAutomatedBilling = true\"\n\t\t\t\t\t>\n\t\t\t\t\t\tAdd Card\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"w-1/2 cursor-pointer rounded-sm py-1.5 text-center transition-all\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'bg-gray-100': !isAutomatedBilling,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@click=\"isAutomatedBilling = false\"\n\t\t\t\t\t>\n\t\t\t\t\t\tAdd Prepaid Credits\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"isAutomatedBilling\"\n\t\t\t\t\t\tclass=\"mb-5 flex items-center gap-2 text-sm text-gray-700\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\tAdding a card will enable automated billing for your account. You\n\t\t\t\t\t\t\twill be charged automatically at the end of your billing cycle.\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tclass=\"mb-5 flex items-center gap-2 text-sm text-gray-700\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FeatherIcon class=\"h-4\" name=\"info\" />\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\tAdding prepaid credits will allow you to manually recharge your\n\t\t\t\t\t\t\taccount balance. You can use this balance to pay for your plan.\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<CardForm\n\t\t\t\t\tv-if=\"isAutomatedBilling\"\n\t\t\t\t\t@success=\"paymentModeAdded\"\n\t\t\t\t\t:showAddressForm=\"false\"\n\t\t\t\t/>\n\t\t\t\t<PrepaidCreditsForm\n\t\t\t\t\tv-else\n\t\t\t\t\t:minimumAmount=\"\n\t\t\t\t\t\t$team.doc?.currency === 'INR' ? plan.price_inr : plan.price_usd\n\t\t\t\t\t\"\n\t\t\t\t\t@success=\"paymentModeAdded\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</template>\n\t\t<template #actions v-if=\"step === 'site-plans'\">\n\t\t\t<Button\n\t\t\t\tvariant=\"solid\"\n\t\t\t\t:disabled=\"!plan || ($site?.doc && plan === $site.doc.plan)\"\n\t\t\t\t@click=\"handleNext()\"\n\t\t\t\tclass=\"w-full\"\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\t!$team.doc.payment_mode ||\n\t\t\t\t\t!$team.doc.billing_details ||\n\t\t\t\t\t!Object.keys(this.$team.doc.billing_details).length\n\t\t\t\t\t\t? 'Next'\n\t\t\t\t\t\t: $site.doc?.current_plan?.is_trial_plan\n\t\t\t\t\t\t\t? 'Upgrade Plan'\n\t\t\t\t\t\t\t: 'Change plan'\n\t\t\t\t}}\n\t\t\t</Button>\n\t\t</template>\n\t</Dialog>\n</template>\n<script>\nimport { getCachedDocumentResource, Progress } from 'frappe-ui';\nimport SitePlansCards from './SitePlansCards.vue';\nimport { getPlans, getPlan } from '../data/plans';\nimport CardForm from './billing/CardForm.vue';\nimport BillingDetails from './billing/BillingDetails.vue';\nimport PrepaidCreditsForm from './billing/PrepaidCreditsForm.vue';\n\nexport default {\n\tname: 'ManageSitePlansDialog',\n\tcomponents: {\n\t\tCardForm,\n\t\tProgress,\n\t\tSitePlansCards,\n\t\tBillingDetails,\n\t\tPrepaidCreditsForm,\n\t},\n\tprops: {\n\t\tsite: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tshow: true,\n\t\t\tplan: null,\n\t\t\tstep: 'site-plans',\n\t\t\tisAutomatedBilling: true,\n\t\t\tshowAddPaymentModeDialog: false,\n\t\t\tshowBillingDetailsDialog: false,\n\t\t};\n\t},\n\twatch: {\n\t\tsite: {\n\t\t\timmediate: true,\n\t\t\thandler(siteName) {\n\t\t\t\tif (siteName) {\n\t\t\t\t\tif (this.$site?.doc?.plan) {\n\t\t\t\t\t\tthis.plan = getPlan(this.$site.doc.plan);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\thandleNext() {\n\t\t\tif (\n\t\t\t\t!this.$team.doc.billing_details ||\n\t\t\t\t!Object.keys(this.$team.doc.billing_details).length\n\t\t\t) {\n\t\t\t\tthis.step = 'billing-details';\n\t\t\t\tthis.$team.reload();\n\t\t\t} else if (!this.$team.doc.payment_mode) {\n\t\t\t\tthis.step = 'add-payment-mode';\n\t\t\t} else {\n\t\t\t\tthis.changePlan();\n\t\t\t}\n\t\t},\n\t\tchangePlan() {\n\t\t\treturn this.$site.setPlan.submit(\n\t\t\t\t{ plan: this.plan.name },\n\t\t\t\t{\n\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\tthis.show = false;\n\t\t\t\t\t\tlet plan = getPlans().find(\n\t\t\t\t\t\t\t(plan) => plan.name === this.$site.doc.plan,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlet formattedPlan = plan\n\t\t\t\t\t\t\t? `${this.$format.planTitle(plan)}/mo`\n\t\t\t\t\t\t\t: this.$site.doc.plan;\n\t\t\t\t\t\tthis.$toast.success(`Plan changed to ${formattedPlan}`);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tpaymentModeAdded() {\n\t\t\tthis.$team.reload();\n\t\t\tthis.show = false;\n\t\t\tthis.$toast.success(\n\t\t\t\t'Payment mode added and the plan has been changed successfully',\n\t\t\t);\n\t\t\tthis.changePlan();\n\t\t},\n\t},\n\tcomputed: {\n\t\t$site() {\n\t\t\treturn getCachedDocumentResource('Site', this.site);\n\t\t},\n\t\tshowSetupSubscription() {\n\t\t\treturn (\n\t\t\t\t!this.$team.doc.payment_mode ||\n\t\t\t\t!this.$team.doc.billing_details ||\n\t\t\t\t!Object.keys(this.$team.doc.billing_details).length\n\t\t\t);\n\t\t},\n\t\tprogressLabel() {\n\t\t\tif (this.step === 'site-plans') {\n\t\t\t\treturn 'Select a plan';\n\t\t\t} else if (this.step === 'billing-details') {\n\t\t\t\treturn 'Add billing details';\n\t\t\t} else if (this.step === 'add-payment-mode') {\n\t\t\t\treturn 'Add payment mode';\n\t\t\t}\n\t\t},\n\t},\n};\n</script>\n"],"names":["_sfc_main","CardForm","Progress","SitePlansCards","BillingDetails","PrepaidCreditsForm","siteName","getPlan","plan","formattedPlan","_hoisted_2","_hoisted_3","_hoisted_5","_hoisted_7","$data","_cache","$event","_createSlots","_withCtx","_openBlock","_createElementBlock","_hoisted_1","$options","_createCommentVNode","_createElementVNode","_createTextVNode","_hoisted_4","_hoisted_6","_hoisted_8","_hoisted_9","_a","_toDisplayString","_ctx","_b"],"mappings":"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"}