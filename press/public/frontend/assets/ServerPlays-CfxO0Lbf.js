import b from"./CardWithDetails-8Q6clK2F.js";import{x as c,r as d,h as o,o as l,w as u,j as h,q as _,u as f,F as $,v as w,n as D,A as y,a5 as A,X as S,Y as R}from"./main-Dpl-JOF2.js";import{_ as C}from"./ListItem-CkkFcC1t.js";import{S as B}from"./StepsDetail-844EGZPD.js";import"./Card-BCzTSeNK.js";import"./CardDetails-BY8v0wfH.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="046e0ab2-1454-4cef-9a49-32406b4dd64d",e._sentryDebugIdIdentifier="sentry-dbid-046e0ab2-1454-4cef-9a49-32406b4dd64d")}catch(s){}})();{var p=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};p._sentryModuleMetadata=p._sentryModuleMetadata||{},p._sentryModuleMetadata[new Error().stack]=Object.assign({},p._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const x={name:"PlaysDetail",props:["playName"],components:{StepsDetail:B},inject:["viewportWidth"],resources:{play(){return{url:"press.api.server.play",params:{play:this.playName},auto:!!this.playName}}},data(){return{runningPlay:null}},computed:{play(){return this.$resources.play.data},subtitle(){if(this.play)return this.play.status=="Success"?`Completed ${this.formatDate(this.play.creation,"relative")} in ${this.$formatDuration(this.play.duration,"hh:mm:ss")}`:this.play.status=="Undelivered"?"play failed to start":null},steps(){if(this.play)return this.play.steps.map((e,t)=>({name:e.task,status:e.status,output:e.output,running:this.isStepRunning(e),completed:this.isStepCompleted(e,t)}))}},mounted(){this.$socket.emit("doc_subscribe","Ansible Play",this.playName),this.$socket.on("ansible_play_update",this.onAnsiblePlayUpdate)},unmounted(){this.$socket.emit("doc_unsubscribe","Ansible Play",this.playName),this.$socket.off("ansible_play_update",this.onAnsiblePlayUpdate),this.runningPlay=null},methods:{onAnsiblePlayUpdate(e){e.id===this.playName&&(this.runningPlay=e)},isStepRunning(e){if(!this.runningPlay)return!1;let t=this.runningPlay.steps.find(s=>s.name==e.step_name);return(t==null?void 0:t.status)==="Running"},isStepCompleted(e,t){return this.runningPlay?this.runningPlay.current.index>t:e.status==="Success"}}};function U(e,t,s,m,r,n){const i=d("StepsDetail");return l(),o(i,{showDetails:n.play,loading:e.$resources.play.loading,title:n.play?n.play.play:"",subtitle:n.subtitle,steps:n.steps},null,8,["showDetails","loading","title","subtitle","steps"])}const I=c(x,[["render",U]]),L={name:"AnsiblePlays",props:["title","subtitle","resource","playName","playRoute"],components:{PlaysDetail:I,CardWithDetails:b},data(){return{runningPlay:null}},resources:{plays(){return this.resource()}},mounted(){this.$socket.emit("doctype_subscribe","Ansible Play"),this.$socket.on("list_update",this.onAnsiblePlayUpdate)},unmounted(){this.$socket.emit("doctype_unsubscribe","Ansible Play"),this.$socket.off("list_update",this.onAnsiblePlayUpdate)},methods:{onAnsiblePlayUpdate(e){e.id===this.playName&&(this.runningPlay=e,this.runningPlay.status==="Success"&&setTimeout(()=>{this.$resources.plays.reset(),this.$resources.plays.reload()},1e3))}}},E={key:0,class:"py-3"};function V(e,t,s,m,r,n){const i=A,g=C,P=d("router-link"),N=S,k=d("PlaysDetail"),v=b;return l(),o(v,{title:s.title,subtitle:s.subtitle,showDetails:s.playName},{details:u(()=>[y(k,{playName:s.playName},null,8,["playName"])]),default:u(()=>[h("div",null,[(l(!0),_($,null,w(e.$resources.plays.data,a=>(l(),o(P,{class:D(["block cursor-pointer rounded-md px-2.5",s.playName===a.name?"bg-gray-100":"hover:bg-gray-50"]),key:a.name,to:s.playRoute(a)},{default:u(()=>[y(g,{title:a.play,description:e.formatDate(a.creation)},{actions:u(()=>[r.runningPlay&&r.runningPlay.id==a.name&&r.runningPlay.status!=="Success"?(l(),o(i,{key:0,label:r.runningPlay.status},null,8,["label"])):a.status!="Success"?(l(),o(i,{key:1,label:a.status},null,8,["label"])):f("",!0)]),_:2},1032,["title","description"]),t[1]||(t[1]=h("div",{class:"border-b"},null,-1))]),_:2},1032,["class","to"]))),128)),e.$resources.plays.hasNextPage?(l(),_("div",E,[y(N,{loading:e.$resources.plays.list.loading,loadingText:"Loading...",onClick:t[0]||(t[0]=a=>e.$resources.plays.next())},{default:u(()=>t[2]||(t[2]=[R(" Load more ")])),_:1},8,["loading"])])):f("",!0)])]),_:1},8,["title","subtitle","showDetails"])}const j=c(L,[["render",V]]),T={name:"ServerPlays",props:["serverName","playName"],components:{AnsiblePlays:j},methods:{plaResource(){return{type:"list",doctype:"Ansible Play",url:"press.api.server.plays",filters:{server:this.serverName},pageLength:10,start:0,auto:!0}},playRoute(e){return`/servers/${this.serverName}/plays/${e.name}`}}};function W(e,t,s,m,r,n){const i=d("AnsiblePlays");return l(),o(i,{title:"Plays",subtitle:"History of ansible plays that ran on your server",resource:n.plaResource,playName:s.playName,playRoute:n.playRoute},null,8,["resource","playName","playRoute"])}const O=c(T,[["render",W]]);export{O as default};
//# sourceMappingURL=ServerPlays-CfxO0Lbf.js.map
