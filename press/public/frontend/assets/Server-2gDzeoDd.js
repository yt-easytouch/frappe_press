var U=Object.defineProperty,j=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var I=(t,e,s)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$=(t,e)=>{for(var s in e||(e={}))R.call(e,s)&&I(t,s,e[s]);if(S)for(var s of S(e))F.call(e,s)&&I(t,s,e[s]);return t},D=(t,e)=>j(t,M(e));var E=(t,e,s)=>new Promise((i,o)=>{var r=n=>{try{d(s.next(n))}catch(a){o(a)}},v=n=>{try{d(s.throw(n))}catch(a){o(a)}},d=n=>n.done?i(n.value):Promise.resolve(n.value).then(r,v);d((s=s.apply(t,e)).next())});import{_ as C}from"./Tabs-d4e9i9wh.js";import{x as B,h as y,o as c,w as _,A as u,a8 as J,a9 as O,aA as z,r as V,q as h,u as m,j as l,X as q,C as K,t as p,a5 as X,k as H}from"./main-Dpl-JOF2.js";import{_ as L}from"./Breadcrumbs-yx7M4N4X.js";import{n as b}from"./toast-Dk0nDfLL.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="5311b280-3b6f-4365-a9e5-a7883a8164bf",t._sentryDebugIdIdentifier="sentry-dbid-5311b280-3b6f-4365-a9e5-a7883a8164bf")}catch(s){}})();{var g=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};g._sentryModuleMetadata=g._sentryModuleMetadata||{},g._sentryModuleMetadata[new Error().stack]=Object.assign({},g._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const Q={name:"EditServerTitleDialog",props:["modelValue","server"],emits:["update:modelValue"],data(){return{serverTitle:this.server.title}},resources:{editTitle(){var t;return{url:"press.api.server.rename",params:{name:(t=this.server)==null?void 0:t.name,title:this.serverTitle},validate(){var e;if(this.serverTitle===((e=this.server)==null?void 0:e.title))return"No changes in server title"},onSuccess(){this.show=!1,this.server.title=this.serverTitle}}}},computed:{show:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}}};function W(t,e,s,i,o,r){const v=J,d=O,n=z;return c(),y(n,{options:{title:"Edit Title",actions:[{label:"Update",variant:"solid",loading:t.$resources.editTitle.loading,onClick:()=>t.$resources.editTitle.submit()}]},modelValue:r.show,"onUpdate:modelValue":e[1]||(e[1]=a=>r.show=a)},{"body-content":_(()=>[u(v,{label:"Title",type:"text",modelValue:o.serverTitle,"onUpdate:modelValue":e[0]||(e[0]=a=>o.serverTitle=a)},null,8,["modelValue"]),u(d,{class:"mt-4",message:t.$resources.editTitle.error},null,8,["message"])]),_:1},8,["options","modelValue"])}const Y=B(Q,[["render",W]]),Z={name:"Server",pageMeta(){return{title:`Server - ${this.serverName} - Easytouch Cloud`}},props:["serverName"],components:{EditServerTitleDialog:Y,Tabs:C},data(){return{runningJob:!1,runningPlay:!1,showEditTitleDialog:!1,errorMessage:""}},resources:{server(){return{url:"press.api.server.get",params:{name:this.serverName},auto:!0,onSuccess(){this.routeToGeneral()},onError:this.$routeTo404PageIfNotFound}},reboot(){return{url:"press.api.server.reboot",params:{name:this.serverName},onSuccess(t){b({title:"Server Reboot Scheduled Successfully",color:"green",icon:"check"}),this.$resources.server.reload()},onError(){b({title:"An error occurred",color:"red",icon:"x"})}}}},methods:{routeToGeneral(){if(this.$route.matched.length===1){let t=this.$route.fullPath;this.$router.replace(`${t}/overview`)}}},computed:{server(){return this.$resources.server.data},regionInfo(){return!this.$resources.server.loading&&this.$resources.server.data?this.$resources.server.data.region_info:null},serverActions(){return[{label:"Edit Title",icon:"edit",onClick:()=>this.showEditTitleDialog=!0},{label:"Visit Server",icon:"external-link",condition:()=>["Active","Updating"].includes(this.server.status)&&this.$account.user.user_type==="System User",onClick:()=>{window.open(`https://${this.server.name}`,"_blank")}},{label:"View in Desk",icon:"external-link",condition:()=>this.$account.user.user_type=="System User",onClick:()=>{window.open(`${window.location.protocol}//${window.location.host}/app/${this.server.type}/${this.server.name}`,"_blank")}},{label:"Reboot",icon:"tool",condition:()=>this.server.status==="Active"&&this.$account.hasPermission(this.server.name,"press.api.server.reboot"),loading:this.$resources.reboot.loading,onClick:()=>this.$resources.reboot.submit()},{label:"Impersonate Team",icon:"tool",condition:()=>this.$account.user.user_type=="System User",onClick:()=>E(this,null,function*(){yield this.$account.switchTeam(this.server.team),b({title:"Switched Team",message:`Switched to ${this.server.team}`,icon:"check",color:"green"})})}]},tabs(){let t=i=>`/servers/${this.serverName}/${i}`,e=[{label:"Installing",route:"install"},{label:"Overview",route:"overview"},{label:"Analytics",route:"analytics"},{label:"Benches",route:"benches"},{label:"Jobs",route:"jobs",showRedDot:this.runningJob},{label:"Plays",route:"plays",showRedDot:this.runningPlay},{label:"Settings",route:"settings"}],s={Active:["Overview","Analytics","Benches","Jobs","Plays","Settings"],Pending:["Installing"],Installing:["Installing","Plays"]};if(this.server){let i=s[this.server.status];return i!=null&&i.length&&(e=e.filter(o=>i.includes(o.label))),e.map(o=>D($({},o),{route:t(o.route)}))}return[]}}},G={key:0},ee={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-5 py-2.5"},te={class:"flex flex-col space-y-3 px-5 py-3 md:flex-row md:items-baseline md:justify-between md:space-y-0"},re={class:"mt-2 flex items-center"},se={class:"text-2xl font-bold"},oe={key:0,class:"ml-2 hidden cursor-default flex-row items-center self-end rounded-md bg-yellow-50 px-3 py-1 text-xs font-medium text-yellow-700 md:flex"},ne=["src","alt","title"],le={class:"mb-10 flex flex-row justify-between md:hidden"},ie={class:"flex flex-row"},ae={key:0,class:"flex cursor-default flex-row items-center rounded-md bg-yellow-50 px-3 py-1 text-xs font-medium text-yellow-700"},ce=["src","alt","title"],ue={class:"p-5 pt-1"};function de(t,e,s,i,o,r){var w,x;const v=q,d=K,n=L,a=V("EditServerTitleDialog"),N=X,A=V("router-view"),P=C;return c(),h("div",null,[r.server?(c(),h("div",G,[l("div",null,[l("header",ee,[u(n,{items:[{label:"Servers",route:{name:"Servers"}},{label:(w=r.server)==null?void 0:w.title,route:{name:"ServerOverview",params:{serverName:(x=r.server)==null?void 0:x.name}}}]},{actions:_(()=>{var f;return[l("div",null,[((f=r.server)==null?void 0:f.status)==="Active"?(c(),y(v,{key:0,"icon-left":"plus",label:"New Bench",onClick:e[0]||(e[0]=k=>{var T;return t.$router.push({name:"NewServerBench",params:{server:(T=r.server)==null?void 0:T.name}})})})):m("",!0),u(d,{options:r.serverActions},{default:_(({open:k})=>[u(v,{variant:"ghost",class:"mr-2",icon:"more-horizontal"})]),_:1},8,["options"])])]}),_:1},8,["items"])]),u(a,{modelValue:o.showEditTitleDialog,"onUpdate:modelValue":e[1]||(e[1]=f=>o.showEditTitleDialog=f),server:r.server},null,8,["modelValue","server"]),l("div",te,[l("div",re,[l("h1",se,p(r.server.title),1),u(N,{class:"ml-4",label:r.server.status},null,8,["label"]),r.regionInfo?(c(),h("div",oe,[r.regionInfo.image?(c(),h("img",{key:0,class:"mr-2 h-4",src:r.regionInfo.image,alt:`Flag of ${r.regionInfo.title}`,title:r.regionInfo.image},null,8,ne)):m("",!0),l("p",null,p(r.regionInfo.title),1)])):m("",!0)]),l("div",le,[l("div",ie,[r.regionInfo?(c(),h("div",ae,[r.regionInfo.image?(c(),h("img",{key:0,class:"mr-2 h-4",src:r.regionInfo.image,alt:`Flag of ${r.regionInfo.title}`,title:r.regionInfo.image},null,8,ce)):m("",!0),l("p",null,p(r.regionInfo.title),1)])):m("",!0)])])])])])):m("",!0),l("div",ue,[u(P,{tabs:r.tabs},{default:_(()=>[u(A,null,{default:_(({Component:f,route:k})=>[r.server?(c(),y(H(f),{key:0,server:r.server},null,8,["server"])):m("",!0)]),_:1})]),_:1},8,["tabs"])])])}const ge=B(Z,[["render",de]]);export{ge as default};
//# sourceMappingURL=Server-2gDzeoDd.js.map
