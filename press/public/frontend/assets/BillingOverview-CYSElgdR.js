import{q as r,o as s,j as e,W as j,h as C,w as b,Z as t,F as L,aA as F,l as M,J as S,ac as B,u as k,A as o,t as x,X as A,aB as Y,ax as H,a6 as z,B as V,a4 as le,aC as N,aD as Z,v as se,k as J,aE as K,am as ne,C as W,a2 as $,Y as oe,aF as ie,z as de,D as re,P as ue,aG as ce}from"./main-Dpl-JOF2.js";import{_ as X}from"./AddPrepaidCreditsDialog-DtI4IApw.js";import{I as me}from"./InvoiceTable-D1HjWyXY.js";import{_ as pe}from"./BillingDetails-D_ZOfa0J.js";import{_ as ve}from"./CardForm-DBdGk3af.js";import"./PrepaidCreditsForm-DIaFhUMJ.js";import"./stripe.esm-D4yu_pm0.js";import"./StripeLogo-De_iztuU.js";(function(){try{var u=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},a=new Error().stack;a&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[a]="0ee6cc9c-79c7-4c98-8a4e-466f61be690c",u._sentryDebugIdIdentifier="sentry-dbid-0ee6cc9c-79c7-4c98-8a4e-466f61be690c")}catch(m){}})();{var O=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};O._sentryModuleMetadata=O._sentryModuleMetadata||{},O._sentryModuleMetadata[new Error().stack]=Object.assign({},O._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},_e=e("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[e("path",{d:"M4 2v20l2-1l2 1l2-1l2 1l2-1l2 1l2-1l2 1V2l-2 1l-2-1l-2 1l-2-1l-2 1l-2-1l-2 1l-2-1Z"}),e("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8m4 1V7"})],-1),ge=[_e];function ye(u,a){return s(),r("svg",fe,ge)}const he={name:"lucide-receipt",render:ye},be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xe=e("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[e("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),e("path",{d:"M2 10h20"})],-1),we=[xe];function ke(u,a){return s(),r("svg",be,we)}const Ce={name:"lucide-credit-card",render:ke},$e={key:0,class:"text-base text-gray-600"},Ve={key:1,class:"text-base text-gray-600"},De={__name:"UpcomingInvoiceDialog",props:{showInvoiceDialog:Boolean},setup(u){const{upcomingInvoice:a}=j("billing"),m=u;return(f,c)=>{const i=F;return s(),C(i,{modelValue:m.showInvoiceDialog,"onUpdate:modelValue":c[0]||(c[0]=d=>m.showInvoiceDialog=d),options:{size:"3xl",title:"Total usage for this month"}},{"body-content":b(()=>[t(a).data.upcoming_invoice?(s(),r(L,{key:0},[t(a).data.upcoming_invoice.status==="Empty"?(s(),r("div",$e," Nothing to show ")):(s(),C(me,{key:1,invoiceId:t(a).data.upcoming_invoice.name},null,8,["invoiceId"]))],64)):(s(),r("div",Ve,"Nothing to show"))]),_:1},8,["modelValue"])}}},Pe={class:"flex flex-col gap-4"},Ie={class:"flex flex-col rounded-lg text-base text-gray-900 shadow"},Me={class:"flex flex-col gap-2.5 px-4 py-3"},Ae={class:"flex items-center justify-between"},Be={class:"flex flex-col gap-1.5"},Se={class:"text-gray-700"},je={class:"flex items-center justify-between"},Ne={class:"flex gap-2 text-gray-700"},Ue={class:"font-medium text-gray-900"},Ee={key:0,class:"m-1.5 flex items-center justify-between rounded-lg bg-gray-50 px-2.5 py-2"},Re={class:"flex h-7 items-center gap-2 text-gray-800"},Oe={__name:"BillingSummary",setup(u){const a=j("team"),{currentBillingAmount:m,upcomingInvoice:f,unpaidInvoices:c}=j("billing"),i=M(!1),d=M(!1),h=S(()=>a.doc.currency=="INR"?"₹":"$"),_=B({url:"press.api.billing.total_unpaid_amount",cache:"unpaidAmount",auto:!0}),p=()=>{const P=new Date;return new Date(P.getFullYear(),P.getMonth()+1,0).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})};function D(){a.doc.payment_mode=="Prepaid Credits"?i.value=!0:v()}function v(){let P=c.data;if(P.length>1)a.doc.payment_mode==="Prepaid Credits"?i.value=!0:Y({title:"Multiple unpaid invoices",message:"You have multiple unpaid invoices. Please pay them from the invoices page",primaryAction:{label:"Go to invoices",variant:"solid",onClick:({hide:n})=>{H.push({name:"BillingInvoices"}),n()}}});else{let n=P;n.stripe_invoice_url&&a.doc.payment_mode==="Card"?window.open(`/api/method/press.api.client.run_doc_method?dt=Invoice&dn=${n.name}&method=stripe_payment_url`):i.value=!0}}return(P,n)=>{var R,g;const U=Ce,E=he;return s(),r("div",Pe,[e("div",Ie,[e("div",Me,[e("div",Ae,[e("div",Be,[n[5]||(n[5]=e("div",{class:"text-lg font-semibold"},"Recurring Charges",-1)),e("div",Se,[n[4]||(n[4]=e("span",null,"Next charge date — ",-1)),e("span",null,x(p()),1)])])]),e("div",je,[e("div",Ne,[o(U,{class:"h-4 w-4"}),e("div",null,[n[6]||(n[6]=e("span",null,"Current billing amount so far is ",-1)),e("span",Ue,x(h.value)+" "+x(((R=t(m))==null?void 0:R.toFixed(2))||"0.00"),1)])]),e("div",null,[o(t(A),{label:"View Invoice",onClick:n[0]||(n[0]=I=>d.value=!0)})])])]),t(_).data?(s(),r("div",Ee,[e("div",Re,[o(E,{class:"h-4 w-4"}),e("div",null,[n[7]||(n[7]=e("span",null,"Unpaid amount is ",-1)),e("span",null,x(h.value)+" "+x((g=t(_).data)==null?void 0:g.toFixed(2)),1)])]),e("div",null,[o(t(A),{variant:"solid",label:"Pay now",onClick:D})])])):k("",!0)]),i.value?(s(),C(X,{key:0,modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=I=>i.value=I),onSuccess:n[2]||(n[2]=I=>t(f).reload())},null,8,["modelValue"])):k("",!0),o(De,{modelValue:d.value,"onUpdate:modelValue":n[3]||(n[3]=I=>d.value=I)},null,8,["modelValue"])])}}},T={__name:"DropdownItem",props:{label:String,active:Boolean,onClick:Array},setup(u){return(a,m)=>(s(),r("div",null,[o(t(A),{class:"flex w-full justify-between rounded text-base",variant:"ghost",label:u.label,onClick:u.onClick},z({default:b(()=>[le(a.$slots,"default")]),_:2},[u.active?{name:"suffix",fn:b(()=>[o(t(V),{class:"h-4",name:"check"})]),key:"0"}:void 0]),1032,["label","onClick"])]))}},Te={key:0,class:"mb-5 inline-flex gap-1.5 text-base text-gray-700"},Ye={__name:"BillingDetailsDialog",props:N({showMessage:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:N(["success"],["update:modelValue"]),setup(u,{emit:a}){const m=a,f=Z(u,"modelValue"),c=M(null);return(i,d)=>(s(),C(t(F),{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=h=>f.value=h),options:{title:"Billing Details"}},{"body-content":b(()=>[u.showMessage?(s(),r("div",Te,[o(t(V),{class:"h-4",name:"info"}),d[2]||(d[2]=e("span",null," Add billing details to your account before proceeding.",-1))])):k("",!0),o(pe,{ref_key:"billingRef",ref:c,onSuccess:d[0]||(d[0]=()=>{f.value=!1,m("success")})},null,512)]),_:1},8,["modelValue"]))}},Fe={key:0,class:"mb-5 inline-flex gap-1.5 text-base text-gray-700"},ze={__name:"AddCardDialog",props:N({showMessage:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:N(["success"],["update:modelValue"]),setup(u,{emit:a}){const m=a,f=Z(u,"modelValue");return(c,i)=>(s(),C(t(F),{modelValue:f.value,"onUpdate:modelValue":i[1]||(i[1]=d=>f.value=d),options:{title:"Add new card"}},{"body-content":b(()=>[u.showMessage?(s(),r("div",Fe,[o(t(V),{class:"h-4",name:"info"}),i[2]||(i[2]=e("span",null," Add at least one card before changing the payment mode. ",-1))])):k("",!0),o(ve,{onSuccess:i[0]||(i[0]=()=>{f.value=!1,m("success")})})]),_:1},8,["modelValue"]))}},Le={key:0,class:"flex flex-col gap-2.5"},Ze={class:"flex gap-2"},qe={class:"flex h-7 items-center gap-1 font-medium"},He={class:"flex gap-1 text-gray-700"},Je={class:"text-gray-600"},Ke={key:0},We={__name:"ChangeCardDialog",props:{modelValue:{},modelModifiers:{}},emits:N(["success","addCard"],["update:modelValue"]),setup(u,{emit:a}){const m=a,f=Z(u,"modelValue"),c=B({url:"press.api.billing.get_payment_methods",cache:"cards",auto:!0}),i=_=>{B({url:"press.api.billing.set_as_default",params:{name:_},auto:!0,onSuccess:()=>{c.reload(),m("success")}})},d=M(!1),h=_=>{d.value=!0,Y({title:"Remove Card",message:"Are you sure you want to remove this card?",primaryAction:{label:"Remove",variant:"solid",theme:"red",onClick:({hide:p})=>{B({url:"press.api.billing.remove_payment_method",params:{name:_},auto:!0,onSuccess:()=>{c.reload(),d.value=!1,p()}})}},onSuccess:()=>{d.value=!1}})};return(_,p)=>(s(),r("div",null,[o(t(F),{modelValue:f.value,"onUpdate:modelValue":p[1]||(p[1]=D=>f.value=D),options:{title:"Choose active card"},disableOutsideClickToClose:d.value},{"body-content":b(()=>{var D;return[(D=t(c).data)!=null&&D.length?(s(),r("div",Le,[(s(!0),r(L,null,se(t(c).data,v=>(s(),r("div",{key:v.name,class:"flex justify-between gap-2 rounded p-2.5 text-base text-gray-900 hover:bg-gray-100"},[e("div",Ze,[(s(),C(J(t(K)(v.brand)),{class:"my-auto"})),e("div",null,[e("div",qe,[e("div",null,x(v.name_on_card),1),p[3]||(p[3]=e("div",null,"·",-1)),e("div",He,[p[2]||(p[2]=e("div",null,"Card ending in ••••",-1)),e("div",null,x(v.last_4),1)]),v.is_default?(s(),C(t(ne),{key:0,class:"ml-1.5",label:"Default",variant:"outline",theme:"green"})):k("",!0)]),e("div",Je," Expiry "+x(v.expiry_month<10?`0${v.expiry_month}`:v.expiry_month)+"/"+x(v.expiry_year),1)])]),t(c).data.length>1&&!v.is_default?(s(),r("div",Ke,[o(t(W),{options:[{label:"Set as default",onClick:()=>i(v.name),condition:()=>!v.is_default},{label:"Remove",onClick:()=>h(v.name)}]},{default:b(()=>[o(t(A),{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])])):k("",!0)]))),128))])):k("",!0)]}),actions:b(()=>[o(t(A),{label:"Add new card",class:"w-full",variant:"solid",onClick:p[0]||(p[0]=D=>m("addCard"))},{prefix:b(()=>[o(t(V),{name:"plus",class:"h-4"})]),_:1})]),_:1},8,["modelValue","disableOutsideClickToClose"])]))}},Xe={class:"flex flex-col gap-4"},Ge={class:"flex flex-col"},Qe={key:0,class:"flex items-center justify-between text-base text-gray-900"},et={class:"flex flex-col gap-1.5"},tt={class:"overflow-hidden text-ellipsis text-gray-700"},at={key:0,class:"inline-flex items-center gap-2"},lt={class:"text-gray-700"},st={key:1,class:"text-gray-700"},nt={class:"shrink-0"},ot={key:1,class:"my-3 h-px bg-gray-100"},it={class:"flex items-center justify-between text-base text-gray-900"},dt={class:"flex flex-col gap-1.5"},rt={key:0,class:"inline-flex items-center gap-2 text-gray-700"},ut={key:1,class:"text-gray-700"},ct={class:"shrink-0"},mt={class:"flex items-center justify-between text-base text-gray-900"},pt={class:"flex flex-col gap-1.5"},vt={class:"text-gray-700"},ft={class:"shrink-0"},_t={class:"flex items-center justify-between text-base text-gray-900"},gt={class:"flex flex-col gap-1.5"},yt={key:0,class:"leading-5 text-gray-700"},ht={key:1,class:"text-gray-700"},bt={class:"shrink-0"},xt={__name:"PaymentDetails",setup(u){const a=j("team"),{availableCredits:m,upcomingInvoice:f,currentBillingAmount:c,unpaidInvoices:i}=j("billing"),d=M(!1),h=M(!1),_=M(!1),p=M(!1),D=S(()=>a.doc.currency=="INR"?"₹":"$"),v=B({url:"press.api.account.get_billing_information",cache:"billingDetails",auto:!0}),P=B({url:"press.api.billing.change_payment_mode",onSuccess:()=>setTimeout(()=>a.reload(),1e3)}),n=S(()=>{let y=v.data;if(!y)return"";const{billing_name:l,address_line1:w,city:Q,state:ee,country:te,pincode:ae,gstin:q}=y||{};return[l,w,Q,ee,te,ae,q=="Not Applicable"?"":q].filter(Boolean).join(", ")}),U=[{label:"Card",value:"Card",description:"Your card will be charged for monthly subscription",component:()=>$(T,{label:"Card",active:a.doc.payment_mode==="Card",onClick:()=>I("Card")})},{label:"Prepaid credits",value:"Prepaid Credits",description:"You will be charged from your credit balance for monthly subscription",component:()=>$(T,{label:"Prepaid credits",active:a.doc.payment_mode==="Prepaid Credits",onClick:()=>I("Prepaid Credits")})},{label:"Paid by Partner",value:"Paid By Partner",condition:()=>a.doc.partner_email,description:"Your partner will be charged for monthly subscription",component:()=>$(T,{label:"Paid by Partner",active:a.doc.payment_mode==="Paid by Partner",onClick:()=>Y({title:"Confirm Payment Mode",message:"By changing the payment mode to <strong>Paid by Partner</strong>, following details will be shared with your partner: <br><br><li>Site/Server name</li> <li>Plan name</li><li>Number of days site/server is active</li><br>Are you sure you want to proceed?",primaryAction:{label:"Change Payment Mode",variant:"solid",onClick:({hide:y})=>{I("Paid By Partner"),y()}}})})},{component:()=>$("div",[$("div",{class:"border-t border-gray-200 my-1"}),$(T,null,{default:()=>$("div",{class:"flex gap-2"},[$("a",{href:"https://easytouch.cloud/payment-options",target:"_blank"},"Alternate Payment Methods"),$(V,{name:"external-link",class:"h-4"})])})])}],E=S(()=>U.find(y=>y.value===a.doc.payment_mode));function R(){let y=i.data;if(y.length>1)a.doc.payment_mode==="Prepaid Credits"?h.value=!0:Y({title:"Multiple unpaid invoices",message:"You have multiple unpaid invoices. Please pay them from the invoices page",primaryAction:{label:"Go to invoices",variant:"solid",onClick:({hide:l})=>{H.push({name:"BillingInvoices"}),l()}}});else{let l=y[0];l.stripe_invoice_url&&a.doc.payment_mode==="Card"?window.open(`/api/method/press.api.client.run_doc_method?dt=Invoice&dn=${l.name}&method=stripe_payment_url`):h.value=!0}}const g=M(!1);function I(y){if(g.value=!1,!n.value){g.value=!0,d.value=!0;return}if(y==="Prepaid Credits"&&a.doc.balance===0){g.value=!0,h.value=!0;return}else if(y==="Card"&&!a.doc.payment_method)g.value=!0,_.value=!0;else if(y==="Paid By Partner"&&i.data.length>0){if(i.data){R();return}if(c.value){const l=de(()=>re(()=>import("./FinalizeInvoicesDialog-Du3Hd19J.js"),__vite__mapDeps([0,1,2])));ie($(l));return}}P.loading||P.submit({mode:y})}function G(){a.doc.payment_method?p.value=!0:(g.value=!1,_.value=!0)}return(y,l)=>(s(),r(L,null,[e("div",Xe,[l[18]||(l[18]=e("div",{class:"text-lg font-semibold text-gray-900"},"Payment details",-1)),e("div",Ge,[t(a).doc.payment_mode=="Card"?(s(),r("div",Qe,[e("div",et,[l[12]||(l[12]=e("div",{class:"font-medium"},"Active Card",-1)),e("div",tt,[t(a).doc.payment_method?(s(),r("div",at,[(s(),C(J(t(K)(t(a).doc.payment_method.brand)))),e("div",lt,[e("span",null,x(t(a).doc.payment_method.name_on_card),1),l[11]||(l[11]=e("span",null," · Card ending in •••• ",-1)),e("span",null,x(t(a).doc.payment_method.last_4),1)])])):(s(),r("span",st,"No card added"))])]),e("div",nt,[o(t(A),{label:t(a).doc.payment_method?"Change card":"Add card",onClick:G},z({_:2},[t(a).doc.payment_method?void 0:{name:"prefix",fn:b(()=>[o(t(V),{class:"h-4",name:"plus"})]),key:"0"}]),1032,["label"])])])):k("",!0),t(a).doc.payment_mode=="Card"?(s(),r("div",ot)):k("",!0),e("div",it,[e("div",dt,[l[13]||(l[13]=e("div",{class:"font-medium"},"Mode of payment",-1)),t(a).doc.payment_mode?(s(),r("div",rt,[o(t(V),{class:"h-4",name:"info"}),oe(" "+x(E.value.description),1)])):(s(),r("span",ut,"Not set"))]),e("div",ct,[o(t(W),{options:U},{default:b(({open:w})=>[o(t(A),{label:t(a).doc.payment_mode?E.value.label:"Set mode"},{suffix:b(()=>[o(t(V),{name:w?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1})])]),l[16]||(l[16]=e("div",{class:"my-3 h-px bg-gray-100"},null,-1)),e("div",mt,[e("div",pt,[l[14]||(l[14]=e("div",{class:"font-medium"},"Credit balance",-1)),e("div",vt,x(t(m)||D.value+" 0.00"),1)]),e("div",ft,[o(t(A),{label:"Add credit",onClick:l[0]||(l[0]=()=>{if(g.value=!1,!n.value){g.value=!0,d.value=!0;return}h.value=!0})},{prefix:b(()=>[o(t(V),{class:"h-4",name:"plus"})]),_:1})])]),l[17]||(l[17]=e("div",{class:"my-3 h-px bg-gray-100"},null,-1)),e("div",_t,[e("div",gt,[l[15]||(l[15]=e("div",{class:"font-medium"},"Billing address",-1)),n.value?(s(),r("div",yt,x(n.value),1)):(s(),r("div",ht,"No address"))]),e("div",bt,[o(t(A),{label:n.value?"Edit ":"Add billing address",onClick:l[1]||(l[1]=()=>{g.value=!1,d.value=!0})},z({_:2},[n.value?void 0:{name:"prefix",fn:b(()=>[o(t(V),{class:"h-4",name:"plus"})]),key:"0"}]),1032,["label"])])])])]),d.value?(s(),C(Ye,{key:0,modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=w=>d.value=w),showMessage:g.value,onSuccess:l[3]||(l[3]=w=>t(v).reload())},null,8,["modelValue","showMessage"])):k("",!0),h.value?(s(),C(X,{key:1,modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=w=>h.value=w),showMessage:g.value,onSuccess:l[5]||(l[5]=w=>t(f).reload())},null,8,["modelValue","showMessage"])):k("",!0),_.value?(s(),C(ze,{key:2,modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=w=>_.value=w),showMessage:g.value,onSuccess:l[7]||(l[7]=()=>{g.value=!1,_.value=!1,t(a).reload()})},null,8,["modelValue","showMessage"])):k("",!0),p.value?(s(),C(We,{key:3,modelValue:p.value,"onUpdate:modelValue":l[8]||(l[8]=w=>p.value=w),onAddCard:l[9]||(l[9]=()=>{p.value=!1,_.value=!0}),onSuccess:l[10]||(l[10]=()=>t(a).reload())},null,8,["modelValue"])):k("",!0)],64))}},wt={key:0,class:"flex flex-1 flex-col gap-8 overflow-y-auto px-60 pt-6"},kt={key:1,class:"mt-12 flex flex-1 items-center justify-center"},Bt={__name:"BillingOverview",setup(u){const a=j("team"),m=B({url:"press.api.billing.upcoming_invoice",cache:"upcomingInvoice",auto:!0}),f=B({url:"press.api.billing.get_unpaid_invoices",cache:["unpaidInvoices",a.name],auto:!0});return ue("billing",{upcomingInvoice:m,availableCredits:S(()=>{var c;return(c=m.data)==null?void 0:c.available_credits}),currentBillingAmount:S(()=>{var c,i;return(i=(c=m.data)==null?void 0:c.upcoming_invoice)==null?void 0:i.total}),unpaidInvoices:f}),(c,i)=>t(a).doc?(s(),r("div",wt,[o(Oe),o(xt)])):(s(),r("div",kt,[o(t(ce),{class:"h-8"})]))}};export{Bt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/FinalizeInvoicesDialog-Du3Hd19J.js","assets/main-Dpl-JOF2.js","assets/main-B0ZLDivw.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=BillingOverview-CYSElgdR.js.map
