import{x as g,ao as C,aZ as B,bg as k,r as p,q as m,o as c,A as n,a9 as h,aA as w,w as a,u as b,F as x,X as E,Y as _,j as l,t as u,a8 as j,aH as L,V as M}from"./main-Dpl-JOF2.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="87bf9413-9afa-4254-8b02-73b8c5148c6c",e._sentryDebugIdIdentifier="sentry-dbid-87bf9413-9afa-4254-8b02-73b8c5148c6c")}catch(y){}})();{var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};i._sentryModuleMetadata=i._sentryModuleMetadata||{},i._sentryModuleMetadata[new Error().stack]=Object.assign({},i._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const P={name:"PartnerCustomerInvoices",props:["customerTeam","customerCurrency"],components:{ObjectList:C},data(){return{team:this.customerTeam,currency:this.customerCurrency}},computed:{options(){return{doctype:"Invoice",fields:["type"],columns:[{label:"Invoice",fieldname:"name"},{label:"Status",fieldname:"status",type:"Badge"},{label:"Date",fieldname:"due_date",format(e){return Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}},{label:"Total",fieldname:"total",format:this.formatCurrency},{label:"Amount Due",fieldname:"amount_due",format:this.formatCurrency}],filters:{team:this.team,due_date:[">=",k().subtract(5,"month").endOf("month").format("YYYY-MM-DD")],partner_customer:!0}}}},methods:{formatCurrency(e){return e===0?"":B(e,this.currency)}}};function O(e,t,y,D,r,s){const d=p("ObjectList");return c(),m("div",null,[n(d,{options:s.options},null,8,["options"])])}const F=g(P,[["render",O]]),N={name:"PartnerCustomers",components:{PartnerCustomerInvoices:F,Dialog:w,ErrorMessage:h,ObjectList:C},data(){return{contributionDialog:!1,showInvoice:null,transferCreditsDialog:!1,customerTeam:null,amount:0,showConfirmationDialog:!1}},resources:{transferCredits(){return{url:"press.api.partner.transfer_credits",onSuccess(e){this.amount=e,this.transferCreditsDialog=!1,this.showConfirmationDialog=!0,M.success("Credits Transferred")}}},getBalance:{url:"press.api.billing.get_balance_credit",auto:!0}},computed:{partnerCustomerList(){return{resource(){return{url:"press.api.partner.get_partner_customers",transform(e){return e.map(t=>({email:t.user,billing_name:t.billing_name||"",payment_mode:t.payment_mode||"",currency:t.currency,name:t.name}))},initialData:[],auto:!0}},columns:[{label:"Name",fieldname:"billing_name"},{label:"Email",fieldname:"email"},{label:"Payment Mode",fieldname:"payment_mode"},{label:"Currency",fieldname:"currency",width:.5},{label:"Contributions",type:"Button",width:.5,align:"center",Button:({row:e})=>({label:"View",onClick:()=>{this.showInvoice=e,this.contributionDialog=!0}})},{label:"",type:"Button",width:.8,align:"right",key:"actions",Button:({row:e})=>({label:"Transfer Credits",onClick:()=>{this.transferCreditsDialog=!0,this.customerTeam=e}})}]}}},methods:{formatCurrency(e){return e===0?"":L(e)},creditBalance(){return this.formatCurrency(parseFloat(this.$resources.getBalance.data)-parseFloat(this.amount))}}},A={class:"p-4"},S={key:0,class:"text-base text-gray-600"},U={class:"pb-3 text-p-base"},Y={class:"text-p-base"},q={class:"text-base font-medium text-gray-700"};function z(e,t,y,D,r,s){const d=p("ObjectList"),v=p("PartnerCustomerInvoices"),f=w,V=j,I=h,T=E;return c(),m("div",A,[n(d,{options:s.partnerCustomerList},null,8,["options"]),n(f,{modelValue:r.contributionDialog,"onUpdate:modelValue":t[0]||(t[0]=o=>r.contributionDialog=o),options:{size:"3xl",title:"Last 6 Month's Contribution"}},{"body-content":a(()=>[r.showInvoice?(c(),m(x,{key:0},[r.showInvoice.status==="Empty"?(c(),m("div",S," Nothing to show ")):b("",!0),n(v,{customerTeam:r.showInvoice.name,customerCurrency:r.showInvoice.currency},null,8,["customerTeam","customerCurrency"])],64)):b("",!0)]),_:1},8,["modelValue"]),n(f,{modelValue:r.transferCreditsDialog,"onUpdate:modelValue":t[3]||(t[3]=o=>r.transferCreditsDialog=o),options:{title:"Transfer Credits"}},{"body-content":a(()=>[l("p",U," Enter the equivalent amount of credits (in "+u(e.$team.doc.currency)+") you wish to transfer. ",1),n(V,{placeholder:"Amount",modelValue:r.amount,"onUpdate:modelValue":t[1]||(t[1]=o=>r.amount=o),autocomplete:"off"},null,8,["modelValue"]),n(I,{class:"mt-2",message:e.$resources.transferCredits.error},null,8,["message"])]),actions:a(()=>[n(T,{type:"primary",variant:"solid",class:"w-full",loading:e.$resources.transferCredits.loading,onClick:t[2]||(t[2]=o=>e.$resources.transferCredits.submit({amount:r.amount,customer:r.customerTeam.name,partner:e.$team.doc.name}))},{default:a(()=>t[5]||(t[5]=[_(" Transfer ")])),_:1},8,["loading"])]),_:1},8,["modelValue"]),n(f,{modelValue:r.showConfirmationDialog,"onUpdate:modelValue":t[4]||(t[4]=o=>r.showConfirmationDialog=o),options:{title:"Credits Transferred Successfully"}},{"body-content":a(()=>[l("p",Y,[_(u(s.formatCurrency(r.amount))+" credits have been transferred to ",1),l("strong",null,u(r.customerTeam.billing_name),1)]),l("span",q,"Credits available: "+u(s.creditBalance()),1)]),_:1},8,["modelValue"])])}const K=g(N,[["render",z]]);export{K as default};
//# sourceMappingURL=PartnerCustomers-CZ-CYR4N.js.map
