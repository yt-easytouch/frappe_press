import{x as B,q as g,o as n,j as y,v as A,F as T,n as S,an as U,r as D,A as s,u as J,a8 as $,a9 as R,w as o,h as d,Y as v,B as M,y as F,bW as V,bg as x}from"./main-Dpl-JOF2.js";import{_ as L}from"./BarChart-CKiFk9xA.js";import{_ as z}from"./LineChart-BDXlcfBY.js";import{D as q}from"./datetime-PXpIdgFA.js";import{A as N}from"./AnalyticsCard-Cbt3l-Ja.js";import"./Card-BCzTSeNK.js";import"./tailwind.theme-XeumNAwU.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="1d0b79fb-9dac-45da-ac64-adecbba9e143",e._sentryDebugIdIdentifier="sentry-dbid-1d0b79fb-9dac-45da-ac64-adecbba9e143")}catch(r){}})();{var f=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};f._sentryModuleMetadata=f._sentryModuleMetadata||{},f._sentryModuleMetadata[new Error().stack]=Object.assign({},f._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const I={name:"SiteUptime",props:["data","loading"],computed:{uptimeTypes(){return[{key:"value",label:"Web"}]},subtitle(){if(!this.data)return"";let e=0,a=0;for(;a<this.data.length&&typeof this.data[a].value=="number";a++)e+=this.data[a].value;const r=(e/a*100).toFixed(2);return isNaN(r)?"":`Average: ${r}%`}},methods:{formatDate(e){return q.fromSQL(e).toLocaleString(q.DATETIME_FULL)}}},E={key:0,class:"flex h-5/6 items-center justify-center"},Q={class:"flex h-10 justify-between"},O=["title"];function W(e,a,r,p,u,t){return!r.data||r.data[0].date===void 0?(n(),g("div",E,a[0]||(a[0]=[y("div",{class:"text-base text-gray-700"},"No data",-1)]))):(n(!0),g(T,{key:1},A(t.uptimeTypes,h=>(n(),g("div",{class:"mx-4 mt-8",key:h.key},[y("div",Q,[(n(!0),g(T,null,A(r.data,c=>(n(),g("div",{key:c.date,class:S(["w-1.5 rounded",[c[h.key]===void 0?"bg-white":c[h.key]===1?"bg-green-500":c[h.key]===0?"bg-red-500":"bg-yellow-500"]]),title:c[h.key]?`${t.formatDate(c.date)} | Uptime: ${(c.value*100).toFixed(2)}%`:""},null,10,O))),128))])]))),128))}const K=B(I,[["render",W]]),Y={name:"SiteAnalytics",props:["name"],components:{BarChart:L,LineChart:z,SiteUptime:K,AlertBanner:U,AnalyticsCard:N},data(){return{duration:"24h",showAdvancedAnalytics:!1,localTimezone:x.tz.guess(),slowLogsDurationType:"Denormalized",slowLogsFrequencyType:"Denormalized",durationOptions:[{label:"Duration",value:null,disabled:!0},{label:"1 hour",value:"1h"},{label:"6 hours",value:"6h"},{label:"24 hours",value:"24h"},{label:"7 days",value:"7d"},{label:"15 days",value:"15d"}]}},resources:{analytics(){return{url:"press.api.analytics.get",params:{name:this.name,timezone:this.localTimezone,duration:this.duration},auto:!0}},advancedAnalytics(){return{url:"press.api.analytics.get_advanced_analytics",params:{name:this.name,timezone:this.localTimezone,duration:this.duration},auto:this.showAdvancedAnalytics}},slowLogsCount(){return{url:"press.api.analytics.get_slow_logs_by_query",params:{name:this.name,agg_type:"count",timezone:this.localTimezone,duration:this.duration,normalize:this.slowLogsFrequencyType==="Normalized"},auto:this.showAdvancedAnalytics}},slowLogsDuration(){return{url:"press.api.analytics.get_slow_logs_by_query",params:{name:this.name,agg_type:"duration",timezone:this.localTimezone,duration:this.duration,normalize:this.slowLogsDurationType==="Normalized"},auto:this.showAdvancedAnalytics}}},computed:{requestChartColors(){return[this.$theme.colors.green[500],this.$theme.colors.red[500],this.$theme.colors.yellow[500],this.$theme.colors.pink[500],this.$theme.colors.purple[500],this.$theme.colors.blue[500],this.$theme.colors.teal[500],this.$theme.colors.cyan[500],this.$theme.colors.gray[500],this.$theme.colors.orange[500]]},usageCounterData(){var r,p;let e=(r=this.$resources.analytics.data)==null?void 0:r.usage_counter;if(!e)return;let a=(p=this.$resources.analytics.data)==null?void 0:p.plan_limit;return{datasets:[e.map(u=>[+new Date(u.date),u.value/1e6])],markLine:{data:[{name:"Daily Compute Limit",yAxis:a,label:{formatter:"{b}: {c} seconds",position:"middle"},lineStyle:{color:"#f5222d"}}],symbol:["none","none"]}}},requestCountData(){var a;let e=(a=this.$resources.analytics.data)==null?void 0:a.request_count;if(e)return{datasets:[e.map(r=>[+new Date(r.date),r.value])]}},requestCountByPathData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.request_count_by_path;if(e)return e},requestDurationByPathData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.request_duration_by_path;if(e)return e},averageRequestDurationByPathData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.average_request_duration_by_path;if(e)return e},backgroundJobCountByMethodData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.background_job_count_by_method;if(e)return e},backgroundJobDurationByMethodData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.background_job_duration_by_method;if(e)return e},averageBackgroundJobDurationByMethodData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.average_background_job_duration_by_method;if(e)return e},slowLogsDurationData(){const e=this.$resources.slowLogsDuration.data;if(e)return e},slowLogsCountData(){const e=this.$resources.slowLogsCount.data;if(e)return e},requestTimeData(){var a;let e=(a=this.$resources.analytics.data)==null?void 0:a.request_cpu_time;if(e)return{datasets:[e.map(r=>[+new Date(r.date),r.value/1e6])]}},jobCountData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.job_count;if(e)return{datasets:[e.map(r=>[+new Date(r.date),r.value])]}},jobTimeData(){var a;let e=(a=this.$resources.advancedAnalytics.data)==null?void 0:a.job_cpu_time;if(e)return{datasets:[e.map(r=>[+new Date(r.date),r.value/1e6])]}}},methods:{toggleAdvancedAnalytics(){this.showAdvancedAnalytics=!this.showAdvancedAnalytics}}},H={class:"space-y-4 p-5"},X={class:"flex space-x-4"},Z={class:"grid grid-cols-1 gap-5 sm:grid-cols-2"},G={key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2"};function ee(e,a,r,p,u,t){const h=$,c=R,b=z,l=D("AnalyticsCard"),P=D("SiteUptime"),_=D("router-link"),j=M,m=L,w=F,C=V;return n(),g("div",H,[y("div",X,[s(h,{class:"ml-auto w-32",type:"select",options:u.durationOptions,modelValue:u.duration,"onUpdate:modelValue":a[0]||(a[0]=i=>u.duration=i)},null,8,["options","modelValue"])]),s(c,{message:e.$resources.analytics.error||e.$resources.advancedAnalytics.error},null,8,["message"]),y("div",Z,[s(l,{title:"Daily Usage"},{default:o(()=>[(n(),d(b,{type:"time",title:"Usage Counter",key:t.usageCounterData,data:t.usageCounterData,unit:"seconds",chartTheme:[e.$theme.colors.purple[500]],loading:e.$resources.analytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{title:"Uptime"},{default:o(()=>{var i,k;return[s(P,{data:(k=(i=e.$resources.analytics)==null?void 0:i.data)==null?void 0:k.uptime,loading:e.$resources.analytics.loading,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","loading"])]}),_:1}),s(l,{title:"Requests"},{action:o(()=>[s(_,{class:"text-base text-gray-600 hover:text-gray-700",to:{name:"Site Performance Request Logs"}},{default:o(()=>a[4]||(a[4]=[v(" Request Log Report → ")])),_:1})]),default:o(()=>[(n(),d(b,{type:"time",title:"Requests",key:t.requestCountData,data:t.requestCountData,unit:"requests",chartTheme:[e.$theme.colors.green[500]],loading:e.$resources.analytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{title:"Requests CPU Usage"},{default:o(()=>[(n(),d(b,{type:"time",title:"Requests CPU Usage",key:t.requestTimeData,data:t.requestTimeData,unit:"seconds",chartTheme:[e.$theme.colors.yellow[500]],loading:e.$resources.analytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1})]),y("div",{class:"!mt-6 flex w-fit cursor-pointer space-x-2",onClick:a[1]||(a[1]=(...i)=>t.toggleAdvancedAnalytics&&t.toggleAdvancedAnalytics(...i))},[a[5]||(a[5]=y("h2",{class:"text-lg font-semibold"},"Advanced Analytics",-1)),s(j,{class:"h-5 w-5 text-gray-500 hover:text-gray-700",name:u.showAdvancedAnalytics?"chevron-down":"chevron-right"},null,8,["name"])]),u.showAdvancedAnalytics?(n(),g("div",G,[s(l,{title:"Background Jobs"},{default:o(()=>[(n(),d(b,{type:"time",title:"Background Jobs",key:t.jobCountData,data:t.jobCountData,unit:"jobs",chartTheme:[e.$theme.colors.red[500]],loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{title:"Background Jobs CPU Usage"},{default:o(()=>[(n(),d(b,{type:"time",title:"Background Jobs CPU Usage",key:t.jobTimeData,data:t.jobTimeData,unit:"seconds",chartTheme:[e.$theme.colors.blue[500]],loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Frequent Requests"},{default:o(()=>[(n(),d(m,{title:"Request Count by Path",key:t.requestCountByPathData,data:t.requestCountByPathData,unit:"requests",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Slowest Requests"},{default:o(()=>[(n(),d(m,{key:t.requestDurationByPathData,data:t.requestDurationByPathData,unit:"seconds",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Individual Request Time (Average)"},{default:o(()=>[(n(),d(m,{key:t.averageRequestDurationByPathData,data:t.averageRequestDurationByPathData,unit:"seconds",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Frequent Background Jobs"},{default:o(()=>[(n(),d(m,{key:t.backgroundJobCountByMethodData,data:t.backgroundJobCountByMethodData,unit:"jobs",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Slowest Background Jobs"},{default:o(()=>[(n(),d(m,{key:t.backgroundJobDurationByMethodData,data:t.backgroundJobDurationByMethodData,unit:"seconds",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Individual Background Job Time (Average)"},{default:o(()=>[(n(),d(m,{key:t.averageBackgroundJobDurationByMethodData,data:t.averageBackgroundJobDurationByMethodData,unit:"seconds",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Frequent Slow Queries"},{action:o(()=>[s(w,{text:"Show Detailed Reports"},{default:o(()=>[s(_,{class:"ml-2 mr-auto text-base text-gray-600 hover:text-gray-700",to:{name:"Site Performance Slow Queries"}},{default:o(()=>a[6]||(a[6]=[v(" → ")])),_:1})]),_:1}),s(C,{buttons:[{label:"Denormalized"},{label:"Normalized"}],modelValue:u.slowLogsFrequencyType,"onUpdate:modelValue":a[2]||(a[2]=i=>u.slowLogsFrequencyType=i)},null,8,["modelValue"])]),default:o(()=>[(n(),d(m,{key:t.slowLogsCountData,data:t.slowLogsCountData,unit:"queries",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1}),s(l,{class:"sm:col-span-2",title:"Top Slow Queries"},{action:o(()=>[s(w,{text:"Show Detailed Reports"},{default:o(()=>[s(_,{class:"ml-2 mr-auto text-base text-gray-600 hover:text-gray-700",to:{name:"Site Performance Slow Queries"}},{default:o(()=>a[7]||(a[7]=[v(" → ")])),_:1})]),_:1}),s(C,{buttons:[{label:"Denormalized"},{label:"Normalized"}],modelValue:u.slowLogsDurationType,"onUpdate:modelValue":a[3]||(a[3]=i=>u.slowLogsDurationType=i)},null,8,["modelValue"])]),default:o(()=>[(n(),d(m,{key:t.slowLogsDurationData,data:t.slowLogsDurationData,unit:"seconds",chartTheme:t.requestChartColors,loading:e.$resources.advancedAnalytics.loading,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading"]))]),_:1})])):J("",!0)])}const ue=B(Y,[["render",ee]]);export{ue as default};
//# sourceMappingURL=SiteAnalytics-Bod8TJDe.js.map
