{"version":3,"file":"TagsDialog-CQrOPzan.js","sources":["../../../../dashboard/src2/components/Autocomplete.vue","../../../../dashboard/src2/dialogs/TagsDialog.vue"],"sourcesContent":["<template>\n\t<div class=\"relative space-y-1.5\">\n\t\t<label class=\"block text-xs text-gray-600\" v-if=\"label\">\n\t\t\t{{ label }}\n\t\t</label>\n\t\t<Combobox\n\t\t\t:modelValue=\"value\"\n\t\t\t@update:modelValue=\"\n\t\t\t\tval => {\n\t\t\t\t\temit('update:modelValue', val?.value);\n\t\t\t\t}\n\t\t\t\"\n\t\t\tv-slot=\"{ open }\"\n\t\t\t:nullable=\"nullable\"\n\t\t\t:multiple=\"multiple\"\n\t\t>\n\t\t\t<Popover class=\"w-full\" ref=\"rootRef\">\n\t\t\t\t<template #target=\"{ togglePopover }\">\n\t\t\t\t\t<ComboboxButton v-show=\"false\" ref=\"comboboxButton\"></ComboboxButton>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"border-outline-gray-1 bg-surface-gray-1 text-text-icons-gray-8 hover:border-outline-gray-2 hover:bg-surface-gray-1 form-input flex h-7 w-full items-center justify-between gap-2 rounded p-0 text-sm transition-colors\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ComboboxInput\n\t\t\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\t\t\t@focus=\"\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\ttogglePopover();\n\t\t\t\t\t\t\t\t\tif (!open.value) {\n\t\t\t\t\t\t\t\t\t\t$refs.comboboxButton?.$el.click();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t@change=\"handleQueryChange\"\n\t\t\t\t\t\t\t:displayValue=\"getDisplayValue\"\n\t\t\t\t\t\t\t:placeholder=\"!modelValue ? placeholder : null\"\n\t\t\t\t\t\t\tclass=\"focus:ring-outline-gray-3 h-full w-full rounded border border-gray-100 bg-gray-100 bg-transparent pl-2 pr-5 text-base text-gray-800 placeholder-gray-500 transition-colors focus:border-gray-500 focus:bg-white focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template #body=\"{ isOpen, togglePopover }\">\n\t\t\t\t\t<div v-show=\"isOpen\">\n\t\t\t\t\t\t<ComboboxOptions\n\t\t\t\t\t\t\tclass=\"bg-surface-white absolute right-0 z-[999] max-h-[15rem] w-full overflow-y-auto rounded-lg p-0 shadow-2xl\"\n\t\t\t\t\t\t\tv-show=\"filteredOptions.length\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"w-full list-none bg-white px-1.5 py-1.5\">\n\t\t\t\t\t\t\t\t<ComboboxOption\n\t\t\t\t\t\t\t\t\tv-for=\"option in filteredOptions\"\n\t\t\t\t\t\t\t\t\tv-slot=\"{ active, selected }\"\n\t\t\t\t\t\t\t\t\t:key=\"option.value\"\n\t\t\t\t\t\t\t\t\t:value=\"option\"\n\t\t\t\t\t\t\t\t\t:disabled=\"String(option.value).startsWith('_separator')\"\n\t\t\t\t\t\t\t\t\t:title=\"option.label\"\n\t\t\t\t\t\t\t\t\tclass=\"flex items-center\"\n\t\t\t\t\t\t\t\t\t@click=\"\n\t\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\t\tif (!open.value) {\n\t\t\t\t\t\t\t\t\t\t\t\t$refs.comboboxButton?.$el.click();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tv-if=\"String(option.value).startsWith('_separator')\"\n\t\t\t\t\t\t\t\t\t\tclass=\"!text-text-icons-gray-5 flex w-full items-center gap-2 px-2.5 pb-2 pt-3 text-xs font-medium\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ option.label }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t\t\tclass=\"flex w-full cursor-pointer select-none items-center justify-between truncate rounded px-2.5 py-1.5 text-base\"\n\t\t\t\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t\t\t\t'bg-gray-100': active,\n\t\t\t\t\t\t\t\t\t\t\t'bg-gray-300': selected\n\t\t\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ option.label }}\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ComboboxOption>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"border-outline-gray-2 bg-surface-gray-1 sticky bottom-0 rounded-b-sm border-t\"\n\t\t\t\t\t\t\t\tv-if=\"actionButton\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t\t:is=\"actionButton.component\"\n\t\t\t\t\t\t\t\t\tv-if=\"actionButton?.component\"\n\t\t\t\t\t\t\t\t\t@change=\"updateOptions\"\n\t\t\t\t\t\t\t\t></component>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t\t:iconLeft=\"actionButton.icon\"\n\t\t\t\t\t\t\t\t\tclass=\"text-text-icons-gray-8 w-full rounded-none text-xs\"\n\t\t\t\t\t\t\t\t\t@click=\"actionButton.handler\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ actionButton.label }}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</ComboboxOptions>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</Popover>\n\t\t</Combobox>\n\t\t<div\n\t\t\tclass=\"text-text-icons-gray-4 hover:text-text-icons-gray-5 absolute right-[1px] top-[3px] cursor-pointer p-1\"\n\t\t\t@click=\"clearValue\"\n\t\t\tv-show=\"modelValue\"\n\t\t>\n\t\t\t<FeatherIcon name=\"x\" class=\"mt-3.5 h-4 w-4 stroke-gray-700\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n\tCombobox,\n\tComboboxButton,\n\tComboboxInput,\n\tComboboxOption,\n\tComboboxOptions\n} from '@headlessui/vue';\nimport { ComputedRef, PropType, computed, ref, watch } from 'vue';\nimport { Popover } from 'frappe-ui';\n\ntype Option = {\n\tlabel: string;\n\tvalue: string;\n};\n\nconst emit = defineEmits(['update:modelValue']);\n\ntype Action = {\n\tlabel: String;\n\thandler: () => void;\n\ticon: string;\n\tcomponent?: any;\n};\n\nconst props = defineProps({\n\toptions: {\n\t\ttype: Array as PropType<Option[]>,\n\t\tdefault: () => []\n\t},\n\tmodelValue: {},\n\tplaceholder: {\n\t\ttype: String,\n\t\tdefault: ''\n\t},\n\tlabel: {\n\t\ttype: String,\n\t\tdefault: ''\n\t},\n\t// Allow user to input value that is not in the options\n\tallowInputAsOption: {\n\t\ttype: Boolean,\n\t\tdefault: false\n\t},\n\tactionButton: {\n\t\ttype: Object as PropType<Action>,\n\t\tdefault: null\n\t}\n});\n\nconst query = ref('');\nconst multiple = computed(() => Array.isArray(props.modelValue));\nconst nullable = computed(() => !multiple.value);\nconst filteredOptions = ref(props.options);\n\nconst getDisplayValue = (option: Option | Option[]) => {\n\tif (Array.isArray(option)) {\n\t\treturn option.map(o => o.label).join(', ');\n\t} else if (option) {\n\t\treturn option.label || option.value || '';\n\t} else {\n\t\treturn '';\n\t}\n};\n\nconst value = computed(() => {\n\tif (!props.modelValue) {\n\t\treturn null;\n\t}\n\treturn (\n\t\tfilteredOptions.value.find(option => option.value === props.modelValue) || {\n\t\t\tlabel: props.modelValue,\n\t\t\tvalue: props.modelValue\n\t\t}\n\t);\n}) as ComputedRef<Option>;\n\nwatch(() => query.value || props.options, updateOptions, { immediate: true });\n\nasync function updateOptions() {\n\tif (!query.value) {\n\t\tfilteredOptions.value = props.options;\n\t} else {\n\t\tfilteredOptions.value = props.options.filter(option => {\n\t\t\tconst label = option.label.toLowerCase();\n\t\t\tconst value = option.label.toLowerCase();\n\t\t\tconst queryLower = query.value.toLowerCase();\n\t\t\treturn label.includes(queryLower) || value.includes(query.value);\n\t\t});\n\t}\n}\n\nfunction handleQueryChange(event: Event) {\n\tquery.value = (event.target as HTMLInputElement).value;\n\tif (props.allowInputAsOption && !filteredOptions.value.length) {\n\t\temit('update:modelValue', query.value);\n\t}\n}\n\nconst clearValue = () => emit('update:modelValue', null);\n</script>\n","<template>\n\t<Dialog v-model=\"showDialog\" :options=\"{ title: 'Add Tag' }\">\n\t\t<template #body-content>\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t<PressAutocomplete\n\t\t\t\t\t\tv-model=\"selectedTag\"\n\t\t\t\t\t\t:options=\"tagOptions\"\n\t\t\t\t\t\tlabel=\"Select or create a tag\"\n\t\t\t\t\t\t:allowInputAsOption=\"true\"\n\t\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tlabel=\"Add\"\n\t\t\t\t\t\ticon-left=\"plus\"\n\t\t\t\t\t\t@click=\"addTag\"\n\t\t\t\t\t\tclass=\"mt-5\"\n\t\t\t\t\t\t:disabled=\"!selectedTag\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script>\nimport { ErrorMessage, getCachedDocumentResource } from 'frappe-ui';\nimport { toast } from 'vue-sonner';\nimport Autocomplete from '../components/Autocomplete.vue';\n\nexport default {\n\tname: 'TagsDialog',\n\tprops: ['docname', 'doctype'],\n\tcomponents: { ErrorMessage, PressAutocomplete: Autocomplete },\n\tdata() {\n\t\treturn {\n\t\t\tshowDialog: true,\n\t\t\tnewTag: '',\n\t\t\tselectedTag: null\n\t\t};\n\t},\n\tresources: {\n\t\tavailableTags() {\n\t\t\treturn {\n\t\t\t\ttype: 'list',\n\t\t\t\tdoctype: 'Press Tag',\n\t\t\t\tfilters: { doctype_name: this.doctype },\n\t\t\t\tfields: ['tag'],\n\t\t\t\tpageLength: 1000,\n\t\t\t\tauto: true\n\t\t\t};\n\t\t}\n\t},\n\tcomputed: {\n\t\t$doc() {\n\t\t\treturn getCachedDocumentResource(this.doctype, this.docname);\n\t\t},\n\t\ttagOptions() {\n\t\t\tconst docTags = this.$doc.doc.tags.map(t => t.tag_name);\n\t\t\treturn [\n\t\t\t\t...(this.$resources.availableTags.data || [])\n\t\t\t\t\t.filter(t => !docTags.includes(t.tag))\n\t\t\t\t\t.map(t => ({\n\t\t\t\t\t\tlabel: t.tag || 'No label',\n\t\t\t\t\t\tvalue: t.tag\n\t\t\t\t\t}))\n\t\t\t];\n\t\t}\n\t},\n\tmethods: {\n\t\taddTag() {\n\t\t\tconst tag = this.selectedTag;\n\t\t\ttoast.promise(this.$doc.addTag.submit({ tag }), {\n\t\t\t\tsuccess: () => {\n\t\t\t\t\tthis.selectedTag = null;\n\t\t\t\t\treturn 'Tag added successfully';\n\t\t\t\t},\n\t\t\t\tloading: 'Adding tag...',\n\t\t\t\terror: 'Failed to add tag'\n\t\t\t});\n\t\t}\n\t}\n};\n</script>\n"],"names":["emit","__emit","props","__props","query","ref","multiple","computed","nullable","filteredOptions","getDisplayValue","option","o","value","watch","updateOptions","__async","label","value2","queryLower","handleQueryChange","event","clearValue","_sfc_main","docTags","toast","tag","_hoisted_1","_hoisted_2","$data","_cache","$event","_withCtx","_createElementVNode","$options"],"mappings":"w9DAiIA,MAAAA,EAAAC,EASAC,EAAAC,EAyBAC,EAAAC,EAAA,EAAA,EACAC,EAAAC,EAAA,IAAA,MAAA,QAAAL,EAAA,UAAA,CAAA,EACAM,EAAAD,EAAA,IAAA,CAAAD,EAAA,KAAA,EACAG,EAAAJ,EAAAH,EAAA,OAAA,EAEAQ,EAAAC,GACC,MAAA,QAAAA,CAAA,EACCA,EAAA,IAAAC,GAAAA,EAAA,KAAA,EAAA,KAAA,IAAA,EAAyCD,IAEzCA,EAAA,OAAAA,EAAA,QAAA,GAMFE,EAAAN,EAAA,IACCL,EAAA,WAGAO,EAAA,MAAA,KAAAE,GAAAA,EAAA,QAAAT,EAAA,UAAA,GAAA,CAC4E,MAAAA,EAAA,WAC7D,MAAAA,EAAA,UACA,EALd,IAMA,EAIFY,EAAA,IAAAV,EAAA,OAAAF,EAAA,QAAAa,EAAA,CAAA,UAAA,GAAA,EAEA,SAAAA,GAAA,QAAAC,EAAA,sBACCZ,EAAA,MAGCK,EAAA,MAAAP,EAAA,QAAA,OAAAS,GAAA,CACC,MAAAM,EAAAN,EAAA,MAAA,YAAA,EACAO,EAAAP,EAAA,MAAA,YAAA,EACAQ,EAAAf,EAAA,MAAA,YAAA,EACA,OAAAa,EAAA,SAAAE,CAAA,GAAAD,EAAA,SAAAd,EAAA,KAAA,CAA+D,CAAA,EANhEK,EAAA,MAAAP,EAAA,OAQD,GAGD,SAAAkB,EAAAC,EAAA,CACCjB,EAAA,MAAAiB,EAAA,OAAA,MACAnB,EAAA,oBAAA,CAAAO,EAAA,MAAA,QACCT,EAAA,oBAAAI,EAAA,KAAA,CACD,CAGD,MAAAkB,EAAA,IAAAtB,EAAA,oBAAA,IAAA,w3ECtLAuB,GAAA,CACC,KAAA,2FAGA,MAAA,CACC,MAAA,CACC,WAAA,GACA,OAAA,GACA,YAAA,kBAID,eAAA,CACC,MAAA,aAEC,QAAA,YACA,QAAA,CAAA,aAAA,KAAA,OAAA,EACA,OAAA,CAAA,KAAA,EACA,WAAA,IACA,KAAA,GAEF,GAED,SAAA,CACC,MAAA,kGAKC,MAAA,CACC,IAAA,KAAA,WAAA,cAAA,MAAA,CAAA,GACC,OAAA,GAAA,CAAAC,EAAA,SAAA,EAAA,GAAA,CAAA,EACA,IAAA,IAAA,oCAGA,EAAA,EAEH,GAED,QAAA,CACC,QAAA,0BAECC,GAAA,QAAA,KAAA,KAAA,OAAA,OAAA,CAAA,IAAAC,CAAA,CAAA,EAAA,cAEE,KAAA,YAAA,uDAID,MAAA,mBACD,CAAA,CACD,CACD,CACD,EA/EQC,GAAA,CAAA,MAAA,WAAA,EACCC,GAAA,CAAA,MAAA,6BAAA,oFAJT,WAAAC,EAAA,WAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,WAAAE,GAC+B,QAAA,CAAA,MAAA,SAAA,IAClB,eAAAC,EAAA,IAAA,CACVC,EAAA,MAAAN,GAAA,CACCM,EAAA,MAAAL,GAAA,MAJJ,WAAAC,EAAA,YAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,YAAAE,GAOO,QAAAG,EAAA,WACD,MAAA,yBACC,mBAAA,GACD,MAAA,gDAGA,MAAA,MACA,YAAA,OACC,QAAAA,EAAA,OACD,MAAA,OACC,SAAA,CAAAL,EAAA"}