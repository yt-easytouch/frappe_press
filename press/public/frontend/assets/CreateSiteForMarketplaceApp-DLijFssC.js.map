{"version":3,"file":"CreateSiteForMarketplaceApp-DLijFssC.js","sources":["../../../../dashboard/src2/pages/CreateSiteForMarketplaceApp.vue"],"sourcesContent":["<template>\n\t<div class=\"top-0 z-10 shrink-0\">\n\t\t<Header>\n\t\t\t<FBreadcrumbs\n\t\t\t\t:items=\"[\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Install App',\n\t\t\t\t\t\troute: { name: 'InstallApp', params: { app: app } }\n\t\t\t\t\t}\n\t\t\t\t]\"\n\t\t\t/>\n\t\t</Header>\n\n\t\t<div class=\"m-12 mx-auto max-w-2xl px-5\">\n\t\t\t<div v-if=\"$resources.app.loading\" class=\"py-4 text-base text-gray-600\">\n\t\t\t\tLoading...\n\t\t\t</div>\n\t\t\t<div v-else class=\"space-y-6\">\n\t\t\t\t<div class=\"mb-12 flex\">\n\t\t\t\t\t<img\n\t\t\t\t\t\t:src=\"appDoc.image\"\n\t\t\t\t\t\tclass=\"h-12 w-12 rounded-lg border\"\n\t\t\t\t\t\t:alt=\"appDoc.name\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"my-1 ml-4 flex flex-col justify-between\">\n\t\t\t\t\t\t<h1 class=\"text-lg font-semibold\">{{ appDoc.title }}</h1>\n\t\t\t\t\t\t<p class=\"text-sm text-gray-600\">{{ appDoc.description }}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"failure\"\n\t\t\t\t\tclass=\"flex items-center space-x-2 rounded border border-gray-200 bg-gray-100 p-4 text-base text-gray-700\"\n\t\t\t\t>\n\t\t\t\t\t<i-lucide-alert-circle class=\"inline-block h-5 w-5\" />\n\t\t\t\t\t<p>\n\t\t\t\t\t\tFailed to install the app.\n\t\t\t\t\t\t<router-link class=\"underline\" :to=\"failureRoute\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t$resources.siteGroupDeploy.doc?.status === 'Bench Deploy Failed'\n\t\t\t\t\t\t\t\t\t? 'View Deploy'\n\t\t\t\t\t\t\t\t\t: 'View Job'\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</router-link>\n\t\t\t\t\t\t.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"divide-y rounded-lg bg-gray-50 px-4\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"step in steps\"\n\t\t\t\t\t\t:key=\"step.id\"\n\t\t\t\t\t\tclass=\"flex items-center border-gray-200 px-1 py-3\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t\t\t\t\t<LoadingIndicator\n\t\t\t\t\t\t\t\tclass=\"h-4 w-4 text-gray-900\"\n\t\t\t\t\t\t\t\tv-if=\"step.icon() === 'loading'\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FeatherIcon\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t:name=\"step.icon()\"\n\t\t\t\t\t\t\t\tclass=\"h-5 w-5 rounded-full p-0.5 text-white\"\n\t\t\t\t\t\t\t\t:stroke-width=\"3\"\n\t\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t\t'bg-green-500': step.icon() === 'check',\n\t\t\t\t\t\t\t\t\t'bg-red-500': step.icon() === 'x',\n\t\t\t\t\t\t\t\t\t'bg-gray-500': step.icon() === 'clock'\n\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class=\"flex flex-col space-y-1\">\n\t\t\t\t\t\t\t\t<h5 class=\"text-base\">{{ step.title }}</h5>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { Breadcrumbs } from 'frappe-ui';\nimport Header from '../components/Header.vue';\n\nexport default {\n\tprops: {\n\t\tapp: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\tpageMeta() {\n\t\treturn {\n\t\t\ttitle: `Install ${this.appDoc.title} - Easytouch Cloud`\n\t\t};\n\t},\n\tcomponents: {\n\t\tFBreadcrumbs: Breadcrumbs,\n\t\tHeader\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tsiteGroupDeployName: this.$route.query.siteGroupDeployName\n\t\t};\n\t},\n\tmounted() {\n\t\tthis.$socket.emit(\n\t\t\t'doc_subscribe',\n\t\t\t'Site Group Deploy',\n\t\t\tthis.siteGroupDeployName\n\t\t);\n\n\t\tthis.$socket.on('doc_update', () => {\n\t\t\tthis.$resources.siteGroupDeploy.reload();\n\t\t});\n\t},\n\tresources: {\n\t\tapp() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.marketplace.get',\n\t\t\t\tparams: {\n\t\t\t\t\tapp: this.app\n\t\t\t\t},\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tsiteGroupDeploy() {\n\t\t\treturn {\n\t\t\t\ttype: 'document',\n\t\t\t\tdoctype: 'Site Group Deploy',\n\t\t\t\tname: this.siteGroupDeployName,\n\t\t\t\tonSuccess: doc => {\n\t\t\t\t\tif (doc.status === 'Site Created') {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.$router.push({\n\t\t\t\t\t\t\t\tname: 'Site Detail Overview',\n\t\t\t\t\t\t\t\tparams: { name: doc.site }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\tcomputed: {\n\t\tfailure() {\n\t\t\treturn ['Site Creation Failed', 'Bench Deploy Failed'].includes(\n\t\t\t\tthis.$resources.siteGroupDeploy.doc?.status\n\t\t\t);\n\t\t},\n\t\tfailureRoute() {\n\t\t\tif (this.$resources.siteGroupDeploy.doc?.status === 'Bench Deploy Failed')\n\t\t\t\treturn {\n\t\t\t\t\tname: 'Release Group Detail Deploys',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tname: this.$resources.siteGroupDeploy.doc.release_group\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\telse if (\n\t\t\t\tthis.$resources.siteGroupDeploy.doc?.status === 'Site Creation Failed'\n\t\t\t)\n\t\t\t\treturn {\n\t\t\t\t\tname: 'Site Jobs',\n\t\t\t\t\tparams: { name: this.$resources.siteGroupDeploy.doc.site }\n\t\t\t\t};\n\t\t},\n\t\tsteps() {\n\t\t\tconst statusPosition = status => {\n\t\t\t\tif (!status) return -1;\n\n\t\t\t\treturn [\n\t\t\t\t\t'Pending',\n\t\t\t\t\t'Deploying Bench',\n\t\t\t\t\t'Bench Deployed',\n\t\t\t\t\t'Bench Deploy Failed',\n\t\t\t\t\t'Creating Site',\n\t\t\t\t\t'Site Created',\n\t\t\t\t\t'Site Creation Failed'\n\t\t\t\t].indexOf(status);\n\t\t\t};\n\t\t\tconst status = this.$resources.siteGroupDeploy?.doc?.status;\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: 0,\n\t\t\t\t\ttitle: 'Initializing',\n\t\t\t\t\tdescription: 'Initializing the setup',\n\t\t\t\t\tstatus: 'Pending',\n\t\t\t\t\ticon: () => {\n\t\t\t\t\t\tif (statusPosition(status) === 0) {\n\t\t\t\t\t\t\treturn 'loading';\n\t\t\t\t\t\t} else if (statusPosition(status) > 0) {\n\t\t\t\t\t\t\treturn 'check';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessage: 'This should take a few minutes'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 1,\n\t\t\t\t\ttitle:\n\t\t\t\t\t\tstatusPosition(status) <= 1 ? 'Deploying Bench' : 'Bench Deployed',\n\t\t\t\t\tdescription: 'Deploying bench on the server',\n\t\t\t\t\tstatus: 'Deploying Bench',\n\t\t\t\t\ticon: () => {\n\t\t\t\t\t\tif (status === 'Bench Deploy Failed') {\n\t\t\t\t\t\t\treturn 'x';\n\t\t\t\t\t\t} else if (statusPosition(status) === 1) {\n\t\t\t\t\t\t\treturn 'loading';\n\t\t\t\t\t\t} else if (statusPosition(status) > 1) {\n\t\t\t\t\t\t\treturn 'check';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn 'clock';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessage: 'This should take a few minutes'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 2,\n\t\t\t\t\ttitle: statusPosition(status) <= 4 ? 'Creating Site' : 'Site Created',\n\t\t\t\t\tdescription: 'Creating site on the server',\n\t\t\t\t\tstatus: 'Creating Site',\n\t\t\t\t\ticon: () => {\n\t\t\t\t\t\tif (status === 'Site Creation Failed') {\n\t\t\t\t\t\t\treturn 'x';\n\t\t\t\t\t\t} else if (statusPosition(status) === 4) {\n\t\t\t\t\t\t\treturn 'loading';\n\t\t\t\t\t\t} else if (statusPosition(status) > 4) {\n\t\t\t\t\t\t\treturn 'check';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn 'clock';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmessage: 'This should take a few minutes'\n\t\t\t\t}\n\t\t\t];\n\t\t},\n\t\tappDoc() {\n\t\t\treturn this.$resources.app.data || {};\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","doc","_a","_b","status","statusPosition","_hoisted_1","_hoisted_2","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_openBlock","_createElementBlock","_withCtx","_createElementVNode","_hoisted_4","_toDisplayString","$options","_hoisted_10","_cache","_createTextVNode","_ctx","_createCommentVNode","_Fragment","_renderList","step"],"mappings":"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"}