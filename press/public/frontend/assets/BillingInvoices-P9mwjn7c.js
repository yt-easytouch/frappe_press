import{x as C,ao as w,r as d,q as l,o as n,A as u,h as f,u as _,w as I,F as D,aA as P,aH as x,d as p,aI as B,a2 as k,aB as A,ax as M,X as S,ap as y}from"./main-Dpl-JOF2.js";import{I as V}from"./InvoiceTable-D1HjWyXY.js";import{_ as Y}from"./AddPrepaidCreditsDialog-DtI4IApw.js";import"./PrepaidCreditsForm-DIaFhUMJ.js";import"./stripe.esm-D4yu_pm0.js";import"./StripeLogo-De_iztuU.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c432302d-ae4d-4f4f-93cc-8720d3c4983b",e._sentryDebugIdIdentifier="sentry-dbid-c432302d-ae4d-4f4f-93cc-8720d3c4983b")}catch(o){}})();{var a=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};a._sentryModuleMetadata=a._sentryModuleMetadata||{},a._sentryModuleMetadata[new Error().stack]=Object.assign({},a._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const E={name:"BillingInvoices",props:["tab"],components:{ObjectList:w,InvoiceTable:V,AddPrepaidCreditsDialog:Y},data(){return{invoiceDialog:!1,showInvoice:null,showBuyPrepaidCreditsDialog:!1,minimumAmount:0}},computed:{options(){return{doctype:"Invoice",fields:["type","invoice_pdf","payment_mode","stripe_invoice_url","due_date","period_start","period_end","mpesa_invoice","mpesa_invoice_pdf"],filterControls:()=>[{type:"select",label:"Type",class:this.$isMobile?"":"w-36",fieldname:"type",options:["","Subscription","Prepaid Credits"]},{type:"select",label:"Status",class:this.$isMobile?"":"w-36",fieldname:"status",options:["","Draft","Invoice Created","Unpaid","Paid","Refunded","Uncollectible","Collected","Empty"]}],columns:[{label:"Invoice",fieldname:"name",class:"font-medium",format(e,t){return t.type=="Subscription"?p(t.period_end).format("MMMM YYYY"):t.type=="Partnership Fees"?"Partnership Fees":"Prepaid Credits"},width:.8},{label:"Status",fieldname:"status",type:"Badge",width:"150px"},{label:"Date",fieldname:"due_date",format(e,t){if(t.type=="Subscription"){let o=p(t.period_start),s=p(t.period_end);return`${o.year()===s.year()?o.format("MMM D"):o.format("ll")} - ${s.format("ll")}`}return B(e,"ll")}},{label:"Total",fieldname:"total",format:this.formatCurrency,align:"right",width:.6},{label:"Amount Paid",fieldname:"amount_paid",format:this.formatCurrency,align:"right",width:.6},{label:"Amount Due",fieldname:"amount_due",format:this.formatCurrency,align:"right",width:.6},{label:"",type:"Button",align:"right",Button:({row:e})=>{if(e.invoice_pdf||e.mpesa_invoice_pdf)return{label:"Download Invoice",slots:{prefix:y("download")},onClick:()=>{e.mpesa_invoice_pdf?window.open(e.mpesa_invoice_pdf):window.open(e.invoice_pdf)}};if(e.status==="Unpaid"&&e.amount_due>0)return{label:"Pay Now",slots:{prefix:y("external-link")},onClick:t=>{t.stopPropagation(),e.stripe_invoice_url&&e.payment_mode=="Card"?window.open(`/api/method/press.api.client.run_doc_method?dt=Invoice&dn=${e.name}&method=stripe_payment_url`):(this.showBuyPrepaidCreditsDialog=!0,this.minimumAmount=e.amount_due)}}},prefix(e){if(e.stripe_payment_failed&&e.status!=="Paid")return k(S,{variant:"ghost",theme:"red",icon:"alert-circle",onClick(t){t.stopPropagation(),A({title:"Payment Failed",message:`<div class="space-y-4"><p class="text-base">Your payment with the card ending <strong>${e.stripe_payment_failed_card}</strong> failed for this invoice due to the following reason:</p><div class="text-sm font-mono text-gray-600 rounded p-2 bg-gray-100">${e.stripe_payment_error}</div><p class="text-base">Please change your payment method to pay this invoice.</p></div>`,primaryAction:{label:"Change Payment Method",variant:"solid",onClick:({hide:o})=>{o(),M.push({name:"BillingPaymentMethods"})}}})}})}}],orderBy:"due_date desc, creation desc",onRowClick:e=>{this.showInvoice=e,this.invoiceDialog=!0}}}},methods:{formatCurrency(e){return e===0?"":x(e)}}},j={class:"p-5"},F={key:0,class:"text-base text-gray-600"};function T(e,t,o,s,i,m){var c;const g=d("ObjectList"),h=d("InvoiceTable"),v=P,b=d("AddPrepaidCreditsDialog");return n(),l("div",j,[u(g,{options:m.options},null,8,["options"]),u(v,{modelValue:i.invoiceDialog,"onUpdate:modelValue":t[0]||(t[0]=r=>i.invoiceDialog=r),options:{size:"3xl",title:(c=i.showInvoice)==null?void 0:c.name}},{"body-content":I(()=>[i.showInvoice?(n(),l(D,{key:0},[i.showInvoice.status==="Empty"?(n(),l("div",F," Nothing to show ")):(n(),f(h,{key:1,invoiceId:i.showInvoice.name},null,8,["invoiceId"]))],64)):_("",!0)]),_:1},8,["modelValue","options"]),i.showBuyPrepaidCreditsDialog?(n(),f(b,{key:0,modelValue:i.showBuyPrepaidCreditsDialog,"onUpdate:modelValue":t[1]||(t[1]=r=>i.showBuyPrepaidCreditsDialog=r),minimumAmount:i.minimumAmount,onSuccess:t[2]||(t[2]=()=>{i.showBuyPrepaidCreditsDialog=!1})},null,8,["modelValue","minimumAmount"])):_("",!0)])}const q=C(E,[["render",T]]);export{q as default};
//# sourceMappingURL=BillingInvoices-P9mwjn7c.js.map
