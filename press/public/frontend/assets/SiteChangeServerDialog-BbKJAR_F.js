import{x as _,r as y,h as l,o as n,w as I,u as d,q as m,A as u,bp as w,a8 as D,t as T,a9 as k,aA as V,V as g,av as $}from"./main-Dpl-JOF2.js";import{D as C}from"./DateTimeControl-DSJ0TMcX.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},r=new Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="86b9afb3-2db5-475d-9ee1-7affe9a9cbc2",e._sentryDebugIdIdentifier="sentry-dbid-86b9afb3-2db5-475d-9ee1-7affe9a9cbc2")}catch(o){}})();{var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};i._sentryModuleMetadata=i._sentryModuleMetadata||{},i._sentryModuleMetadata[new Error().stack]=Object.assign({},i._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const A={props:["site"],components:{DateTimeControl:C},data(){return{show:!0,targetServer:{label:"",value:""},targetDateTime:null,skipFailingPatches:!1}},watch:{targetServer(e){this.$resources.isServerAddedInGroup.fetch({name:this.site,server:e.value})}},computed:{$site(){return $("Site",this.site)},message(){return this.$resources.changeServerOptions.data.length===0?"No servers available for your team to move the site to. Please create a server first.":this.targetServer.value&&!this.$resources.isServerAddedInGroup.data?"The chosen server isn't added to the bench group yet. Please add the server to the bench groupfirst.":this.targetServer.value&&this.$resources.isServerAddedInGroup.data?"The chosen server is already added to the bench. You can now migrate the site to the server.":""},errorMessage(){return this.$resources.addServerToReleaseGroup.error||this.$resources.isServerAddedInGroup.error||this.$resources.changeServerOptions.error||this.$resources.changeServer.error},datetimeInIST(){return this.targetDateTime?this.$dayjs(this.targetDateTime).format("YYYY-MM-DDTHH:mm"):null}},resources:{changeServerOptions(){return{url:"press.api.site.change_server_options",params:{name:this.site},initialData:[],auto:!0,transform(e){return e.map(r=>({label:r.title||r.name,description:r.name,value:r.name}))}}},isServerAddedInGroup(){return{url:"press.api.site.is_server_added_in_group",initialData:!1}},changeServer(){return{url:"press.api.site.change_server",onSuccess(){g.success("Site has been scheduled to move to another server."),this.show=!1}}},addServerToReleaseGroup(){var e;return{url:"press.api.site.add_server_to_release_group",params:{name:this.site,group_name:(e=this.$site.doc)==null?void 0:e.group,server:this.targetServer.value},onSuccess(r){var o;g.success(`Server ${this.targetServer.value} added to the bench. Please wait for the deploy to be completed.`),this.$router.push({name:"Release Group Job",params:{name:(o=this.$site.doc)==null?void 0:o.group,id:r}}),this.show=!1}}}},methods:{resetValues(){this.targetServer={label:"",value:""},this.targetDateTime=null,this.$resources.isServerAddedInGroup.reset()}}},G={key:2,class:"mt-4 space-y-4"},M={key:3,class:"mt-4 text-sm text-gray-700"};function O(e,r,o,P,s,a){var p,h;const v=w,c=D,S=y("DateTimeControl"),f=k,b=V;return n(),l(b,{modelValue:s.show,"onUpdate:modelValue":r[3]||(r[3]=t=>s.show=t),onClose:a.resetValues,options:{title:"Move Site to another Server",actions:[{label:"Add Server to Bench Group",loading:e.$resources.addServerToReleaseGroup.loading,disabled:e.$resources.isServerAddedInGroup.data||!s.targetServer.value,onClick:()=>e.$resources.addServerToReleaseGroup.submit()},{label:"Change Server",loading:e.$resources.changeServer.loading,variant:"solid",disabled:!((h=(p=e.$resources.changeServerOptions)==null?void 0:p.data)!=null&&h.length)||!s.targetServer.value||!e.$resources.isServerAddedInGroup.data,onClick:()=>{e.$resources.changeServer.submit({name:o.site,server:s.targetServer.value,scheduled_datetime:a.datetimeInIST,skip_failing_patches:s.skipFailingPatches})}}]}},{"body-content":I(()=>[e.$resources.changeServerOptions.loading?(n(),l(v,{key:0,class:"mx-auto h-4 w-4"})):e.$resources.changeServerOptions.data.length>0?(n(),l(c,{key:1,label:"Select Server",variant:"outline",type:"autocomplete",options:e.$resources.changeServerOptions.data,modelValue:s.targetServer,"onUpdate:modelValue":r[0]||(r[0]=t=>s.targetServer=t)},null,8,["options","modelValue"])):d("",!0),e.$resources.isServerAddedInGroup.data?(n(),m("div",G,[u(S,{modelValue:s.targetDateTime,"onUpdate:modelValue":r[1]||(r[1]=t=>s.targetDateTime=t),label:"Schedule Time"},null,8,["modelValue"]),u(c,{label:"Skip failing patches if any",type:"checkbox",modelValue:s.skipFailingPatches,"onUpdate:modelValue":r[2]||(r[2]=t=>s.skipFailingPatches=t)},null,8,["modelValue"])])):d("",!0),a.message&&!a.errorMessage?(n(),m("p",M,T(a.message),1)):d("",!0),u(f,{class:"mt-4",message:a.errorMessage},null,8,["message"])]),_:1},8,["modelValue","onClose","options"])}const E=_(A,[["render",O]]);export{E as default};
//# sourceMappingURL=SiteChangeServerDialog-BbKJAR_F.js.map
