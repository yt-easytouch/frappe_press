var b=(e,s,a)=>new Promise((h,o)=>{var t=n=>{try{i(a.next(n))}catch(m){o(m)}},u=n=>{try{i(a.throw(n))}catch(m){o(m)}},i=n=>n.done?h(n.value):Promise.resolve(n.value).then(t,u);i((a=a.apply(e,s)).next())});import{x as k,b as P,r as C,q as l,o as d,A as p,j as r,aj as E,h as T,u as x,a6 as I,w as _,t as c,a7 as q,ag as D,au as $,F as B,a9 as L,a8 as V,X as j,Y as M,ay as N,ad as R,V as F}from"./main-Dpl-JOF2.js";import{L as A}from"./LoginBox-qd4moaUa.js";import"./YooltechLogo-DH5Linvn.js";import"./ETLogo-Ziye5dPH.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="3467ee4b-a343-4646-8cea-ed9a44f7ccbe",e._sentryDebugIdIdentifier="sentry-dbid-3467ee4b-a343-4646-8cea-ed9a44f7ccbe")}catch(a){}})();{var y=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};y._sentryModuleMetadata=y._sentryModuleMetadata||{},y._sentryModuleMetadata[new Error().stack]=Object.assign({},y._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const O={name:"SignupSetup",props:["productId"],components:{LoginBox:A},data(){return{progressErrorCount:0,findingClosestServer:!1,closestCluster:null,subdomain:""}},watch:{subdomain:{handler:P(function(){this.$resources.subdomainExists.submit()},500)}},resources:{siteRequest(){return{url:"press.api.product_trial.get_request",params:{product:this.productId,account_request:this.$team.doc.account_request},auto:!0,initialData:{},onSuccess:e=>{(e==null?void 0:e.status)!=="Pending"&&this.$router.push({name:"SignupLoginToSite",params:{productId:this.productId},query:{product_trial_request:e.name}})},onError(e){F.error(e.messages.join(`
`))}}},saasProduct(){return{type:"document",doctype:"Product Trial",name:this.productId,auto:!0}},subdomainExists(){return{url:"press.api.site.exists",makeParams(){var e;return{domain:(e=this.saasProduct)==null?void 0:e.domain,subdomain:this.subdomain}},validate(){const e=N(this.subdomain);if(e)throw new R(e)},transform(e){return!e}}},createSite(){return{url:"press.api.client.run_doc_method",makeParams:()=>{var e;return{dt:"Product Trial Request",dn:this.$resources.siteRequest.data.name,method:"create_site",args:{subdomain:this.subdomain,cluster:(e=this.closestCluster)!=null?e:"Default"}}},auto:!1,onSuccess:e=>{this.$router.push({name:"SignupLoginToSite",params:{productId:this.productId},query:{product_trial_request:this.$resources.siteRequest.data.name}})}}}},computed:{saasProduct(){return this.$resources.saasProduct.doc}},methods:{createSite(){return b(this,null,function*(){return yield this.getClosestCluster(),this.$resources.createSite.submit()})},getClosestCluster(){return b(this,null,function*(){if(this.closestCluster)return this.closestCluster;let e=Object.keys(this.saasProduct.proxy_servers);if(e.length>0){this.findingClosestServer=!0;let s=e.map(u=>this.getPingTime(u)),o=(yield Promise.allSettled(s)).reduce((u,i)=>u.value.pingTime<i.value.pingTime?u:i).value.server,t=this.saasProduct.proxy_servers[o];this.closestCluster||(this.closestCluster=t),this.findingClosestServer=!1}return this.closestCluster})},getPingTime(e){return b(this,null,function*(){let s=999999;try{let a=new Date().getTime();yield fetch(`https://${e}`),s=new Date().getTime()-a}catch(a){console.warn(a)}return{server:e,pingTime:s}})},redirectToLogin(){this.$router.push({name:"Login"})}}},z={key:0,class:"flex h-screen w-screen items-center justify-center"},K={key:1,class:"flex h-screen overflow-hidden sm:bg-gray-50"},U={class:"w-full overflow-auto"},X={class:"mx-auto flex items-center space-x-2"},Y=["src"],H={class:"select-none text-xl font-semibold tracking-tight text-gray-900"},J={class:"w-full space-y-1.5"},Q={class:"col-span-2 flex w-full"},W=["placeholder"],Z={class:"flex items-center rounded-r bg-gray-100 px-2 text-base"},G={class:"mt-1"},ee={key:0,class:"text-sm text-gray-600"},se={key:0,class:"text-sm text-green-600"},te={key:1,class:"text-sm text-red-600"};function re(e,s,a,h,o,t){var w;const u=E,i=L,n=V,m=j,S=C("LoginBox");return e.$resources.saasProduct.loading?(d(),l("div",z,[p(u,{class:"mr-2 w-4"}),s[2]||(s[2]=r("p",{class:"text-gray-800"},"Loading",-1))])):(d(),l("div",K,[r("div",U,[t.saasProduct?(d(),T(S,{key:0,title:"Letâ€™s set up your site",logo:(w=t.saasProduct)==null?void 0:w.logo},I({default:_(()=>{var g,f;return[r("form",{class:"w-full space-y-4",onSubmit:s[1]||(s[1]=q((...v)=>t.createSite&&t.createSite(...v),["prevent"]))},[r("div",J,[s[3]||(s[3]=r("label",{class:"block text-xs text-ink-gray-5"}," Enter subdomain for your site ",-1)),r("div",Q,[D(r("input",{class:"dark:[color-scheme:dark] z-10 h-7 w-full rounded rounded-r-none border border-outline-gray-2 bg-surface-white py-1.5 pl-2 pr-2 text-base text-ink-gray-8 placeholder-ink-gray-4 transition-colors hover:border-outline-gray-3 hover:shadow-sm focus:border-outline-gray-4 focus:bg-surface-white focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3",placeholder:`${t.saasProduct.name}-site`,"onUpdate:modelValue":s[0]||(s[0]=v=>o.subdomain=v)},null,8,W),[[$,o.subdomain]]),r("div",Z," ."+c(t.saasProduct.domain),1)]),r("div",G,[e.$resources.subdomainExists.loading?(d(),l("div",ee," Checking... ")):!e.$resources.subdomainExists.error&&e.$resources.subdomainExists.fetched&&o.subdomain?(d(),l(B,{key:1},[e.$resources.subdomainExists.data?(d(),l("div",se,c(o.subdomain)+"."+c(t.saasProduct.domain)+" is available ",1)):(d(),l("div",te,c(o.subdomain)+"."+c(t.saasProduct.domain)+" is not available ",1))],64)):x("",!0),p(i,{message:e.$resources.subdomainExists.error},null,8,["message"])])]),p(n,{label:"Email address (will be your login ID)",modelValue:e.$team.doc.user,disabled:!0,variant:"outline",class:"mb-4"},null,8,["modelValue"]),p(i,{class:"mt-2",message:(g=e.$resources.createSite)==null?void 0:g.error},null,8,["message"]),p(m,{class:"mt-8 w-full",variant:"solid",type:"submit",disabled:!!e.$resources.subdomainExists.error||!e.$resources.subdomainExists.data||!o.subdomain.length,loading:o.findingClosestServer||((f=e.$resources.createSite)==null?void 0:f.loading),loadingText:"Creating site..."},{default:_(()=>s[4]||(s[4]=[M(" Next ")])),_:1},8,["disabled","loading"])],32)]}),footer:_(()=>[s[5]||(s[5]=r("div",{class:"mt-2 flex w-full items-center justify-center text-sm text-gray-600"}," Powered by Easytouch Cloud ",-1))]),_:2},[t.saasProduct?{name:"logo",fn:_(()=>{var g,f;return[r("div",X,[r("img",{class:"inline-block h-7 w-7 rounded-sm",src:(g=t.saasProduct)==null?void 0:g.logo},null,8,Y),r("span",H,c((f=t.saasProduct)==null?void 0:f.title),1)])]}),key:"0"}:void 0]),1032,["logo"])):x("",!0)])]))}const de=k(O,[["render",re]]);export{de as default};
//# sourceMappingURL=SetupSite-BLLDn_C_.js.map
