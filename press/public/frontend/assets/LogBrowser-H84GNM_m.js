import{x as q,q as r,o as t,A as i,j as e,w as S,bB as J,a8 as U,aj as X,F as B,v as I,n as D,t as v,l as H,J as f,h as L,u as k,Z as h,as as se,Y,X as Z,bw as ne,r as R,ag as O,ah as K,y as le,bC as re,at as ae,a9 as ie}from"./main-Dpl-JOF2.js";import{_ as de}from"./Breadcrumbs-yx7M4N4X.js";import{_ as ce}from"./Header-BNMc-OFG.js";import{_ as ue}from"./alert-circle-DHphV4ie.js";import{_ as me}from"./info-BXlf1Uhm.js";import{u as ge,F as W,g as pe,b as _e,c as fe,d as he,a as ve}from"./index-C2jCZcKa.js";import{_ as be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CH7TZuXP.js";(function(){try{var o=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},n=new Error().stack;n&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[n]="6f197450-5efe-405e-a8a8-75f7e1ef403e",o._sentryDebugIdIdentifier="sentry-dbid-6f197450-5efe-405e-a8a8-75f7e1ef403e")}catch(a){}})();{var M=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};M._sentryModuleMetadata=M._sentryModuleMetadata||{},M._sentryModuleMetadata[new Error().stack]=Object.assign({},M._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const xe={props:{mode:String,docName:String},data(){return{searchLogQuery:"",logId:this.$route.params.logId}},resources:{benchLogs(){var o;return{url:"press.api.bench.logs",params:{name:(o=this.bench)==null?void 0:o.split("-").slice(0,2).join("-"),bench:this.bench},auto:this.mode==="bench"&&this.bench,cache:["BenchLogs",this.bench]}},siteLogs(){return{url:"press.api.site.logs",params:{name:this.site},auto:this.mode==="site"&&this.site,cache:["SiteLogs",this.site]}}},computed:{logs(){var n,a;let o=[];return this.mode==="bench"?o=((n=this.$resources.benchLogs)==null?void 0:n.data)||[]:this.mode==="site"&&(o=((a=this.$resources.siteLogs)==null?void 0:a.data)||[]),this.searchLogQuery&&(o=o.filter(b=>b.name.toLowerCase().includes(this.searchLogQuery.toLowerCase()))),o},bench(){return this.mode==="bench"?this.docName:null},site(){return this.mode==="site"?this.docName:null}}},ye={class:"m-4 mr-0 flex h-full w-1/4 flex-col"},we={class:"h-[81.5vh] space-y-2 overflow-auto pr-4"},ke={key:0,class:"mt-20 flex justify-center space-x-2 text-sm text-gray-700"},Le={key:1,class:"mt-20 flex justify-center text-sm text-gray-700"},Ce=["onClick"],Se={class:"flex items-center justify-between"},$e={class:"space-y-1"},Ve={class:"text-base text-gray-700"},Be={class:"text-xs text-gray-500"},Ne={class:"text-sm text-gray-500"};function Ie(o,n,a,b,d,x){var m,C;const $=J,y=U,V=X;return t(),r("div",ye,[i(y,{class:"mb-4 mr-4",label:"Search log files",modelValue:d.searchLogQuery,"onUpdate:modelValue":n[0]||(n[0]=g=>d.searchLogQuery=g)},{prefix:S(()=>[i($,{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),e("div",we,[(m=o.$resources.benchLogs)!=null&&m.loading||(C=o.$resources.siteLogs)!=null&&C.loading?(t(),r("div",ke,[i(V,{class:"w-4"}),n[1]||(n[1]=e("span",null," Fetching logs... ",-1))])):x.logs.length===0?(t(),r("div",Le," No logs found ")):(t(!0),r(B,{key:2},I(x.logs,g=>(t(),r("div",{class:D(["cursor-pointer rounded border border-gray-200 p-3 hover:bg-gray-50",{"border-gray-800":d.logId===g.name}]),onClick:()=>{d.logId=g.name,o.$router.push({name:"Log Browser",params:{mode:a.mode,docName:a.mode==="bench"?x.bench:x.site,logId:g.name}})}},[e("div",Se,[e("div",$e,[e("p",Ve,v(g.name),1),e("p",Be,v(o.$format.date(g.modified,"YYYY-MM-DD HH:mm")),1)]),e("p",Ne,v(o.$format.bytes(g.size)),1)])],10,Ce))),256))])])}const De=q(xe,[["render",Ie]]),Fe={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden"},Ee={class:"relative flex h-full w-full flex-col overflow-hidden"},Me={class:"mb-4 flex justify-between"},Re={class:"space-x-2"},je={class:"flex space-x-2"},Pe={class:"flex h-[81.5vh] w-full flex-col overflow-hidden rounded border"},Ae={class:"relative flex flex-1 flex-col overflow-auto"},He={key:0,class:"w-full border-separate border-spacing-0"},Ue={class:"z-5 sticky top-0 w-full rounded bg-gray-100"},Qe=["colSpan"],ze={class:"flex items-center truncate px-3 py-2 text-base font-semibold"},Te={class:"hover:bg-gray-50"},Ye=["onClick"],Oe={key:0,class:"flex items-center space-x-2"},Ke=["colspan"],We={key:1,class:"p-8"},qe={class:"flex justify-between rounded rounded-t-none border-t p-1"},Je={class:"flex flex-shrink-0 items-center justify-end gap-3"},Xe={class:"tnum text-sm text-gray-600"},Ze={class:"flex gap-2"},Ge={__name:"LogViewer",props:{log:{type:Array,required:!0}},setup(o){const n=o,a=H(""),b=H(""),d=H("desc"),x=f(()=>{const s=[];return b.value&&s.push({id:"level",value:b.value}),a.value&&s.push({id:"description",value:a.value}),s}),$=f(()=>n.log),y=f(()=>{const s=Object.keys($.value[0]||{});return s.sort((l,N)=>l==="description"?1:N==="description"?-1:0),s.length?s:["description"]}),V=f(()=>d.value?[{id:"time",desc:d.value==="desc"}]:[]),m=ge({data:$.value,columns:y.value.map(s=>({id:s,header:E(s),accessorKey:s,enableSorting:s==="time",sortingFn:s==="time"?"datetime":null,isNumber:!1})),state:{get columnFilters(){return x.value},get sorting(){return V.value}},initialState:{pagination:{pageSize:20,pageIndex:0}},getRowCanExpand:s=>!0,getCoreRowModel:ve(),getSortedRowModel:he(),getExpandedRowModel:fe(),getFilteredRowModel:_e(),getPaginationRowModel:pe()}),C=f(()=>m.getState().pagination.pageSize),g=f(()=>m.getState().pagination.pageIndex+1),F=f(()=>n.log.length),j=f(()=>F.value?(g.value-1)*C.value+1:0),P=f(()=>{const s=g.value*C.value;return s>n.log.length?n.log.length:s});function E(s){return s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""}function p(s){return E(A(s))}function A(s){return s.row.original[s.column.columnDef.accessorKey]}function _(s){const l=s.getToggleExpandedHandler();s.getCanExpand()&&l()}return(s,l)=>{var z,T;const N=U,G=J,ee=me,te=se,oe=ue,Q=Z;return t(),r("div",Fe,[e("div",Ee,[e("div",null,[e("div",Me,[e("div",Re,[y.value.includes("level")?(t(),L(N,{key:0,type:"select",label:"Filter By Level",options:[{label:"All",value:""},{label:"Info",value:"Info"},{label:"Warning",value:"warning"},{label:"Error",value:"error"},{label:"Critical",value:"critical"}],class:"w-24",modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=c=>b.value=c)},null,8,["modelValue"])):k("",!0)]),e("div",je,[y.value.includes("time")?(t(),L(N,{key:0,type:"select",label:"Sort By",options:[{label:"Sort By",disabled:!0},{label:"Newest First",value:"desc"},{label:"Oldest First",value:"asc"}],class:"w-32",modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=c=>d.value=c)},null,8,["modelValue"])):k("",!0),i(N,{class:"w-80",label:"Search log",modelValue:a.value,"onUpdate:modelValue":l[2]||(l[2]=c=>a.value=c)},{prefix:S(()=>[i(G,{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"])])]),e("div",Pe,[e("div",Ae,[(z=y.value)!=null&&z.length||(T=n.log)!=null&&T.length?(t(),r("table",He,[e("thead",Ue,[(t(!0),r(B,null,I(h(m).getHeaderGroups(),c=>(t(),r("tr",{key:c.id},[(t(!0),r(B,null,I(c.headers,w=>(t(),r("th",{key:w.id,colSpan:w.colSpan,class:D(["text-gray-800",{"w-2/12":w.column.columnDef.id==="level","w-3/12":w.column.columnDef.id==="time"}])},[e("div",ze,[w.isPlaceholder?k("",!0):(t(),L(h(W),{key:0,render:w.column.columnDef.header,props:w.getContext()},null,8,["render","props"]))])],10,Qe))),128))]))),128))]),e("tbody",null,[(t(!0),r(B,null,I(h(m).getRowModel().rows,(c,w)=>(t(),r(B,{key:c.id},[e("tr",Te,[(t(!0),r(B,null,I(c.getVisibleCells(),u=>(t(),r("td",{key:u.id,class:D(["max-w-[35rem] cursor-pointer truncate border-b px-3 py-2",{"border-b-0":c.getIsExpanded()}]),onClick:pt=>_(c)},[u.column.columnDef.id==="level"?(t(),r("div",Oe,[p(u)==="Info"?(t(),L(ee,{key:0,class:"h-4 w-4 text-blue-500"})):p(u)==="Warning"?(t(),L(te,{key:1,class:"h-4 w-4 text-yellow-500"})):p(u)==="Error"||p(u)==="Critical"?(t(),L(oe,{key:2,class:"h-4 w-4 text-red-500"})):k("",!0),e("span",{class:D(["text-xs",{"text-blue-500":p(u)==="Info","text-yellow-500":p(u)==="Warning","text-red-500":p(u)==="Error"||p(u)==="Critical"}])},v(p(u)),3)])):(t(),r("div",{key:1,class:D(["truncate font-mono text-sm",{"font-mono ":u.column.columnDef.id==="time","font-mono text-gray-600":u.column.columnDef.id==="description"}])},[i(h(W),{render:u.column.columnDef.cell,props:u.getContext()},null,8,["render","props"])],2))],10,Ye))),128))]),e("tr",null,[c.getIsExpanded()?(t(),r("td",{key:0,colspan:c.getAllCells().length,class:"max-w-[39.75rem] whitespace-pre-wrap break-words border-b bg-gray-900 px-3 py-4 font-mono text-sm text-gray-200"},v(c.original.description),9,Ke)):k("",!0)])],64))),128)),l[5]||(l[5]=e("tr",{height:"99%",class:"border-b"},null,-1))])])):k("",!0),h(m).getRowModel().rows.length===0?(t(),r("div",We,l[6]||(l[6]=[e("p",{class:"text-center text-sm text-gray-500"}," No log entries found ",-1)]))):k("",!0)]),e("div",qe,[l[9]||(l[9]=e("div",null,null,-1)),e("div",Je,[e("p",Xe,v(j.value)+" - "+v(P.value)+" of "+v(F.value)+" rows ",1),e("div",Ze,[i(Q,{variant:"ghost",onClick:l[3]||(l[3]=c=>h(m).previousPage()),disabled:!h(m).getCanPreviousPage(),iconLeft:"arrow-left"},{default:S(()=>l[7]||(l[7]=[Y(" Prev ")])),_:1},8,["disabled"]),i(Q,{variant:"ghost",onClick:l[4]||(l[4]=c=>h(m).nextPage()),disabled:!h(m).getCanNextPage(),iconRight:"arrow-right"},{default:S(()=>l[8]||(l[8]=[Y(" Next ")])),_:1},8,["disabled"])])])])])])])])}}},et={components:{Header:ce,LogList:De,LogViewer:Ge,LinkControl:ne,Breadcrumbs:be},props:{mode:String,logId:String,docName:String},mounted(){this.mode||this.$router.push({name:"Log Browser",params:{mode:"bench"}})},updated(){this.mode||this.$router.push({name:"Log Browser",params:{mode:"bench"}})},data(){return{site:this.mode==="site"?this.docName:null,bench:this.mode==="bench"?this.docName:null,searchLogQuery:""}},resources:{log(){return{url:"press.api.log_browser.get_log",params:{log_type:this.mode,doc_name:this.docName,log_name:this.logId},initialData:[],auto:this.logId}}},computed:{log(){var o;return(o=this.$resources.log)==null?void 0:o.data}}},tt={class:"flex flex-col"},ot={class:"flex w-full flex-col gap-2 md:flex-row md:items-center md:justify-between"},st={class:"flex flex-row items-center gap-2"},nt={class:"flex flex-row gap-2"},lt={class:"rounded-md bg-purple-100 p-1.5"},rt={class:"flex"},at={key:0,class:"w-full"},it={class:"flex h-full min-h-[80vh] w-full items-center justify-center gap-2 text-gray-700"},dt={key:1,class:"flex h-full w-full"},ct={class:"m-4 flex h-full w-3/4 flex-col"},ut={key:0,class:"flex h-full min-h-[90vh] w-full items-center justify-center gap-2 text-gray-700"},mt={key:3,class:"flex h-full min-h-[90vh] w-full items-center justify-center gap-2 text-gray-700"};function gt(o,n,a,b,d,x){const $=de,y=U,V=R("LinkControl"),m=re,C=le,g=ae,F=Z,j=R("Header"),P=R("LogList"),E=X,p=ie,A=R("LogViewer");return t(),r("div",tt,[i(j,{class:"bg-white"},{default:S(()=>[e("div",ot,[e("div",st,[i($,{items:[{label:"Dev Tools",route:{name:"Log Browser"}},{label:"Log Browser",route:{name:"Log Browser"}}]})]),e("div",nt,[i(y,{class:"w-20",type:"select",options:[{label:"Select Mode",disabled:!0},{label:"Bench",value:"bench"},{label:"Site",value:"site"}],modelValue:a.mode,"onUpdate:modelValue":n[0]||(n[0]=_=>o.$router.push({name:"Log Browser",params:{mode:_}}))},null,8,["modelValue"]),O(i(V,{options:{doctype:"Site",filters:{status:"Active"},initialData:[{label:d.site,value:d.site}]},placeholder:"Select a site",modelValue:d.site,"onUpdate:modelValue":n[1]||(n[1]=_=>{this.site=_,o.$router.push({name:"Log Browser",params:{mode:"site",docName:_}})})},null,8,["options","modelValue"]),[[K,a.mode==="site"]]),O(i(V,{class:"w-52",options:{doctype:"Bench",filters:{status:"Active"},initialData:[{label:d.bench,value:d.bench}]},placeholder:"Select a bench",modelValue:d.bench,"onUpdate:modelValue":n[2]||(n[2]=_=>{this.bench=_,o.$router.push({name:"Log Browser",params:{mode:"bench",docName:_}})})},null,8,["options","modelValue"]),[[K,a.mode==="bench"]]),i(C,{text:"This is an experimental feature"},{default:S(()=>[e("div",lt,[i(m,{class:"h-4 w-4 text-purple-500"})])]),_:1}),i(F,{link:"https://easytouch.cloud/docs/devtools/log-browser",target:"_blank"},{default:S(()=>[i(g,{class:"h-4 w-4"})]),_:1})])])]),_:1}),e("div",rt,[a.mode==="bench"&&!d.bench||a.mode==="site"&&!d.site?(t(),r("div",at,[e("p",it," Select a "+v(a.mode)+" to view logs ",1)])):a.mode?(t(),r("div",dt,[i(P,{mode:a.mode,docName:a.docName},null,8,["mode","docName"]),e("div",ct,[o.$resources.log.loading?(t(),r("div",ut,[i(E,{class:"h-4 w-4"}),n[3]||(n[3]=e("span",null," Fetching the log... ",-1))])):o.$resources.log.error?(t(),L(p,{key:1,message:o.$resources.log.error},null,8,["message"])):a.logId?(t(),L(A,{key:2,log:x.log},null,8,["log"])):(t(),r("div",mt," Select a log to view "))])])):k("",!0)])])}const wt=q(et,[["render",gt]]);export{wt as default};
//# sourceMappingURL=LogBrowser-H84GNM_m.js.map
