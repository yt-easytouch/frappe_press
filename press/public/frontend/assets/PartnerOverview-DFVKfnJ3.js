var G=(i,n,l)=>new Promise((u,o)=>{var r=y=>{try{m(l.next(y))}catch(p){o(p)}},g=y=>{try{m(l.throw(y))}catch(p){o(p)}},m=y=>y.done?u(y.value):Promise.resolve(y.value).then(r,g);m((l=l.apply(i,n)).next())});import{x as K,r as Q,q as R,o as b,A as d,aZ as Y,aH as ee,W as F,l as f,ac as I,aW as te,ad as J,j as e,u as z,Z as a,a9 as T,n as U,aG as ae,h as D,X as N,V as L,H as se,aX as ne,B as X,aP as re,J as j,w as A,t as C,a8 as q,m as oe,aA as le,bg as H}from"./main-Dpl-JOF2.js";import{_ as ie}from"./Progress.vue_vue_type_script_setup_true_lang-DREy3z5o.js";import{G as Z}from"./GenericList-TeL894c5.js";import{C as ue}from"./ClickToCopyField-C85Phphs.js";import{l as ce}from"./stripe.esm-D4yu_pm0.js";import{R as de,S as me}from"./StripeLogo-De_iztuU.js";(function(){try{var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},n=new Error().stack;n&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[n]="40b329b7-be3b-4119-a6fb-66c6ea3e6d28",i._sentryDebugIdIdentifier="sentry-dbid-40b329b7-be3b-4119-a6fb-66c6ea3e6d28")}catch(l){}})();{var E=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};E._sentryModuleMetadata=E._sentryModuleMetadata||{},E._sentryModuleMetadata[new Error().stack]=Object.assign({},E._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const pe={name:"PartnerContribution",props:["partnerEmail"],components:{GenericList:Z},data(){return{partnerContributions:[]}},resources:{getPartnerContribution(){return{url:"press.api.partner.get_partner_contribution_list",auto:!0,params:{partner_email:this.partnerEmail},onSuccess(i){this.partnerContributions=i.map(n=>({customer_name:n.customer_name,status:n.status,due_date:n.due_date,currency:n.currency,total:n.total_before_discount,partner_total:n.partner_total}))}}}},computed:{partnerContributionsList(){return{data:this.partnerContributions,selectable:!1,columns:[{label:"Customer",fieldname:"customer_name"},{label:"Status",fieldname:"status",width:.5},{label:"Date",fieldname:"due_date",format(i){return Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(i))},width:.6},{label:"Currency",fieldname:"currency",width:.5,align:"center"},{label:"Total",fieldname:"total",format(i,n){return i===0?"":Y(i,n.currency)},align:"right",width:.6},{label:"Partner Total",fieldname:"partner_total",format(i){return ee(i)},align:"right",width:.6}]}}}},fe={class:"px-2"};function ye(i,n,l,u,o,r){const g=Q("GenericList");return b(),R("div",fe,[d(g,{options:r.partnerContributionsList},null,8,["options"])])}const _e=K(pe,[["render",ye]]),ve={key:0,class:"mt-8 flex justify-center"},be={class:"mt-8"},ge={__name:"BuyPartnerCreditsStripe",props:{amount:{type:Number,default:0},maximumAmount:{type:Number,default:0}},emits:["success"],setup(i,{emit:n}){const l=i,u=n;F("team");const o=f("Get Amount"),r=f(null),g=f(null),m=f(null),y=f(!1),p=f(null),s=f(null),S=f(null),_=f(!1),M=f(null),v=I({url:"press.api.billing.create_payment_intent_for_partnership_fees",params:{amount:l.amount},validate(){if(l.amount>l.maximumAmount)throw new J(`Amount must be lesser than or equal to ${l.maximumAmount}`)},onSuccess(P){return G(this,null,function*(){o.value="Setting up Stripe";let{publishable_key:c,client_secret:t}=P;r.value=t,p.value=yield ce(c),S.value=p.value.elements();const x={base:{color:"#171717",fontFamily:["ui-sans-serif","system-ui","-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial",'"Noto Sans"',"sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"','"Noto Color Emoji"'].join(", "),fontSmoothing:"antialiased",fontSize:"13px","::placeholder":{color:"#C7C7C7"}},invalid:{color:"#7C7C7C",iconColor:"#7C7C7C"}};s.value=S.value.create("card",{hidePostalCode:!0,style:x,classes:{complete:"",focus:"bg-gray-100"}}),o.value="Add Card Details",te(()=>{s.value.mount(M.value)}),s.value.addEventListener("change",$=>{var h;g.value=((h=$.error)==null?void 0:h.message)||null}),s.value.addEventListener("ready",()=>{_.value=!0})})}});function k(){return G(this,null,function*(){y.value=!0;let P=yield p.value.confirmCardPayment(r.value,{payment_method:{card:s.value}});P.error?(m.value=P.error.message,y.value=!1):(L.success("Payment processed successfully, we will update your account shortly on confirmation from Stripe"),y.value=!1,u("success"),m.value=null)})}return(P,c)=>(b(),R("div",null,[e("label",{class:U(["block",{"pointer-events-none h-0.5 opacity-0":o.value!="Add Card Details","mt-4":o.value=="Add Card Details"}])},[c[1]||(c[1]=e("span",{class:"text-sm leading-4 text-gray-700"}," Credit or Debit Card ",-1)),e("div",{class:"form-input mt-2 block w-full pl-3",ref_key:"cardElementRef",ref:M},null,512),d(a(T),{class:"mt-1",message:g.value},null,8,["message"])],2),o.value=="Setting up Stripe"?(b(),R("div",ve,[d(a(ae),{class:"h-4 w-4 text-gray-700"})])):z("",!0),d(a(T),{class:"mt-2",message:a(v).error||m.value},null,8,["message"]),e("div",be,[o.value=="Get Amount"?(b(),D(a(N),{key:0,class:"w-full",size:"md",variant:"solid",label:"Proceed to payment using Stripe",loading:a(v).loading,onClick:c[0]||(c[0]=t=>a(v).submit())},null,8,["loading"])):o.value=="Add Card Details"?(b(),D(a(N),{key:1,class:"w-full",size:"md",variant:"solid",label:"Make payment via Stripe",loading:y.value,onClick:k},null,8,["loading"])):z("",!0)])]))}},xe={key:0,class:"mt-2.5 inline-flex gap-2 text-base text-gray-700"},he={class:"mt-8"},we={__name:"BuyPartnerCreditsRazorpay",props:{amount:{type:Number,default:0},maximumAmount:{type:Number,default:0},type:{type:String,default:"prepaid-credits"}},emits:["success"],setup(i,{emit:n}){const l=i,u=n,o=F("team"),r=f(!1),g=f(!1),m=f(null);se(()=>{m.value=document.createElement("script"),m.value.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),m.value.async=!0,document.head.appendChild(m.value)}),ne(()=>{var v;(v=m.value)==null||v.remove()});let y=l.type==="prepaid-credits"?"Prepaid Credits":"Partnership Fee";const p=I({url:"press.api.billing.create_razorpay_order",params:{amount:l.amount,type:y},onSuccess:v=>S(v),validate:()=>{if(l.amount>l.maximumAmount)throw new J("Amount more than maximum amount required")}}),s=I({url:"press.api.billing.handle_razorpay_payment_failed",onSuccess:()=>{console.log("Payment Failed.")}});function S(v){var P;const k={key:v.key_id,order_id:v.order_id,name:"Easytouch Cloud",image:"https://frappe.io/files/cloud.png",prefill:{email:(P=o.doc)==null?void 0:P.user},handler:M,theme:{color:"#171717"}},V=new Razorpay(k);V.open(),V.on("payment.failed",_)}function _(v){s.submit({response:v}),L.error("Payment failed")}function M(){r.value=!0,u("success"),L.success("Payment successful")}return(v,k)=>(b(),R("div",null,[a(o).doc.currency==="INR"?(b(),R("span",xe,[d(a(X),{name:"info",class:"my-1 h-4"}),k[1]||(k[1]=e("span",{class:"leading-5"}," If you select Razorpay, you can pay using Credit Card, Debit Card, Net Banking, UPI, Wallets, etc. If you are using Net Banking, it may take upto 5 days for balance to reflect. ",-1))])):z("",!0),d(a(T),{class:"mt-3",message:a(p).error},null,8,["message"]),e("div",he,[r.value?(b(),D(a(N),{key:1,class:"w-full",size:"md",label:"Confirming payment",variant:"solid",loading:g.value},null,8,["loading"])):(b(),D(a(N),{key:0,class:"w-full",size:"md",variant:"solid",label:"Proceed to payment using Razorpay",loading:a(p).loading,onClick:k[0]||(k[0]=V=>a(p).submit())},null,8,["loading"]))])]))}},Ce={class:"grid w-4 place-items-center text-sm text-gray-700"},Se={class:"grid w-4 place-items-center text-sm text-gray-700"},ke={class:"mt-4"},Pe={class:"mt-1.5 grid grid-cols-1 gap-2 sm:grid-cols-2"},$e={__name:"PartnerCreditsForm",emits:["success"],setup(i,{emit:n}){const l=n,u=F("team"),o=re({doctype:"Press Settings",name:"Press Settings",auto:!0}),r=j(()=>{var s;if(!o.doc)return 0;const p=((s=u.doc)==null?void 0:s.currency)=="INR"?o.doc.partnership_fee_inr:o.doc.partnership_fee_usd;return Math.ceil(p)}),g=f(r.value),m=f(""),y=j(()=>{var s;const p=g.value||0;return((s=u.doc)==null?void 0:s.currency)==="INR"?(p+p*(u.doc.billing_info.gst_percentage||0)).toFixed(2):p});return(p,s)=>{var S;return b(),R("div",null,[e("div",null,[d(a(q),{label:`Amount (Minimum Amount: ${r.value})`,class:"mb-3",modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=_=>g.value=_),modelModifiers:{number:!0},name:"amount",autocomplete:"off",type:"number",max:r.value},{prefix:A(()=>[e("div",Ce,C(a(u).doc.currency==="INR"?"₹":"$"),1)]),_:1},8,["label","modelValue","max"]),a(u).doc.currency==="INR"?(b(),D(a(q),{key:0,label:`Total Amount + GST (${((S=a(u).doc)==null?void 0:S.billing_info.gst_percentage)*100}%)`,disabled:"",modelValue:y.value,name:"total",autocomplete:"off",type:"number"},{prefix:A(()=>[e("div",Se,C(a(u).doc.currency==="INR"?"₹":"$"),1)]),_:1},8,["label","modelValue"])):z("",!0)]),e("div",ke,[s[7]||(s[7]=e("div",{class:"text-xs text-gray-600"},"Select Payment Gateway",-1)),e("div",Pe,[a(u).doc.currency==="INR"||a(u).doc.razorpay_enabled?(b(),D(a(N),{key:0,size:"lg",class:U({"border-[1.5px] border-gray-700":m.value==="Razorpay"}),onClick:s[1]||(s[1]=_=>m.value="Razorpay")},{default:A(()=>[d(de,{class:"w-24"})]),_:1},8,["class"])):z("",!0),d(a(N),{size:"lg",class:U({"border-[1.5px] border-gray-700":m.value==="Stripe"}),onClick:s[2]||(s[2]=_=>m.value="Stripe")},{default:A(()=>[d(me,{class:"h-7 w-24"})]),_:1},8,["class"])])]),m.value==="Stripe"?(b(),D(ge,{key:0,amount:g.value,maximumAmount:r.value,onSuccess:s[3]||(s[3]=()=>l("success")),onCancel:s[4]||(s[4]=_=>p.show=!1)},null,8,["amount","maximumAmount"])):z("",!0),m.value==="Razorpay"?(b(),D(we,{key:1,amount:g.value,maximumAmount:r.value,type:"Partnership Fee",onSuccess:s[5]||(s[5]=()=>l("success")),onCancel:s[6]||(s[6]=_=>p.show=!1)},null,8,["amount","maximumAmount"])):z("",!0)])}}},Ne={class:"px-2"},Re={__name:"PartnerMembers",props:{partnerName:String},setup(i){const l=I({url:"press.api.partner.get_partner_members",cache:"partnerMembers",auto:!0,params:{partner:i.partnerName},transform(o){return o=o.map(r=>({full_name:r.member_name,email:r.member_email,course:r.course=="frappe-developer-certification"?"Framework":"ERPNext",version:r.version})),o}}),u=j(()=>({data:l.data||[],selectable:!1,columns:[{label:"Name",fieldname:"full_name"},{label:"Email",fieldname:"email"},{label:"Course",fieldname:"course",width:.6},{label:"Version",fieldname:"version",width:.5,align:"center"}]}));return(o,r)=>(b(),R("div",Ne,[d(Z,{options:u.value},null,8,["options"])]))}},ze={class:"flex flex-col gap-5 overflow-y-auto px-60 py-6"},De={class:"flex flex-col"},Ae={class:"text-3xl font-semibold"},Ie={class:"rounded-lg text-base text-gray-900 shadow"},Me={class:"flex flex-col gap-2.5 p-4"},Ve={class:"flex"},Be={class:"flex items-center gap-0.5"},Ee={class:"text-xl font-semibold"},je={class:"pt-2"},Fe={class:"text-base font-medium text-gray-500"},Ge={class:"flex justify-between gap-4"},Te={class:"flex-1"},Ue={class:"flex items-center justify-between"},Le={class:"text-xl font-semibold py-2"},Oe={class:"text-sm text-gray-600"},We={class:"flex-1"},qe={class:"flex items-center justify-between"},He={class:"flex items-center"},Je={class:"text-xl font-semibold py-2"},Xe={class:"flex justify-between gap-4"},Ze={class:"rounded-lg text-base flex-1 text-gray-900 p-4 shadow"},Ke={class:"flex h-full flex-col justify-between gap-2"},Qe={class:"rounded-lg text-base flex-1 text-gray-900 p-4 shadow"},Ye={class:"flex h-full flex-col justify-between"},et={class:"flex items-center justify-between"},tt={class:"flex"},at={class:"text-base font-medium text-gray-700"},st={key:0},nt={class:"text-sm text-gray-600"},mt={__name:"PartnerOverview",setup(i){const n=F("team"),l=f(!1),u=f(!1),o=f(!1),r=I({url:"press.api.partner.get_partner_details",auto:!0,cache:"partnerDetails",params:{partner_email:n.doc.partner_email},onSuccess(){v(r.data.partner_type)}}),g=j(()=>{var x;const c=new Date,t=new Date((x=r.data)==null?void 0:x.end_date);return Math.ceil((t-c)/(1e3*60*60*24))});function m(){var $;const c=H(($=r.data)==null?void 0:$.end_date),t=H(),x=c.diff(t,"days");return x>=0&&x<=15}const y=I({url:"press.api.partner.get_current_month_partner_contribution",auto:!0,cache:"currentMonthContribution",params:{partner_email:n.doc.partner_email}}),p=I({url:"press.api.partner.get_prev_month_partner_contribution",auto:!0,cache:"prevMonthContribution",params:{partner_email:n.doc.partner_email}}),s=f(0),S=f(""),_=f(0);function M(c){return Math.ceil(y.data/c*100)}function v(c){var B;const t={Gold:575e3,Silver:23e4,Bronze:57500},x={Gold:6900,Silver:2875,Bronze:690},$=(B=r.data)==null?void 0:B.partner_type;let h="";switch($){case"Entry":h="Bronze",_.value=n.doc.currency==="INR"?t.Bronze:x.Bronze;break;case"Bronze":h="Silver",_.value=n.doc.currency==="INR"?t.Silver:x.Silver;break;case"Silver":h="Gold",_.value=n.doc.currency==="INR"?t.Gold:x.Gold;break;default:h="Gold",_.value=n.doc.currency==="INR"?t.Gold:x.Gold}S.value=h,s.value=M(_.value),_.value=_.value-y.data}oe(()=>r.data,c=>{c&&v(c.partner_type)},{deep:!0});const k=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),V=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:n.doc.currency,maximumFractionDigits:2}).format(c),P=c=>new Intl.NumberFormat("en-US",{notation:"compact",compactDisplay:"short"}).format(c);return(c,t)=>{var $,h,B,O,W;const x=le;return b(),R("div",ze,[e("div",De,[t[7]||(t[7]=e("div",{class:"text-gray-500"},"Welcome back!",-1)),e("div",null,[e("h1",Ae,C(($=a(r).data)==null?void 0:$.company_name),1)])]),e("div",Ie,[e("div",Me,[e("div",Ve,[e("div",Be,[d(a(X),{name:"award",class:"h-5 text-gray-700"}),e("h3",Ee,C((h=a(r).data)==null?void 0:h.partner_type)+" Tier ",1)])]),e("div",je,[d(a(ie),{size:"lg",value:s.value,label:"Current Progress",hint:!1},{hint:A(()=>[e("span",Fe,C(P(_.value))+" to reach "+C(S.value),1)]),_:1},8,["value"])]),t[11]||(t[11]=e("div",{class:"my-1 h-px bg-gray-100"},null,-1)),e("div",Ge,[e("div",Te,[e("div",Ue,[t[8]||(t[8]=e("div",{class:"text-sm text-gray-600"}," Current Month Contribution ",-1)),d(a(N),{label:"Details",onClick:t[0]||(t[0]=w=>l.value=!0)})]),e("div",Le,C(V(a(y).data)||"0.0"),1),e("div",Oe,[e("span",null,"Previous Month: "+C(V(a(p).data)||"0.0"),1)])]),t[10]||(t[10]=e("div",{class:"mx-1 w-px border-r"},null,-1)),e("div",We,[e("div",qe,[t[9]||(t[9]=e("div",{class:"text-sm text-gray-600"},"Certified Members",-1)),d(a(N),{label:"View",onClick:t[1]||(t[1]=w=>o.value=!0)})]),e("div",He,[e("div",Je,C(((B=a(r).data)==null?void 0:B.custom_number_of_certified_members)||0),1)])])])])]),e("div",Xe,[e("div",Ze,[e("div",Ke,[t[12]||(t[12]=e("div",{class:"flex"},[e("h3",{class:"font-semibold text-lg"},"Partner Referral Code")],-1)),d(ue,{textContent:(O=a(n).doc)==null?void 0:O.partner_referral_code},null,8,["textContent"]),t[13]||(t[13]=e("span",{class:"text-sm text-gray-600"},"Share code with customers to link with your account.",-1))])]),e("div",Qe,[e("div",Ye,[t[14]||(t[14]=e("div",{class:"flex"},[e("h3",{class:"font-semibold text-lg"},"Renewal Details")],-1)),e("div",et,[e("div",tt,[e("span",at,C(k((W=a(r).data)==null?void 0:W.end_date)),1)]),m()?(b(),R("div",st,[d(a(N),{label:"Renew",disabled:!1,variant:"solid",onClick:t[2]||(t[2]=w=>u.value=!0)})])):z("",!0)]),e("span",nt,"Renewal in "+C(g.value)+" days",1)])])]),d(x,{show:l.value,modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=w=>l.value=w),options:{size:"5xl",title:"Contributions of this month"}},{"body-content":A(()=>[d(_e,{partnerEmail:a(n).doc.partner_email},null,8,["partnerEmail"])]),_:1},8,["show","modelValue"]),d(x,{show:u.value,modelValue:u.value,"onUpdate:modelValue":t[5]||(t[5]=w=>u.value=w),options:{title:"Pay Partnership Fee"}},{"body-content":A(()=>[d($e,{onSuccess:t[4]||(t[4]=()=>{u.value=!1})})]),_:1},8,["show","modelValue"]),d(x,{show:o.value,modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=w=>o.value=w),options:{size:"3xl",title:"Certified Members"}},{"body-content":A(()=>{var w;return[d(Re,{partnerName:(w=a(r).data)==null?void 0:w.name},null,8,["partnerName"])]}),_:1},8,["show","modelValue"])])}}};export{mt as default};
//# sourceMappingURL=PartnerOverview-DFVKfnJ3.js.map
