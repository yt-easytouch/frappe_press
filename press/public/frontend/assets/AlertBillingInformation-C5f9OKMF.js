var w=(s,e,o)=>new Promise((_,t)=>{var m=l=>{try{r(o.next(l))}catch(d){t(d)}},y=l=>{try{r(o.throw(l))}catch(d){t(d)}},r=l=>l.done?_(l.value):Promise.resolve(l.value).then(m,y);r((o=o.apply(s,e)).next())});import{x as P,q as b,o as i,h as f,u as p,j as u,A as a,a8 as S,a9 as D,n as x,aj as I,w as c,Y as h,X as k,t as v,aA as M,z as A,D as B}from"./main-Dpl-JOF2.js";import{_ as $}from"./Alert-COV4XS8q.js";import{S as T}from"./StripeLogo-BRF2qIyd.js";import{l as E}from"./stripe.esm-D4yu_pm0.js";import G from"./BillingInformationDialog-B5pmLI5R.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="fc7ff1e1-b6d3-4aa6-91c9-69d6c34ba128",s._sentryDebugIdIdentifier="sentry-dbid-fc7ff1e1-b6d3-4aa6-91c9-69d6c34ba128")}catch(o){}})();{var C=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};C._sentryModuleMetadata=C._sentryModuleMetadata||{},C._sentryModuleMetadata[new Error().stack]=Object.assign({},C._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const F={name:"BuyPrepaidCredits",components:{StripeLogo:T},props:{minimumAmount:{default:0}},mounted(){this.updateTotal()},watch:{creditsToBuy(){this.updateTotal()}},data(){return{step:"Get Amount",clientSecret:null,creditsToBuy:this.minimumAmount||null,total:this.minimumAmount,cardErrorMessage:null,errorMessage:null,paymentInProgress:!1}},resources:{createPaymentIntent(){return{url:"press.api.billing.create_payment_intent_for_buying_credits",params:{amount:this.creditsToBuy},validate(){if(this.creditsToBuy<this.minimumAmount&&!this.$account.team.erpnext_partner)return`Amount must be greater than ${this.minimumAmount}`},onSuccess(e){return w(this,null,function*(){this.step="Setting up Stripe";let{publishable_key:o,client_secret:_}=e;this.clientSecret=_,this.stripe=yield E(o),this.elements=this.stripe.elements();let t=this.$theme,m={base:{color:t.colors.black,fontFamily:t.fontFamily.sans.join(", "),fontSmoothing:"antialiased",fontSize:"13px","::placeholder":{color:t.colors.gray[400]}},invalid:{color:t.colors.red[600],iconColor:t.colors.red[600]}};this.card=this.elements.create("card",{hidePostalCode:!0,style:m,classes:{complete:"",focus:"bg-gray-100"}}),this.step="Add Card Details",this.$nextTick(()=>{this.card.mount(this.$refs["card-element"])}),this.card.addEventListener("change",y=>{var r;this.cardErrorMessage=((r=y.error)==null?void 0:r.message)||null}),this.card.addEventListener("ready",()=>{this.ready=!0})})}}}},methods:{updateTotal(){this.$account.team.currency==="INR"?this.total=Number((this.creditsToBuy+this.creditsToBuy*this.$account.billing_info.gst_percentage).toFixed(2)):this.total=this.creditsToBuy},setupStripe(){this.$resources.createPaymentIntent.submit()},onBuyClick(){return w(this,null,function*(){this.paymentInProgress=!0;let s=yield this.stripe.confirmCardPayment(this.clientSecret,{payment_method:{card:this.card}});this.paymentInProgress=!1,s.error?this.errorMessage=s.error.message:(this.$emit("success"),this.errorMessage=null,this.creditsToBuy=null)})}}},N={class:"form-input mt-2 block w-full py-2 pl-3",ref:"card-element"},R={key:2,class:"mt-8 flex justify-center"},O={class:"mt-4 flex w-full justify-between"},j={key:0},L={key:1};function U(s,e,o,_,t,m){const y=S,r=D,l=I,d=T,g=k;return i(),b("div",null,[t.step=="Get Amount"?(i(),f(y,{key:0,class:"mb-2",label:"Credits",modelValue:t.creditsToBuy,"onUpdate:modelValue":e[0]||(e[0]=n=>t.creditsToBuy=n),modelModifiers:{number:!0},name:"amount",autocomplete:"off",type:"number",min:o.minimumAmount},null,8,["modelValue","min"])):p("",!0),u("label",{class:x(["block",{"h-0.5 opacity-0":t.step!="Add Card Details","mt-4":t.step=="Add Card Details"}])},[e[4]||(e[4]=u("span",{class:"text-sm leading-4 text-gray-700"}," Credit or Debit Card ",-1)),u("div",N,null,512),a(r,{class:"mt-1",message:t.cardErrorMessage},null,8,["message"])],2),t.step=="Get Amount"?(i(),f(y,{key:1,label:"Total Amount + GST(if applicable)",disabled:"",modelValue:t.total,"onUpdate:modelValue":e[1]||(e[1]=n=>t.total=n),name:"total",autocomplete:"off",type:"number"},null,8,["modelValue"])):p("",!0),t.step=="Setting up Stripe"?(i(),b("div",R,[a(l,{class:"h-4 w-4 text-gray-600"})])):p("",!0),a(r,{class:"mt-2",message:s.$resources.createPaymentIntent.error||t.errorMessage},null,8,["message"]),u("div",O,[a(d),t.step=="Get Amount"?(i(),b("div",j,[a(g,{variant:"solid",onClick:e[2]||(e[2]=n=>s.$resources.createPaymentIntent.submit()),loading:s.$resources.createPaymentIntent.loading},{default:c(()=>e[5]||(e[5]=[h(" Next ")])),_:1},8,["loading"])])):p("",!0),t.step=="Add Card Details"?(i(),b("div",L,[a(g,{onClick:e[3]||(e[3]=n=>s.$emit("cancel"))},{default:c(()=>e[6]||(e[6]=[h(" Cancel ")])),_:1}),a(g,{class:"ml-2",variant:"solid",onClick:m.onBuyClick,loading:t.paymentInProgress},{default:c(()=>e[7]||(e[7]=[h(" Buy Credits ")])),_:1},8,["onClick","loading"])])):p("",!0)])])}const V=P(F,[["render",U]]),W="/assets/press/frontend/assets/razorpay-CemtX--w.svg",q="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2024.0.3,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20468%20222.5'%20style='enable-background:new%200%200%20468%20222.5;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill-rule:evenodd;clip-rule:evenodd;fill:%23635BFF;}%20%3c/style%3e%3cg%3e%3cpath%20class='st0'%20d='M414,113.4c0-25.6-12.4-45.8-36.1-45.8c-23.8,0-38.2,20.2-38.2,45.6c0,30.1,17,45.3,41.4,45.3%20c11.9,0,20.9-2.7,27.7-6.5v-20c-6.8,3.4-14.6,5.5-24.5,5.5c-9.7,0-18.3-3.4-19.4-15.2h48.9C413.8,121,414,115.8,414,113.4z%20M364.6,103.9c0-11.3,6.9-16,13.2-16c6.1,0,12.6,4.7,12.6,16H364.6z'/%3e%3cpath%20class='st0'%20d='M301.1,67.6c-9.8,0-16.1,4.6-19.6,7.8l-1.3-6.2h-22v116.6l25-5.3l0.1-28.3c3.6,2.6,8.9,6.3,17.7,6.3%20c17.9,0,34.2-14.4,34.2-46.1C335.1,83.4,318.6,67.6,301.1,67.6z%20M295.1,136.5c-5.9,0-9.4-2.1-11.8-4.7l-0.1-37.1%20c2.6-2.9,6.2-4.9,11.9-4.9c9.1,0,15.4,10.2,15.4,23.3C310.5,126.5,304.3,136.5,295.1,136.5z'/%3e%3cpolygon%20class='st0'%20points='223.8,61.7%20248.9,56.3%20248.9,36%20223.8,41.3%20'/%3e%3crect%20x='223.8'%20y='69.3'%20class='st0'%20width='25.1'%20height='87.5'/%3e%3cpath%20class='st0'%20d='M196.9,76.7l-1.6-7.4h-21.6v87.5h25V97.5c5.9-7.7,15.9-6.3,19-5.2v-23C214.5,68.1,202.8,65.9,196.9,76.7z'/%3e%3cpath%20class='st0'%20d='M146.9,47.6l-24.4,5.2l-0.1,80.1c0,14.8,11.1,25.7,25.9,25.7c8.2,0,14.2-1.5,17.5-3.3V135%20c-3.2,1.3-19,5.9-19-8.9V90.6h19V69.3h-19L146.9,47.6z'/%3e%3cpath%20class='st0'%20d='M79.3,94.7c0-3.9,3.2-5.4,8.5-5.4c7.6,0,17.2,2.3,24.8,6.4V72.2c-8.3-3.3-16.5-4.6-24.8-4.6%20C67.5,67.6,54,78.2,54,95.9c0,27.6,38,23.2,38,35.1c0,4.6-4,6.1-9.6,6.1c-8.3,0-18.9-3.4-27.3-8v23.8c9.3,4,18.7,5.7,27.3,5.7%20c20.8,0,35.1-10.3,35.1-28.2C117.4,100.6,79.3,105.9,79.3,94.7z'/%3e%3c/g%3e%3c/svg%3e",X={name:"PrepaidCreditsDialog",components:{BuyPrepaidCredits:V},data(){return{paymentGateway:null,creditsToBuy:this.minimumAmount,total:this.minimumAmount}},mounted(){const s=document.createElement("script");s.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),s.async=!0,document.head.appendChild(s),this.$account.team.currency==="USD"&&!this.$account.team.razorpay_enabled&&(this.paymentGateway="stripe"),this.updateTotal()},watch:{creditsToBuy(){this.updateTotal()}},props:{modelValue:{default:!0},minimumAmount:{type:Number,default:0}},emits:["update:show","success"],resources:{createRazorpayOrder(){return{url:"press.api.billing.create_razorpay_order",params:{amount:this.creditsToBuy},onSuccess(s){this.processOrder(s)},validate(){if(this.creditsToBuy<this.minimumAmount)return"Amount less than minimum amount required"}}},handlePaymentSuccess(){return{url:"press.api.billing.handle_razorpay_payment_success",onSuccess(){this.$emit("success")}}},handlePaymentFailed(){return{url:"press.api.billing.handle_razorpay_payment_failed",onSuccess(){console.log("Payment Failed.")}}}},methods:{updateTotal(){this.$account.team.currency==="INR"?this.total=Number((this.creditsToBuy+this.creditsToBuy*this.$account.billing_info.gst_percentage).toFixed(2)):this.total=this.creditsToBuy},buyCreditsWithRazorpay(){this.$resources.createRazorpayOrder.submit()},processOrder(s){const e={key:s.key_id,order_id:s.order_id,name:"Easytouch Cloud",image:"/assets/press/images/frappe-cloud-logo.png",prefill:{email:this.$account.team.user},theme:{color:"#2490EF"},handler:this.handlePaymentSuccess},o=new Razorpay(e);o.open(),o.on("payment.failed",this.handlePaymentFailed)},handlePaymentSuccess(s){this.$emit("success")},handlePaymentFailed(s){this.$resources.handlePaymentFailed.submit({response:s})}}},Y={class:"mt-1 text-base text-gray-600"},H={key:1},J={class:"mt-4 flex w-full justify-between"},K={key:0,class:"grid grid-cols-1 gap-2 sm:grid-cols-2"};function Q(s,e,o,_,t,m){const y=V,r=S,l=D,d=k,g=M;return i(),f(g,{modelValue:o.modelValue,"onUpdate:modelValue":e[7]||(e[7]=n=>s.$emit("update:show",n))},{"body-title":c(()=>[e[8]||(e[8]=u("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"}," Add money to your account ",-1)),u("p",Y,v(t.paymentGateway?"":"Choose your payment gateway"),1)]),"body-content":c(()=>[t.paymentGateway==="stripe"?(i(),f(y,{key:0,minimumAmount:o.minimumAmount,onSuccess:e[0]||(e[0]=n=>s.$emit("success")),onCancel:e[1]||(e[1]=n=>s.$emit("update:show",!1))},null,8,["minimumAmount"])):p("",!0),t.paymentGateway==="razorpay"?(i(),b("div",H,[a(r,{label:`Amount (Minimum Amount: ${o.minimumAmount})`,class:"mb-2",modelValue:t.creditsToBuy,"onUpdate:modelValue":e[2]||(e[2]=n=>t.creditsToBuy=n),modelModifiers:{number:!0},name:"amount",autocomplete:"off",type:"number",min:o.minimumAmount},null,8,["label","modelValue","min"]),a(r,{label:"Total Amount + GST(if applicable)",disabled:"",modelValue:t.total,"onUpdate:modelValue":e[3]||(e[3]=n=>t.total=n),name:"total",autocomplete:"off",type:"number"},null,8,["modelValue"]),e[11]||(e[11]=u("p",{class:"mt-3 text-xs"},[u("span",{class:"font-semibold"},"Note"),h(": If you are using Net Banking, it may take upto 5 days for balance to reflect. ")],-1)),a(l,{class:"mt-3",message:s.$resources.createRazorpayOrder.error},null,8,["message"]),u("div",J,[a(d,{onClick:e[4]||(e[4]=n=>t.paymentGateway=null)},{default:c(()=>e[9]||(e[9]=[h("Go Back")])),_:1}),u("div",null,[a(d,{variant:"solid",loading:s.$resources.createRazorpayOrder.loading,onClick:m.buyCreditsWithRazorpay},{default:c(()=>e[10]||(e[10]=[h(" Buy ")])),_:1},8,["loading","onClick"])])])])):p("",!0),u("div",null,[t.paymentGateway?p("",!0):(i(),b("div",K,[s.$account.team.currency==="INR"||s.$account.team.razorpay_enabled?(i(),f(d,{key:0,onClick:e[5]||(e[5]=n=>t.paymentGateway="razorpay"),class:"py-2"},{default:c(()=>e[12]||(e[12]=[u("img",{class:"w-24",src:W,alt:"Razorpay Logo"},null,-1)])),_:1})):p("",!0),a(d,{onClick:e[6]||(e[6]=n=>t.paymentGateway="stripe")},{default:c(()=>e[13]||(e[13]=[u("img",{class:"h-7 w-24",src:q,alt:"Stripe Logo"},null,-1)])),_:1})]))])]),_:1},8,["modelValue"])}const z=P(X,[["render",Q]]),Z=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"})),ee={name:"AlertBillingInformation",components:{BillingInformationDialog:A(()=>B(()=>import("./BillingInformationDialog-B5pmLI5R.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),PrepaidCreditsDialog:A(()=>B(()=>Promise.resolve().then(()=>Z),void 0))},data(){return{showCardDialog:!1,showPrepaidCreditsDialog:!1}},methods:{handleAddPrepaidCreditsSuccess(){this.showPrepaidCreditsDialog=!1}},computed:{isDefaultPaymentModeCard(){return this.$account.team.payment_mode=="Card"},message(){return this.isDefaultPaymentModeCard?"We couldn't verify your card with micro charge. Please add some balance to your account to start creating sites.":"You haven't added your billing information yet. Add it to start creating sites."}}};function te(s,e,o,_,t,m){const y=k,r=G,l=z,d=$;return s.$account.hasBillingInfo?p("",!0):(i(),f(d,{key:0,title:"Account Setup"},{actions:c(()=>[a(y,{variant:"solid",onClick:e[0]||(e[0]=g=>m.isDefaultPaymentModeCard?t.showPrepaidCreditsDialog=!0:t.showCardDialog=!0),class:"whitespace-nowrap"},{default:c(()=>[h(v(m.isDefaultPaymentModeCard?"Add Balance":"Add Billing Information"),1)]),_:1})]),default:c(()=>[h(v(m.message)+" ",1),t.showCardDialog?(i(),f(r,{key:0,modelValue:t.showCardDialog,"onUpdate:modelValue":e[1]||(e[1]=g=>t.showCardDialog=g)},null,8,["modelValue"])):p("",!0),t.showPrepaidCreditsDialog?(i(),f(l,{key:1,show:t.showPrepaidCreditsDialog,"onUpdate:show":e[2]||(e[2]=g=>t.showPrepaidCreditsDialog=g),"minimum-amount":s.$account.team.currency==="INR"?10:1,onSuccess:m.handleAddPrepaidCreditsSuccess},null,8,["show","minimum-amount","onSuccess"])):p("",!0)]),_:1}))}const le=P(ee,[["render",te]]);export{Z as P,le as _,z as a};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/BillingInformationDialog-B5pmLI5R.js","assets/main-Dpl-JOF2.js","assets/main-B0ZLDivw.css","assets/StripeCard-BRr8QCrN.js","assets/StripeLogo-BRF2qIyd.js","assets/AddressForm-Cz0XUJgF.js","assets/Form-CIPLpg2e.js","assets/stripe.esm-D4yu_pm0.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=AlertBillingInformation-C5f9OKMF.js.map
