import{x as D,q as b,o as r,j as n,u as S,a4 as R,t as z,n as M,V as y,h as m,w as d,Y as f,X as C,ao as j,a2 as k,r as h,A as c,aA as N,bw as A,az as E,aV as F,aj as Q,a7 as K,F as O,bz as x,bA as B}from"./main-Dpl-JOF2.js";import{_ as U}from"./Breadcrumbs-yx7M4N4X.js";import{_ as H}from"./Header-BNMc-OFG.js";import{_ as J}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CH7TZuXP.js";import{D as X,_ as Y}from"./DatabaseTableSchemaDialog-BbI1Ahkp.js";import"./index-C2jCZcKa.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="ee940e15-5f53-46af-bb8d-770a6b3faf71",s._sentryDebugIdIdentifier="sentry-dbid-ee940e15-5f53-46af-bb8d-770a6b3faf71")}catch(a){}})();{var v=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};v._sentryModuleMetadata=v._sentryModuleMetadata||{},v._sentryModuleMetadata[new Error().stack]=Object.assign({},v._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const W={name:"ToggleContent",props:{label:{type:String,required:!0},subLabel:{type:String,default:""}},data(){return{isVisible:!1}},methods:{toggleVisibility(){this.isVisible=!this.isVisible}}},Z={class:"rounded border text-base"},G={class:"font-medium text-gray-800"},ee={key:0,class:"mt-2 text-sm text-gray-700"},se={key:0,class:"text-sm leading-normal"};function te(s,e,a,l,t,i){return r(),b("div",Z,[n("div",{class:M(["flex cursor-pointer select-none flex-row items-center justify-between gap-2 p-4",{"!pb-2":t.isVisible}]),onClick:e[0]||(e[0]=(...u)=>i.toggleVisibility&&i.toggleVisibility(...u))},[n("div",null,[n("p",G,z(a.label),1),a.subLabel?(r(),b("p",ee,z(a.subLabel),1)):S("",!0)]),t.isVisible?R(s.$slots,"actions",{key:0}):S("",!0)],2),t.isVisible?(r(),b("div",se,[R(s.$slots,"default")])):S("",!0)])}const ae=D(W,[["render",te]]),ie={props:{row:{type:Object,required:!0},site:{type:String,required:!0}},data(){return{isKilled:!1}},resources:{killProcess(){return{url:"press.api.client.run_doc_method",initialData:{},makeParams:()=>({dt:"Site",dn:this.site,method:"kill_database_process",args:{id:this.row.ID}}),onSuccess:s=>{this.isKilled=!0,y.success("Database Process Killed")},auto:!1}}},methods:{killProcess(){this.$resources.killProcess.submit()}}},le={key:0};function ne(s,e,a,l,t,i){const u=C;return t.isKilled?(r(),b("p",le,"Process Killed")):(r(),m(u,{key:1,onClick:i.killProcess,loading:this.$resources.killProcess.loading,loadingText:"Killing",iconLeft:"x",variant:"ghost",class:"w-full"},{default:d(()=>e[0]||(e[0]=[f("Kill")])),_:1},8,["onClick","loading"]))}const q=D(ie,[["render",ne]]),re={name:"DatabaseTableSchemaSizeDetails",props:{site:{type:String,required:!0},tableSchemas:{type:Object,required:!0},viewSchemaDetails:{type:Function,required:!0}},components:{ObjectList:j},computed:{listOptions(){if(!this.tableSchemas)return{};let s=[];for(const e in this.tableSchemas){const a=this.tableSchemas[e];s.push({table_name:e,index_size:this.bytesToMB(a.size.index_length),data_size:this.bytesToMB(a.size.data_length),total_size:this.bytesToMB(a.size.total_size)})}return s.sort((e,a)=>a.total_size-e.total_size),{data:()=>s,hideControls:!0,columns:[{label:"Table Name",fieldname:"table_name",width:"180px",align:"left",type:"Component",component({row:e}){return k("div",{class:"truncate text-base cursor-copy",onClick(){"clipboard"in navigator&&(navigator.clipboard.writeText(e.table_name),y.success("Copied to clipboard"))}},[e.table_name])}},{label:"Total Size (MB)",fieldname:"total_size",align:"center"},{label:"Data Size (MB)",fieldname:"data_size",align:"center"},{label:"Index Size (MB)",fieldname:"index_size",align:"center"},{label:"View Schema",fieldname:"table_name",type:"Component",align:"center",component:({row:e})=>k("button",{class:"inline-flex items-center justify-center gap-2 transition-colors focus:outline-none text-gray-800 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 focus-visible:ring focus-visible:ring-gray-400 h-7 text-base px-2 rounded",onClick:()=>{this.viewSchemaDetails(e.table_name)}},["View Schema"])}]}}},methods:{bytesToMB(s){return(s/(1024*1024)).toFixed(2)}}};function oe(s,e,a,l,t,i){const u=h("ObjectList"),g=N;return r(),m(g,{options:{title:"Table Size",size:"3xl"}},{"body-content":d(()=>[c(u,{options:i.listOptions},null,8,["options"])]),_:1})}const ue=D(re,[["render",oe]]),de={props:{row:{type:Object,required:!0},site:{type:String,required:!0}},data(){return{isJobRunning:!1,jobName:null}},resources:{addIndex(){return{url:"press.api.client.run_doc_method",initialData:{},makeParams:()=>({dt:"Site",dn:this.site,method:"add_database_index",args:{table:this.row.Table,column:this.row.Column}}),onSuccess:s=>{var e,a,l,t;s!=null&&s.message&&((e=s==null?void 0:s.message)!=null&&e.success?(y.success((a=s==null?void 0:s.message)==null?void 0:a.message),this.isJobRunning=!0,this.jobName=(l=s==null?void 0:s.message)==null?void 0:l.job_name):y.error((t=s==null?void 0:s.message)==null?void 0:t.message))},auto:!1}}},methods:{addIndex(){this.$resources.addIndex.submit()},viewJob(){this.jobName&&window.open(this.$router.resolve(`/sites/${this.site}/insights/jobs/${this.jobName}`).href,"_blank")}}};function ce(s,e,a,l,t,i){const u=C;return t.isJobRunning?(r(),m(u,{key:0,onClick:i.viewJob,variant:"ghost",class:"w-full"},{default:d(()=>e[0]||(e[0]=[f("View Job")])),_:1},8,["onClick"])):(r(),m(u,{key:1,onClick:i.addIndex,loading:this.$resources.addIndex.loading,loadingText:"Adding Index",iconLeft:"plus",variant:"ghost",class:"w-full"},{default:d(()=>e[1]||(e[1]=[f("Add DB Index")])),_:1},8,["onClick","loading"]))}const me=D(de,[["render",ce]]),be={name:"DatabasePerformanceSchemaDisabledNotice"},fe={class:"flex h-60 flex-col items-center justify-center gap-1"};function ge(s,e,a,l,t,i){return r(),b("div",fe,e[0]||(e[0]=[n("p",{class:"text-base text-gray-700"}," Performance Schema is not enabled on database server ",-1),n("p",{class:"text-base text-gray-700"},[f(" Please reach out to "),n("a",{href:"https://support.frappe.io/",target:"_blank",class:"underline"},"support"),f(" to enable it ")],-1)]))}const he=D(be,[["render",ge]]),_e={name:"DatabaseAnalyzer",components:{Header:H,Breadcrumbs:J,FTabs:E,LinkControl:A,ObjectList:j,ToggleContent:ae,ResultTable:Y,DatabaseTableSchemaDialog:X,DatabaseTableSchemaSizeDetailsDialog:ue,DatabaseProcessKillButton:q,DatabasePerformanceSchemaDisabledNotice:he},data(){return{site:null,errorMessage:null,isIndexSuggestionTriggered:!1,queryTabIndex:0,dbIndexTabIndex:0,showTableSchemaSizeDetailsDialog:!1,preSelectedSchemaForSchemaDialog:null,showTableSchemasDialog:!1,fetchingDatabaseIndex:!1,DatabaseProcessKillButton:B(q),DatabaseAddIndexButton:B(me)}},mounted(){const e=new URL(window.location.href).searchParams.get("site");e&&(this.site=e)},watch:{site(s){if(!s)return;const e=new URL(window.location.href);e.searchParams.set("site",s),window.history.pushState({},"",e),this.data=null,this.errorMessage=null,this.fetchTableSchemas({site_name:s}),this.$resources.site.submit(),this.$resources.databasePerformanceReport.submit({dt:"Site",dn:s,method:"get_database_performance_report"}),this.$resources.databaseProcesses.submit({dt:"Site",dn:s,method:"fetch_database_processes"})}},resources:{site(){return{url:"press.api.client.get",initialData:{},makeParams:()=>({doctype:"Site",name:this.site}),auto:!1}},tableSchemas(){return{url:"press.api.client.run_doc_method",initialData:{},auto:!1,makeParams:()=>({dt:"Site",dn:this.site,method:"fetch_database_table_schema"}),onSuccess:s=>{var e;(e=s==null?void 0:s.message)!=null&&e.loading&&setTimeout(this.fetchTableSchemas,5e3)}}},optimizeTable(){return{url:"press.api.client.run_doc_method",initialData:{},auto:!1,onSuccess:s=>{var e,a,l,t;s!=null&&s.message&&((e=s==null?void 0:s.message)!=null&&e.success?(y.success((a=s==null?void 0:s.message)==null?void 0:a.message),this.$router.push(`/sites/${this.site}/insights/jobs/${(l=s==null?void 0:s.message)==null?void 0:l.job_name}`)):y.error((t=s==null?void 0:s.message)==null?void 0:t.message))}}},databasePerformanceReport(){return{url:"press.api.client.run_doc_method",initialData:{},makeParams:()=>({dt:"Site",dn:this.site,method:"get_database_performance_report"}),auto:!1}},suggestDatabaseIndexes(){return{url:"press.api.client.run_doc_method",initialData:{},makeParams:()=>({dt:"Site",dn:this.site,method:"suggest_database_indexes"}),onSuccess:s=>{var e,a,l,t;s!=null&&s.message&&(this.fetchingDatabaseIndex=(t=(l=(a=(e=this.$resources.suggestDatabaseIndexes)==null?void 0:e.data)==null?void 0:a.message)==null?void 0:l.loading)!=null?t:!1,this.fetchingDatabaseIndex&&setTimeout(()=>{this.$resources.suggestDatabaseIndexes.submit()},5e3))},auto:!1}},databaseProcesses(){return{url:"press.api.client.run_doc_method",initialData:{},makeParams:()=>({dt:"Site",dn:this.site,method:"fetch_database_processes"}),auto:!1}}},computed:{site_info(){return this.$resources.site.data},isRequiredInformationReceived(){var s,e,a,l,t,i,u,g,_,I,T,p,w;return!((e=(s=this.$resources.site)==null?void 0:s.loading)==null||e||this.$resources.tableSchemas.loading||(t=(l=(a=this.$resources.tableSchemas)==null?void 0:a.data)==null?void 0:l.message)!=null&&t.loading||!((g=(u=(i=this.$resources.tableSchemas)==null?void 0:i.data)==null?void 0:u.message)!=null&&g.data)||((T=(I=(_=this.$resources.tableSchemas)==null?void 0:_.data)==null?void 0:I.message)==null?void 0:T.data)=={}||!((w=(p=this.$resources.databasePerformanceReport)==null?void 0:p.data)!=null&&w.message))},tableSchemas(){var e,a,l,t;return this.isRequiredInformationReceived?(t=(l=(a=(e=this.$resources.tableSchemas)==null?void 0:e.data)==null?void 0:a.message)==null?void 0:l.data)!=null?t:[]:[]},tableSizeInfo(){if(!this.isRequiredInformationReceived)return[];let s=[];for(const e in this.tableSchemas){const a=this.tableSchemas[e];s.push({table_name:e,data_size_mb:(a.size.data_length/(1024*1024)).toFixed(3),index_size_mb:(a.size.index_length/(1024*1024)).toFixed(3),total_size_mb:(a.size.total_size/(1024*1024)).toFixed(3),no_of_columns:a.columns.length})}return s},tableAnalysisTableOptions(){return this.isRequiredInformationReceived?{data:()=>this.tableSizeInfo,hideControls:!0,columns:[{label:"Table Name",fieldname:"table_name",width:.5,type:"Component",component({row:s}){return k("div",{class:"truncate text-base cursor-copy",onClick(){"clipboard"in navigator&&(navigator.clipboard.writeText(s.table_name),y.success("Copied to clipboard"))}},[s.table_name])}},{label:"Size (MB)",fieldname:"total_size_mb",width:.5},{label:"No of Columns",fieldname:"no_of_columns",width:.5}]}:[]},databaseSizeBreakup(){if(!this.isRequiredInformationReceived)return null;let s=this.tableSizeInfo.reduce((l,t)=>l+parseFloat(t.data_size_mb),0);s=s.toFixed(2);let e=this.tableSizeInfo.reduce((l,t)=>l+parseFloat(t.index_size_mb),0);e=e.toFixed(2);let a=this.site_info.current_plan.max_database_usage.toFixed(2);return{data_size:s,index_size:e,database_size_limit:a,free_size:(a-s-e).toFixed(2),data_size_percentage:parseInt(s/a*100),index_size_percentage:parseInt(e/a*100)}},isPerformanceSchemaEnabled(){var e,a;const s=(a=(e=this.$resources.databasePerformanceReport)==null?void 0:e.data)==null?void 0:a.message;return s?s.is_performance_schema_enabled:!1},queryTabs(){var a,l;if(!this.isRequiredInformationReceived)return[];const s=(l=(a=this.$resources.databasePerformanceReport)==null?void 0:a.data)==null?void 0:l.message;return s?[{label:"Slow Queries",columns:["Rows Examined","Rows Sent","Calls","Duration","Query"],data:s.slow_queries.map(t=>[t.rows_examined,t.rows_sent,t.count,t.duration,t.query])},{label:"Time Consuming Queries",columns:["Percentage","Calls","Avg Time","Query"],data:s.top_10_time_consuming_queries.map(t=>[Math.round(t.percent,1),t.calls,t.avg_time_ms,t.query])},{label:"Full Table Scan Queries",columns:["Rows Examined","Rows Sent","Calls","Query"],data:s.top_10_queries_with_full_table_scan.map(t=>[t.rows_examined,t.rows_sent,t.calls,t.query])}]:[]},databaseIndexesTab(){var a,l;if(!this.isRequiredInformationReceived)return[];const s=(l=(a=this.$resources.databasePerformanceReport)==null?void 0:a.data)==null?void 0:l.message;return s?[{label:"Suggested Indexes",columns:["Table","Column","Index Name","Sample Query"],data:[]},{label:"Redundant Indexes",columns:["Table Name","Dominant Index","Dominant Index Columns","Redundant Index","Redundant Index Columns"],data:s.redundant_indexes.map(t=>[t.table_name,t.dominant_index_name,t.dominant_index_columns,t.redundant_index_name,t.redundant_index_columns])},{label:"Unused Indexes",columns:["Table Name","Index Name"],data:s.unused_indexes.map(t=>[t.table_name,t.index_name])}]:[]},suggestedDatabaseIndexes(){var a,l,t,i;if(!this.isRequiredInformationReceived)return[];const s=(i=(t=(l=(a=this.$resources.suggestDatabaseIndexes)==null?void 0:a.data)==null?void 0:l.message)==null?void 0:t.data)!=null?i:[];let e=[];for(const u of s)for(const g of u.suggested_indexes)e.push([g.table,g.column,u.normalized]);return{columns:["Table","Column","Slow Query"],data:e}},databaseProcesses(){var e,a;if(!this.isRequiredInformationReceived)return null;const s=(a=(e=this.$resources.databaseProcesses.data)==null?void 0:e.message)!=null?a:[];return{columns:["ID","State","Time","User","Host","Command","Query"],data:s.map(l=>[l.id,l.state,l.time,l.db_user,l.db_user_host,l.command,l.query])}},cellFormatters(){return{"Rows Examined":s=>x(s,"commaSeperatedNumber"),"Rows Sent":s=>x(s,"commaSeperatedNumber"),Calls:s=>x(s,"commaSeperatedNumber"),"Avg Time":s=>x(s,"durationMilliseconds"),Duration:s=>x(s,"durationSeconds"),Time:s=>x(s,"durationSeconds")}},fullViewFormatters(){return{Query:s=>x(s,"sql")}},alignColumns(){return{Percentage:"right","Rows Examined":"right","Rows Sent":"right",Calls:"right","Avg Time":"right",Duration:"right",Time:"right"}}},methods:{fetchTableSchemas({site_name:s=null,reload:e=!1}={}){s||(s=this.site),s&&this.$resources.tableSchemas.submit({dt:"Site",dn:s,method:"fetch_database_table_schema",args:{reload:e}})},optimizeTable(){this.$resources.optimizeTable.submit({dt:"Site",dn:this.site,method:"optimize_tables"})},viewTableSchemaDetails(s){this.showTableSchemaSizeDetailsDialog=!1,this.preSelectedSchemaForSchemaDialog=s,this.showTableSchemasDialog=!0},formatSizeInMB(s){try{let e=parseFloat(s);if(e<1){let a=e*1024;return`${Math.round(a)} KB`}else return e<1024?`${Math.round(e)} MB`:`${(e/1024).toFixed(1)} GB`}catch(e){return`${s} MB`}}}},pe={class:"flex w-full flex-col gap-2 md:flex-row md:items-center md:justify-between"},xe={class:"flex flex-row items-center gap-2"},Se={class:"flex flex-row gap-2"},ye={class:"m-5"},we={key:0,class:"mt-2 flex flex-col"},De={class:"flex flex-row items-center justify-between"},Te={class:"flex flex-row gap-2"},ze={class:"full flex w-full flex-col items-start justify-start overflow-y-auto rounded px-1.5"},Ie={class:"flex w-full items-center justify-start gap-x-2 py-3"},ve={class:"ml-auto text-sm text-gray-800"},ke={class:"flex w-full items-center justify-start gap-x-2 border-t py-3"},Ce={class:"ml-auto text-sm text-gray-800"},Ve={class:"flex w-full items-center justify-start gap-x-2 border-t py-3"},Pe={class:"ml-auto text-sm text-gray-800"},Re={key:0,class:"flex h-60 w-full items-center justify-center gap-2 text-base text-gray-700"},Fe={class:"mt-1"},Be={class:"mt-1"},qe={key:1},je={key:0,class:"flex h-60 flex-col items-center justify-center gap-4"},$e={key:1,class:"flex h-full min-h-[80vh] w-full items-center justify-center gap-2 text-gray-700"},Le={key:2,class:"flex h-full min-h-[80vh] w-full items-center justify-center gap-2 text-gray-700"};function Me(s,e,a,l,t,i){const u=U,g=h("LinkControl"),_=C,I=h("Header"),T=Q,p=h("ResultTable"),w=h("ToggleContent"),V=h("DatabasePerformanceSchemaDisabledNotice"),P=h("FTabs"),$=h("DatabaseTableSchemaSizeDetailsDialog"),L=h("DatabaseTableSchemaDialog");return r(),b(O,null,[c(I,{class:"sticky top-0 z-10 bg-white"},{default:d(()=>[n("div",pe,[n("div",xe,[c(u,{items:[{label:"Dev Tools",route:"/database-analyzer"},{label:"Database Analyzer",route:"/database-analyzer"}]})]),n("div",Se,[c(g,{class:"cursor-pointer",options:{doctype:"Site",filters:{status:"Active"}},placeholder:"Select a site",modelValue:t.site,"onUpdate:modelValue":e[0]||(e[0]=o=>t.site=o)},null,8,["modelValue"]),c(_,{iconLeft:"refresh-ccw",variant:"subtle",loading:t.site&&!i.isRequiredInformationReceived,disabled:!t.site,onClick:e[1]||(e[1]=()=>i.fetchTableSchemas({reload:!0}))},{default:d(()=>e[10]||(e[10]=[n("span",{class:"md:hidden"},"Schema",-1),n("span",{class:"hidden md:inline"},"Refresh Schema",-1)])),_:1},8,["loading","disabled"])])])]),_:1}),n("div",ye,[i.isRequiredInformationReceived?(r(),b("div",we,[n("div",null,[n("div",De,[e[13]||(e[13]=n("p",{class:"text-base font-medium text-gray-800"}," Database Size Breakup ",-1)),n("div",Te,[c(_,{onClick:e[2]||(e[2]=o=>this.showTableSchemaSizeDetailsDialog=!0)},{default:d(()=>e[11]||(e[11]=[f(" View Details ")])),_:1}),c(_,{onClick:i.optimizeTable,loading:this.$resources.optimizeTable.loading},{default:d(()=>e[12]||(e[12]=[f(" Optimize Table ")])),_:1},8,["onClick","loading"])])]),n("div",{class:"mb-4 mt-4 flex h-7 w-full cursor-pointer items-start justify-start overflow-clip rounded border bg-gray-50 pl-0",onClick:e[3]||(e[3]=o=>t.showTableSchemaSizeDetailsDialog=!0)},[n("div",{class:"h-7",style:F({backgroundColor:"#E86C13",width:`${i.databaseSizeBreakup.data_size_percentage}%`})},null,4),n("div",{class:"h-7",style:F({backgroundColor:"#34BAE3",width:`${i.databaseSizeBreakup.index_size_percentage}%`})},null,4)]),n("div",ze,[n("div",Ie,[e[14]||(e[14]=n("div",{class:"h-2 w-2 rounded-full",style:{"background-color":"#e86c13"}},null,-1)),e[15]||(e[15]=n("span",{class:"text-sm text-gray-800"},"Data Size",-1)),n("span",ve,z(i.formatSizeInMB(this.databaseSizeBreakup.data_size)),1)]),n("div",ke,[e[16]||(e[16]=n("div",{class:"h-2 w-2 rounded-full",style:{"background-color":"#34bae3"}},null,-1)),e[17]||(e[17]=n("span",{class:"text-sm text-gray-800"},"Index Size",-1)),n("span",Ce,z(i.formatSizeInMB(this.databaseSizeBreakup.index_size)),1)]),n("div",Ve,[e[18]||(e[18]=n("div",{class:"h-2 w-2 rounded-full",style:{"background-color":"#e2e2e2"}},null,-1)),e[19]||(e[19]=n("span",{class:"text-sm text-gray-800"},"Free Space",-1)),n("span",Pe,z(i.formatSizeInMB(this.databaseSizeBreakup.free_size)),1)])])]),c(w,{class:"mt-3",label:"Database Processes",subLabel:"Analyze the processes of the database"},{actions:d(()=>[n("div",null,[c(_,{loading:this.$resources.databaseProcesses.loading,"loading-text":"Refreshing","icon-left":"rotate-ccw",onClick:e[4]||(e[4]=K(o=>this.$resources.databaseProcesses.submit(),["stop"]))},{default:d(()=>e[20]||(e[20]=[f("Refresh")])),_:1},8,["loading"])])]),default:d(()=>[this.$resources.databaseProcesses.loading?(r(),b("div",Re,[c(T,{class:"w-4"}),e[21]||(e[21]=f(" Loading Database Processes "))])):(r(),m(p,{key:1,class:"mt-2",columns:i.databaseProcesses.columns,data:i.databaseProcesses.data,alignColumns:i.alignColumns,cellFormatters:i.cellFormatters,fullViewFormatters:i.fullViewFormatters,actionHeaderLabel:"Kill",actionComponent:t.DatabaseProcessKillButton,actionComponentProps:{site:this.site},enableCSVExport:!1,borderLess:!0},null,8,["columns","data","alignColumns","cellFormatters","fullViewFormatters","actionComponent","actionComponentProps"]))]),_:1}),c(w,{class:"mt-3",label:"SQL Query Analysis",subLabel:"Check the concerning queries that might be affecting your database performance"},{default:d(()=>[n("div",Fe,[i.queryTabs.length?(r(),m(P,{key:0,tabs:i.queryTabs,modelValue:t.queryTabIndex,"onUpdate:modelValue":e[5]||(e[5]=o=>t.queryTabIndex=o)},{"tab-panel":d(({tab:o})=>[(o.label==="Time Consuming Queries"||o.label==="Full Table Scan Queries")&&!i.isPerformanceSchemaEnabled?(r(),m(V,{key:0})):(r(),m(p,{key:1,columns:o.columns,data:o.data,alignColumns:i.alignColumns,cellFormatters:i.cellFormatters,fullViewFormatters:i.fullViewFormatters,enableCSVExport:!1,borderLess:!0,isTruncateText:!0},null,8,["columns","data","alignColumns","cellFormatters","fullViewFormatters"]))]),_:1},8,["tabs","modelValue"])):S("",!0)])]),_:1}),c(w,{class:"mt-3",label:"Database Index Analysis",subLabel:"Analyze the indexes of the database"},{default:d(()=>[n("div",Be,[i.databaseIndexesTab.length?(r(),m(P,{key:0,tabs:i.databaseIndexesTab,modelValue:t.dbIndexTabIndex,"onUpdate:modelValue":e[7]||(e[7]=o=>t.dbIndexTabIndex=o)},{"tab-panel":d(({tab:o})=>[(o.label==="Unused Indexes"||o.label==="Suggested Indexes")&&!i.isPerformanceSchemaEnabled?(r(),m(V,{key:0})):o.label==="Suggested Indexes"?(r(),b("div",qe,[!t.isIndexSuggestionTriggered||this.$resources.suggestDatabaseIndexes.loading||this.fetchingDatabaseIndex?(r(),b("div",je,[c(_,{variant:"outline",onClick:e[6]||(e[6]=()=>{this.isIndexSuggestionTriggered=!0,this.$resources.suggestDatabaseIndexes.submit()}),loading:this.$resources.suggestDatabaseIndexes.loading||this.fetchingDatabaseIndex},{default:d(()=>e[22]||(e[22]=[f("Suggest Indexes")])),_:1},8,["loading"]),e[23]||(e[23]=n("p",{class:"text-base text-gray-700"}," This may take a while to analyze ",-1))])):(r(),m(p,{key:1,columns:i.suggestedDatabaseIndexes.columns,data:i.suggestedDatabaseIndexes.data,alignColumns:i.alignColumns,cellFormatters:i.cellFormatters,fullViewFormatters:i.fullViewFormatters,enableCSVExport:!1,borderLess:!0,actionHeaderLabel:"Add Index",actionComponent:t.DatabaseAddIndexButton,actionComponentProps:{site:this.site},isTruncateText:!0},null,8,["columns","data","alignColumns","cellFormatters","fullViewFormatters","actionComponent","actionComponentProps"]))])):(r(),m(p,{key:2,columns:o.columns,data:o.data,alignColumns:i.alignColumns,cellFormatters:i.cellFormatters,fullViewFormatters:i.fullViewFormatters,isTruncateText:!0,enableCSVExport:!1,borderLess:!0},null,8,["columns","data","alignColumns","cellFormatters","fullViewFormatters"]))]),_:1},8,["tabs","modelValue"])):S("",!0)])]),_:1}),this.site?(r(),m($,{key:0,site:this.site,tableSchemas:i.tableSchemas,modelValue:t.showTableSchemaSizeDetailsDialog,"onUpdate:modelValue":e[8]||(e[8]=o=>t.showTableSchemaSizeDetailsDialog=o),viewSchemaDetails:i.viewTableSchemaDetails},null,8,["site","tableSchemas","modelValue","viewSchemaDetails"])):S("",!0),this.site?(r(),m(L,{key:1,site:this.site,tableSchemas:i.tableSchemas,"pre-selected-schema":t.preSelectedSchemaForSchemaDialog,modelValue:t.showTableSchemasDialog,"onUpdate:modelValue":e[9]||(e[9]=o=>t.showTableSchemasDialog=o)},null,8,["site","tableSchemas","pre-selected-schema","modelValue"])):S("",!0)])):t.site?(r(),b("div",Le,[c(T,{class:"w-4"}),e[24]||(e[24]=f(" Loading Table Schemas "))])):(r(),b("div",$e," Select a site to get started "))])],64)}const Ue=D(_e,[["render",Me]]);export{Ue as default};
//# sourceMappingURL=DatabaseAnalyzer-D4dD3gZS.js.map
