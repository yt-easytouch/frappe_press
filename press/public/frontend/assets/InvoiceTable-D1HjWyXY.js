import{x,aJ as v,q as o,o as d,j as e,u as i,A as b,w as _,X as k,F as p,v as h,t as s,Y as w}from"./main-Dpl-JOF2.js";(function(){try{var r=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="d84a9f3d-e45f-427a-9bb5-974f535c7e59",r._sentryDebugIdIdentifier="sentry-dbid-d84a9f3d-e45f-427a-9bb5-974f535c7e59")}catch(l){}})();{var m=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};m._sentryModuleMetadata=m._sentryModuleMetadata||{},m._sentryModuleMetadata[new Error().stack]=Object.assign({},m._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const C={name:"InvoiceTable",props:["invoiceId"],resources:{invoice(){return{type:"document",doctype:"Invoice",name:this.invoiceId}},downloadInvoiceAsCSV(){return{url:"press.api.billing.fetch_invoice_items",makeParams(){return{invoice:this.invoiceId}},onSuccess(r){const t=`${this.invoiceId}.csv`;this.downloadAsCSV(r,t)}}}},computed:{groupedLineItems(){if(!this.doc)return{};const r={};for(let t of this.doc.items)r[t.document_type]=r[t.document_type]||[],r[t.document_type].push(t);return r},doc(){return this.$resources.invoice.doc},gstPercentage(){return this.$team.doc.billing_info.gst_percentage}},methods:{formatPlan(r){let t=v().find(l=>l.name===r);if(t){let l=this.$team.doc.currency==="INR";return this.$format.userCurrency(l?t.price_inr:t.price_usd)}return r},formatCurrency(r){if(!this.doc)return;let t=this.doc.currency;return this.$format.currency(r,t)},downloadAsCSV(r,t){if(!r||r.length===0)return;let l=[];l[0]=Object.keys(r[0]),r.forEach(c=>{l.push(Object.values(c))});const f=l.map(c=>Object.values(c).join(",")).join(`
`),y=new Blob([f],{type:"text/csv"}),n=window.URL.createObjectURL(y),a=document.createElement("a");a.href=n,a.download=t,a.click(),window.URL.revokeObjectURL(n)}}},I={class:"flex justify-end mb-3"},D={key:0,class:"overflow-x-auto"},S={class:"text w-full border-separate border-spacing-y-2 text-base font-normal text-gray-900"},j={class:"mt-1 bg-gray-50"},A={colspan:"100",class:"rounded p-2 text-base font-medium"},L={class:"py-1 pl-2 pr-2"},T={key:0,class:"text-gray-700"},V={class:"py-1 pl-2 pr-2 text-right"},P={class:"py-1 pl-2 pr-2 text-right"},B={class:"py-1 pl-2 pr-2 text-right font-medium"},R={key:0},E={class:"whitespace-nowrap pb-2 pr-2 pt-4 text-right font-medium"},N={key:1},O={class:"whitespace-nowrap pb-2 pr-2 pt-4 text-right font-medium"},U={key:2},q={class:"whitespace-nowrap pb-2 pr-2 pt-4 text-right font-medium"},F={key:3},M={class:"pb-2 pr-2 pt-4 text-right font-medium"},W={class:"whitespace-nowrap pb-2 pr-2 pt-4 text-right font-medium"},J={class:"whitespace-nowrap pb-2 pr-2 pt-4 text-right font-medium"},K={class:"whitespace-nowrap py-3 pr-2 text-right font-medium"},Q={class:"whitespace-nowrap py-3 pr-2 text-right font-medium"},X={key:1,class:"py-20 text-center"};function Y(r,t,l,f,y,n){const a=k;return d(),o("div",null,[e("div",I,[b(a,{"icon-left":"download",class:"shrink-0",onClick:r.$resources.downloadInvoiceAsCSV.submit},{default:_(()=>t[0]||(t[0]=[e("span",{class:"text-sm"},"Download as CSV",-1)])),_:1},8,["onClick"])]),n.doc?(d(),o("div",D,[e("table",S,[t[21]||(t[21]=e("thead",{class:"bg-gray-100"},[e("tr",{class:"text-gray-600"},[e("th",{class:"rounded-l p-2 text-left font-normal"},"Description"),e("th",{class:"whitespace-nowrap p-2 text-right font-normal"},"Rate"),e("th",{class:"whitespace-nowrap p-2 text-right font-normal"}," Quantity "),e("th",{class:"rounded-r p-2 text-right font-normal"},"Amount")])],-1)),e("tbody",null,[(d(!0),o(p,null,h(n.groupedLineItems,(c,g)=>(d(),o(p,{key:g},[e("tr",j,[e("td",A,s(g),1)]),(d(!0),o(p,null,h(c,(u,z)=>(d(),o("tr",{key:u.idx},[e("td",L,[w(s(u.document_name)+" ",1),u.plan?(d(),o("span",T," ("+s(n.formatPlan(u.plan))+"/mo) ",1)):i("",!0)]),e("td",V,s(n.formatCurrency(u.rate)),1),e("td",P,s(u.quantity)+" "+s(["Site","Release Group","Server","Database Server"].includes(u.document_type)?r.$format.plural(u.quantity,"day","days"):""),1),e("td",B,s(n.formatCurrency(u.amount)),1)]))),128))],64))),128))]),e("tfoot",null,[n.doc.total_discount_amount>0?(d(),o("tr",R,[t[1]||(t[1]=e("td",null,null,-1)),t[2]||(t[2]=e("td",null,null,-1)),t[3]||(t[3]=e("td",{class:"pb-2 pr-2 pt-4 text-right font-medium"}," Total Without Discount ",-1)),e("td",E,s(n.formatCurrency(n.doc.total_before_discount)),1)])):i("",!0),n.doc.total_discount_amount>0?(d(),o("tr",N,[t[4]||(t[4]=e("td",null,null,-1)),t[5]||(t[5]=e("td",null,null,-1)),t[6]||(t[6]=e("td",{class:"pb-2 pr-2 pt-4 text-right font-medium"}," Total Discount Amount ",-1)),e("td",O,s(r.$team.doc.erpnext_partner?n.formatCurrency(n.doc.total_discount_amount):n.formatCurrency(0)),1)])):i("",!0),n.doc.gst>0?(d(),o("tr",U,[t[7]||(t[7]=e("td",null,null,-1)),t[8]||(t[8]=e("td",null,null,-1)),t[9]||(t[9]=e("td",{class:"pb-2 pr-2 pt-4 text-right font-medium"}," Total (Without Tax) ",-1)),e("td",q,s(n.formatCurrency(n.doc.total)),1)])):i("",!0),n.doc.gst>0?(d(),o("tr",F,[t[10]||(t[10]=e("td",null,null,-1)),t[11]||(t[11]=e("td",null,null,-1)),e("td",M," IGST @ "+s(Number(n.gstPercentage*100))+"% ",1),e("td",W,s(n.doc.gst),1)])):i("",!0),e("tr",null,[t[12]||(t[12]=e("td",null,null,-1)),t[13]||(t[13]=e("td",null,null,-1)),t[14]||(t[14]=e("td",{class:"pb-2 pr-2 pt-4 text-right font-medium"},"Grand Total",-1)),e("td",J,s(n.formatCurrency(n.doc.total+n.doc.gst)),1)]),n.doc.total!==n.doc.amount_due&&["Paid","Unpaid"].includes(n.doc.status)?(d(),o(p,{key:4},[e("tr",null,[t[15]||(t[15]=e("td",null,null,-1)),t[16]||(t[16]=e("td",null,null,-1)),t[17]||(t[17]=e("td",{class:"pr-2 text-right font-medium"},"Applied Balance",-1)),e("td",K," - "+s(n.formatCurrency(n.doc.applied_credits)),1)]),e("tr",null,[t[18]||(t[18]=e("td",null,null,-1)),t[19]||(t[19]=e("td",null,null,-1)),t[20]||(t[20]=e("td",{class:"pr-2 text-right font-medium"},"Amount Due",-1)),e("td",Q,s(n.formatCurrency(n.doc.amount_due)),1)])],64)):i("",!0)])])])):i("",!0),r.$resources.invoice.loading?(d(),o("div",X,[b(a,{loading:!0},{default:_(()=>t[22]||(t[22]=[w("Loading")])),_:1})])):i("",!0)])}const H=x(C,[["render",Y]]);export{H as I};
//# sourceMappingURL=InvoiceTable-D1HjWyXY.js.map
