import{x,B as j,r as k,q as l,o as n,u as g,j as v,t as I,h as p,n as E,aT as L,F as M,v as $,b as F,w as u,A as i,X as G,Y as V,ae as P,aA as S,ar as R,C as U,a5 as z,a8 as q,a9 as Y}from"./main-Dpl-JOF2.js";import{_ as B}from"./Card-BCzTSeNK.js";import{_ as N}from"./ListItem-CkkFcC1t.js";import{F as K}from"./fuse.basic.esm-KoNXVm3X.js";import{n as C}from"./toast-Dk0nDfLL.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a91f2c75-c0dd-403c-ab07-c0655c33aa5c",e._sentryDebugIdIdentifier="sentry-dbid-a91f2c75-c0dd-403c-ab07-c0655c33aa5c")}catch(s){}})();{var D=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};D._sentryModuleMetadata=D._sentryModuleMetadata||{},D._sentryModuleMetadata[new Error().stack]=Object.assign({},D._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const X={name:"Input",inheritAttrs:!1,expose:["getInputValue"],components:{FeatherIcon:j},props:{label:{type:String},type:{type:String,default:"text",validator(e){let t=["text","number","checkbox","textarea","select","email","password","date"].includes(e);return t||console.warn(`Invalid value "${e}" for "type" prop for Input`),t}},modelValue:{type:[String,Number,Boolean,Object,Array]},inputClass:{type:[String,Array,Object]},debounce:{type:Number},options:{type:Array},disabled:{type:Boolean},rows:{type:Number,default:3},placeholder:{type:String},iconLeft:{type:String}},emits:["input","change","update:modelValue"],methods:{focus(){this.$refs.input.focus()},blur(){this.$refs.input.blur()},getInputValue(e){let t=e?e.target:this.$refs.input,s=t.value;return this.type=="checkbox"&&(s=t.checked),s}},computed:{passedInputValue(){return"value"in this.$attrs?this.$attrs.value:this.modelValue||null},inputAttributes(){let e={},t=s=>{this.$emit("input",this.getInputValue(s))};return this.debounce&&(t=F(t,this.debounce)),this.type=="checkbox"&&(e.checked=this.passedInputValue),Object.assign(e,this.$attrs,{onInput:t,onChange:s=>{this.$emit("change",this.getInputValue(s)),this.$emit("update:modelValue",this.getInputValue(s))}})},selectOptions(){return this.options.map(e=>typeof e=="string"?{label:e,value:e}:e).filter(Boolean)},isNormalInput(){return["text","number","checkbox","email","password","date"].includes(this.type)}}},H={key:0,class:"mb-2 block text-sm leading-4 text-gray-700"},J=["type","disabled","placeholder","value"],Q=["placeholder","value","disabled","rows"],W=["disabled"],Z=["value","disabled","selected"],ee={key:1,class:"ml-2 inline-block text-base leading-4"};function te(e,t,s,h,o,r){const d=k("FeatherIcon");return n(),l("label",{class:E([s.type=="checkbox"?"flex":"block",e.$attrs.class])},[s.label&&s.type!="checkbox"?(n(),l("span",H,I(s.label),1)):g("",!0),v("div",{class:E(["relative flex",{"items-center":r.isNormalInput||s.type=="select"}])},[s.iconLeft&&s.type!="checkbox"?(n(),p(d,{key:0,name:s.iconLeft,class:E(["absolute mx-2 h-4 w-4 text-gray-600",{"mt-2":s.type=="textarea"}])},null,8,["name","class"])):g("",!0),r.isNormalInput?(n(),l("input",L({key:1},r.inputAttributes,{class:["border-gray-400 placeholder-gray-500",[{"form-input block w-full":s.type!="checkbox","form-checkbox":s.type=="checkbox","pl-8":s.iconLeft&&s.type!="checkbox"},s.inputClass]],ref:"input",type:s.type||"text",disabled:s.disabled,placeholder:s.placeholder,value:r.passedInputValue}),null,16,J)):g("",!0),s.type==="textarea"?(n(),l("textarea",L({key:2},r.inputAttributes,{placeholder:s.placeholder,class:["placeholder-gray-500",["form-textarea block w-full resize-none",s.inputClass,{"pl-8":s.iconLeft}]],ref:"input",value:r.passedInputValue,disabled:s.disabled,rows:s.rows}),null,16,Q)):g("",!0),s.type==="select"?(n(),l("select",L({key:3},r.inputAttributes,{class:["form-select block w-full",{"pl-8":s.iconLeft}],ref:"input",disabled:s.disabled}),[(n(!0),l(M,null,$(r.selectOptions,c=>(n(),l("option",{key:c.value,value:c.value,disabled:c.disabled||!1,selected:r.passedInputValue===c.value},I(c.label),9,Z))),128))],16,W)):g("",!0)],2),s.label&&s.type=="checkbox"?(n(),l("span",ee,I(s.label),1)):g("",!0)],2)}const T=x(X,[["render",te]]),se={name:"EditPermissions",props:["show","name","type"],data(){return{updated:{},filteredList:[]}},resources:{options(){return{url:"press.api.account.get_permission_options",auto:!0,params:{name:this.name,ptype:this.type},onSuccess(e){this.fuse=new K(e.options,{keys:["doctype","name","title"],threshold:.3}),this.filteredList=e.options}}},updatePermissions(){return{url:"press.api.account.update_permissions",params:{user:this.name,ptype:this.type,updated:this.updated},onSuccess(){C({title:"Permissions Updated",color:"green",icon:"check"}),this.$emit("close",!0),this.$resources.options.fetch()}}}},methods:{isSelected(e,t){var h,o;let s=!1;return e.perms!==null&&(s=e.perms.includes(t)),s||(((o=(h=this.updated)==null?void 0:h[e.doctype])==null?void 0:o[e.name])||[]).includes(t)},updateSearchTerm(e){e?this.filteredList=this.fuse.search(e).map(t=>t.item):this.filteredList=this.options},updateAction(e,t,s){this.updated[e.doctype]||(this.updated[e.doctype]={}),this.updated[e.doctype][e.name]||(this.updated[e.doctype][e.name]=e.perms===null?[]:e.perms.split(",")),this.updated[e.doctype][e.name].includes(s)?this.updated[e.doctype][e.name]=this.updated[e.doctype][e.name].filter(h=>h!==s):this.updated[e.doctype][e.name].push(s)},toggleSelectAll(e,t,s){this.updated[e.doctype]||(this.updated[e.doctype]={});const h=Object.values(this.actions[e.doctype]);this.updated[e.doctype][e.name]=s?Object.assign([],h):[],this.filteredList[t].perms=s?h.join(","):""}},computed:{options(){return this.$resources.options.data?this.$resources.options.data.options:[]},actions(){return this.$resources.options.data?this.$resources.options.data.actions:{}}}},oe={key:1,class:"flex flex-col max-h-96 overflow-auto"},ne={key:0,class:"mt-4 text-center"},re={class:"text-gray-500"},ae={class:"border-b pt-2"},ie={class:"mr-2 mt-4 w-full pb-2 text-lg text-gray-600"},le={class:"inline-block align-middle text-base font-bold"},ue={class:"grid grid-cols-4 gap-4 py-4"};function me(e,t,s,h,o,r){const d=T,c=P,_=k("router-link"),f=G,y=S;return n(),p(y,{options:{title:`Editing permissions for ${s.type==="group"?"group":"member"} ${s.name}`,size:"3xl"},modelValue:s.show,onAfterLeave:t[2]||(t[2]=()=>{e.$emit("close",!0)})},{"body-content":u(()=>[i(d,{class:"mb-2",placeholder:"Search",onInput:t[0]||(t[0]=a=>r.updateSearchTerm(a))}),e.$resources.options.loading?(n(),p(c,{key:0})):(n(),l("div",oe,[r.options.length===0?(n(),l("div",ne,[v("span",re,[t[4]||(t[4]=V(" No options available to add permissions, let's create somes sites! ")),i(_,{to:"/sites/new",class:"text-gray-900"},{default:u(()=>t[3]||(t[3]=[V(" Click here ")])),_:1})])])):(n(!0),l(M,{key:1},$(o.filteredList,(a,A)=>(n(),l("div",ae,[v("span",ie,I(a.doctype),1),v("span",le,I(a.title?a.title:a.name),1),i(d,{class:"pt-4",type:"checkbox",label:"Select All",onChange:w=>r.toggleSelectAll(a,A,w)},null,8,["onChange"]),v("div",ue,[(n(!0),l(M,null,$(Object.entries(r.actions[a.doctype]),([w,m])=>(n(),p(d,{type:"checkbox",checked:r.isSelected(a,m),label:w,onChange:()=>r.updateAction(a,A,m)},null,8,["checked","label","onChange"]))),256))])]))),256))]))]),actions:u(()=>[i(f,{variant:"solid",class:"w-full",onClick:t[1]||(t[1]=a=>e.$resources.updatePermissions.submit()),disabled:r.options.length===0},{default:u(()=>t[5]||(t[5]=[V(" Save ")])),_:1},8,["disabled"])]),_:1},8,["options","modelValue"])}const O=x(se,[["render",me]]),ce={name:"ManageGroupMembers",data(){return{member:{},autoCompleteList:[]}},props:["show","group"],watch:{group(){this.$resources.groupUsers.submit()}},resources:{removeGroupUser:{url:"press.api.account.remove_permission_group_user",onSuccess(){this.$resources.groupUsers.fetch()}},addGroupUser:{url:"press.api.account.add_permission_group_user",onSuccess(){this.$resources.groupUsers.fetch(),this.member={}}},groupUsers(){return{url:"press.api.account.permission_group_users",params:{name:this.group.name},onSuccess(e){this.autoCompleteList=this.$account.team_members.filter(t=>!e.includes(t.name)&&t.name!=this.$account.team.user).map(t=>({label:t.name,value:t.name}))}}}}},de={key:1},pe={key:0,class:"text-gray-500 text-center"};function he(e,t,s,h,o,r){const d=P,c=G,_=N,f=R,y=S;return n(),p(y,{options:{title:`Manage Members for ${s.group.title}`},modelValue:s.show,onAfterLeave:t[2]||(t[2]=()=>{e.$emit("close",!0),this.memberEmail=""})},{"body-content":u(()=>[e.$resources.groupUsers.loading?(n(),p(d,{key:0})):(n(),l("div",de,[e.$resources.groupUsers.data.length===0?(n(),l("span",pe," No members added to this group. ")):(n(!0),l(M,{key:1},$(e.$resources.groupUsers.data,a=>(n(),p(_,{title:a,key:a},{actions:u(()=>[i(c,{icon:"trash",onClick:()=>e.$resources.removeGroupUser.submit({name:s.group.name,user:a})},null,8,["onClick"])]),_:2},1032,["title"]))),128))]))]),actions:u(()=>[i(f,{options:o.autoCompleteList,modelValue:o.member,"onUpdate:modelValue":t[0]||(t[0]=a=>o.member=a),placeholder:"Select a member to add"},null,8,["options","modelValue"]),i(c,{variant:"solid",label:"Add Member",class:"mt-2 w-full",loading:e.$resources.groupUsers.loading,onClick:t[1]||(t[1]=a=>e.$resources.addGroupUser.submit({name:s.group.name,user:o.member.value}))},null,8,["loading"])]),_:1},8,["options","modelValue"])}const be=x(ce,[["render",he]]),ge={name:"AccountGroups",components:{EditPermissions:O,ManageGroupMembers:be},data(){return{groupName:"",memberEmail:"",showAddGroupDialog:!1,showGroupMemberDialog:!1,showManageMemberDialog:!1,showEditMemberDialog:!1,group:{name:"",title:""},showAddMemberForm:!1}},resources:{groups:{url:"press.api.account.groups",auto:!0},addMember:{url:"press.api.account.add_team_member",onSuccess(){this.showManageMemberDialog=!1,this.memberEmail=null,C({title:"Invite Sent!",message:"They will receive an email shortly to join your team.",color:"green",icon:"check"})}},addGroup:{url:"press.api.account.add_permission_group",validate(){if(this.groupName.length==0)return"Group name is required."},onSuccess(e){this.$resources.groups.fetch(),C({title:"Group Created!",message:"You can now assign this group to your team members",color:"green",icon:"check"}),this.group=e,this.showAddGroupDialog=!1,this.showGroupMemberDialog=!0}},removeGroup:{url:"press.api.account.remove_permission_group",onSuccess(){this.$resources.groups.fetch(),C({title:"Group Removed!",message:"Permissions have been removed from all team members",color:"green",icon:"check"})}}},methods:{removeGroup(e){this.$confirm({title:"Remove Group",message:`Are you sure you want to remove ${e.title} ?`,actionLabel:"Remove",actionColor:"red",action:t=>{this.$resources.removeGroup.submit({name:e.name}),t()}})},dropdownItems(e){return[{label:"Manage Members",icon:"users",onClick:()=>{this.group=e,this.showGroupMemberDialog=!0}},{label:"Edit Permissions",icon:"edit",onClick:()=>{this.group=e,this.showEditMemberDialog=!0}},{label:"Remove",icon:"trash-2",onClick:()=>this.removeGroup(e)}]}},computed:{showManageTeamButton(){const e=this.$account.team;return this.$account.hasRole("Press Admin")&&(e.default_payment_method||e.payment_mode=="Prepaid Credits"||e.free_account||e.erpnext_partner||e.parent_team)},groups(){return this.$resources.groups.data?this.$resources.groups.data:[]}}},_e={class:"max-h-96 divide-y"};function fe(e,t,s,h,o,r){const d=G,c=U,_=N,f=B,y=k("EditPermissions"),a=k("ManageGroupMembers"),A=T,w=S;return n(),l(M,null,[i(f,{title:"Group Permissions",subtitle:"Create a group or permission and assign it to your team members"},{actions:u(()=>[r.showManageTeamButton?(n(),p(d,{key:0,onClick:t[0]||(t[0]=m=>o.showAddGroupDialog=!0)},{default:u(()=>t[6]||(t[6]=[V(" Add New Group ")])),_:1})):g("",!0)]),default:u(()=>[v("div",_e,[(n(!0),l(M,null,$(r.groups,m=>(n(),p(_,{title:m.title,description:m.name,key:m.name},{actions:u(()=>[i(c,{options:r.dropdownItems(m),right:""},{default:u(({open:b})=>[i(d,{icon:"more-horizontal"})]),_:2},1032,["options"])]),_:2},1032,["title","description"]))),128))])]),_:1}),i(y,{type:"group",show:o.showEditMemberDialog,name:o.group.name,onClose:t[1]||(t[1]=m=>o.showEditMemberDialog=!1)},null,8,["show","name"]),i(a,{group:o.group,"onUpdate:group":t[2]||(t[2]=m=>o.group=m),show:o.showGroupMemberDialog,onClose:t[3]||(t[3]=m=>o.showGroupMemberDialog=!1)},null,8,["group","show"]),i(w,{options:{title:"Add New Group",actions:[{label:"Create Group",variant:"solid",loading:e.$resources.addGroup.loading,onClick:()=>e.$resources.addGroup.submit({title:o.groupName})}]},modelValue:o.showAddGroupDialog,"onUpdate:modelValue":t[5]||(t[5]=m=>o.showAddGroupDialog=m)},{"body-content":u(()=>[i(A,{label:"Title",type:"text",modelValue:o.groupName,"onUpdate:modelValue":t[4]||(t[4]=m=>o.groupName=m),required:""},null,8,["modelValue"])]),_:1},8,["options","modelValue"])],64)}const ye=x(ge,[["render",fe]]),we={name:"AccountMembers",components:{EditPermissions:O},data(){return{showManageMemberDialog:!1,showEditMemberDialog:!1,memberName:"",showAddMemberForm:!1,memberEmail:null}},resources:{addMember:{url:"press.api.account.add_team_member",onSuccess(){this.showManageMemberDialog=!1,this.memberEmail=null,C({title:"Invite Sent!",message:"They will receive an email shortly to join your team.",color:"green",icon:"check"})}},removeMember:{url:"press.api.account.remove_team_member",onSuccess(){this.showManageMemberDialog=!1,this.$account.fetchAccount(),C({title:"Team member removed.",icon:"check",color:"green"})}}},methods:{getRoleBadgeProps(e){let t="Member";return this.$account.team.name==e.name&&(t="Owner"),{status:t,color:{Owner:"blue",Member:"gray"}[t]}},removeMember(e){this.$confirm({title:"Remove Member",message:`Are you sure you want to remove ${e.first_name} ?`,actionLabel:"Remove",actionColor:"red",action:t=>{this.$resources.removeMember.submit({user_email:e.name}),t()}})},dropdownItems(e){return[{label:"Edit Permissions",icon:"edit",onClick:()=>{this.memberName=e.name,this.showEditMemberDialog=!0}},{label:"Remove",icon:"trash-2",onClick:()=>this.removeMember(e)}]}},computed:{showManageTeamButton(){const e=this.$account.team;return this.$account.hasRole("Press Admin")&&(e.default_payment_method||e.payment_mode=="Prepaid Credits"||e.free_account||e.erpnext_partner||e.parent_team)}}},ve={class:"max-h-96 divide-y"};function ke(e,t,s,h,o,r){const d=G,c=z,_=U,f=N,y=q,a=Y,A=S,w=k("EditPermissions"),m=B;return n(),p(m,{title:"Team Members and Permissions",subtitle:"Team members can access your account on your behalf."},{actions:u(()=>[r.showManageTeamButton?(n(),p(d,{key:0,onClick:t[0]||(t[0]=b=>o.showManageMemberDialog=!0)},{default:u(()=>t[4]||(t[4]=[V(" Add New Member ")])),_:1})):g("",!0)]),default:u(()=>[v("div",ve,[(n(!0),l(M,null,$(e.$account.team_members,b=>(n(),p(f,{title:`${b.first_name} ${b.last_name}`,description:b.name,key:b.name},{actions:u(()=>[b.name==e.$account.team.user?(n(),p(c,{key:0,label:"Owner",color:"blue",class:"ml-2"})):(n(),p(_,{key:1,options:r.dropdownItems(b),right:""},{default:u(({open:xe})=>[i(d,{icon:"more-horizontal"})]),_:2},1032,["options"]))]),_:2},1032,["title","description"]))),128))]),i(A,{options:{title:"Add New Member",actions:[{label:"Send Invitation",variant:"solid",loading:e.$resources.addMember.loading,onClick:()=>e.$resources.addMember.submit({email:o.memberEmail})}]},modelValue:o.showManageMemberDialog,"onUpdate:modelValue":t[2]||(t[2]=b=>o.showManageMemberDialog=b)},{"body-content":u(()=>[i(y,{label:"Enter the email address of your teammate to invite them.",class:"mt-2",modelValue:o.memberEmail,"onUpdate:modelValue":t[1]||(t[1]=b=>o.memberEmail=b),required:""},null,8,["modelValue"]),i(a,{message:e.$resources.addMember.error},null,8,["message"])]),_:1},8,["options","modelValue"]),i(w,{type:"user",show:o.showEditMemberDialog,name:o.memberName,onClose:t[3]||(t[3]=b=>o.showEditMemberDialog=!1)},null,8,["show","name"])]),_:1})}const Me=x(we,[["render",ke]]),Ae={name:"AccountSettings",pageMeta(){return{title:"Settings - Team"}},components:{AccountMembers:Me,AccountGroups:ye}},Ce={key:0,class:"space-y-5"};function $e(e,t,s,h,o,r){const d=k("AccountMembers"),c=k("AccountGroups");return e.$account.user.name===e.$account.team.user||e.$account.user.user_type==="System User"?(n(),l("div",Ce,[i(d),i(c)])):g("",!0)}const Ee=x(Ae,[["render",$e]]);export{Ee as default};
//# sourceMappingURL=TeamSettings-CR36DDCZ.js.map
