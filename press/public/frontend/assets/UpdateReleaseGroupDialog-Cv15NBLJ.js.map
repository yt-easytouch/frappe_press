{"version":3,"file":"UpdateReleaseGroupDialog-Cv15NBLJ.js","sources":["../../../../dashboard/src2/components/group/UpdateReleaseGroupDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\tv-model=\"show\"\n\t\t:options=\"{\n\t\t\tsize: '4xl',\n\t\t\ttitle: 'Update Bench Group',\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<AlertBanner\n\t\t\t\tv-if=\"benchDocResource.doc.are_builds_suspended\"\n\t\t\t\tclass=\"mb-4\"\n\t\t\t\ttitle=\"<b>Builds Suspended:</b> updates will be scheduled to run when builds resume.\"\n\t\t\t\ttype=\"warning\"\n\t\t\t/>\n\t\t\t<!-- Update Steps -->\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<!-- Select Apps Step -->\n\t\t\t\t<div v-if=\"step === 'select-apps'\">\n\t\t\t\t\t<h2 class=\"mb-4 text-lg font-medium\">Select apps to update</h2>\n\t\t\t\t\t<GenericList\n\t\t\t\t\t\tclass=\"max-h-[500px]\"\n\t\t\t\t\t\tv-if=\"benchDocResource.doc.deploy_information.update_available\"\n\t\t\t\t\t\t:options=\"updatableAppOptions\"\n\t\t\t\t\t\t@update:selections=\"handleAppSelection\"\n\t\t\t\t\t/>\n\t\t\t\t\t<p v-else class=\"text-center text-base text-gray-600\">\n\t\t\t\t\t\tNo apps to update\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Remove Apps Step -->\n\t\t\t\t<div v-else-if=\"step === 'removed-apps'\">\n\t\t\t\t\t<h2 class=\"mb-4 text-lg font-medium\">These apps will be removed</h2>\n\t\t\t\t\t<GenericList class=\"max-h-[500px]\" :options=\"removedAppOptions\" />\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Select Site Step -->\n\t\t\t\t<div v-else-if=\"step === 'select-sites'\">\n\t\t\t\t\t<h2 class=\"mb-4 text-lg font-medium\">Select sites to update</h2>\n\t\t\t\t\t<GenericList\n\t\t\t\t\t\tclass=\"max-h-[500px]\"\n\t\t\t\t\t\tv-if=\"benchDocResource.doc.deploy_information.sites.length\"\n\t\t\t\t\t\t:options=\"siteOptions\"\n\t\t\t\t\t\t@update:selections=\"handleSiteSelection\"\n\t\t\t\t\t/>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"text-center text-base font-medium text-gray-600\"\n\t\t\t\t\t\tv-else-if=\"!benchDocResource.doc.deploy_information.sites.length\"\n\t\t\t\t\t>\n\t\t\t\t\t\tNo active sites to update\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Restrict Build Step -->\n\t\t\t\t<div\n\t\t\t\t\tv-else-if=\"step === 'restrict-build' && restrictMessage\"\n\t\t\t\t\tclass=\"flex flex-col gap-4\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<h2 class=\"text-lg font-medium\">Build might fail</h2>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://easytouch.cloud/docs/common-issues/build-might-fail\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\tclass=\"cursor-pointer rounded-full border border-gray-200 bg-gray-100 p-0.5 text-base text-gray-700\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i-lucide-help-circle :class=\"`h-4 w-4 text-red-600`\" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclass=\"text-base font-medium text-gray-800\"\n\t\t\t\t\t\tv-html=\"restrictMessage\"\n\t\t\t\t\t></p>\n\t\t\t\t\t<div class=\"mt-4\">\n\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\tlabel=\"I understand, run deploy anyway\"\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tv-model=\"ignoreWillFailCheck\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-if=\"canUpdateInPlace\" class=\"flex gap-2\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tlabel=\"Use in place update\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tv-model=\"useInPlaceUpdate\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Tooltip text=\"View documentation\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://easytouch.cloud/docs/in-place-updates\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i-lucide-help-circle :class=\"`h-4 w-4 text-gray-600`\" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t<ErrorMessage :message=\"errorMessage\" />\n\t\t\t</div>\n\t\t</template>\n\t\t<template #actions>\n\t\t\t<div class=\"flex items-center justify-between space-y-2\">\n\t\t\t\t<div v-if=\"!canShowBack\"><!-- Spacer div --></div>\n\t\t\t\t<Button v-if=\"canShowBack\" label=\"Back\" @click=\"back\" />\n\t\t\t\t<Button v-if=\"canShowNext\" variant=\"solid\" label=\"Next\" @click=\"next\" />\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"canShowDeploy\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t:label=\"deployLabel\"\n\t\t\t\t\t:loading=\"\n\t\t\t\t\t\t$resources.deployAndUpdate.loading ||\n\t\t\t\t\t\t$resources.updateInPlace.loading\n\t\t\t\t\t\"\n\t\t\t\t\t@click=\"updateBench\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script>\nimport { h } from 'vue';\nimport { Checkbox, getCachedDocumentResource } from 'frappe-ui';\nimport CommitChooser from '@/components/utils/CommitChooser.vue';\nimport CommitTag from '@/components/utils/CommitTag.vue';\nimport GenericList from '../../components/GenericList.vue';\nimport { getTeam } from '../../data/team';\nimport { DashboardError } from '../../utils/error';\nimport AlertBanner from '../AlertBanner.vue';\n\nexport default {\n\tname: 'UpdateReleaseGroupDialog',\n\tprops: ['bench'],\n\tcomponents: {\n\t\tGenericList,\n\t\tCommitChooser,\n\t\tCommitTag,\n\t\tAlertBanner,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tshow: true,\n\t\t\tstep: '',\n\t\t\terrorMessage: '',\n\t\t\tignoreWillFailCheck: false,\n\t\t\tuseInPlaceUpdate: false,\n\t\t\trestrictMessage: '',\n\t\t\tselectedApps: [],\n\t\t\tselectedSites: [],\n\t\t};\n\t},\n\tmounted() {\n\t\tif (this.hasUpdateAvailable) {\n\t\t\tthis.step = 'select-apps';\n\t\t} else if (this.hasRemovedApps) {\n\t\t\tthis.step = 'removed-apps';\n\t\t} else {\n\t\t\tthis.step = 'select-sites';\n\t\t}\n\t},\n\tcomputed: {\n\t\tupdatableAppOptions() {\n\t\t\tlet deployInformation = this.benchDocResource.doc.deploy_information;\n\t\t\tlet appData = deployInformation.apps.filter(\n\t\t\t\t(app) => app.update_available === true,\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tdata: appData,\n\t\t\t\tselectable: true,\n\t\t\t\tcolumns: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'App',\n\t\t\t\t\t\tfieldname: 'title',\n\t\t\t\t\t\twidth: 1.75,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'From',\n\t\t\t\t\t\tfieldname: 'current_hash',\n\t\t\t\t\t\ttype: 'Component',\n\t\t\t\t\t\tcomponent({ row: app }) {\n\t\t\t\t\t\t\tif (!app.current_hash) return null;\n\t\t\t\t\t\t\tlet tag = app.will_branch_change\n\t\t\t\t\t\t\t\t? app.current_branch\n\t\t\t\t\t\t\t\t: app.current_hash.slice(0, 7);\n\n\t\t\t\t\t\t\treturn h(CommitTag, {\n\t\t\t\t\t\t\t\ttag: tag,\n\t\t\t\t\t\t\t\tlink: `${app.repository_url}/commit/${tag}`,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'To',\n\t\t\t\t\t\tfieldname: 'next_release',\n\t\t\t\t\t\ttype: 'Component',\n\t\t\t\t\t\tcomponent({ row: app }) {\n\t\t\t\t\t\t\tif (app.will_branch_change) {\n\t\t\t\t\t\t\t\treturn h(CommitTag, {\n\t\t\t\t\t\t\t\t\ttag: app.branch,\n\t\t\t\t\t\t\t\t\tlink: `${app.repository_url}/commit/${app.branch}`,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfunction commitChooserOptions(app) {\n\t\t\t\t\t\t\t\treturn app.releases.map((release) => {\n\t\t\t\t\t\t\t\t\tconst messageMaxLength = 75;\n\t\t\t\t\t\t\t\t\tlet message = release.message.split('\\n')[0];\n\t\t\t\t\t\t\t\t\tmessage =\n\t\t\t\t\t\t\t\t\t\tmessage.length > messageMaxLength\n\t\t\t\t\t\t\t\t\t\t\t? message.slice(0, messageMaxLength) + '...'\n\t\t\t\t\t\t\t\t\t\t\t: message;\n\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tlabel: release.tag\n\t\t\t\t\t\t\t\t\t\t\t? release.tag\n\t\t\t\t\t\t\t\t\t\t\t: `${message} (${release.hash.slice(0, 7)})`,\n\t\t\t\t\t\t\t\t\t\tvalue: release.name,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfunction initialDeployTo(app) {\n\t\t\t\t\t\t\t\tconst next_release = app.releases.filter(\n\t\t\t\t\t\t\t\t\t(release) => release.name === app.next_release,\n\t\t\t\t\t\t\t\t)[0];\n\t\t\t\t\t\t\t\tif (app.will_branch_change) {\n\t\t\t\t\t\t\t\t\treturn app.branch;\n\t\t\t\t\t\t\t\t} else if (next_release) {\n\t\t\t\t\t\t\t\t\treturn next_release.tag || next_release.hash.slice(0, 7);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!app.releases.length) return undefined;\n\n\t\t\t\t\t\t\tlet initialValue = {\n\t\t\t\t\t\t\t\tlabel: initialDeployTo(app),\n\t\t\t\t\t\t\t\tvalue: app.next_release,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn h(CommitChooser, {\n\t\t\t\t\t\t\t\toptions: commitChooserOptions(app),\n\t\t\t\t\t\t\t\tmodelValue: initialValue,\n\t\t\t\t\t\t\t\t'onUpdate:modelValue': (value) => {\n\t\t\t\t\t\t\t\t\tappData.find((a) => a.name === app.name).next_release =\n\t\t\t\t\t\t\t\t\t\tvalue.value;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Status',\n\t\t\t\t\t\tfieldname: 'title',\n\t\t\t\t\t\ttype: 'Badge',\n\t\t\t\t\t\tformat(value, row) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tdeployInformation.removed_apps.find(\n\t\t\t\t\t\t\t\t\t(app) => app.name === row.name,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treturn 'Will be Uninstalled';\n\t\t\t\t\t\t\t} else if (!row.will_branch_change && !row.current_hash) {\n\t\t\t\t\t\t\t\treturn 'First Deploy';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn 'Update Available';\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Changes',\n\t\t\t\t\t\ttype: 'Button',\n\t\t\t\t\t\twidth: 0.5,\n\t\t\t\t\t\talign: 'right',\n\t\t\t\t\t\tButton({ row }) {\n\t\t\t\t\t\t\tlet url;\n\t\t\t\t\t\t\tif (row.current_hash && row.next_release) {\n\t\t\t\t\t\t\t\tlet hash = row.releases.find(\n\t\t\t\t\t\t\t\t\t(release) => release.name === row.next_release,\n\t\t\t\t\t\t\t\t)?.hash;\n\n\t\t\t\t\t\t\t\tif (hash)\n\t\t\t\t\t\t\t\t\turl = `${row.repository_url}/compare/${row.current_hash}...${hash}`;\n\t\t\t\t\t\t\t} else if (row.next_release) {\n\t\t\t\t\t\t\t\turl = `${row.repository_url}/commit/${\n\t\t\t\t\t\t\t\t\trow.releases.find(\n\t\t\t\t\t\t\t\t\t\t(release) => release.name === row.next_release,\n\t\t\t\t\t\t\t\t\t).hash\n\t\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!url) return null;\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tlabel: 'View',\n\t\t\t\t\t\t\t\tvariant: 'ghost',\n\t\t\t\t\t\t\t\tonClick() {\n\t\t\t\t\t\t\t\t\twindow.open(url, '_blank');\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t},\n\t\tremovedAppOptions() {\n\t\t\tlet deployInformation = this.benchDocResource.doc.deploy_information;\n\t\t\tlet appData = deployInformation.removed_apps;\n\n\t\t\treturn {\n\t\t\t\tdata: appData,\n\t\t\t\tcolumns: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'App',\n\t\t\t\t\t\tfieldname: 'title',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Status',\n\t\t\t\t\t\tfieldname: 'name',\n\t\t\t\t\t\ttype: 'Badge',\n\t\t\t\t\t\tformat() {\n\t\t\t\t\t\t\treturn 'Will be Uninstalled';\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t},\n\t\tsiteOptions() {\n\t\t\tlet deployInformation = this.benchDocResource.doc.deploy_information;\n\t\t\tlet siteData = deployInformation.sites;\n\t\t\tlet team = getTeam();\n\n\t\t\t/**\n\t\t\t * If In Place update is being used failed patches are skipped\n\t\t\t * and site backups are not taken by default.\n\t\t\t */\n\t\t\tconst disabled = this.useInPlaceUpdate;\n\n\t\t\treturn {\n\t\t\t\tdata: siteData,\n\t\t\t\tselectable: true,\n\t\t\t\tcolumns: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Site',\n\t\t\t\t\t\tfieldname: 'name',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Skip failed patches',\n\t\t\t\t\t\tfieldname: 'skip_failing_patches',\n\t\t\t\t\t\twidth: 0.5,\n\t\t\t\t\t\ttype: 'Component',\n\t\t\t\t\t\tcomponent({ row }) {\n\t\t\t\t\t\t\treturn h(Checkbox, {\n\t\t\t\t\t\t\t\tmodelValue: row.skip_failing_patches,\n\t\t\t\t\t\t\t\tdisabled,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Skip backup',\n\t\t\t\t\t\tfieldname: 'skip_backups',\n\t\t\t\t\t\twidth: 0.3,\n\t\t\t\t\t\ttype: 'Component',\n\t\t\t\t\t\tcondition() {\n\t\t\t\t\t\t\treturn !!team.doc.skip_backups;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomponent({ row }) {\n\t\t\t\t\t\t\treturn h(Checkbox, {\n\t\t\t\t\t\t\t\tmodelValue: row.skip_backups,\n\t\t\t\t\t\t\t\tdisabled,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t},\n\t\tbenchDocResource() {\n\t\t\treturn getCachedDocumentResource('Release Group', this.bench);\n\t\t},\n\t\thasUpdateAvailable() {\n\t\t\treturn this.benchDocResource.doc.deploy_information.apps.some(\n\t\t\t\t(app) => app.update_available === true,\n\t\t\t);\n\t\t},\n\t\thasRemovedApps() {\n\t\t\treturn !!this.benchDocResource.doc.deploy_information.removed_apps.length;\n\t\t},\n\t\tdeployInformation() {\n\t\t\treturn this.benchDocResource?.doc.deploy_information;\n\t\t},\n\t\tcanShowBack() {\n\t\t\tif (this.step === 'select-apps') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.hasUpdateAvailable || this.step === 'restrict-build';\n\t\t},\n\t\tcanShowNext() {\n\t\t\tif (this.step === 'restrict-build') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.step === 'select-sites' && !this.restrictMessage) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tcanShowDeploy() {\n\t\t\treturn !this.canShowNext;\n\t\t},\n\t\tdeployLabel() {\n\t\t\tif (this.selectedSites.length === 0) {\n\t\t\t\treturn 'Skip and Deploy';\n\t\t\t}\n\n\t\t\tlet site = 'site';\n\t\t\tif (this.selectedSites.length > 1) {\n\t\t\t\tsite = `${this.selectedSites.length} sites`;\n\t\t\t}\n\n\t\t\tif (this.useInPlaceUpdate) {\n\t\t\t\treturn `Update ${site} in place`;\n\t\t\t}\n\n\t\t\treturn `Deploy and update ${site}`;\n\t\t},\n\t\tcanUpdateInPlace() {\n\t\t\tif (!this.benchDocResource?.doc?.enable_inplace_updates) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// In Place updates cannot take place with removed apps.\n\t\t\tif (this.hasRemovedApps) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// All sites to be updated must belong to the same bench.\n\t\t\tconst benches = new Set(this.selectedSites.map((s) => s.bench));\n\t\t\tif (benches.size !== 1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Failed in place update benches have to be regular updated.\n\t\t\tconst inPlaceUpdateFailedBenches =\n\t\t\t\tthis.benchDocResource?.doc?.inplace_update_failed_benches ?? [];\n\n\t\t\tconst allSites = this.siteOptions.data\n\t\t\t\t.filter(\n\t\t\t\t\t(s) =>\n\t\t\t\t\t\tbenches.has(s.bench) ||\n\t\t\t\t\t\tinPlaceUpdateFailedBenches.includes(s.bench),\n\t\t\t\t)\n\t\t\t\t.map((s) => s.name);\n\n\t\t\t// All sites under a bench should be updated\n\t\t\tif (allSites.length !== this.selectedSites.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t},\n\tresources: {\n\t\tdeployAndUpdate() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.bench.deploy_and_update',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.bench,\n\t\t\t\t\tapps: this.selectedApps,\n\t\t\t\t\tsites: this.selectedSites,\n\t\t\t\t\trun_will_fail_check: !this.ignoreWillFailCheck,\n\t\t\t\t},\n\t\t\t\tvalidate() {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.hasUpdateAvailable &&\n\t\t\t\t\t\tthis.selectedApps.length === 0 &&\n\t\t\t\t\t\tthis.deployInformation.removed_apps.length === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tthrow new DashboardError('Please select an app to proceed');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonSuccess(candidate) {\n\t\t\t\t\tthis.$router.push({\n\t\t\t\t\t\tname: 'Deploy Candidate',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: candidate,\n\t\t\t\t\t\t\tname: this.bench,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tthis.restrictMessage = '';\n\t\t\t\t\tthis.show = false;\n\t\t\t\t\tthis.$emit('success', candidate);\n\t\t\t\t},\n\t\t\t\tonError: this.setErrorMessage.bind(this),\n\t\t\t};\n\t\t},\n\t\tupdateInPlace() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.bench.update_inplace',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.bench,\n\t\t\t\t\tapps: this.selectedApps,\n\t\t\t\t\tsites: this.selectedSites,\n\t\t\t\t},\n\t\t\t\tonSuccess(id) {\n\t\t\t\t\tthis.$router.push({\n\t\t\t\t\t\tname: 'Release Group Job',\n\t\t\t\t\t\tparams: { id },\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.restrictMessage = '';\n\t\t\t\t\tthis.show = false;\n\t\t\t\t\tthis.$emit('success', null);\n\t\t\t\t},\n\t\t\t\tonError: this.setErrorMessage.bind(this),\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tback() {\n\t\t\tif (this.step === 'select-apps') {\n\t\t\t\treturn;\n\t\t\t} else if (this.step === 'removed-apps') {\n\t\t\t\tthis.step = 'select-apps';\n\t\t\t} else if (this.step === 'select-sites' && this.hasRemovedApps) {\n\t\t\t\tthis.step = 'removed-apps';\n\t\t\t} else if (this.step === 'select-sites' && !this.hasRemovedApps) {\n\t\t\t\tthis.step = 'select-apps';\n\t\t\t} else if (this.step === 'restrict-build') {\n\t\t\t\tthis.step = 'select-sites';\n\t\t\t}\n\n\t\t\tif (this.step === 'select-apps') {\n\t\t\t\tthis.selectedApps = [];\n\t\t\t}\n\t\t},\n\t\tnext() {\n\t\t\tif (this.errorMessage) {\n\t\t\t\tthis.errorMessage = '';\n\t\t\t}\n\n\t\t\tif (this.step === 'select-apps' && this.selectedApps.length === 0) {\n\t\t\t\tthis.errorMessage = 'Please select an app to proceed';\n\t\t\t\treturn;\n\t\t\t} else if (this.step === 'select-apps' && this.hasRemovedApps) {\n\t\t\t\tthis.step = 'removed-apps';\n\t\t\t} else if (this.step === 'select-apps' && !this.hasRemovedApps) {\n\t\t\t\tthis.step = 'select-sites';\n\t\t\t} else if (this.step === 'removed-apps') {\n\t\t\t\tthis.step = 'select-sites';\n\t\t\t} else if (this.step === 'select-sites' && this.restrictMessage) {\n\t\t\t\tthis.step = 'restrict-build';\n\t\t\t}\n\t\t},\n\t\thandleAppSelection(apps) {\n\t\t\tapps = Array.from(apps);\n\t\t\tlet appData = this.benchDocResource.doc.deploy_information.apps;\n\n\t\t\tthis.selectedApps = appData\n\t\t\t\t.filter((app) => apps.includes(app.name))\n\t\t\t\t.map((app) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tapp: app.name,\n\t\t\t\t\t\tsource: app.source,\n\t\t\t\t\t\trelease: app.next_release,\n\t\t\t\t\t\thash: app.releases.find(\n\t\t\t\t\t\t\t(release) => release.name === app.next_release,\n\t\t\t\t\t\t).hash,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t\thandleSiteSelection(sites) {\n\t\t\tsites = Array.from(sites);\n\t\t\tlet siteData = this.benchDocResource.doc.deploy_information.sites;\n\n\t\t\tthis.selectedSites = siteData.filter((site) => sites.includes(site.name));\n\t\t},\n\t\tdeployFrom(app) {\n\t\t\tif (app.will_branch_change) {\n\t\t\t\treturn app.current_branch;\n\t\t\t}\n\t\t\treturn app.current_hash\n\t\t\t\t? app.current_tag || app.current_hash.slice(0, 7)\n\t\t\t\t: null;\n\t\t},\n\t\tinitialDeployTo(app) {\n\t\t\treturn this.benchDocResource.doc.deploy_information.apps.find(\n\t\t\t\t(a) => a.app === app.app,\n\t\t\t).next_release;\n\t\t},\n\t\tupdateBench() {\n\t\t\tif (this.restrictMessage && !this.ignoreWillFailCheck) {\n\t\t\t\tthis.errorMessage =\n\t\t\t\t\t'Please check the <b>I understand</b> box to proceed';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.errorMessage = '';\n\t\t\tif (this.canUpdateInPlace && this.useInPlaceUpdate) {\n\t\t\t\tthis.setSkipBackupsAndFailingPatches();\n\t\t\t\tthis.$resources.updateInPlace.submit();\n\t\t\t} else {\n\t\t\t\tthis.$resources.deployAndUpdate.submit();\n\t\t\t}\n\t\t},\n\t\tsetSkipBackupsAndFailingPatches() {\n\t\t\tfor (const site of this.selectedSites) {\n\t\t\t\tsite.skip_failing_patches = true;\n\t\t\t\tsite.skip_backups = true;\n\t\t\t}\n\t\t},\n\t\tsetErrorMessage(error) {\n\t\t\tthis.ignoreWillFailCheck = false;\n\t\t\tif (error?.exc_type === 'BuildValidationError') {\n\t\t\t\tthis.restrictMessage = error?.messages?.[0] ?? '';\n\t\t\t}\n\n\t\t\tif (error?.exc_type === 'PermissionError') {\n\t\t\t\tthis.errorMessage = error?.messages?.[0] ?? '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.restrictMessage) {\n\t\t\t\tthis.step = 'restrict-build';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.errorMessage =\n\t\t\t\t'Internal Server Error: Deploy could not be initiated';\n\t\t},\n\t},\n};\n</script>\n"],"names":["_sfc_main","CommitTag","deployInformation","appData","app","h","tag","commitChooserOptions","release","message","next_release","initialValue","value","row","url","hash","siteData","team","getTeam","disabled","Checkbox","site","benches","inPlaceUpdateFailedBenches","s","candidate","apps","sites","a","error","_b","_a","_d","_c","_hoisted_1","_hoisted_8","_hoisted_10","_hoisted_11","_hoisted_14","$data","_cache","$event","_withCtx","_createCommentVNode","_createElementVNode","_openBlock","_createElementBlock","_hoisted_2","$options","_hoisted_4","_hoisted_5","_hoisted_7","_hoisted_9","_hoisted_12","_hoisted_13","_hoisted_15"],"mappings":"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"}