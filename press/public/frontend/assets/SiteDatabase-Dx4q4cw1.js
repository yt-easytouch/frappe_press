var x=(s,e,o)=>new Promise((y,a)=>{var i=b=>{try{m(o.next(b))}catch(h){a(h)}},c=b=>{try{m(o.throw(b))}catch(h){a(h)}},m=b=>b.done?y(b.value):Promise.resolve(b.value).then(i,c);m((o=o.apply(s,e)).next())});import{_ as O}from"./Card-BCzTSeNK.js";import{a2 as q,x as C,q as p,o as r,F as E,v as N,n as H,j as t,t as f,h as _,u as g,w as d,Y as u,A as n,a5 as K,C as X,y as j,X as I,aA as F,a9 as T,ai as Q,ae as Z,a8 as J,r as V,ag as U,c8 as M}from"./main-Dpl-JOF2.js";import{D as G}from"./datetime-PXpIdgFA.js";import{n as $}from"./toast-Dk0nDfLL.js";import{_ as W}from"./BackupFilesUploader-D7iED6IX.js";import{_ as ee}from"./FileUploader-C1pIUjCt.js";import{_ as L}from"./ClickToCopyField-DpU9Eau5.js";import{_ as Y}from"./SitePlansTable-BtPUM3i9.js";import"./ListItem-CkkFcC1t.js";import"./dayjs.min-BK4AnHlu.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="ddf6e711-c13e-41ce-9a66-82f1240fb63c",s._sentryDebugIdIdentifier="sentry-dbid-ddf6e711-c13e-41ce-9a66-82f1240fb63c")}catch(o){}})();{var R=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};R._sentryModuleMetadata=R._sentryModuleMetadata||{},R._sentryModuleMetadata[new Error().stack]=Object.assign({},R._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const se={name:"FormatDate",props:{type:{type:String,default:"full"}},render(){let e=this.$slots.default()[0].children;e=e.trim();let o=this.formatDate(e,this.type);return q("span",{title:this.$date(e).toLocaleString(G.DATETIME_FULL)},o)}},te={name:"SiteRestoreSelector",props:["sites","selectedSite"],emits:["update:selectedSite"]},ae={class:"max-h-96 overflow-auto my-2"},oe=["onClick"],ie={class:"flex flex-row items-center gap-2"},ne=["checked"],le={class:"text-lg font-medium text-gray-900 group-select"};function re(s,e,o,y,a,i){return r(),p("div",ae,[(r(!0),p(E,null,N(o.sites,(c,m)=>(r(),p("div",{key:c.name,onClick:b=>s.$emit("update:selectedSite",c),class:H(["focus-within:shadow-outline flex cursor-pointer border px-4 py-3 text-left text-base",[o.selectedSite===c?"bg-blue-50":"hover:bg-blue-50",{"border-b-0":o.sites.length>1&&![o.sites.length-1,0].includes(m),"rounded-b-md":o.sites.length>1&&m===o.sites.length-1,"rounded-t-md border-b-0":o.sites.length>1&&m===0,"rounded-md border":o.sites.length==1}]])},[t("div",ie,[t("input",{type:"radio",checked:o.selectedSite===c},null,8,ne),t("div",le,f(c.name),1)])],10,oe))),128))])}const z=C(te,[["render",re]]),de={name:"SiteDatabaseBackups",props:["site"],components:{SiteRestoreSelector:z},data(){return{isRestorePending:!1,backupToRestore:null,showRestoreOnAnotherSiteDialog:!1,restoreOnAnotherSiteErrorMessage:null,selectedSite:null}},resources:{sites(){return{url:"press.api.site.all",initialData:[],auto:!0}},backups(){var s;return{url:"press.api.site.backups",params:{name:(s=this.site)==null?void 0:s.name},initialData:[],auto:!0}},scheduleBackup(){var s;return{url:"press.api.site.backup",params:{name:(s=this.site)==null?void 0:s.name,with_files:!0},onSuccess:()=>{this.$resources.backups.reload()},onError:e=>{$({title:"Couldn't create backup",message:e.messages.join(`
`),color:"red",icon:e.messages[0].includes("suspension")?"info":"alert-triangle"})}}}},mounted(){this.$socket.on("agent_job_update",s=>{s.site===this.site.name&&s.name==="Backup Site"&&s.status==="Success"&&this.$resources.backups.reload()})},computed:{backups(){return this.$resources.backups},permissions(){return{backups:this.$account.hasPermission(this.site.name,"press.api.site.get_backup_link")}}},methods:{dropdownItems(s){return[{group:"Download",items:[{label:`Database (${this.formatBytes(s.database_size||0)})`,onClick:()=>{this.downloadBackup(s.name,"database",s.database_url,s.offsite)}},{label:`Public Files (${this.formatBytes(s.public_size||0)})`,condition:()=>s.public_file,onClick:()=>{this.downloadBackup(s.name,"public",s.public_url,s.offsite)}},{label:`Private Files (${this.formatBytes(s.private_size||0)})`,condition:()=>s.private_file,onClick:()=>{this.downloadBackup(s.name,"private",s.private_url,s.offsite)}},{label:`Site Config (${this.formatBytes(s.config_file_size||0)})`,condition:()=>s.config_file_size,onClick:()=>{this.downloadBackup(s.name,"config",s.config_file_url,s.offsite)}}]},{group:"Restore",condition:()=>s.offsite,items:[{label:"Restore Backup",onClick:()=>{this.$confirm({title:"Restore Backup",message:`Are you sure you want to restore your site to <b>${this.formatDate(s.creation)}</b>?`,actionLabel:"Restore",action:e=>{e(),this.restoreOffsiteBackup(s)}})}},{label:"Restore Backup on Another Site",onClick:()=>{this.showRestoreOnAnotherSiteDialog=!0,this.backupToRestore=s}}]}].filter(e=>e.condition?e.condition():!0)},downloadBackup(s,e,o,y){return x(this,null,function*(){let a=y?yield this.$call("press.api.site.get_backup_link",{name:this.site.name,backup:s,file:e}):o;window.open(a)})},restoreOffsiteBackup(s){return x(this,null,function*(){this.isRestorePending=!0,this.$call("press.api.site.restore",{name:this.site.name,files:{database:s.remote_database_file,public:s.remote_public_file,private:s.remote_private_file}}).then(()=>{this.isRestorePending=!1,this.$router.push(`/sites/${this.site.name}/jobs`),setTimeout(()=>{window.location.reload()},1e3)})})},restoreOffsiteBackupOnAnotherSite(s){return x(this,null,function*(){this.isRestorePending=!0,this.$call("press.api.site.restore",{name:this.selectedSite.name,files:{database:s.remote_database_file,public:s.remote_public_file,private:s.remote_private_file}}).then(()=>{this.isRestorePending=!1,this.showRestoreOnAnotherSiteDialog=!1,this.$router.push(`/sites/${this.selectedSite.name}/jobs`),setTimeout(()=>{window.location.reload()},1e3)}).catch(e=>{this.restoreOnAnotherSiteErrorMessage=e})})}}},ue={key:0,class:"mt-4"},ce={class:"text-base"},me={key:0,class:"divide-y"},pe={class:"text-base"},be={key:0,class:"flex items-center justify-between"},fe={key:1},ge={class:"flex items-center space-x-2"},he={key:1,class:"mt-2 text-base text-gray-600"},_e={key:1};function ye(s,e,o,y,a,i){const c=I,m=z,b=T,h=F,w=se,S=K,A=j,k=X,l=O;return o.site?(r(),_(l,{key:0,title:"Backups",subtitle:"Backups are enabled and are scheduled to run every day."},{actions:d(()=>{var D,P;return[((D=o.site)==null?void 0:D.status)==="Active"||((P=o.site)==null?void 0:P.status)==="Suspended"?(r(),_(c,{key:0,onClick:e[0]||(e[0]=v=>s.$resources.scheduleBackup.fetch()),loading:s.$resources.scheduleBackup.loading,class:"py-5"},{default:d(()=>e[4]||(e[4]=[u(" Create Backup ")])),_:1},8,["loading"])):g("",!0),n(h,{options:{title:"Restore Backup on Another Site"},modelValue:a.showRestoreOnAnotherSiteDialog,"onUpdate:modelValue":e[3]||(e[3]=v=>a.showRestoreOnAnotherSiteDialog=v)},{"body-content":d(()=>{var v;return[e[9]||(e[9]=t("p",{class:"text-base"}," Select the site where you want to restore the backup ",-1)),n(m,{sites:s.$resources.sites.data.filter(B=>B.name!==this.site.name),selectedSite:a.selectedSite,"onUpdate:selectedSite":e[1]||(e[1]=B=>a.selectedSite=B)},null,8,["sites","selectedSite"]),a.selectedSite?(r(),p("div",ue,[t("p",ce,[e[5]||(e[5]=u(" Are you sure you want to restore the backup from ")),t("b",null,f((v=o.site)==null?void 0:v.name),1),e[6]||(e[6]=u(" taken on ")),t("b",null,f(s.formatDate(a.backupToRestore.creation)),1),e[7]||(e[7]=u(" to your site ")),t("b",null,f(a.selectedSite.name),1),e[8]||(e[8]=u("? "))])])):g("",!0),n(b,{class:"mt-2",message:a.restoreOnAnotherSiteErrorMessage},null,8,["message"])]}),actions:d(()=>[a.selectedSite?(r(),_(c,{key:0,variant:"solid",class:"w-full",onClick:e[2]||(e[2]=v=>i.restoreOffsiteBackupOnAnotherSite(a.backupToRestore))},{default:d(()=>e[10]||(e[10]=[u(" Restore ")])),_:1})):g("",!0)]),_:1},8,["modelValue"])]}),default:d(()=>[i.backups.data.length?(r(),p("div",me,[(r(!0),p(E,null,N(i.backups.data,D=>(r(),p("div",{class:"flex items-center justify-between py-2",key:D.database_url},[t("div",pe,[D.status==="Success"?(r(),p("span",be,[t("span",null,[e[11]||(e[11]=u(" Backup on ")),n(w,null,{default:d(()=>[u(f(D.creation),1)]),_:2},1024)])])):(r(),p("span",fe," Performing Backup... "))]),t("div",ge,[D.offsite?(r(),_(S,{key:0,label:"Offsite",theme:"green"})):g("",!0),n(k,{options:i.dropdownItems(D)},{default:d(({open:P})=>[n(A,{text:i.permissions.backups?"Download Backups":"You don't have enough permissions to perform this action"},{default:d(()=>[n(c,{icon:"more-horizontal",disabled:!i.permissions.backups},null,8,["disabled"])]),_:1},8,["text"])]),_:2},1032,["options"])])]))),128))])):(r(),p("div",he,[s.$resources.backups.loading?(r(),_(c,{key:0,loading:!0,"loading-text":"Loading"})):(r(),p("span",_e," No backups found "))]))]),_:1})):g("",!0)}const we=C(de,[["render",ye]]),ke={props:["site","modelValue"],emits:["update:modelValue"],data(){return{pollingAgentJob:!1,showChangePlanDialog:!1,selectedPlan:null,enableReadWriteAccess:!1,error:null}},components:{ClickToCopyField:L,SitePlansTable:Y},resources:{fetchDatabaseAccessInfo(){return{url:"press.api.site.get_database_access_info",params:{name:this.site},auto:!0}},enableDatabaseAccess(){return{url:"press.api.site.enable_database_access",params:{name:this.site,mode:this.enableReadWriteAccess?"read_write":"read_only"},onSuccess(s){this.pollDatabaseAccessJob(s)}}},disableDatabaseAccess(){return{url:"press.api.site.disable_database_access",params:{name:this.site},onSuccess(s){this.pollDatabaseAccessJob(s)}}},plans(){return{url:"press.api.site.get_plans",params:{name:this.site},initialData:[],auto:!0}},changePlan(){var s;return{url:"press.api.site.change_plan",params:{name:this.site,plan:(s=this.selectedPlan)==null?void 0:s.name},onSuccess(){$({title:`Plan changed to ${this.selectedPlan.plan_title}`,icon:"check",color:"green"}),this.showChangePlanDialog=!1,this.selectedPlan=null,this.$resources.plans.reset(),this.$resources.fetchDatabaseAccessInfo.fetch()},onError(e){this.showChangePlanDialog=!1,$({title:e,icon:"x",color:"red"})}}}},computed:{databaseAccessInfo(){return!this.$resources.fetchDatabaseAccessInfo.loading&&this.$resources.fetchDatabaseAccessInfo.data?this.$resources.fetchDatabaseAccessInfo.data:null},dbAccessCommand(){if(this.databaseAccessInfo){const{credentials:s}=this.databaseAccessInfo;return`mysql -u ${s.username} -p -h ${s.host} -P ${s.port} --ssl --ssl-verify-server-cert`}return null},plans(){return this.$resources.plans.data.map(e=>(e.database_access||(e.disabled=!0),e))},showDialog:{get(){return this.modelValue},set(s){this.$emit("update:modelValue",s)}}},methods:{dialogClosed(){this.$emit("update:show",null)},pollDatabaseAccessJob(s){this.pollingAgentJob=!0,Q({url:"press.api.site.get_job_status",params:{job_name:s}}).then(e=>{console.log(e),e.status==="Success"?(this.pollingAgentJob=!1,this.$resources.fetchDatabaseAccessInfo.fetch()):e.status==="Failure"?(this.pollingAgentJob=!1,this.error="Something went wrong. Please try again."):setTimeout(()=>{this.pollDatabaseAccessJob(s)},1e3)})}}},De={key:1},ve={key:2},Se={key:0},Ae={key:0},Ce={class:"ml-1 font-mono text-sm"},xe={class:"ml-1 font-mono text-sm"},Re={class:"ml-1 font-mono text-sm"},Pe={class:"ml-1 font-mono text-sm"},Be={class:"ml-1 font-mono text-sm"},Ve={class:"pb-2 pt-5"},$e={key:1},Ie={class:"mt-4"},Fe={key:0,class:"mb-2"};function Te(s,e,o,y,a,i){const c=Z,m=I,b=Y,h=T,w=F,S=L,A=J;return o.site?(r(),_(w,{key:0,options:{title:"Access Database"},modelValue:i.showDialog,"onUpdate:modelValue":e[6]||(e[6]=k=>i.showDialog=k),onClose:i.dialogClosed},{"body-content":d(()=>{var k;return[s.$resources.fetchDatabaseAccessInfo.loading?(r(),_(c,{key:0})):(k=i.databaseAccessInfo)!=null&&k.is_available_on_current_plan?(r(),p("div",ve,[i.databaseAccessInfo?(r(),p("div",Se,[i.databaseAccessInfo.is_database_access_enabled?(r(),p("div",Ae,[t("div",null,[e[9]||(e[9]=t("p",{class:"mb-2 text-base font-semibold text-gray-700"}," Using an Analytics or Business Intelligence Tool ",-1)),e[10]||(e[10]=t("p",{class:"mb-2 text-base"}," Use following credentials with your analytics or business intelligence tool ",-1)),t("p",Ce," Host: "+f(i.databaseAccessInfo.credentials.host),1),t("p",xe," Port: "+f(i.databaseAccessInfo.credentials.port),1),t("p",Re," Database Name: "+f(i.databaseAccessInfo.credentials.database),1),t("p",Pe," Username: "+f(i.databaseAccessInfo.credentials.username),1),t("p",Be," Password: "+f(i.databaseAccessInfo.credentials.password),1)]),t("div",Ve,[e[11]||(e[11]=t("p",{class:"mb-2 text-base font-semibold text-gray-700"}," Using MariaDB Client ",-1)),e[12]||(e[12]=t("p",{class:"mb-2 text-base"},[t("span",null,"Run this command in your terminal to access MariaDB console")],-1)),n(S,{class:"ml-1",textContent:i.dbAccessCommand},null,8,["textContent"]),e[13]||(e[13]=t("p",{class:"mt-3 text-sm"},[u(" Note: You should have a "),t("span",{class:"font-mono"},"mariadb"),u(" client installed on your computer. ")],-1))])])):(r(),p("div",$e,e[14]||(e[14]=[t("p",{class:"mb-2 text-sm"}," Database console access is disabled for this site. ",-1)])))])):g("",!0),t("div",Ie,[i.databaseAccessInfo&&!i.databaseAccessInfo.is_database_access_enabled?(r(),p("div",Fe,[n(A,{type:"checkbox",label:"Enable Read-Write Access",modelValue:a.enableReadWriteAccess,"onUpdate:modelValue":e[3]||(e[3]=l=>a.enableReadWriteAccess=l)},null,8,["modelValue"]),n(h,{class:"mt-2",message:a.error||a.enableReadWriteAccess&&"Your credentials can be used to modify or wipe your database"},null,8,["message"])])):g("",!0),i.databaseAccessInfo&&!i.databaseAccessInfo.is_database_access_enabled?(r(),_(m,{key:1,onClick:e[4]||(e[4]=l=>s.$resources.enableDatabaseAccess.submit()),loading:s.$resources.enableDatabaseAccess.loading||a.pollingAgentJob,variant:"solid",class:"mt-2 w-full"},{default:d(()=>[u("Enable "+f(a.enableReadWriteAccess?"Read-Write":"Read-Only")+" Access",1)]),_:1},8,["loading"])):g("",!0),i.databaseAccessInfo&&i.databaseAccessInfo.is_database_access_enabled?(r(),_(m,{key:2,onClick:e[5]||(e[5]=l=>s.$resources.disableDatabaseAccess.submit()),loading:s.$resources.disableDatabaseAccess.loading||a.pollingAgentJob,class:"w-full"},{default:d(()=>e[15]||(e[15]=[u("Disable Access")])),_:1},8,["loading"])):g("",!0)])])):(r(),p("div",De,[t("div",null,[e[8]||(e[8]=t("p",{class:"text-base"}," Database access is not available on your current plan. Please upgrade your plan to access your site database. ",-1)),n(m,{class:"mt-4 w-full",variant:"solid",onClick:e[0]||(e[0]=l=>a.showChangePlanDialog=!0)},{default:d(()=>e[7]||(e[7]=[u("Upgrade Site Plan")])),_:1})]),n(w,{options:{title:"Upgrade Plan",actions:[{label:"Submit",variant:"solid",loading:s.$resources.changePlan.loading,onClick:()=>s.$resources.changePlan.submit()}]},modelValue:a.showChangePlanDialog,"onUpdate:modelValue":e[2]||(e[2]=l=>a.showChangePlanDialog=l)},{"body-content":d(()=>[n(b,{class:"mt-3",plans:i.plans,selectedPlan:a.selectedPlan,"onUpdate:selectedPlan":e[1]||(e[1]=l=>a.selectedPlan=l)},null,8,["plans","selectedPlan"]),n(h,{class:"mt-4",message:s.$resources.changePlan.error},null,8,["message"])]),_:1},8,["options","modelValue"])]))]}),_:1},8,["modelValue","onClose"])):g("",!0)}const Ue=C(ke,[["render",Te]]),Me={name:"SiteDatabase",components:{FileUploader:ee,BackupFilesUploader:W,DatabaseAccessDialog:Ue},props:["site"],data(){return{confirmSiteName:"",showResetDialog:!1,showMigrateDialog:!1,showRestoreDialog:!1,showDatabaseAccessDialog:!1,selectedFiles:{database:null,public:null,private:null},wantToSkipFailingPatches:!1}},resources:{restoreBackup(){var s;return{url:"press.api.site.restore",params:{name:(s=this.site)==null?void 0:s.name,files:this.selectedFiles,skip_failing_patches:this.wantToSkipFailingPatches},validate(){var e;if(this.confirmSiteName!==((e=this.site)==null?void 0:e.name))return"Please type the site name to confirm.";if(!this.filesUploaded)return"Please upload database, public and private files to restore."},onSuccess(e){this.selectedFiles={},this.$router.push({name:"SiteJobs",params:{jobName:e}}),setTimeout(()=>{window.location.reload()},1e3)}}},resetDatabase(){var s;return{url:"press.api.site.reinstall",params:{name:(s=this.site)==null?void 0:s.name},validate(){var e;if(this.confirmSiteName!==((e=this.site)==null?void 0:e.name))return"Please type the site name to confirm."},onSuccess(e){this.$router.push({name:"SiteJobs",params:{jobName:e}}),setTimeout(()=>{window.location.reload()},1e3)}}},migrateDatabase(){var s;return{url:"press.api.site.migrate",params:{name:(s=this.site)==null?void 0:s.name},validate(){var e;if(this.confirmSiteName!==((e=this.site)==null?void 0:e.name))return"Please type the site name to confirm."},onSuccess(){var e;this.$router.push({name:"SiteOverview",params:{site:(e=this.site)==null?void 0:e.name}}),setTimeout(()=>{window.location.reload()},1e3)}}},clearCache(){var s;return{url:"press.api.site.clear_cache",params:{name:(s=this.site)==null?void 0:s.name},onSuccess(){var e;this.$router.push({name:"SiteOverview",params:{site:(e=this.site)==null?void 0:e.name}}),setTimeout(()=>{window.location.reload()},1e3)}}}},methods:{migrateDatabase(){this.$resources.migrateDatabase.submit({name:this.site.name,skip_failing_patches:this.wantToSkipFailingPatches})},confirmClearCache(){this.$confirm({title:"Clear Cache",message:`
					<b>bench clear-cache</b> and <b>bench clear-website-cache</b> commands will be executed on your site. Are you sure
					you want to run these command?
				`,actionLabel:"Clear Cache",actionColor:"red",action:s=>{this.$resources.clearCache.submit(),s()}})}},computed:{permissions(){return{migrate:this.$account.hasPermission(this.site.name,"press.api.site.migrate"),restore:this.$account.hasPermission(this.site.name,"press.api.site.restore"),reset:this.$account.hasPermission(this.site.name,"press.api.site.reset"),access:this.$account.hasPermission(this.site.name,"press.api.site.enable_database_access")}},filesUploaded(){return this.selectedFiles.database}}},Oe={class:"divide-y"},Ee={class:"flex items-center justify-between py-3"},Ne={class:"flex items-center justify-between py-3"},je={class:"flex items-center justify-between py-3"},Je={class:"flex items-center justify-between py-3"},We={key:0,class:"flex items-center justify-between py-3"},Le={class:"mt-4 text-base"},Ye={class:"font-semibold"},ze={class:"mt-2"},qe={class:"space-y-4"},He={class:"mt-4 text-base"},Ke={class:"font-semibold"},Xe={class:"mt-3"},Qe={class:"mt-4 text-base"},Ze={class:"font-semibold"};function Ge(s,e,o,y,a,i){const c=I,m=j,b=J,h=T,w=F,S=W,A=V("DatabaseAccessDialog"),k=O;return o.site?(r(),_(k,{key:0,title:"Restore, Migrate & Reset",subtitle:o.site.status==="Suspended"?"Activate the site to enable these actions":""},{default:d(()=>[t("div",Oe,[t("div",Ee,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-lg"},"Restore"),t("p",{class:"mt-1 text-base text-gray-600"}," Restore your database using a previous backup ")],-1)),n(m,{text:i.permissions.restore?"Restore Database":"You don't have enough permissions to perform this action"},{default:d(()=>[n(c,{theme:"red",disabled:o.site.status==="Suspended"||!i.permissions.restore,onClick:e[0]||(e[0]=l=>a.showRestoreDialog=!0)},{default:d(()=>e[15]||(e[15]=[u(" Restore ")])),_:1},8,["disabled"])]),_:1},8,["text"])]),t("div",Ne,[e[18]||(e[18]=t("div",null,[t("h3",{class:"text-lg"},"Migrate"),t("p",{class:"mt-1 text-base text-gray-600"}," Run bench migrate command on your database ")],-1)),n(m,{text:i.permissions.migrate?"Migrate Database":"You don't have enough permissions to perform this action"},{default:d(()=>[n(c,{theme:"red",disabled:o.site.status==="Suspended"||!i.permissions.migrate,onClick:e[1]||(e[1]=l=>a.showMigrateDialog=!0)},{default:d(()=>e[17]||(e[17]=[u(" Migrate ")])),_:1},8,["disabled"])]),_:1},8,["text"])]),t("div",je,[e[20]||(e[20]=t("div",null,[t("h3",{class:"text-lg"},"Reset"),t("p",{class:"mt-1 text-base text-gray-600"}," Reset your database to a clean state ")],-1)),n(m,{text:i.permissions.reset?"Reset Database":"You don't have enough permissions to perform this action"},{default:d(()=>[n(c,{theme:"red",disabled:o.site.status==="Suspended"||!i.permissions.reset,onClick:e[2]||(e[2]=l=>a.showResetDialog=!0)},{default:d(()=>e[19]||(e[19]=[u(" Reset ")])),_:1},8,["disabled"])]),_:1},8,["text"])]),t("div",Je,[e[22]||(e[22]=t("div",null,[t("h3",{class:"text-lg"},"Clear Cache"),t("p",{class:"mt-1 text-base text-gray-600"},"Clear your site's cache")],-1)),n(c,{disabled:o.site.status==="Suspended",onClick:i.confirmClearCache},{default:d(()=>e[21]||(e[21]=[u(" Clear ")])),_:1},8,["disabled","onClick"])]),s.$account.team.database_access_enabled?(r(),p("div",We,[e[24]||(e[24]=t("div",null,[t("h3",{class:"text-lg"},"Access"),t("p",{class:"mt-1 text-base text-gray-600"},"Connect to your database")],-1)),n(m,{text:i.permissions.access?"Access Database":"You don't have enough permissions to perform this action"},{default:d(()=>[n(c,{disabled:!i.permissions.access,"icon-left":"database",onClick:e[3]||(e[3]=l=>a.showDatabaseAccessDialog=!0)},{default:d(()=>e[23]||(e[23]=[u(" Access")])),_:1},8,["disabled"])]),_:1},8,["text"])])):g("",!0)]),n(w,{options:{title:"Migrate Database",actions:[{label:"Migrate",variant:"solid",theme:"red",loading:s.$resources.migrateDatabase.loading,onClick:i.migrateDatabase}]},modelValue:a.showMigrateDialog,"onUpdate:modelValue":e[6]||(e[6]=l=>a.showMigrateDialog=l),onClose:e[7]||(e[7]=()=>{s.$resources.migrateDatabase.reset(),a.wantToSkipFailingPatches=!1})},{"body-content":d(()=>[e[28]||(e[28]=t("p",{class:"text-base"},[t("b",null,"bench migrate"),u(" command will be executed on your database. Are you sure you want to run this command? We recommend that you download a database backup before continuing. ")],-1)),t("p",Le,[e[25]||(e[25]=u(" Please type ")),t("span",Ye,f(o.site.name),1),e[26]||(e[26]=u(" to confirm. "))]),n(b,{class:"mt-4 w-full",modelValue:a.confirmSiteName,"onUpdate:modelValue":e[4]||(e[4]=l=>a.confirmSiteName=l)},null,8,["modelValue"]),n(h,{class:"mt-2",message:s.$resources.migrateDatabase.error},null,8,["message"]),t("div",ze,[U(t("input",{id:"skip-failing",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500","onUpdate:modelValue":e[5]||(e[5]=l=>a.wantToSkipFailingPatches=l)},null,512),[[M,a.wantToSkipFailingPatches]]),e[27]||(e[27]=t("label",{for:"skip-failing",class:"ml-2 text-sm text-gray-900"}," Skip failing patches (if any patch fails) ",-1))])]),_:1},8,["options","modelValue"]),n(w,{options:{title:"Restore",actions:[{label:"Restore",variant:"solid",loading:s.$resources.restoreBackup.loading,onClick:()=>s.$resources.restoreBackup.submit()}]},modelValue:a.showRestoreDialog,"onUpdate:modelValue":e[11]||(e[11]=l=>a.showRestoreDialog=l)},{"body-content":d(()=>[t("div",qe,[e[29]||(e[29]=t("p",{class:"text-base"}," Restore your database using a previous backup. ",-1)),n(S,{backupFiles:a.selectedFiles,"onUpdate:backupFiles":e[8]||(e[8]=l=>a.selectedFiles=l)},null,8,["backupFiles"])]),t("p",He,[e[30]||(e[30]=u(" Please type ")),t("span",Ke,f(o.site.name),1),e[31]||(e[31]=u(" to confirm. "))]),n(b,{class:"mt-4 w-full",modelValue:a.confirmSiteName,"onUpdate:modelValue":e[9]||(e[9]=l=>a.confirmSiteName=l)},null,8,["modelValue"]),t("div",Xe,[U(t("input",{id:"skip-failing",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500","onUpdate:modelValue":e[10]||(e[10]=l=>a.wantToSkipFailingPatches=l)},null,512),[[M,a.wantToSkipFailingPatches]]),e[32]||(e[32]=t("label",{for:"skip-failing",class:"ml-2 text-sm text-gray-900"}," Skip failing patches (if any patch fails) ",-1))]),n(h,{class:"mt-2",message:s.$resources.restoreBackup.error},null,8,["message"])]),_:1},8,["options","modelValue"]),a.showDatabaseAccessDialog?(r(),_(A,{key:0,site:o.site.name,modelValue:a.showDatabaseAccessDialog,"onUpdate:modelValue":e[12]||(e[12]=l=>a.showDatabaseAccessDialog=l)},null,8,["site","modelValue"])):g("",!0),n(w,{options:{title:"Reset Database",actions:[{label:"Reset",variant:"solid",theme:"red",loading:s.$resources.resetDatabase.loading,onClick:()=>s.$resources.resetDatabase.submit()}]},modelValue:a.showResetDialog,"onUpdate:modelValue":e[14]||(e[14]=l=>a.showResetDialog=l)},{"body-content":d(()=>[e[35]||(e[35]=t("p",{class:"text-base"}," All the data from your site will be lost. Are you sure you want to reset your database? ",-1)),t("p",Qe,[e[33]||(e[33]=u(" Please type ")),t("span",Ze,f(o.site.name),1),e[34]||(e[34]=u(" to confirm. "))]),n(b,{class:"mt-4 w-full",modelValue:a.confirmSiteName,"onUpdate:modelValue":e[13]||(e[13]=l=>a.confirmSiteName=l)},null,8,["modelValue"]),n(h,{class:"mt-2",message:s.$resources.resetDatabase.error},null,8,["message"])]),_:1},8,["options","modelValue"])]),_:1},8,["subtitle"])):g("",!0)}const es=C(Me,[["render",Ge]]),ss={name:"SiteDatabase",props:["site"],components:{SiteDatabaseBackups:we,SiteDatabaseRestore:es}},ts={key:0,class:"grid grid-cols-1 gap-5 md:grid-cols-2"};function as(s,e,o,y,a,i){const c=V("SiteDatabaseBackups"),m=V("SiteDatabaseRestore");return o.site?(r(),p("div",ts,[n(c,{site:o.site},null,8,["site"]),n(m,{site:o.site},null,8,["site"])])):g("",!0)}const fs=C(ss,[["render",as]]);export{fs as default};
//# sourceMappingURL=SiteDatabase-Dx4q4cw1.js.map
