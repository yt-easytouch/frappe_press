import{x as ee,z as C,r as I,q as a,o as s,j as p,A as d,a6 as L,w as l,X as te,u as m,Y as _,F as v,h as c,t as h,B as se,a8 as ie,v as k,n as ne,a5 as oe,y as ae,C as le,a7 as re,ae as de,a9 as ue,aA as ce,D as U}from"./main-Dpl-JOF2.js";import{_ as $,a as x,b as B,c as P}from"./TableHeader-DvqcS5cY.js";import{_ as F,a as pe}from"./AlertBillingInformation-C5f9OKMF.js";import{_ as me}from"./Alert-COV4XS8q.js";import{_ as _e}from"./Breadcrumbs-yx7M4N4X.js";import{l as ge}from"./loginAsAdmin-BAeVrwth.js";import{n as V}from"./toast-Dk0nDfLL.js";import"./StripeLogo-BRF2qIyd.js";import"./stripe.esm-D4yu_pm0.js";import"./BillingInformationDialog-B5pmLI5R.js";import"./StripeCard-BRr8QCrN.js";import"./AddressForm-Cz0XUJgF.js";import"./Form-CIPLpg2e.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="12c2a205-6479-476e-ba58-4874dfacd87e",t._sentryDebugIdIdentifier="sentry-dbid-12c2a205-6479-476e-ba58-4874dfacd87e")}catch(n){}})();{var A=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};A._sentryModuleMetadata=A._sentryModuleMetadata||{},A._sentryModuleMetadata[new Error().stack]=Object.assign({},A._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const he={name:"Sites",pageMeta(){return{title:"Sites - Easytouch Cloud"}},props:["bench"],components:{Table:P,TableHeader:B,TableRow:x,TableCell:$,PrepaidCreditsDialog:C(()=>U(()=>import("./AlertBillingInformation-C5f9OKMF.js").then(t=>t.P),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),StripeCard:C(()=>U(()=>import("./StripeCard-BRr8QCrN.js"),__vite__mapDeps([7,4,1,2,8,9,5]))),AlertBillingInformation:F,UpdateBillingDetails:C(()=>U(()=>import("./UpdateBillingDetails-DpNU6Kwd.js"),__vite__mapDeps([10,1,2,8,9])))},data(){return{showPrepaidCreditsDialog:!1,showAddCardDialog:!1,searchTerm:"",reasonForAdminLogin:"",errorMessage:null,showReasonForAdminLoginDialog:!1,siteForLogin:null,site_status:"All",site_tag:"",showAddressDialog:!1}},resources:{allSites(){return{url:"press.api.site.all",params:{site_filter:{status:this.site_status,tag:this.site_tag}},auto:!0,cache:["SiteList",this.site_status,this.site_tag,this.$account.team.name]}},siteTags:{url:"press.api.site.site_tags",auto:!0,initialData:[]},latestUnpaidInvoice:{url:"press.api.billing.get_latest_unpaid_invoice",auto:!0},loginAsAdmin(){return ge("placeholderSite")},billingDetails:"press.api.billing.details"},mounted(){this.$socket.on("agent_job_update",this.onAgentJobUpdate),this.$socket.on("list_update",this.onSiteUpdate)},unmounted(){this.$socket.off("agent_job_update",this.onAgentJobUpdate),this.$socket.off("list_update",this.onSiteUpdate)},methods:{validateCreateSite(){this.$account.hasBillingInfo?this.$account.billing_info.has_unpaid_invoices&&!this.$account.team.free_account?V({title:"Please settle your unpaid invoices from the billing tab in order to create new sites",icon:"info",color:"yellow"}):this.$router.replace("/sites/new"):this.showAddCardDialog=!0},onAgentJobUpdate(t){(t.name==="New Site"||t.name==="New Site from Backup")&&t.status==="Success"&&t.user===this.$account.user.name&&(this.reload(),V({title:"Site creation complete!",message:"Login to your site and complete the setup wizard",icon:"check",color:"green"}))},onSiteUpdate(t){if(t.doctype==="Site"){let e=this.sites;(t.user===this.$account.user.name||e.includes(t.name))&&this.reload()}},reload(){!this.$resources.allSites.loading&&new Date-this.$resources.allSites.lastLoaded>5e3&&this.$resources.allSites.reload()},handleAddPrepaidCreditsSuccess(){this.$resources.latestUnpaidInvoice.reload(),this.showPrepaidCreditsDialog=!1},dropdownItems(t){return[{label:"Visit Site",onClick:()=>{window.open(`https://${t.name}/apps`,"_blank")}},{label:"Login As Admin",onClick:()=>{if(this.$account.team.name===t.team)return this.$resources.loginAsAdmin.submit({name:t.name});this.siteForLogin=t.name,this.showReasonForAdminLoginDialog=!0}}]},proceedWithLoginAsAdmin(){if(this.errorMessage="",!this.reasonForAdminLogin.trim()){this.errorMessage="Reason is required";return}this.$resources.loginAsAdmin.submit({name:this.siteForLogin,reason:this.reasonForAdminLogin}),this.showReasonForAdminLoginDialog=!1}},computed:{sites(){if(!this.$resources.allSites.data)return[];let t=this.$resources.allSites.data.filter(e=>this.$account.hasPermission(e.name,"",!0));return this.searchTerm?t.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())):t},sitesByGroup(){let t={};for(let e of this.sites){let n=e.group;t[n]||(t[n]=[]),e.route={name:"SiteOverview",params:{siteName:e.name}},t[n].push(e)}return t},groups(){let t=[],e=[];for(let n of this.sites)n.public&&(n.title="Shared",n.group="Shared"),t.includes(n.group)||(t.push(n.group),n.public?e.unshift({title:n.title,group:n.group,public:n.public,version:n.version}):e.push({title:n.title,group:n.group,public:n.public,version:n.version}));return e},showUnpaidInvoiceAlert(){if(this.latestUnpaidInvoice)return!(this.$account.team.erpnext_partner||this.$account.team.free_account)},latestUnpaidInvoice(){if(this.$resources.latestUnpaidInvoice.data)return this.$resources.latestUnpaidInvoice.data},siteStatusFilterOptions(){return[{label:"All",value:"All"},{label:"Active",value:"Active"},{label:"Broken",value:"Broken"},{label:"Inactive",value:"Inactive"},{label:"Trial",value:"Trial"},{label:"Update Available",value:"Update Available"}]},siteTagFilterOptions(){const t=[{label:"",value:""}];return this.$resources.siteTags.data?[...t,...this.$resources.siteTags.data.map(e=>({label:e,value:e}))]:t}}},fe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-5 py-2.5"},be={class:"my-5 space-y-2 px-5"},ve={key:0},ye={class:"mx-5"},Ae={class:"pb-20"},ke={class:"flex"},we={class:"flex w-full space-x-2 pb-4"},Se={class:"flex w-full items-center rounded-t bg-gray-50 px-3 py-2 text-base"},De={class:"font-semibold text-gray-900"},Ce={key:0,class:"ml-2 text-gray-600"},Ue={key:2,class:"h-7"},Te={key:1,class:"hidden space-x-1 lg:flex"},Ie={key:1},Le={key:2,class:"hidden md:block"},Ve={key:3,class:"hidden md:block"},$e=["src","alt","title"],xe={key:1,class:"text-base text-gray-700"},Be={key:4,class:"w-full text-right"},Pe={key:5},Fe={class:"mt-8 flex items-center justify-center"},Ee={key:1,class:"text-base text-gray-700"};function Re(t,e,n,Me,i,u){var T;const f=te,E=_e,w=me,R=F,M=I("router-link"),N=I("UpdateBillingDetails"),O=pe,j=se,y=ie,z=B,S=oe,q=ae,Y=le,J=$,H=x,W=de,G=P,K=ue,X=ce;return s(),a("div",null,[p("div",null,[p("header",fe,[d(E,{items:[{label:"Sites",route:{name:"Sites"}}]},L({_:2},[(T=this.$account)!=null&&T.team.enabled?{name:"actions",fn:l(()=>[d(f,{variant:"solid","icon-left":"plus",class:"ml-2",label:"Create",onClick:u.validateCreateSite},null,8,["onClick"])]),key:"0"}:void 0]),1024)]),p("div",be,[t.$account.team.enabled?m("",!0):(s(),a("div",ve,[d(w,{title:"Your account is disabled"},{actions:l(()=>[d(f,{variant:"solid",route:"/settings/profile"},{default:l(()=>e[10]||(e[10]=[_(" Enable Account ")])),_:1})]),default:l(()=>[e[11]||(e[11]=_(" Enable your account to start creating sites "))]),_:1})])),d(R),u.showUnpaidInvoiceAlert?(s(),a(v,{key:1},[u.latestUnpaidInvoice.payment_mode==="Prepaid Credits"?(s(),c(w,{key:0,title:"Your last invoice payment has failed."},{actions:l(()=>[d(f,{onClick:e[0]||(e[0]=r=>t.$account.team.billing_address?i.showPrepaidCreditsDialog=!0:i.showAddressDialog=!0),variant:"solid"},{default:l(()=>e[12]||(e[12]=[_(" Add Credits ")])),_:1})]),default:l(()=>[e[13]||(e[13]=_(" Please add ")),p("strong",null,h(u.latestUnpaidInvoice.currency)+" "+h(u.latestUnpaidInvoice.amount_due),1),e[14]||(e[14]=_(" more in credits. "))]),_:1})):(s(),c(w,{key:1,title:"Your last invoice payment has failed."},L({default:l(()=>[e[16]||(e[16]=_(" Pay now for uninterrupted services. "))]),_:2},[this.$resources.latestUnpaidInvoice.data?{name:"actions",fn:l(()=>[d(M,{to:{path:"/billing",query:{invoiceStatus:"Unpaid"}}},{default:l(()=>[d(f,{variant:"solid"},{default:l(()=>e[15]||(e[15]=[_(" Go to Billing ")])),_:1})]),_:1})]),key:"0"}:void 0]),1024)),i.showAddressDialog?(s(),c(N,{key:2,modelValue:i.showAddressDialog,"onUpdate:modelValue":e[1]||(e[1]=r=>i.showAddressDialog=r),onUpdated:e[2]||(e[2]=r=>{i.showAddressDialog=!1,i.showPrepaidCreditsDialog=!0,t.$resources.billingDetails.reload()})},null,8,["modelValue"])):m("",!0),i.showPrepaidCreditsDialog?(s(),c(O,{key:3,show:i.showPrepaidCreditsDialog,"onUpdate:show":e[3]||(e[3]=r=>i.showPrepaidCreditsDialog=r),"minimum-amount":Math.ceil(u.latestUnpaidInvoice.amount_due),onSuccess:u.handleAddPrepaidCreditsSuccess},null,8,["show","minimum-amount","onSuccess"])):m("",!0)],64)):m("",!0)]),p("div",ye,[p("div",Ae,[p("div",ke,[p("div",we,[d(y,{label:"Search Sites",modelValue:i.searchTerm,"onUpdate:modelValue":e[4]||(e[4]=r=>i.searchTerm=r)},{prefix:l(()=>[d(j,{name:"search",class:"w-4 text-gray-600"})]),_:1},8,["modelValue"]),d(y,{label:"Status",class:"mr-8",type:"select",options:u.siteStatusFilterOptions,modelValue:i.site_status,"onUpdate:modelValue":e[5]||(e[5]=r=>i.site_status=r)},null,8,["options","modelValue"]),t.$resources.siteTags.data.length>0?(s(),c(y,{key:0,label:"Tag",class:"mr-8",type:"select",options:u.siteTagFilterOptions,modelValue:i.site_tag,"onUpdate:modelValue":e[6]||(e[6]=r=>i.site_tag=r)},null,8,["options","modelValue"])):m("",!0)])]),d(G,{columns:[{label:"Site Name",name:"name",width:2},{label:"Status",name:"status",width:1},{label:"Region",name:"region",width:.5},{label:"Tags",name:"tags",width:1},{label:"Plan",name:"plan",width:1.5},{label:"",name:"actions",width:.5}],rows:u.sites},{default:l(({rows:r,columns:Q})=>[d(z,{class:"mb-4 hidden lg:grid"}),(s(!0),a(v,null,k(u.groups,g=>(s(),a("div",{key:g.group,class:"mb-4 rounded border"},[p("div",Se,[p("span",De,h(g.title),1),g.public?m("",!0):(s(),a("span",Ce,h(g.version),1)),g.public?(s(),a("div",Ue)):(s(),c(f,{key:1,variant:"ghost",class:"ml-auto",route:{name:"Bench",params:{benchName:g.group}}},{default:l(()=>e[17]||(e[17]=[_(" View Bench ")])),_:2},1032,["route"]))]),(s(!0),a(v,null,k(u.sitesByGroup[g.group],(o,Z)=>(s(),c(H,{key:o.name,row:o,class:ne(Z===0?"rounded-b":"rounded")},{default:l(()=>[(s(!0),a(v,null,k(Q,b=>(s(),c(J,null,{default:l(()=>[b.name==="status"?(s(),c(S,{key:0,label:t.$siteStatus(o)},null,8,["label"])):b.name==="tags"?(s(),a("div",Te,[(s(!0),a(v,null,k(o.tags.slice(0,1),(D,Ne)=>(s(),c(S,{theme:"blue",label:D},null,8,["label"]))),256)),o.tags.length>1?(s(),c(q,{key:0,text:o.tags.slice(1).join(", ")},{default:l(()=>[o.tags.length>1?(s(),c(S,{key:0,label:`+${o.tags.length-1}`},null,8,["label"])):m("",!0)]),_:2},1032,["text"])):m("",!0),o.tags.length==0?(s(),a("span",Ie,"-")):m("",!0)])):b.name==="plan"?(s(),a("span",Le,h(o.plan?`${t.$planTitle(o.plan)}${o.plan.price_usd>0?"/mo":""}`:""),1)):b.name==="region"?(s(),a("div",Ve,[o.server_region_info.image?(s(),a("img",{key:0,class:"h-4",src:o.server_region_info.image,alt:`Flag of ${o.server_region_info.title}`,title:o.server_region_info.title},null,8,$e)):(s(),a("span",xe,h(o.server_region_info.title),1))])):b.name=="actions"?(s(),a("div",Be,[["Active","Updating"].includes(o.status)?(s(),c(Y,{key:0,onClick:e[7]||(e[7]=re(()=>{},["prevent"])),options:u.dropdownItems(o)},{default:l(({open:D})=>[d(f,{variant:D?"subtle":"ghost",icon:"more-horizontal"},null,8,["variant"])]),_:2},1032,["options"])):m("",!0)])):(s(),a("span",Pe,h(o[b.name]||""),1))]),_:2},1024))),256))]),_:2},1032,["row","class"]))),128))]))),128)),p("div",Fe,[t.$resources.allSites.loading&&!t.$resources.allSites.data?(s(),c(W,{key:0})):t.$resources.allSites.fetched&&r.length===0?(s(),a("div",Ee," No Sites ")):m("",!0)])]),_:1},8,["rows"]),d(X,{options:{title:"Login As Administrator",actions:[{label:"Proceed",variant:"solid",onClick:u.proceedWithLoginAsAdmin}]},modelValue:i.showReasonForAdminLoginDialog,"onUpdate:modelValue":e[9]||(e[9]=r=>i.showReasonForAdminLoginDialog=r)},{"body-content":l(()=>[d(y,{label:"Reason for logging in as Administrator",type:"textarea",modelValue:i.reasonForAdminLogin,"onUpdate:modelValue":e[8]||(e[8]=r=>i.reasonForAdminLogin=r),required:""},null,8,["modelValue"]),d(K,{class:"mt-3",message:i.errorMessage},null,8,["message"])]),_:1},8,["options","modelValue"])])])])])}const et=ee(he,[["render",Re]]);export{et as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/AlertBillingInformation-C5f9OKMF.js","assets/main-Dpl-JOF2.js","assets/main-B0ZLDivw.css","assets/Alert-COV4XS8q.js","assets/StripeLogo-BRF2qIyd.js","assets/stripe.esm-D4yu_pm0.js","assets/BillingInformationDialog-B5pmLI5R.js","assets/StripeCard-BRr8QCrN.js","assets/AddressForm-Cz0XUJgF.js","assets/Form-CIPLpg2e.js","assets/UpdateBillingDetails-DpNU6Kwd.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=Sites-B9fK3Pc3.js.map
