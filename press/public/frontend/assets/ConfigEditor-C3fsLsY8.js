var I=Object.defineProperty,O=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var D=(t,e,s)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_=(t,e)=>{for(var s in e||(e={}))P.call(e,s)&&D(t,s,e[s]);if(S)for(var s of S(e))B.call(e,s)&&D(t,s,e[s]);return t},N=(t,e)=>O(t,J(e));var K=(t,e,s)=>new Promise((o,n)=>{var i=r=>{try{p(s.next(r))}catch(c){n(c)}},d=r=>{try{p(s.throw(r))}catch(c){n(c)}},p=r=>r.done?o(r.value):Promise.resolve(r.value).then(i,d);p((s=s.apply(t,e)).next())});import{_ as T}from"./Card-BCzTSeNK.js";import{x as U,ar as V,h as C,o as u,w as y,j as f,A as g,q as h,a9 as M,F as E,v as j,a8 as F,X as L,Y as w,u as v,t as $,aA as H,aT as q}from"./main-Dpl-JOF2.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="fadaa645-0d0f-45e1-98bb-e63135315eda",t._sentryDebugIdIdentifier="sentry-dbid-fadaa645-0d0f-45e1-98bb-e63135315eda")}catch(s){}})();{var m=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};m._sentryModuleMetadata=m._sentryModuleMetadata||{},m._sentryModuleMetadata[new Error().stack]=Object.assign({},m._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const X={name:"ConfigEditor",components:{Autocomplete:V},props:["title","subtitle","configName","configData","updateConfigMethod"],data(){return{isDirty:!1,showCustomKeyInput:!1,showAddConfigKeyDialog:!1,chosenStandardConfig:{title:"",key:""},newConfig:{key:"",value:"",type:"String"}}},resources:{configData(){return this.configData()},updateConfig(){function t(o){try{return JSON.parse(o),!0}catch(n){return!1}}const e=this.$resources.configData.data.map(o=>{const n=o.value;return isNaN(n)?t(n)?o.type="JSON":o.type==="Password"?o.type="Password":o.type="String":o.type="Number",{key:o.key,value:n,type:o.type}});return N(_({},this.updateConfigMethod(e)),{validate(){return K(this,null,function*(){let o=e.map(i=>i.key);if(o.length!==[...new Set(o)].length)return"Duplicate key";this.$resources.validateKeys.submit({keys:JSON.stringify(o)});let n=this.$resources.validateKeys.data;if((n==null?void 0:n.length)>0)return`Invalid key: ${n.join(", ")}`;for(let i of e)if(i.type==="JSON")try{JSON.parse(JSON.stringify(i.value))}catch(d){return`Invalid JSON -- ${d}`}else if(i.type==="Number")try{Number(i.value)}catch(d){return"Invalid Number"}})},onSuccess(){this.isDirty=!1,this.$resources.configData.reload()}})},standardConfigKeys:{url:"press.api.config.standard_keys",cache:"standardConfigKeys",auto:!0},validateKeys:{url:"press.api.config.is_valid"}},computed:{configPreview(){let t={};for(let e of this.$resources.configData.data){let s=e.value;if(["Boolean","Number"].includes(e.type))s=Number(e.value);else if(e.type==="JSON")try{s=JSON.parse(e.value)}catch(o){s={}}t[e.key]=s}return JSON.stringify(t,null,"&nbsp; ")},getStandardConfigKeys(){return[{group:"Custom",items:[{label:"Create a custom key",value:"custom_key"}]},{group:"Standard",items:this.$resources.standardConfigKeys.data.map(t=>({label:t.title,value:t.key}))}]}},methods:{configInputProps(){return{type:{String:"text",Password:"text",Number:"number",JSON:"textarea",Boolean:"select"}[this.newConfig.type],options:this.newConfig.type==="Boolean"?["1","0"]:null}},addConfig(){this.$resources.configData.data.push({key:this.getStandardConfigKey(this.newConfig.key),value:this.newConfig.value,type:this.newConfig.type}),this.isDirty=!0,this.showAddConfigKeyDialog=!1},handleAutocompleteSelection(){var t,e,s;((t=this.chosenStandardConfig)==null?void 0:t.value)==="custom_key"?this.showCustomKeyInput=!0:(this.showCustomKeyInput=!1,this.newConfig.type=this.getStandardConfigType((e=this.chosenStandardConfig)==null?void 0:e.value)),this.newConfig.type==="Boolean"?this.newConfig.value=0:this.newConfig.type==="JSON"?this.newConfig.value="{}":this.newConfig.value="",this.newConfig.key=((s=this.chosenStandardConfig)==null?void 0:s.value)||""},getStandardConfigType(t){var e;return((e=this.$resources.standardConfigKeys.data.find(s=>s.key===t))==null?void 0:e.type)||"String"},getStandardConfigKey(t){var e;return((e=this.$resources.standardConfigKeys.data.find(s=>s.title===t))==null?void 0:e.key)||t},getStandardConfigTitle(t){var e;return((e=this.$resources.standardConfigKeys.data.find(s=>s.key===t))==null?void 0:e.title)||t},removeConfig(t){const e=this.$resources.configData.data.indexOf(t);e>-1&&this.$resources.configData.data.splice(e,1),this.isDirty=!0},updateConfig(){this.isDirty?this.$resources.updateConfig.submit():this.isDirty=!1}}},Y={class:"flex space-x-4"},z={class:"w-full shrink-0 space-y-4 md:w-1/2"},Q={class:"ml-2"},R={key:1,class:"my-2 text-base text-gray-600"},W={class:"hidden h-fit max-w-full flex-1 overflow-x-scroll whitespace-pre-line rounded bg-gray-100 p-4 font-mono text-base md:block"},Z={key:0,class:"mb-4"},G=["innerHTML"],ee={class:"space-y-4"};function te(t,e,s,o,n,i){const d=L,p=M,r=F,c=V,x=H,A=T;return u(),C(A,{title:s.title||"Site Config"},{actions:y(()=>[n.isDirty?(u(),C(d,{key:0,class:"mr-2",loading:t.$resources.configData.loading,onClick:e[0]||(e[0]=()=>{t.$resources.configData.reload().then(()=>{n.isDirty=!1})})},{default:y(()=>e[11]||(e[11]=[w(" Discard changes ")])),_:1},8,["loading"])):v("",!0),n.isDirty?(u(),C(d,{key:1,variant:"solid",onClick:i.updateConfig,loading:t.$resources.updateConfig.loading},{default:y(()=>e[12]||(e[12]=[w(" Save changes ")])),_:1},8,["onClick","loading"])):v("",!0)]),default:y(()=>{var k,b;return[f("div",Y,[f("div",z,[f("div",Q,[g(p,{message:t.$resources.updateConfig.error},null,8,["message"]),(b=(k=t.$resources.configData)==null?void 0:k.data)!=null&&b.length?(u(!0),h(E,{key:0},j(t.$resources.configData.data,l=>(u(),h("div",{key:l.key,class:"mt-2 flex"},[g(r,{label:i.getStandardConfigTitle(l.key),modelValue:l.value,"onUpdate:modelValue":a=>l.value=a,onClick:a=>{l.type==="Password"&&(l.value=""),l.type==="Password"&&(n.isDirty=!0)},onInput:e[1]||(e[1]=a=>n.isDirty=!0),class:"flex-1"},null,8,["label","modelValue","onUpdate:modelValue","onClick"]),g(d,{class:"ml-2 mt-5",icon:"x",variant:"ghost",onClick:a=>i.removeConfig(l)},null,8,["onClick"])]))),128)):(u(),h("p",R," No keys added. Click on Add Key to add one. ")),g(d,{class:"mt-4",onClick:e[2]||(e[2]=l=>n.showAddConfigKeyDialog=!0)},{default:y(()=>e[13]||(e[13]=[w("Add Key")])),_:1})])]),f("div",W,[s.configName?(u(),h("div",Z,$(s.configName),1)):v("",!0),f("div",{innerHTML:i.configPreview},null,8,G)]),g(x,{options:{title:"Add Config Key",actions:[{label:"Add Key",variant:"solid",onClick:i.addConfig}]},modelValue:n.showAddConfigKeyDialog,"onUpdate:modelValue":e[10]||(e[10]=l=>n.showAddConfigKeyDialog=l)},{"body-content":y(()=>{var l;return[f("div",ee,[f("div",null,[e[14]||(e[14]=f("span",{class:"mb-1 block text-xs text-gray-600"},"Key",-1)),g(c,{placeholder:"Key",options:i.getStandardConfigKeys,modelValue:n.chosenStandardConfig,"onUpdate:modelValue":[e[3]||(e[3]=a=>n.chosenStandardConfig=a),i.handleAutocompleteSelection]},null,8,["options","modelValue","onUpdate:modelValue"])]),n.showCustomKeyInput?(u(),C(r,{key:0,modelValue:n.newConfig.key,"onUpdate:modelValue":e[4]||(e[4]=a=>n.newConfig.key=a),label:"Custom Key",class:"w-full",onChange:e[5]||(e[5]=a=>n.isDirty=!0)},null,8,["modelValue"])):v("",!0),g(r,{label:"Type",modelValue:n.newConfig.type,"onUpdate:modelValue":e[6]||(e[6]=a=>n.newConfig.type=a),type:"select",disabled:n.chosenStandardConfig&&!n.showCustomKeyInput,options:["String","Number","JSON","Boolean",((l=n.chosenStandardConfig)==null?void 0:l.value)!=="custom_key"?"Password":null],onChange:e[7]||(e[7]=a=>n.isDirty=!0)},null,8,["modelValue","disabled","options"]),g(r,q(i.configInputProps(),{modelValue:n.newConfig.value,"onUpdate:modelValue":e[8]||(e[8]=a=>n.newConfig.value=a),label:"Value",class:"w-full",onChange:e[9]||(e[9]=a=>n.isDirty=!0)}),null,16,["modelValue"])])]}),_:1},8,["options","modelValue"])])]}),_:1},8,["title"])}const ie=U(X,[["render",te]]);export{ie as _};
//# sourceMappingURL=ConfigEditor-C3fsLsY8.js.map
