{"version":3,"file":"MarketplaceAppPricing-_V3gpldP.js","sources":["../../../../dashboard/src/components/PrinterIcon.vue","../../../../dashboard/src/views/marketplace/MarketplaceAppPricing.vue"],"sourcesContent":["<template>\n\t<svg viewBox=\"0 0 80 80\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t<rect\n\t\t\tx=\"16\"\n\t\t\ty=\"5\"\n\t\t\twidth=\"48\"\n\t\t\theight=\"38\"\n\t\t\trx=\"4\"\n\t\t\tfill=\"white\"\n\t\t\tstroke=\"#98A1A9\"\n\t\t\tstroke-width=\"2\"\n\t\t/>\n\t\t<rect\n\t\t\tx=\"8\"\n\t\t\ty=\"13\"\n\t\t\twidth=\"64\"\n\t\t\theight=\"38\"\n\t\t\trx=\"4\"\n\t\t\tfill=\"white\"\n\t\t\tstroke=\"#98A1A9\"\n\t\t\tstroke-width=\"2\"\n\t\t/>\n\t\t<rect\n\t\t\tx=\"2\"\n\t\t\ty=\"21\"\n\t\t\twidth=\"76\"\n\t\t\theight=\"54\"\n\t\t\trx=\"4\"\n\t\t\tfill=\"white\"\n\t\t\tstroke=\"#98A1A9\"\n\t\t\tstroke-width=\"2\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M40 63C48.2843 63 55 56.2843 55 48C55 39.7157 48.2843 33 40 33C31.7157 33 25 39.7157 25 48C25 56.2843 31.7157 63 40 63Z\"\n\t\t\tstroke=\"#98A1A9\"\n\t\t\tstroke-width=\"2\"\n\t\t\tstroke-miterlimit=\"10\"\n\t\t\tstroke-linecap=\"square\"\n\t\t/>\n\t\t<path\n\t\t\td=\"M45.3466 44.0057H43.3295C43.2301 43.3807 43.0099 42.8196 42.6761 42.3366L44.8423 42.3438L45.3608 40.4545H35.9716L35.4176 42.6491H38.0881C39.4588 42.6491 40.2614 43.1605 40.5881 44.0057H35.929L35.4176 45.8665H40.6591C40.3608 46.8466 39.4872 47.4432 38.0881 47.4432H35.6307L35.6378 49.0199L40.6094 55H43.571V54.8722L39.0824 49.3679L39.1676 49.3395C41.7528 48.9986 43.017 47.7273 43.3224 45.8665H44.8423L45.3466 44.0057Z\"\n\t\t\tfill=\"#98A1A9\"\n\t\t/>\n\t</svg>\n</template>\n","<script setup>\nimport { ref, reactive } from 'vue';\nimport { createResource } from 'frappe-ui';\nimport AppPlanCard from '@/components/AppPlanCard.vue';\nimport PrinterIcon from '@/components/PrinterIcon.vue';\n\nconst showEditPlanDialog = ref(false);\nconst currentEditingPlan = reactive({\n\tprice_inr: 0,\n\tprice_usd: 0,\n\tfeatures: [''],\n\tplan_title: '',\n\tenabled: true\n});\n\nconst props = defineProps({\n\tapp: Object\n});\n\nconst appPlans = createResource({\n\turl: 'press.api.marketplace.get_app_plans',\n\tparams: {\n\t\tapp: props.app?.name,\n\t\tinclude_disabled: true\n\t},\n\tauto: true\n});\n\nconst updateAppPlan = createResource({\n\turl: 'press.api.marketplace.update_app_plan',\n\tonSuccess() {\n\t\trefreshState();\n\t}\n});\n\nconst createAppPlan = createResource({\n\turl: 'press.api.marketplace.create_app_plan',\n\tvalidate() {\n\t\tif (!currentEditingPlan.plan_title) {\n\t\t\treturn 'Plan name is required';\n\t\t}\n\t},\n\tonSuccess() {\n\t\trefreshState();\n\t}\n});\n\nfunction editPlan(plan) {\n\tif (plan) {\n\t\tObject.assign(currentEditingPlan, plan);\n\t\tcurrentEditingPlan.enabled = Boolean(plan.enabled);\n\t\tcurrentEditingPlan.features = Array.from(plan.features); // Non-reference copy\n\t}\n\tshowEditPlanDialog.value = true;\n}\n\nfunction addFeatureInput() {\n\tcurrentEditingPlan.features.push('');\n}\n\nfunction deleteFeatureInput(idx) {\n\tcurrentEditingPlan.features.splice(idx, 1);\n}\n\nfunction savePlan() {\n\tif (currentEditingPlan.name) {\n\t\tupdateAppPlan.submit({\n\t\t\tapp_plan_name: currentEditingPlan.name,\n\t\t\tupdated_plan_data: currentEditingPlan\n\t\t});\n\t} else {\n\t\tcreateAppPlan.submit({\n\t\t\tplan_data: currentEditingPlan,\n\t\t\tmarketplace_app: props.app?.name\n\t\t});\n\t}\n}\n\nfunction refreshState() {\n\tappPlans.fetch();\n\tshowEditPlanDialog.value = false;\n\tresetCurrentEditingPlan();\n}\n\nfunction resetCurrentEditingPlan() {\n\tObject.assign(currentEditingPlan, {\n\t\tprice_inr: 0,\n\t\tprice_usd: 0,\n\t\tfeatures: [''],\n\t\tplan_title: '',\n\t\tenabled: true\n\t});\n\n\tupdateAppPlan.error = null;\n\tcreateAppPlan.error = null;\n}\n</script>\n\n<template>\n\t<div>\n\t\t<Card title=\"Pricing Plans\" subtitle=\"Set up pricing plans for this app\">\n\t\t\t<div class=\"m-4\">\n\t\t\t\t<div class=\"flex justify-center\" v-if=\"appPlans.loading\">\n\t\t\t\t\t<Button :loading=\"true\">Loading</Button>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-else-if=\"appPlans.data\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"appPlans.data.length > 0\"\n\t\t\t\t\t\tclass=\"mx-auto grid grid-cols-1 gap-2 md:grid-cols-3\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<AppPlanCard\n\t\t\t\t\t\t\tv-for=\"plan in appPlans.data\"\n\t\t\t\t\t\t\t:plan=\"plan\"\n\t\t\t\t\t\t\t:key=\"plan.name\"\n\t\t\t\t\t\t\t:clickable=\"false\"\n\t\t\t\t\t\t\t:editable=\"true\"\n\t\t\t\t\t\t\t@beginEdit=\"editPlan(plan)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<div class=\"mt-7 flex flex-col items-center justify-center\">\n\t\t\t\t\t\t\t<PrinterIcon class=\"mb-5 h-20 w-20\" />\n\t\t\t\t\t\t\t<p class=\"mb-1 text-2xl font-semibold text-gray-900\">\n\t\t\t\t\t\t\t\tCreate a plan\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p class=\"mb-3.5 text-base text-gray-700\">\n\t\t\t\t\t\t\t\tLooks like you haven't created any plans yet\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<Button variant=\"solid\" @click=\"editPlan()\">Create plan</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<template v-if=\"appPlans.data && 0 < appPlans.data.length\" #actions>\n\t\t\t\t<Button @click=\"editPlan()\">New Plan</Button>\n\t\t\t</template>\n\t\t</Card>\n\n\t\t<Dialog :options=\"{ title: 'Edit Plan' }\" v-model=\"showEditPlanDialog\">\n\t\t\t<template v-slot:body-content>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"mb-4\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tid=\"enabled-checkbox\"\n\t\t\t\t\t\t\tclass=\"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n\t\t\t\t\t\t\tv-model=\"currentEditingPlan.enabled\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label for=\"enabled-checkbox\" class=\"ml-1 text-sm text-gray-900\">\n\t\t\t\t\t\t\tEnabled\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"mb-4\">\n\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\tplaceholder=\"My Pro Plan\"\n\t\t\t\t\t\t\tlabel=\"Name\"\n\t\t\t\t\t\t\tv-model=\"currentEditingPlan.plan_title\"\n\t\t\t\t\t\t></FormControl>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"mb-8\">\n\t\t\t\t\t\t<h3 class=\"mb-4 text-lg font-semibold\">Subscription Price</h3>\n\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\tlabel=\"Price INR\"\n\t\t\t\t\t\t\t\tv-model=\"currentEditingPlan.price_inr\"\n\t\t\t\t\t\t\t></FormControl>\n\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\tlabel=\"Price USD\"\n\t\t\t\t\t\t\t\tv-model=\"currentEditingPlan.price_usd\"\n\t\t\t\t\t\t\t></FormControl>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class=\"mb-4 text-lg font-semibold\">Features</h3>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-for=\"(feature, idx) in currentEditingPlan.features\"\n\t\t\t\t\t\t\t\tclass=\"mb-3.5 flex w-full items-stretch\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mr-3 flex h-6 w-6 items-center justify-center rounded-full bg-gray-100 text-xs\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ idx + 1 }}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t\t\t\t\t\tv-model=\"currentEditingPlan.features[idx]\"\n\t\t\t\t\t\t\t\t\t></FormControl>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tv-if=\"idx > 0\"\n\t\t\t\t\t\t\t\t\tclass=\"ml-3 rounded-full\"\n\t\t\t\t\t\t\t\t\ticon=\"x\"\n\t\t\t\t\t\t\t\t\t@click=\"deleteFeatureInput(idx)\"\n\t\t\t\t\t\t\t\t></Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Button icon-left=\"plus\" @click=\"addFeatureInput\">Add</Button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<ErrorMessage class=\"mt-3\" :message=\"updateAppPlan.error\" />\n\t\t\t\t\t\t\t<ErrorMessage class=\"mt-3\" :message=\"createAppPlan.error\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\n\t\t\t<template #actions>\n\t\t\t\t<Button\n\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t:loading=\"updateAppPlan.loading || createAppPlan.loading\"\n\t\t\t\t\t@click=\"savePlan\"\n\t\t\t\t\t@close=\"resetCurrentEditingPlan\"\n\t\t\t\t\t>Save</Button\n\t\t\t\t>\n\t\t\t</template>\n\t\t</Dialog>\n\t</div>\n</template>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","showEditPlanDialog","ref","currentEditingPlan","reactive","props","__props","appPlans","createResource","_a","updateAppPlan","refreshState","createAppPlan","editPlan","plan","addFeatureInput","deleteFeatureInput","idx","savePlan","resetCurrentEditingPlan"],"mappings":"k+BACMA,EAAA,CAAoB,QAAA,YAAY,KAAA,2CAArC,SAAAC,EAAAC,EAAAC,EAAA,CADD,OAAAC,EAAA,EAAAC,EAAA,MAAAL,EAAAG,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,kgDCMA,MAAAG,EAAAC,EAAA,EAAA,EACAC,EAAAC,EAAA,CACA,UAAA,EACA,UAAA,EACA,SAAA,CAAA,EAAA,EACA,WAAA,GACA,QAAA,EACA,CAAA,EAEAC,EAAAC,EAIAC,EAAAC,EAAA,CACA,IAAA,sCACA,OAAA,CACA,KAAAC,EAAAJ,EAAA,MAAA,YAAAI,EAAA,KACA,iBAAA,EACA,EACA,KAAA,EACA,CAAA,EAEAC,EAAAF,EAAA,CACA,IAAA,wCACA,WAAA,CACAG,EAAA,CACA,CACA,CAAA,EAEAC,EAAAJ,EAAA,CACA,IAAA,wCACA,UAAA,CACA,GAAA,CAAAL,EAAA,WACA,MAAA,uBAEA,EACA,WAAA,CACAQ,EAAA,CACA,CACA,CAAA,EAEA,SAAAE,EAAAC,EAAA,CACAA,IACA,OAAA,OAAAX,EAAAW,CAAA,EACAX,EAAA,QAAA,EAAAW,EAAA,QACAX,EAAA,SAAA,MAAA,KAAAW,EAAA,QAAA,GAEAb,EAAA,MAAA,EACA,CAEA,SAAAc,GAAA,CACAZ,EAAA,SAAA,KAAA,EAAA,CACA,CAEA,SAAAa,EAAAC,EAAA,CACAd,EAAA,SAAA,OAAAc,EAAA,CAAA,CACA,CAEA,SAAAC,GAAA,OACAf,EAAA,KACAO,EAAA,OAAA,CACA,cAAAP,EAAA,KACA,kBAAAA,CACA,CAAA,EAEAS,EAAA,OAAA,CACA,UAAAT,EACA,iBAAAM,EAAAJ,EAAA,MAAA,YAAAI,EAAA,IACA,CAAA,CAEA,CAEA,SAAAE,GAAA,CACAJ,EAAA,MAAA,EACAN,EAAA,MAAA,GACAkB,EAAA,CACA,CAEA,SAAAA,GAAA,CACA,OAAA,OAAAhB,EAAA,CACA,UAAA,EACA,UAAA,EACA,SAAA,CAAA,EAAA,EACA,WAAA,GACA,QAAA,EACA,CAAA,EAEAO,EAAA,MAAA,KACAE,EAAA,MAAA,IACA"}