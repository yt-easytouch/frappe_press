var I=(t,e,n)=>new Promise((v,s)=>{var i=a=>{try{d(n.next(a))}catch(f){s(f)}},p=a=>{try{d(n.throw(a))}catch(f){s(f)}},d=a=>a.done?v(a.value):Promise.resolve(a.value).then(i,p);d((n=n.apply(t,e)).next())});import{_ as D}from"./WizardCard-D6pRuZbe.js";import{_ as B}from"./Steps-B0ktOnsZ.js";import{x as _,q as P,o as u,j as r,A as l,a8 as H,a9 as E,Y as m,r as k,h as y,u as S,w as c,ag as C,ah as x,X as N,t as j,n as K}from"./main-Dpl-JOF2.js";import{_ as V}from"./ClickToCopyField-DpU9Eau5.js";import{_ as T}from"./ServerPlansTable-BTTk3ODU.js";import{_ as F}from"./AlertBillingInformation-C5f9OKMF.js";import"./info-BXlf1Uhm.js";import"./Alert-COV4XS8q.js";import"./StripeLogo-BRF2qIyd.js";import"./stripe.esm-D4yu_pm0.js";import"./BillingInformationDialog-B5pmLI5R.js";import"./StripeCard-BRr8QCrN.js";import"./AddressForm-Cz0XUJgF.js";import"./Form-CIPLpg2e.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="27cc7576-ecdd-432a-978d-b876c0910b21",t._sentryDebugIdIdentifier="sentry-dbid-27cc7576-ecdd-432a-978d-b876c0910b21")}catch(n){}})();{var h=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};h._sentryModuleMetadata=h._sentryModuleMetadata||{},h._sentryModuleMetadata[new Error().stack]=Object.assign({},h._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const W={name:"SelfHostedHostname",props:["title"],emits:["update:title","error"],data(){return{errorMessage:null}},methods:{titleChange(t){return I(this,null,function*(){let e=t.target.value;this.$emit("update:title",e);let n=this.validateTitle(e);this.errorMessage=n,this.$emit("error",n)})},validateTitle(t){return t?null:"Server name cannot be left blank"}}},q={class:"space-y-2"};function X(t,e,n,v,s,i){const p=H,d=E;return u(),P("div",null,[e[0]||(e[0]=r("label",{class:"text-lg font-semibold"}," Choose a name for your Self Hosted server ",-1)),e[1]||(e[1]=r("p",{class:"my-3 text-base text-gray-700"}," Name your server based on its purpose ",-1)),r("div",q,[l(p,{class:"z-10 w-full rounded-r-none",value:n.title,onChange:i.titleChange,placeholder:"AcmeCorp Production Server"},null,8,["value","onChange"])]),l(d,{class:"mt-4",message:s.errorMessage},null,8,["message"])])}const Y=_(W,[["render",X]]),J={name:"SelfHostedServerForm",props:["appPublicIP","appPrivateIP","dbPublicIP","dbPrivateIP","error"],emits:["update:appPublicIP","update:appPrivateIP","update:dbPublicIP","update:dbPrivateIP","update:error"],watch:{hasError(){this.$emit("update:error",this.hasError)}},mounted(){this.$emit("update:error",this.hasError)},computed:{publicIpErrorMessage(){return this.validateIP(this.appPublicIP,"Public")},dbPublicIpErrorMessage(){return this.validateIP(this.dbPublicIP,"DB Public")},privateIpErrorMessage(){return this.validateIP(this.appPrivateIP,"Private")},dbPrivateIpErrorMessage(){return this.validateIP(this.dbPrivateIP,"DB Private")},hasError(){return this.publicIpErrorMessage!==null||this.privateIpErrorMessage!==null||this.dbPublicIpErrorMessage!==null||this.dbPrivateIpErrorMessage!==null}},methods:{validateIP(t,e){try{const n=t.replace(/\s+/g,"");return/^([0-9]{1,3}\.){3}[0-9]{1,3}$/.test(n)?null:`${e} IP is invalid`}catch(n){return`${e} IP cannot be blank`}}}},L={class:"mb-3"},Q={class:"mt-6 flex flex-col gap-4"},Z={class:"mt-6 flex flex-col gap-4"};function G(t,e,n,v,s,i){const p=H,d=E;return u(),P("div",null,[r("div",L,[r("div",null,[e[8]||(e[8]=r("h2",{class:"space-y-1 mt-6 text-lg font-semibold"}," Enter the Application Server Details ",-1)),r("div",Q,[e[4]||(e[4]=r("p",{class:"text-black-900 text-base"},"Public IP of the Server",-1)),l(p,{class:"z-10 w-full rounded-r-none",value:n.appPublicIP,onChange:e[0]||(e[0]=a=>t.$emit("update:appPublicIP",a.target.value))},null,8,["value"]),l(d,{class:"text-sm",message:i.publicIpErrorMessage},null,8,["message"]),e[5]||(e[5]=r("p",{class:"text-black-900 text-base"},"Private IP of the Server",-1)),l(p,{class:"z-10 w-full rounded-r-none",value:n.appPrivateIP,onChange:e[1]||(e[1]=a=>t.$emit("update:appPrivateIP",a.target.value))},null,8,["value"]),l(d,{class:"text-sm",message:i.privateIpErrorMessage},null,8,["message"])]),e[9]||(e[9]=r("h2",{class:"space-y-1 mt-8 text-lg font-semibold"}," Enter the DB Server Details ",-1)),r("div",Z,[e[6]||(e[6]=r("p",{class:"text-black-900 text-base"},"Public IP of the DB Server",-1)),l(p,{class:"z-10 w-full rounded-r-none",value:n.dbPublicIP,onChange:e[2]||(e[2]=a=>t.$emit("update:dbPublicIP",a.target.value))},null,8,["value"]),l(d,{class:"text-sm",message:i.dbPublicIpErrorMessage},null,8,["message"]),e[7]||(e[7]=r("p",{class:"text-black-900 text-base"},"Private IP of the DB Server",-1)),l(p,{class:"z-10 w-full rounded-r-none",value:n.dbPrivateIP,onChange:e[3]||(e[3]=a=>t.$emit("update:dbPrivateIP",a.target.value))},null,8,["value"]),l(d,{class:"text-sm",message:i.dbPrivateIpErrorMessage},null,8,["message"])])])])])}const ee=_(J,[["render",G]]),te={name:"SelfHostedServerVerify",props:["ssh_key"],components:{ClickToCopyField:V}};function se(t,e,n,v,s,i){const p=V;return u(),P("div",null,[e[0]||(e[0]=r("div",{class:"my-2"},[r("span",{class:"text-base"},[m(" Add this SSH Key to "),r("span",{class:"font-mono text-blue-500"},"~/.ssh/authorized_keys"),m(" file of the Server you are adding")])],-1)),l(p,{textContent:n.ssh_key},null,8,["textContent"]),e[1]||(e[1]=r("div",{class:"my-2 grid place-items-center"},null,-1))])}const re=_(te,[["render",se]]),ne={name:"SelfHostedServerPlan",emits:["update:selectedPlan"],props:["options","selectedPlan"],components:{ServerPlansTable:T,AlertBillingInformation:F},computed:{planOptions(){return this.options}}},le={class:"mt-4"};function oe(t,e,n,v,s,i){const p=F,d=T;return u(),P("div",null,[e[1]||(e[1]=r("label",{class:"text-lg font-semibold"},[m(" Select plan for application and database self-hosted server "),r("br"),r("span",{class:"text-sm text-gray-500"}," For server management and support ")],-1)),l(p,{class:"mt-4"}),r("div",le,[l(d,{plans:i.planOptions,selectedPlan:n.selectedPlan,"onUpdate:selectedPlan":e[0]||(e[0]=a=>t.$emit("update:selectedPlan",a))},null,8,["plans","selectedPlan"])])])}const ae=_(ne,[["render",oe]]),ie={name:"NewSelfHostedServer",components:{WizardCard:D,Steps:B,SelfHostedHostname:Y,SelfHostedServerPlan:ae,SelfHostedServerForm:ee,SelfHostedServerVerify:re},data(){return{title:null,options:null,appPublicIP:null,appPrivateIP:null,dbPublicIP:null,dbPrivateIP:null,validationMessage:null,serverDoc:null,ssh_key:null,selectedPlan:null,dnsErrorMessage:null,ipInvalid:!1,unreachable:!1,playOutput:!1,agreedToRegionConsent:!1,steps:[{name:"SelfHostedHostname",validate:()=>this.title},{name:"SelfHostedServerPlan",validate:()=>this.selectedPlan},{name:"ServerDetails",validate:()=>this.appPublicIP},{name:"VerifyServer",validate:()=>this.playOutput}]}},mounted(){return I(this,null,function*(){const t=yield this.$call("press.api.selfhosted.get_plans");this.options=t.map(e=>(e.disabled=!this.$account.hasBillingInfo,e.vcpu="Any",e)),this.ssh_key=yield this.$call("press.api.selfhosted.sshkey")})},resources:{newServer(){return{url:"press.api.selfhosted.new",params:{server:{title:this.title,app_public_ip:this.appPublicIP,app_private_ip:this.appPrivateIP,db_public_ip:this.dbPublicIP,db_private_ip:this.dbPrivateIP,plan:this.selectedPlan}},onSuccess(t){this.serverDoc=t}}},verify(){return{url:"press.api.selfhosted.verify",params:{server:this.serverDoc},onSuccess(t){this.playOutput=t}}},setupServer(){return{url:"press.api.selfhosted.setup",params:{server:this.serverDoc},validate(){let t=this.title;if(!this.agreedToRegionConsent)return"Please agree to the above consent to create server";if(!t)return"Cannot create server"}}}},computed:{},methods:{nextStep(t,e){return I(this,null,function*(){t.name==="ServerDetails"&&!this.ipInvalid&&this.$resources.newServer.submit(),e()})},setupServers(){return I(this,null,function*(){yield this.$resources.setupServer.submit(),this.agreedToRegionConsent&&this.$router.replace("/servers/")})}}},pe={class:"mt-4"},de={key:0,class:"mt-4"},ue={class:"mt-4"},me={key:0,class:"my-6"},ve={class:"flex justify-between"};function ce(t,e,n,v,s,i){const p=k("SelfHostedHostname"),d=k("SelfHostedServerPlan"),a=k("SelfHostedServerForm"),f=k("SelfHostedServerVerify"),b=N,$=E,O=H,U=B,A=D;return s.options?(u(),y(A,{key:0},{default:c(()=>[e[16]||(e[16]=r("div",{class:"mb-6 text-center"},[r("h1",{class:"text-2xl font-bold"},"Create a new Self Hosted Server")],-1)),l(U,{steps:s.steps},{default:c(({active:g,next:z,previous:R,hasPrevious:M,hasNext:w})=>[e[15]||(e[15]=r("div",{class:"mt-8"},null,-1)),C(l(p,{title:s.title,"onUpdate:title":e[0]||(e[0]=o=>s.title=o)},null,8,["title"]),[[x,g.name==="SelfHostedHostname"]]),r("div",pe,[C(l(d,{selectedPlan:s.selectedPlan,"onUpdate:selectedPlan":e[1]||(e[1]=o=>s.selectedPlan=o),options:s.options},null,8,["selectedPlan","options"]),[[x,g.name==="SelfHostedServerPlan"]])]),r("div",null,[C(l(a,{appPublicIP:s.appPublicIP,"onUpdate:appPublicIP":e[2]||(e[2]=o=>s.appPublicIP=o),appPrivateIP:s.appPrivateIP,"onUpdate:appPrivateIP":e[3]||(e[3]=o=>s.appPrivateIP=o),dbPublicIP:s.dbPublicIP,"onUpdate:dbPublicIP":e[4]||(e[4]=o=>s.dbPublicIP=o),dbPrivateIP:s.dbPrivateIP,"onUpdate:dbPrivateIP":e[5]||(e[5]=o=>s.dbPrivateIP=o),error:s.ipInvalid,"onUpdate:error":e[6]||(e[6]=o=>s.ipInvalid=o)},null,8,["appPublicIP","appPrivateIP","dbPublicIP","dbPrivateIP","error"]),[[x,g.name==="ServerDetails"]])]),g.name==="VerifyServer"?(u(),P("div",de,[l(f,{ssh_key:s.ssh_key,"onUpdate:ssh_key":e[7]||(e[7]=o=>s.ssh_key=o)},null,8,["ssh_key"]),t.$resources.verify.data===null?(u(),y(b,{key:0,onClick:e[8]||(e[8]=o=>t.$resources.verify.submit()),loading:t.$resources.verify.loading,variant:"solid"},{default:c(()=>e[11]||(e[11]=[m(" Verify Server ")])),_:1},8,["loading"])):(u(),y(b,{key:1,"icon-left":s.playOutput?"check":"x",variant:"solid",theme:s.playOutput?"gray":"red",appearance:s.playOutput?"success":"warning",onClick:e[9]||(e[9]=o=>t.$resources.verify.submit())},{default:c(()=>[m(j(s.playOutput?"Server Verified":"Server Unreachable"),1)]),_:1},8,["icon-left","theme","appearance"]))])):S("",!0),l($,{class:"mt-2",message:t.$resources.verify.error},null,8,["message"]),r("div",ue,[w?S("",!0):(u(),P("div",me,[l(O,{id:"region-consent",type:"checkbox",label:`I agree that the laws of the region selected by me shall stand
							applicable to me and Frappe.`,class:"rounded border-gray-300 focus:ring-blue-500",modelValue:s.agreedToRegionConsent,"onUpdate:modelValue":e[10]||(e[10]=o=>s.agreedToRegionConsent=o)},null,8,["modelValue"])])),l($,{class:"mb-4",message:t.$resources.newServer.error},null,8,["message"]),r("div",ve,[M?(u(),y(b,{key:0,onClick:R},{default:c(()=>e[12]||(e[12]=[m(" Back ")])),_:2},1032,["onClick"])):S("",!0),w?(u(),y(b,{key:1,class:K(["ml-auto",{"mt-2":M}]),variant:"solid",onClick:o=>i.nextStep(g,z)},{default:c(()=>e[13]||(e[13]=[m(" Next ")])),_:2},1032,["onClick","class"])):S("",!0),C(l(b,{class:"ml-auto",variant:"solid",disabled:!s.playOutput||!this.agreedToRegionConsent,onClick:i.setupServers,loading:t.$resources.setupServer.loading},{default:c(()=>e[14]||(e[14]=[m(" Setup Server ")])),_:2},1032,["disabled","onClick","loading"]),[[x,!w]])])])]),_:1},8,["steps"])]),_:1})):S("",!0)}const $e=_(ie,[["render",ce]]);export{$e as default};
//# sourceMappingURL=NewSelfHostedServer-Bh1cALgY.js.map
