var oe=Object.defineProperty,le=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var R=(t,e,s)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,E=(t,e)=>{for(var s in e||(e={}))ie.call(e,s)&&R(t,s,e[s]);if(O)for(var s of O(e))re.call(e,s)&&R(t,s,e[s]);return t},N=(t,e)=>le(t,ae(e));var M=(t,e,s)=>new Promise((m,o)=>{var n=a=>{try{i(s.next(a))}catch(p){o(p)}},r=a=>{try{i(s.throw(a))}catch(p){o(p)}},i=a=>a.done?m(a.value):Promise.resolve(a.value).then(n,r);i((s=s.apply(t,e)).next())});import{_ as H}from"./Tabs-d4e9i9wh.js";import{_ as q}from"./Alert-COV4XS8q.js";import{x as k,q as h,o as l,j as _,u as b,a7 as S,t as D,A as u,h as c,a8 as F,n as J,F as B,v as U,a5 as j,B as pe,w as d,X as C,Y as g,aA as x,a9 as V,y as ce,r as P,C as de,k as ue}from"./main-Dpl-JOF2.js";import{_ as K}from"./CommitChooser-R9zPknj3.js";import{_ as X}from"./CommitTag-C7m6nG0N.js";import{_ as he}from"./ListItem-CkkFcC1t.js";import{n as $}from"./toast-Dk0nDfLL.js";import{_ as me}from"./Breadcrumbs-yx7M4N4X.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="3a439c72-cdf9-40e1-b8ec-170227b72b71",t._sentryDebugIdIdentifier="sentry-dbid-3a439c72-cdf9-40e1-b8ec-170227b72b71")}catch(s){}})();{var T=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};T._sentryModuleMetadata=T._sentryModuleMetadata||{},T._sentryModuleMetadata[new Error().stack]=Object.assign({},T._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const _e={name:"SiteUpdateCard",props:["site","selectable","selected","selectedSites"],methods:{toggleProperty(t,e,s){this.selectedSites.map(m=>{s==m.name&&(m[e]=t.target.checked)}),this.$emit("update:selectedSites",this.selectedSites)}}},fe={class:"flex flex-col"},be=["checked"],ye={class:"group-select text-lg font-medium text-gray-900"},ge={key:0,class:"mt-2 flex flex-row"};function we(t,e,s,m,o,n){var i;const r=F;return l(),h("button",{class:J(["flex w-full flex-row items-center justify-between rounded-lg border border-gray-100 px-4 py-2 shadow focus:outline-none",[s.selected?"ring-2 ring-inset ring-gray-600":"",s.selectable?"hover:border-gray-300":"cursor-default"]]),ref:"card"},[_("div",fe,[_("div",{onClick:e[1]||(e[1]=S(a=>t.$refs.card.click(),["self"])),class:"flex flex-row items-center gap-2"},[s.selectable?(l(),h("input",{key:0,onClick:e[0]||(e[0]=S(a=>t.$refs.card.click(),["self"])),checked:s.selected,type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-gray-600 focus:ring-transparent"},null,8,be)):b("",!0),_("h3",ye,D(s.site),1)]),s.selected?(l(),h("div",ge,[u(r,{onChange:e[2]||(e[2]=a=>n.toggleProperty(a,"skip_failing_patches",s.site)),type:"checkbox",label:"Skip failing patches",class:"h-4 rounded border-gray-300 text-gray-600 focus:ring-transparent"}),(i=t.$account.team)!=null&&i.skip_backups?(l(),c(r,{key:0,onChange:e[3]||(e[3]=a=>n.toggleProperty(a,"skip_backups",s.site)),type:"checkbox",label:"Skip backup",class:"ml-2 h-4 rounded border-gray-300 text-gray-600 focus:ring-transparent"})):b("",!0)])):b("",!0)])],2)}const Q=k(_e,[["render",we]]),ke={name:"BenchSiteUpdates",props:["sites"],components:{SiteUpdateCard:Q},data(){return{selectedSites:[]}},mounted(){this.$emit("update:selectedSites",[])},methods:{toggleSite(t){this.selectedSites.includes(t)?(this.selectedSites=this.selectedSites.filter(e=>e!==t),this.$emit("update:selectedSites",this.selectedSites)):(this.selectedSites.push(t),this.$emit("update:selectedSites",this.selectedSites))}}},ve={class:"mt-2 space-y-2 divide-y max-h-96 overflow-auto"};function Ae(t,e,s,m,o,n){const r=Q;return l(),h("div",ve,[(l(!0),h(B,null,U(s.sites,i=>(l(),c(r,{key:i.name,onClick:S(a=>n.toggleSite(i),["self"]),site:i.name,selected:o.selectedSites.map(a=>a.name).includes(i.name),selectable:!0,selectedSites:o.selectedSites,"onUpdate:selectedSites":e[0]||(e[0]=a=>o.selectedSites=a)},null,8,["onClick","site","selected","selectedSites"]))),128))])}const Z=k(ke,[["render",Ae]]),Se={name:"AppUpdateCard",props:["app","selectable","selected","uninstall"],data(){return{deployTo:{label:this.initialDeployTo(),value:this.app.next_release}}},watch:{deployTo(t){this.app.next_release=t.value,this.$emit("update:app",this.app)}},computed:{deployFrom(){return this.app.will_branch_change?this.app.current_branch:this.app.current_hash?this.app.current_tag||this.app.current_hash.slice(0,7):null},autocompleteOptions(){return this.app.releases.map(t=>{let s=t.message.split(`
`)[0];return s=s.length>75?s.slice(0,75)+"...":s,{label:t.tag?t.tag:`${s} (${t.hash.slice(0,7)})`,value:t.name}})}},methods:{initialDeployTo(){if(this.uninstall)return"";let t=this.app.releases.filter(e=>e.name===this.app.next_release)[0];return this.app.will_branch_change?this.app.branch:t.tag||t.hash.slice(0,7)},getHash(t){return this.app.releases.find(e=>e.name===t).hash}},components:{CommitTag:X,CommitChooser:K}},De={class:"flex flex-row items-center gap-2"},$e=["checked"],xe={class:"text-left text-lg font-medium text-gray-900"},Te={key:1,class:"ml-2 flex flex-row items-center space-x-2"},Be=["href"];function Ue(t,e,s,m,o,n){const r=j,i=X,a=pe,p=K;return l(),h("button",{class:J(["flex w-full flex-row items-center justify-between rounded-lg border border-gray-100 px-4 py-2 shadow focus:outline-none",[s.selected||s.uninstall?"ring-2 ring-inset ring-gray-600":"",s.selectable?"hover:border-gray-300":"cursor-default"]]),ref:"card"},[_("div",De,[s.selectable?(l(),h("input",{key:0,onClick:e[0]||(e[0]=S(f=>t.$refs.card.click(),["self"])),checked:s.selected,type:"checkbox",class:"h-4 w-4 cursor-pointer rounded border-gray-300 text-gray-600 focus:ring-transparent"},null,8,$e)):b("",!0),_("h3",xe,D(s.app.title),1)]),s.uninstall?(l(),c(r,{key:0,class:"my-1",theme:"red",label:"Will Be Uninstalled "})):(l(),h("div",Te,[n.deployFrom?(l(),c(i,{key:0,tag:n.deployFrom,link:`${s.app.repository_url}/commit/${s.app.current_hash}`},null,8,["tag","link"])):b("",!0),n.deployFrom?(l(),h("a",{key:1,class:"flex cursor-pointer flex-col justify-center",href:`${s.app.repository_url}/compare/${s.app.current_hash}...${n.getHash(o.deployTo.value)}`,target:"_blank"},[u(a,{name:"arrow-right",class:"w-4"})],8,Be)):(l(),c(r,{key:2,label:"First Deploy",theme:"green",class:"whitespace-nowrap"})),u(p,{options:n.autocompleteOptions,modelValue:o.deployTo,"onUpdate:modelValue":e[1]||(e[1]=f=>o.deployTo=f)},null,8,["options","modelValue"])]))],2)}const G=k(Se,[["render",Ue]]),Ce={name:"BenchAppUpdates",props:["apps","removedApps"],components:{AppUpdateCard:G},data(){return{selectedApps:[]}},mounted(){this.selectedApps=this.appsWithUpdates.map(t=>({app:t.app,release:t.next_release})),this.$emit("update:selectedApps",this.selectedApps)},methods:{toggleApp(t){this.selectedApps.map(e=>e.app).includes(t.app)?(this.selectedApps=this.selectedApps.filter(e=>e.app!==t.app),this.$emit("update:selectedApps",this.selectedApps)):(this.selectedApps.push({app:t.app,release:t.next_release}),this.$emit("update:selectedApps",this.selectedApps))}},computed:{appsWithUpdates(){return this.apps.filter(t=>t.update_available)}},watch:{appsWithUpdates:{handler(t){t.map(e=>{this.selectedApps.filter(s=>s.app==e.app).map(s=>s.release=e.next_release)})},deep:!0,immediate:!0},removedApps:{handler(t){t.map(e=>{this.selectedApps.filter(s=>s.app==e.app).map(s=>s.release=e.next_release)})},deep:!0,immediate:!0},selectedApps:{handler(t){let e=this.apps.filter(m=>m.app=="frappe"),s=e.length==1&&e[0].update_available;t.map(m=>m.app).includes("erpnext")&&!t.map(m=>m.app).includes("frappe")&&s&&t.push({app:"frappe",release:e[0].next_release})},deep:!0,immediate:!0}}},Ve={class:"mt-2 space-y-2 divide-y"};function Ie(t,e,s,m,o,n){const r=G;return l(),h("div",Ve,[(l(!0),h(B,null,U(n.appsWithUpdates,(i,a)=>(l(),c(r,{key:i.app,onClick:S(p=>n.toggleApp(i),["self"]),app:n.appsWithUpdates[a],"onUpdate:app":p=>n.appsWithUpdates[a]=p,selected:o.selectedApps.map(p=>p.app).includes(i.app),uninstall:!1,selectable:!0},null,8,["onClick","app","onUpdate:app","selected"]))),128)),(l(!0),h(B,null,U(s.removedApps,(i,a)=>(l(),c(r,{key:i.name,onClick:S(p=>n.toggleApp(i),["self"]),app:s.removedApps[a],"onUpdate:app":p=>s.removedApps[a]=p,selected:o.selectedApps.map(p=>p.app).includes(i.app),uninstall:!0},null,8,["onClick","app","onUpdate:app","selected"]))),128))])}const I=k(Ce,[["render",Ie]]),Ee={name:"SwitchTeamDialog"},Ne={class:"text-xs text-gray-600"},Me={class:"border-t my-2"},Pe={key:0},Fe={key:1,class:"flex flex-row justify-end"};function je(t,e,s,m,o,n){const r=j,i=C,a=he,p=x;return l(),c(p,{options:{title:"Switch Team"}},{"body-content":d(()=>[_("span",Ne,"Current Team: "+D(t.$account.team.name),1),_("div",Me,[(l(!0),h(B,null,U(t.$account.teams,f=>(l(),c(a,{title:`${f.team_title}`,description:f.user,key:f},{actions:d(()=>[t.$account.team.name===f.name?(l(),h("div",Pe,[u(r,{label:"Active",theme:"blue"})])):(l(),h("div",Fe,[u(i,{onClick:A=>t.$account.switchToTeam(f.name)},{default:d(()=>e[0]||(e[0]=[g(" Switch ")])),_:2},1032,["onClick"])]))]),_:2},1032,["title","description"]))),128))])]),_:1})}const W=k(Ee,[["render",je]]),We={name:"AlertBenchUpdate",props:["bench"],components:{BenchAppUpdates:I,BenchSiteUpdates:Z,SwitchTeamDialog:W},data(){return{showDeployDialog:!1,showTeamSwitcher:!1,selectedApps:[],selectedSites:[],step:"Apps"}},resources:{deployInformation(){var t;return{url:"press.api.bench.deploy_information",params:{name:(t=this.bench)==null?void 0:t.name},auto:!0}},deploy(){var t;return{url:"press.api.bench.deploy_and_update",params:{name:(t=this.bench)==null?void 0:t.name,apps:this.selectedApps,sites:this.selectedSites},validate(){if(this.selectedApps.length===0&&this.deployInformation.removed_apps.length===0)return"You must select atleast 1 app to proceed with update."},onSuccess(e){this.showDeployDialog=!1,this.$resources.deployInformation.setData(N(E({},this.$resources.deployInformation.data),{deploy_in_progress:!0,last_deploy:{name:e,status:"Running"}})),$({title:"Updates scheduled successfully",icon:"check",color:"green"})}}}},computed:{show(){if(this.deployInformation)return this.deployInformation.update_available&&["Awaiting Deploy","Active"].includes(this.bench.status)},errorMessage(){return this.$resources.deploy.error||(this.bench.team!==$account.team.name?"Current Team doesn't have enough permissions":"")},deployInformation(){return this.$resources.deployInformation.data},alertTitle(){return this.deployInformation&&this.deployInformation.deploy_in_progress?"Deploy in Progress":this.bench.status=="Active"?"Update Available":"Deploy"}}},Le={key:0},Ye={key:1},ze={key:2};function Oe(t,e,s,m,o,n){const r=C,i=I,a=Z,p=V,f=x,A=q;return n.show?(l(),c(A,{key:0,title:n.alertTitle},{actions:d(()=>[n.deployInformation.deploy_in_progress?(l(),c(r,{key:0,variant:"solid",route:`/groups/${s.bench.name}/deploys/${n.deployInformation.last_deploy.name}`},{default:d(()=>e[7]||(e[7]=[g("View Progress")])),_:1},8,["route"])):(l(),c(r,{key:1,variant:"solid",onClick:e[0]||(e[0]=()=>{o.showDeployDialog=!0,o.step="Apps"})},{default:d(()=>e[8]||(e[8]=[g(" Show Updates ")])),_:1}))]),default:d(()=>[n.deployInformation.deploy_in_progress?(l(),h("span",Le,"A deploy for this bench is in progress")):s.bench.status=="Active"?(l(),h("span",Ye," A new update is available for your bench. Would you like to deploy the update now? ")):(l(),h("span",ze," Your bench is not deployed yet. You can add more apps to your bench before deploying. If you want to deploy now, click on the Show Updates button. ")),u(f,{options:{title:o.step=="Apps"?"Select the apps you want to update":"Select the sites you want to update"},modelValue:o.showDeployDialog,"onUpdate:modelValue":e[6]||(e[6]=y=>o.showDeployDialog=y)},{"body-content":d(()=>[o.step=="Apps"?(l(),c(i,{key:0,apps:n.deployInformation.apps,selectedApps:o.selectedApps,"onUpdate:selectedApps":e[1]||(e[1]=y=>o.selectedApps=y),removedApps:n.deployInformation.removed_apps},null,8,["apps","selectedApps","removedApps"])):b("",!0),o.step=="Sites"?(l(),c(a,{key:1,class:"p-1",sites:n.deployInformation.sites,selectedSites:o.selectedSites,"onUpdate:selectedSites":e[2]||(e[2]=y=>o.selectedSites=y)},null,8,["sites","selectedSites"])):b("",!0),u(p,{class:"mt-2",message:n.errorMessage},null,8,["message"])]),actions:d(()=>[o.step=="Sites"?(l(),c(r,{key:0,class:"w-full",onClick:e[3]||(e[3]=y=>o.step="Apps")},{default:d(()=>e[9]||(e[9]=[g(" Back ")])),_:1})):b("",!0),o.step=="Sites"?(l(),c(r,{key:1,variant:"solid",class:"mt-2 w-full",onClick:e[4]||(e[4]=y=>t.$resources.deploy.submit()),loading:t.$resources.deploy.loading},{default:d(()=>[g(D(o.selectedSites.length>0?"Update":"Skip and Deploy"),1)]),_:1},8,["loading"])):(l(),c(r,{key:2,variant:"solid",class:"w-full",onClick:e[5]||(e[5]=y=>o.step="Sites")},{default:d(()=>e[10]||(e[10]=[g(" Next ")])),_:1}))]),_:1},8,["options","modelValue"])]),_:1},8,["title"])):b("",!0)}const ee=k(We,[["render",Oe]]),Re={name:"AlertBenchUpdate",props:["bench"],components:{BenchAppUpdates:I,SwitchTeamDialog:W},data(){return{showDeployDialog:!1,showTeamSwitcher:!1,selectedApps:[]}},resources:{deployInformation(){var t;return{url:"press.api.bench.deploy_information",params:{name:(t=this.bench)==null?void 0:t.name},auto:!0}},deploy(){var t;return{url:"press.api.bench.deploy",params:{name:(t=this.bench)==null?void 0:t.name,apps:this.selectedApps},validate(){if(this.selectedApps.length===0&&this.deployInformation.removed_apps.length===0)return"You must select atleast 1 app to proceed with update."},onSuccess(e){this.$router.push(`/groups/${this.bench.name}/deploys/${e}`),this.showDeployDialog=!1}}}},computed:{permissions(){return{update:this.$account.hasPermission(this.bench.name,"press.api.bench.deploy_and_update")}},show(){if(this.deployInformation)return this.deployInformation.update_available&&["Awaiting Deploy","Active"].includes(this.bench.status)},errorMessage(){return this.$resources.deploy.error||(this.bench.team!==$account.team.name?"Current Team doesn't have enough permissions":"")},deployInformation(){return this.$resources.deployInformation.data},alertTitle(){return this.deployInformation&&this.deployInformation.deploy_in_progress?"Deploy in Progress":this.bench.status=="Active"?"Update Available":"Deploy"}}},He={key:0},qe={key:1},Je={key:2};function Ke(t,e,s,m,o,n){const r=C,i=ce,a=I,p=V,f=W,A=x,y=q;return n.show?(l(),c(y,{key:0,title:n.alertTitle},{actions:d(()=>[n.deployInformation.deploy_in_progress?(l(),c(r,{key:0,variant:"solid",route:`/groups/${s.bench.name}/deploys/${n.deployInformation.last_deploy.name}`},{default:d(()=>e[6]||(e[6]=[g("View Progress")])),_:1},8,["route"])):(l(),c(i,{key:1,text:n.permissions.update?"":"You don't have enough permissions to perform this action"},{default:d(()=>[u(r,{variant:"solid",disabled:!n.permissions.update,onClick:e[0]||(e[0]=w=>o.showDeployDialog=!0)},{default:d(()=>e[7]||(e[7]=[g(" Show updates ")])),_:1},8,["disabled"])]),_:1},8,["text"]))]),default:d(()=>[n.deployInformation.deploy_in_progress?(l(),h("span",He,"A deploy for this bench is in progress")):s.bench.status=="Active"?(l(),h("span",qe," A new update is available for your bench. Would you like to deploy the update now? ")):(l(),h("span",Je," Your bench is not deployed yet. You can add more apps to your bench before deploying. If you want to deploy now, click on Deploy. ")),u(A,{options:{title:"Select the apps you want to update"},modelValue:o.showDeployDialog,"onUpdate:modelValue":e[5]||(e[5]=w=>o.showDeployDialog=w)},{"body-content":d(()=>[u(a,{apps:n.deployInformation.apps,selectedApps:o.selectedApps,"onUpdate:selectedApps":e[1]||(e[1]=w=>o.selectedApps=w),removedApps:n.deployInformation.removed_apps},null,8,["apps","selectedApps","removedApps"]),u(p,{class:"mt-2",message:n.errorMessage},null,8,["message"])]),actions:d(()=>[this.bench.team===t.$account.team.name?(l(),c(r,{key:0,class:"w-full",variant:"solid",onClick:e[2]||(e[2]=w=>t.$resources.deploy.submit()),loading:t.$resources.deploy.loading},{default:d(()=>e[8]||(e[8]=[g(" Deploy ")])),_:1},8,["loading"])):(l(),c(r,{key:1,class:"w-full",variant:"solid",onClick:e[3]||(e[3]=w=>o.showTeamSwitcher=!0)},{default:d(()=>e[9]||(e[9]=[g(" Switch Team ")])),_:1})),u(f,{modelValue:o.showTeamSwitcher,"onUpdate:modelValue":e[4]||(e[4]=w=>o.showTeamSwitcher=w)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["title"])):b("",!0)}const te=k(Re,[["render",Ke]]),Xe={name:"EditBenchTitleDialog",props:["modelValue","bench"],emits:["update:modelValue"],data(){return{confirmBenchName:""}},resources:{dropBench(){var t;return{url:"press.api.bench.archive",params:{name:(t=this.bench)==null?void 0:t.name},onSuccess(){this.show=!1,this.$router.push("/sites")},validate(){var e;if(((e=this.bench)==null?void 0:e.title)!==this.confirmBenchName)return"Please type the bench name correctly to confirm"}}}},computed:{show:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}}},Qe={class:"mt-4 text-base"},Ze={class:"font-semibold"};function Ge(t,e,s,m,o,n){const r=F,i=V,a=x;return l(),c(a,{options:{title:"Drop Bench",actions:[{label:"Drop Bench",variant:"solid",theme:"red",loading:t.$resources.dropBench.loading,onClick:()=>t.$resources.dropBench.submit()}]},modelValue:n.show,"onUpdate:modelValue":e[1]||(e[1]=p=>n.show=p)},{"body-content":d(()=>[e[4]||(e[4]=_("p",{class:"text-base"}," Are you sure you want to drop this bench? All the sites on this bench should be dropped manually before dropping the bench. This action cannot be undone. ",-1)),_("p",Qe,[e[2]||(e[2]=g(" Please type ")),_("span",Ze,D(s.bench.title),1),e[3]||(e[3]=g(" to confirm. "))]),u(r,{class:"mt-4 w-full",modelValue:o.confirmBenchName,"onUpdate:modelValue":e[0]||(e[0]=p=>o.confirmBenchName=p)},null,8,["modelValue"]),u(i,{class:"mt-2",message:t.$resources.dropBench.error},null,8,["message"])]),_:1},8,["options","modelValue"])}const et=k(Xe,[["render",Ge]]),tt={name:"EditBenchTitleDialog",props:["modelValue","bench"],emits:["update:modelValue"],data(){return{benchTitle:this.bench.title}},resources:{editTitle(){var t;return{url:"press.api.bench.rename",params:{name:(t=this.bench)==null?void 0:t.name,title:this.benchTitle},validate(){var e;if(this.benchTitle===((e=this.bench)==null?void 0:e.title))return"No changes in bench title"},onSuccess(){this.show=!1,this.bench.title=this.benchTitle}}}},computed:{show:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}}};function st(t,e,s,m,o,n){const r=F,i=V,a=x;return l(),c(a,{options:{title:"Edit Title",actions:[{label:"Update",variant:"solid",loading:t.$resources.editTitle.loading,onClick:()=>t.$resources.editTitle.submit()}]},modelValue:n.show,"onUpdate:modelValue":e[1]||(e[1]=p=>n.show=p)},{"body-content":d(()=>[u(r,{label:"Title",type:"text",modelValue:o.benchTitle,"onUpdate:modelValue":e[0]||(e[0]=p=>o.benchTitle=p)},null,8,["modelValue"]),u(i,{class:"mt-4",message:t.$resources.editTitle.error},null,8,["message"])]),_:1},8,["options","modelValue"])}const nt=k(tt,[["render",st]]),ot={name:"Bench",pageMeta(){var t;return{title:`Bench - ${((t=this.bench)==null?void 0:t.title)||"Private"} - Easytouch Cloud`}},props:["benchName"],components:{Tabs:H,BenchDropDialog:et,AlertUpdate:ee,AlertBenchUpdate:te,EditBenchTitleDialog:nt},data(){return{showDropBenchDialog:!1,showEditTitleDialog:!1}},resources:{bench(){return{url:"press.api.bench.get",params:{name:this.benchName},auto:!0,onError:this.$routeTo404PageIfNotFound}},updateAllSites(){return{url:"press.api.bench.update_all_sites",params:{name:this.benchName},onSuccess(){$({title:"Switched Team",message:`Switched to ${this.bench.team}`,icon:"check",color:"green"})},onError(t){$({title:t,icon:"x",color:"red"})}}}},activated(){this.$socket.on("list_update",this.onSocketUpdate)},deactivated(){this.$socket.off("list_update",this.onSocketUpdate)},methods:{validateCreateSite(){this.$account.billing_info.has_unpaid_invoices&&!this.$account.team.free_account?$({title:"Please settle your unpaid invoices from the billing tab in order to create new sites",icon:"info",color:"yellow"}):this.$router.push(`/${this.bench.name}/new`)},onSocketUpdate({doctype:t,name:e}){t=="Release Group"&&e==this.bench.name&&this.reloadBench()},reloadBench(){new Date-this.$resources.bench.lastLoaded>1e3*1&&this.$resources.bench.reload()},isSaasLogin(t){return localStorage.getItem("saas_login")?`/saas/manage/${t}/groups`:"/sites"}},computed:{bench(){var t;if((t=this.$resources.bench)!=null&&t.data&&!this.$resources.bench.loading)return this.$resources.bench.data},tabs(){let t=s=>`/groups/${this.benchName}/${s}`,e=[{label:"Sites",route:"sites"},{label:"Apps",route:"apps"},{label:"Deploys",route:"deploys"},{label:"Config",route:"bench-config",condition:()=>{var s;return!((s=this.bench)!=null&&s.public)}},{label:"Jobs",route:"jobs"},{label:"Settings",route:"settings"}].filter(s=>s.condition?s.condition():!0);return this.bench?e.map(s=>N(E({},s),{route:t(s.route)})):[]},benchActions(){return[{label:"Edit Title",icon:"edit",onClick:()=>this.showEditTitleDialog=!0},{label:"View in Desk",icon:"external-link",condition:()=>this.$account.user.user_type=="System User",onClick:()=>{window.open(`${window.location.protocol}//${window.location.host}/app/release-group/${this.bench.name}`,"_blank")}},{label:"Impersonate Team",icon:"tool",condition:()=>this.$account.user.user_type=="System User",onClick:()=>M(this,null,function*(){yield this.$account.switchTeam(this.bench.team)})},{label:"Update All Sites",icon:"arrow-up-circle",condition:()=>this.bench.status=="Active"&&!this.bench.public,onClick:()=>M(this,null,function*(){yield this.$resources.updateAllSites.submit(),$({title:"Site update scheduled successfully",message:"All sites in this bench will be updated to the latest version",icon:"check",color:"green"})})},{label:"Drop Bench",icon:"trash",condition:()=>!this.bench.public,onClick:()=>this.showDropBenchDialog=!0}]}}},lt={key:0},at={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-5 py-2.5"},it={class:"space-x-2"},rt={class:"p-5"},pt={class:"flex flex-col space-y-3 md:flex-row md:items-baseline md:justify-between md:space-y-0"},ct={class:"flex items-center"},dt={class:"text-2xl font-bold"},ut={class:"mb-2 mt-4"};function ht(t,e,s,m,o,n){var L,Y,z;const r=C,i=de,a=me,p=P("EditBenchTitleDialog"),f=P("BenchDropDialog"),A=j,y=te,w=ee,se=P("router-view"),ne=H;return n.bench?(l(),h("div",lt,[_("header",at,[u(a,{items:[{label:"Benches",route:{name:"BenchesScreen"}},{label:(L=n.bench)==null?void 0:L.title,route:{name:"BenchSiteList",params:{benchName:(Y=n.bench)==null?void 0:Y.name}}}]},{actions:d(()=>{var v;return[_("div",it,[((v=n.bench)==null?void 0:v.status)==="Active"?(l(),c(r,{key:0,"icon-left":"plus",label:"New Site",onClick:n.validateCreateSite},null,8,["onClick"])):b("",!0),u(i,{options:n.benchActions},{default:d(({open:mt})=>[u(r,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"])])]}),_:1},8,["items"])]),u(p,{modelValue:o.showEditTitleDialog,"onUpdate:modelValue":e[0]||(e[0]=v=>o.showEditTitleDialog=v),bench:n.bench},null,8,["modelValue","bench"]),u(f,{modelValue:o.showDropBenchDialog,"onUpdate:modelValue":e[1]||(e[1]=v=>o.showDropBenchDialog=v),bench:n.bench},null,8,["modelValue","bench"]),_("div",rt,[_("div",pt,[_("div",ct,[_("h1",dt,D(n.bench.title),1),u(A,{class:"ml-4",label:n.bench.status},null,8,["label"])])]),_("div",ut,[((z=n.bench)==null?void 0:z.no_sites)<=0?(l(),c(y,{key:0,bench:n.bench},null,8,["bench"])):(l(),c(w,{key:1,bench:n.bench},null,8,["bench"]))]),u(ne,{tabs:n.tabs},{default:d(()=>[u(se,null,{default:d(({Component:v})=>[n.bench?(l(),c(ue(v),{key:0,bench:n.bench},null,8,["bench"])):b("",!0)]),_:1})]),_:1},8,["tabs"])])])):b("",!0)}const St=k(ot,[["render",ht]]);export{St as default};
//# sourceMappingURL=Bench-BhHiJ5b7.js.map
