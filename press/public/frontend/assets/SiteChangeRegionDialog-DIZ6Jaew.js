import{x as T,r as v,h as b,o as a,w as h,q as i,A as g,bp as C,u as p,a8 as I,j as r,Y as R,a9 as S,aA as x,V as A,av as B}from"./main-Dpl-JOF2.js";import{D as F}from"./DateTimeControl-DSJ0TMcX.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="9f946c1c-1e1a-4670-aeb3-b8e00520cf20",s._sentryDebugIdIdentifier="sentry-dbid-9f946c1c-1e1a-4670-aeb3-b8e00520cf20")}catch(n){}})();{var c=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};c._sentryModuleMetadata=c._sentryModuleMetadata||{},c._sentryModuleMetadata[new Error().stack]=Object.assign({},c._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const P={props:["site"],data(){return{show:!0,targetDateTime:null,selectedRegion:null,skipFailingPatches:!1}},components:{DateTimeControl:F},computed:{datetimeInIST(){return this.targetDateTime?this.$dayjs(this.targetDateTime).tz("Asia/Kolkata").format("YYYY-MM-DDTHH:mm"):null},$site(){return B("Site",this.site)}},resources:{ARecords(){return{type:"list",doctype:"Site Domain",filters:{site:this.site,dns_type:"A",domain:["!=",this.site]},limit:1,auto:!0}},changeRegionOptions(){return{url:"press.api.site.change_region_options",params:{name:this.site},auto:!0}},changeRegion(){return{url:"press.api.site.change_region"}}},methods:{changeRegion(){var s,e;A.promise(this.$resources.changeRegion.submit({name:this.site,cluster:(s=this.selectedRegion)==null?void 0:s.value,scheduled_datetime:this.datetimeInIST,skip_failing_patches:this.skipFailingPatches}),{success:()=>{var n;return this.show=!1,`Site scheduled to be migrated to ${(n=this.selectedRegion)==null?void 0:n.label}`},loading:`Scheduling site to be migrated to ${(e=this.selectedRegion)==null?void 0:e.label}...`,error:n=>{var u;return(u=n.messages)!=null&&u.length?n.messages.join(`
`):n.message||"Failed to schedule site migration"}})},resetValues(){this.selectedRegion=null,this.targetDateTime=null}}},$={key:1,class:"space-y-4"},E=["src"],M=["src"],N={key:0,class:"space-y-4"},O={key:1,class:"mt-4 text-sm text-gray-600"},Y={key:2,class:"rounded border border-gray-200 bg-gray-100 p-2"};function j(s,e,n,u,o,m){const k=C,f=I,w=v("DateTimeControl"),D=S,V=x;return a(),b(V,{options:{title:"Change Region",actions:[{label:"Change Region",loading:s.$resources.changeRegion.loading,variant:"solid",disabled:!o.selectedRegion,onClick:m.changeRegion}]},modelValue:o.show,"onUpdate:modelValue":e[3]||(e[3]=l=>o.show=l),onClose:m.resetValues},{"body-content":h(()=>{var l,_,y;return[s.$resources.changeRegionOptions.loading?(a(),b(k,{key:0,class:"mx-auto h-4 w-4"})):(a(),i("div",$,[g(f,{variant:"outline",type:"autocomplete",label:"Choose Region",modelValue:o.selectedRegion,"onUpdate:modelValue":e[0]||(e[0]=t=>o.selectedRegion=t),options:s.$resources.changeRegionOptions.data.regions.map(t=>({label:t.title||t.name,value:t.name,image:t.image}))},{prefix:h(()=>{var t;return[r("img",{src:(t=o.selectedRegion)==null?void 0:t.image,class:"mr-2 h-4"},null,8,E)]}),"item-prefix":h(({active:t,selected:U,option:d})=>[d!=null&&d.image?(a(),i("img",{key:0,src:d.image,class:"mr-2 h-4"},null,8,M)):p("",!0)]),_:1},8,["modelValue","options"]),((_=(l=s.$resources.changeRegionOptions.data)==null?void 0:l.regions)==null?void 0:_.length)>0&&o.selectedRegion?(a(),i("div",N,[g(w,{modelValue:o.targetDateTime,"onUpdate:modelValue":e[1]||(e[1]=t=>o.targetDateTime=t),label:"Schedule Time"},null,8,["modelValue"]),g(f,{label:"Skip failing patches if any",type:"checkbox",modelValue:o.skipFailingPatches,"onUpdate:modelValue":e[2]||(e[2]=t=>o.skipFailingPatches=t)},null,8,["modelValue"])])):m.$site.doc.group_public?p("",!0):(a(),i("p",O," If the region you're looking for isn't available, please add from the Bench Group dashboard. ")),((y=s.$resources.ARecords.data)==null?void 0:y.length)==0?(a(),i("div",Y,e[4]||(e[4]=[r("p",{class:"text-sm text-gray-700"},[r("strong",null,"Note"),R(": This site seems to have custom domains with "),r("strong",null,"A record"),R(". Please update the same after migration to avoid downtime. To know more, refer "),r("a",{href:"https://easytouch.cloud/docs/sites/custom-domains",target:"_blank",class:"underline"},"the documentation.")],-1)]))):p("",!0)])),g(D,{class:"mt-3",message:s.$resources.changeRegion.error},null,8,["message"])]}),_:1},8,["options","modelValue","onClose"])}const q=T(P,[["render",j]]);export{q as default};
//# sourceMappingURL=SiteChangeRegionDialog-DIZ6Jaew.js.map
