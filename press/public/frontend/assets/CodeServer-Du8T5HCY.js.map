{"version":3,"file":"CodeServer-Du8T5HCY.js","sources":["../../../../dashboard/src/views/spaces/CodeServer.vue"],"sourcesContent":["<template>\n\t<div>\n\t\t<header\n\t\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-5 py-2.5\"\n\t\t>\n\t\t\t<Breadcrumbs\n\t\t\t\t:items=\"[\n\t\t\t\t\t{ label: 'Spaces', route: { name: 'Spaces' } },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: serverName,\n\t\t\t\t\t\troute: {\n\t\t\t\t\t\t\tname: 'CodeServerOverview',\n\t\t\t\t\t\t\tparams: { serverName: serverName }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\"\n\t\t\t>\n\t\t\t\t<template #actions>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Dropdown :options=\"codeServerActions\">\n\t\t\t\t\t\t\t<template v-slot=\"{ open }\">\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" class=\"mr-2\" icon=\"more-horizontal\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</Dropdown>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</Breadcrumbs>\n\t\t</header>\n\n\t\t<div v-if=\"codeServer\" class=\"p-5\">\n\t\t\t<div class=\"pb-2\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex flex-col space-y-3 md:flex-row md:items-baseline md:justify-between md:space-y-0\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"mt-2 flex items-center\">\n\t\t\t\t\t\t<h1 class=\"text-2xl font-bold\">\n\t\t\t\t\t\t\t{{ codeServer.name }}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclass=\"ml-4\"\n\t\t\t\t\t\t\t:label=\"codeServer.status\"\n\t\t\t\t\t\t\t:colorMap=\"$badgeStatusColorMap\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<Tabs :tabs=\"tabs\">\n\t\t\t\t<router-view v-slot=\"{ Component, route }\">\n\t\t\t\t\t<component\n\t\t\t\t\t\tv-if=\"codeServer\"\n\t\t\t\t\t\t:is=\"Component\"\n\t\t\t\t\t\t:codeServer=\"codeServer\"\n\t\t\t\t\t></component>\n\t\t\t\t</router-view>\n\t\t\t</Tabs>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport Tabs from '@/components/Tabs.vue';\nexport default {\n\tname: 'CodeServer',\n\tcomponents: {\n\t\tTabs\n\t},\n\tprops: ['serverName'],\n\tdata() {\n\t\treturn {\n\t\t\trunningJob: false\n\t\t};\n\t},\n\tmethods: {\n\t\topen() {\n\t\t\twindow.open(`https://${this.serverName}`, '_blank');\n\t\t},\n\t\tonSocketUpdate({ doctype, name }) {\n\t\t\tif (doctype === 'Code Server' && name === this.serverName) {\n\t\t\t\tthis.$resources.codeServer.reload();\n\t\t\t}\n\t\t},\n\t\tsetupAgentJobUpdate() {\n\t\t\tif (this._agentJobUpdateSet) return;\n\t\t\tthis._agentJobUpdateSet = true;\n\n\t\t\tthis.$socket.on('agent_job_update', data => {\n\t\t\t\tif (data.name === 'Setup Code Server') {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.status === 'Success' &&\n\t\t\t\t\t\tdata.code_server === this.serverName\n\t\t\t\t\t) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t// running reload immediately doesn't work for some reason\n\t\t\t\t\t\t\tthis.$router.push(`/codeservers/${this.serverName}/overview`);\n\t\t\t\t\t\t\tthis.$resources.codeServer.reload();\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.runningJob =\n\t\t\t\t\tdata.code_server === this.serverName && data.status !== 'Success';\n\t\t\t});\n\t\t},\n\t\trouteToGeneral() {\n\t\t\tif (this.$route.matched.length === 1) {\n\t\t\t\tlet tab = ['Pending'].includes(this.codeServer.status)\n\t\t\t\t\t? 'jobs'\n\t\t\t\t\t: 'overview';\n\t\t\t\tthis.$router.replace(`/codeservers/${this.serverName}/${tab}`);\n\t\t\t}\n\t\t}\n\t},\n\tresources: {\n\t\tcodeServer() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.spaces.code_server',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.serverName\n\t\t\t\t},\n\t\t\t\tauto: true,\n\t\t\t\tonSuccess: this.routeToGeneral,\n\t\t\t\tonError: this.$routeTo404PageIfNotFound\n\t\t\t};\n\t\t}\n\t},\n\tactivated() {\n\t\tthis.setupAgentJobUpdate();\n\n\t\tif (this.codeServer?.status === 'Running') {\n\t\t\tthis.$socket.on('list_update', this.onSocketUpdate);\n\t\t}\n\t},\n\tdeactivated() {\n\t\tthis.$socket.off('list_update', this.onSocketUpdate);\n\t},\n\tcomputed: {\n\t\tcodeServer() {\n\t\t\treturn this.$resources.codeServer.data;\n\t\t},\n\t\ttabs() {\n\t\t\tlet tabRoute = subRoute => `/codeservers/${this.serverName}/${subRoute}`;\n\t\t\tlet tabs = [\n\t\t\t\t{ label: 'Overview', route: 'overview' },\n\t\t\t\t{ label: 'Jobs', route: 'jobs', showRedDot: this.runningJob }\n\t\t\t];\n\n\t\t\tlet tabsByStatus = {\n\t\t\t\tActive: ['Overview', 'Jobs'],\n\t\t\t\tPending: ['Jobs']\n\t\t\t};\n\t\t\tif (this.codeServer) {\n\t\t\t\tlet tabsToShow = tabsByStatus[this.codeServer.status];\n\t\t\t\tif (tabsToShow?.length) {\n\t\t\t\t\ttabs = tabs.filter(tab => tabsToShow.includes(tab.label));\n\t\t\t\t}\n\t\t\t\treturn tabs.map(tab => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...tab,\n\t\t\t\t\t\troute: tabRoute(tab.route)\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn [];\n\t\t},\n\t\tcodeServerActions() {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Open',\n\t\t\t\t\ticon: 'external-link',\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\twindow.open(`https://${this.serverName}`, '_blank');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","Tabs","doctype","name","data","tab","_a","tabRoute","subRoute","tabs","tabsByStatus","__spreadProps","__spreadValues","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createElementVNode","_withCtx","_openBlock","_createElementBlock","_hoisted_2","_toDisplayString","$options","_ctx","Component","route","_createCommentVNode"],"mappings":"oxCA8DA,MAAAA,EAAA,CACC,KAAA,yBAECC,KAAAA,GAED,MAAA,CAAA,YAAA,EACA,MAAA,CACC,MAAA,CACC,WAAA,KAGF,QAAA,CACC,MAAA,qDAGA,eAAA,CAAA,QAAAC,EAAA,KAAAC,GAAA,yCAEE,KAAA,WAAA,WAAA,OAAA,GAGF,qBAAA,CACC,KAAA,gDAGA,KAAA,QAAA,GAAA,mBAAAC,GAAA,CACCA,EAAA,OAAA,2CAGEA,EAAA,cAAA,KAAA,YAEA,WAAA,IAAA,+DAGC,KAAA,WAAA,WAAA,OAAA,CACD,EAAA,GAAA,EAGF,KAAA,gEAED,CAAA,IAED,gBAAA,CACC,GAAA,KAAA,OAAA,QAAA,SAAA,EAAA,oDAEE,kBAED,KAAA,QAAA,QAAA,gBAAA,KAAA,UAAA,IAAAC,CAAA,EAAA,CACD,CACD,2BAIC,MAAA,CACC,IAAA,+BACA,OAAA,CACC,KAAA,KAAA,YAED,KAAA,iCAEA,QAAA,KAAA,0BAEF,kDAKAC,EAAA,KAAA,aAAA,YAAAA,EAAA,UAAA,kIAOD,SAAA,cAEE,OAAA,KAAA,WAAA,WAAA,MAED,MAAA,CACC,IAAAC,EAAAC,GAAA,gBAAA,KAAA,UAAA,IAAAA,CAAA,GACAC,EAAA,CACC,CAAA,MAAA,WAAA,MAAA,UAAA,0DAIDC,EAAA,4BAEC,QAAA,CAAA,MAAA,GAED,GAAA,KAAA,WAAA,gGAKCD,EAAA,IAAAJ,GACCM,EAAAC,EAAA,GACCP,GADD,mBAID,CACD,CACA,MAAA,CAAA,GAED,mBAAA,CACC,MAAA,CACC,cAEC,KAAA,+EAGA,CACD,EAEF,CACD,CACD,EA7KGQ,EAAA,CAAA,MAAA,mFAAA,WA0BsB,MAAA,OACjBC,EAAA,CAAA,MAAA,MAAA,EAEHC,EAAA,CAAA,MAAA,uFAAA,EAEKC,EAAA,CAAA,MAAA,wBAAA,EACAC,EAAA,CAAA,MAAA,oBAAA,gGAjCRC,EAAA,SAAAL,EAAA,+IAea,QAAAM,EAAA,IAAA,8EAIC,QAAA,QAAgB,MAAA,OAAa,KAAA,gFAQ3CC,IAAAC,EAAA,MAAAC,EAAA,CACCJ,EAAA,MAAAJ,EAAA,CACCI,EAAA,MAAAH,EAAA,CAGCG,EAAA,MAAAF,EAAA,CACCE,EAAA,KAAAD,EAAAM,EAAAC,EAAA,WAAA,IAAA,EAAA,CAAA,OAIC,MAAA,iCAEC,SAAAC,EAAA,4EAzCR,QAAAN,EAAA,IAAA,WAAA,QAAAA,EAAA,CAAA,CAAA,UAAAO,EAAA,MAAAC,CAAA,IAAA,iCAoDO,WAAAH,EAAA,oCApDPI,EAAA,GAAA,EAAA,gCAAAA,EAAA,GAAA,EAAA"}