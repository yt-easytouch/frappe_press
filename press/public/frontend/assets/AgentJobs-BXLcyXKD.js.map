{"version":3,"file":"AgentJobs-BXLcyXKD.js","sources":["../../../../dashboard/src/views/general/JobsDetail.vue","../../../../dashboard/src/views/general/AgentJobs.vue"],"sourcesContent":["<template>\n\t<StepsDetail\n\t\t:showDetails=\"job\"\n\t\t:loading=\"$resources.job.loading\"\n\t\t:title=\"job ? job.job_type : ''\"\n\t\t:subtitle=\"subtitle\"\n\t\t:steps=\"steps\"\n\t/>\n</template>\n<script>\nimport StepsDetail from './StepsDetail.vue';\nexport default {\n\tname: 'JobsDetail',\n\tprops: ['jobName'],\n\tcomponents: {\n\t\tStepsDetail\n\t},\n\tinject: ['viewportWidth'],\n\tresources: {\n\t\tjob() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.job',\n\t\t\t\tparams: {\n\t\t\t\t\tjob: this.jobName\n\t\t\t\t},\n\t\t\t\tauto: Boolean(this.jobName)\n\t\t\t};\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\trunningJob: null\n\t\t};\n\t},\n\tcomputed: {\n\t\tjob() {\n\t\t\treturn this.$resources.job.data;\n\t\t},\n\t\tsubtitle() {\n\t\t\tif (!this.job) return;\n\t\t\tif (this.job.status == 'Success') {\n\t\t\t\tlet when = this.formatDate(this.job.creation, 'relative');\n\t\t\t\treturn `Completed ${when} in ${this.$formatDuration(\n\t\t\t\t\tthis.job.duration,\n\t\t\t\t\t'hh:mm:ss'\n\t\t\t\t)}`;\n\t\t\t}\n\t\t\tif (this.job.status == 'Undelivered') {\n\t\t\t\treturn 'Job failed to start';\n\t\t\t}\n\t\t},\n\t\tsteps() {\n\t\t\tif (!this.job) return;\n\t\t\treturn this.job.steps.map((step, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: step.step_name,\n\t\t\t\t\tstatus: step.status,\n\t\t\t\t\toutput: step.output,\n\t\t\t\t\trunning: this.isStepRunning(step),\n\t\t\t\t\tcompleted: this.isStepCompleted(step, index)\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$socket.emit('doc_subscribe', 'Agent Job', this.jobName);\n\t\tthis.$socket.on('agent_job_update', this.onAgentJobUpdate);\n\t},\n\tunmounted() {\n\t\tthis.$socket.emit('doc_unsubscribe', 'Agent Job', this.jobName);\n\t\tthis.$socket.off('agent_job_update', this.onAgentJobUpdate);\n\t\tthis.runningJob = null;\n\t},\n\tmethods: {\n\t\tonAgentJobUpdate(data) {\n\t\t\tif (data.id === this.jobName) {\n\t\t\t\tthis.runningJob = data;\n\t\t\t}\n\t\t},\n\t\tisStepRunning(step) {\n\t\t\tif (!this.runningJob) return false;\n\t\t\tlet runningStep = this.runningJob.steps.find(\n\t\t\t\ts => s.name == step.step_name\n\t\t\t);\n\t\t\treturn runningStep?.status === 'Running';\n\t\t},\n\t\tisStepCompleted(step, index) {\n\t\t\tif (this.runningJob) {\n\t\t\t\treturn this.runningJob.current.index > index;\n\t\t\t}\n\t\t\treturn step.status === 'Success';\n\t\t}\n\t}\n};\n</script>\n","<template>\n\t<CardWithDetails :title=\"title\" :subtitle=\"subtitle\" :showDetails=\"jobName\">\n\t\t<div>\n\t\t\t<router-link\n\t\t\t\tv-for=\"job in $resources.jobs.data\"\n\t\t\t\tclass=\"block cursor-pointer rounded-md px-2.5\"\n\t\t\t\t:class=\"jobName === job.name ? 'bg-gray-100' : 'hover:bg-gray-50'\"\n\t\t\t\t:key=\"job.name\"\n\t\t\t\t:to=\"jobRoute(job)\"\n\t\t\t>\n\t\t\t\t<ListItem :title=\"job.job_type\" :description=\"formatDate(job.creation)\">\n\t\t\t\t\t<template v-slot:actions>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclass=\"whitespace-nowrap\"\n\t\t\t\t\t\t\tv-if=\"\n\t\t\t\t\t\t\t\trunningJob &&\n\t\t\t\t\t\t\t\trunningJob.id == job.name &&\n\t\t\t\t\t\t\t\trunningJob.status !== 'Success'\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t:label=\"runningJob.status\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclass=\"whitespace-nowrap\"\n\t\t\t\t\t\t\tv-else-if=\"job.status != 'Success'\"\n\t\t\t\t\t\t\t:label=\"job.status\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</ListItem>\n\t\t\t\t<div class=\"border-b\"></div>\n\t\t\t</router-link>\n\t\t\t<div class=\"py-3\" v-if=\"$resources.jobs.hasNextPage\">\n\t\t\t\t<Button\n\t\t\t\t\t:loading=\"$resources.jobs.list.loading\"\n\t\t\t\t\tloadingText=\"Loading...\"\n\t\t\t\t\t@click=\"$resources.jobs.next()\"\n\t\t\t\t>\n\t\t\t\t\tLoad more\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t\t<template #details>\n\t\t\t<JobsDetail :jobName=\"jobName\" />\n\t\t</template>\n\t</CardWithDetails>\n</template>\n<script>\nimport CardWithDetails from '@/components/CardWithDetails.vue';\nimport JobsDetail from './JobsDetail.vue';\nexport default {\n\tname: 'AgentJobs',\n\tprops: ['title', 'subtitle', 'resource', 'jobName', 'jobRoute'],\n\tcomponents: { JobsDetail, CardWithDetails },\n\tdata() {\n\t\treturn {\n\t\t\trunningJob: null\n\t\t};\n\t},\n\tresources: {\n\t\tjobs() {\n\t\t\treturn this.resource();\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$socket.on('agent_job_update', this.onAgentJobUpdate);\n\t},\n\tunmounted() {\n\t\tthis.$socket.off('agent_job_update', this.onAgentJobUpdate);\n\t},\n\tmethods: {\n\t\tonAgentJobUpdate(data) {\n\t\t\tif (data.id === this.jobName) {\n\t\t\t\tthis.runningJob = data;\n\t\t\t\tif (this.runningJob.status === 'Success') {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t// calling reload immediately does not fetch the latest status\n\t\t\t\t\t\t// so adding 1 sec delay\n\t\t\t\t\t\tthis.$resources.jobs.reset();\n\t\t\t\t\t\tthis.$resources.jobs.reload();\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","step","index","data","runningStep","$options","_ctx","JobsDetail","CardWithDetails","$props","_withCtx","job","$data","_createCommentVNode","_openBlock","_createElementBlock","_hoisted_1","_cache","$event","_createTextVNode"],"mappings":"05BAWA,MAAAA,EAAA,CACC,KAAA,aACA,MAAA,CAAA,SAAA,uEAOE,MAAA,0BAEC,OAAA,CACC,IAAA,KAAA,6BAIH,GAED,MAAA,CACC,MAAA,CACC,WAAA,OAGF,SAAA,OAEE,OAAA,KAAA,WAAA,IAAA,iBAGA,GAAA,KAAA,IACA,IAAA,KAAA,IAAA,QAAA,sGAGE,KAAA,IAAA,SACA,UACD,CAAA,GAED,GAAA,KAAA,IAAA,QAAA,4CAID,OAAA,CACC,GAAA,KAAA,IACA,OAAA,KAAA,IAAA,MAAA,IAAA,CAAAC,EAAAC,KACC,CACC,KAAAD,EAAA,UACA,OAAAA,EAAA,OACA,OAAAA,EAAA,OACA,QAAA,KAAA,cAAAA,CAAA,EACA,UAAA,KAAA,gBAAAA,EAAAC,CAAA,GAEF,CACD,GAED,SAAA,6PAOC,KAAA,WAAA,MAED,QAAA,2CAGG,KAAA,WAAAC,IAGF,cAAAF,EAAA,CACC,GAAA,CAAA,KAAA,WAAA,MAAA,GACA,IAAAG,EAAA,KAAA,WAAA,MAAA,6BAGA,OAAAA,GAAA,YAAAA,EAAA,UAAA,gCAGA,OAAA,KAAA,WACC,KAAA,WAAA,QAAA,MAAAF,sBAGF,CACD,CACD,mEA3FG,YAAAG,EAAA,IACA,QAAAC,EAAA,WAAA,IAAA,QACA,MAAAD,EAAA,IAAAA,EAAA,IAAA,SAAA,GACA,SAAAA,EAAA,SACA,MAAAA,EAAA,gGC4CHL,EAAA,CACC,KAAA,uEAEA,WAAA,CAAA,WAAAO,EAAA,gBAAAC,CAAA,EACA,MAAA,CACC,MAAA,CACC,WAAA,kBAID,MAAA,CACC,OAAA,KAAA,SAAA,CACD,GAED,SAAA,oIAMA,QAAA,2CAGG,KAAA,WAAAL,EACA,KAAA,WAAA,SAAA,WACC,WAAA,IAAA,2DAKA,EAAA,GAAA,EAGH,CACD,CACD,WArDQ,MAAA,2GA/BW,MAAAM,EAAA,MAAe,SAAAA,EAAA,SAAqB,YAAAA,EAAA,UAyC1C,QAAAC,EAAA,IAAA,+CA1Cb,QAAAA,EAAA,IAAA,2MAAA,QAAAA,EAAA,IAAA,uBAUqC,YAAAJ,EAAA,WAAAK,EAAA,QAAA,IACf,QAAAD,EAAA,IAAA,eAGsBE,EAAA,WAAA,IAAAD,EAAA,MAAqCC,EAAA,WAAA,SAAA,0BAD1E,MAAA,kEAYWD,EAAA,QAAA,0BADX,MAAA,uDAxBPE,EAAA,GAAA,EAAA,2JAgCGC,IAAAC,EAAA,MAAAC,EAAA,MAEG,QAAAV,EAAA,WAAA,KAAA,KAAA,QACD,YAAA,aACC,QAAAW,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAZ,EAAA,WAAA,KAAA,KAAA,KApCN,QAAAI,EAAA,IAAAO,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAAE,EAAA,aAAA,4BAAAN,EAAA,GAAA,EAAA"}