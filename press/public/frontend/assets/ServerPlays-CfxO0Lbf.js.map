{"version":3,"file":"ServerPlays-CfxO0Lbf.js","sources":["../../../../dashboard/src/views/general/PlaysDetail.vue","../../../../dashboard/src/views/general/AnsiblePlays.vue","../../../../dashboard/src/views/server/ServerPlays.vue"],"sourcesContent":["<template>\n\t<StepsDetail\n\t\t:showDetails=\"play\"\n\t\t:loading=\"$resources.play.loading\"\n\t\t:title=\"play ? play.play : ''\"\n\t\t:subtitle=\"subtitle\"\n\t\t:steps=\"steps\"\n\t/>\n</template>\n<script>\nimport StepsDetail from './StepsDetail.vue';\nexport default {\n\tname: 'PlaysDetail',\n\tprops: ['playName'],\n\tcomponents: {\n\t\tStepsDetail\n\t},\n\tinject: ['viewportWidth'],\n\tresources: {\n\t\tplay() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.server.play',\n\t\t\t\tparams: {\n\t\t\t\t\tplay: this.playName\n\t\t\t\t},\n\t\t\t\tauto: Boolean(this.playName)\n\t\t\t};\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\trunningPlay: null\n\t\t};\n\t},\n\tcomputed: {\n\t\tplay() {\n\t\t\treturn this.$resources.play.data;\n\t\t},\n\t\tsubtitle() {\n\t\t\tif (!this.play) return;\n\t\t\tif (this.play.status == 'Success') {\n\t\t\t\tlet when = this.formatDate(this.play.creation, 'relative');\n\t\t\t\treturn `Completed ${when} in ${this.$formatDuration(\n\t\t\t\t\tthis.play.duration,\n\t\t\t\t\t'hh:mm:ss'\n\t\t\t\t)}`;\n\t\t\t}\n\t\t\tif (this.play.status == 'Undelivered') {\n\t\t\t\treturn 'play failed to start';\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tsteps() {\n\t\t\tif (!this.play) return;\n\t\t\treturn this.play.steps.map((step, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: step.task,\n\t\t\t\t\tstatus: step.status,\n\t\t\t\t\toutput: step.output,\n\t\t\t\t\trunning: this.isStepRunning(step),\n\t\t\t\t\tcompleted: this.isStepCompleted(step, index)\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$socket.emit('doc_subscribe', 'Ansible Play', this.playName);\n\t\tthis.$socket.on('ansible_play_update', this.onAnsiblePlayUpdate);\n\t},\n\tunmounted() {\n\t\tthis.$socket.emit('doc_unsubscribe', 'Ansible Play', this.playName);\n\t\tthis.$socket.off('ansible_play_update', this.onAnsiblePlayUpdate);\n\t\tthis.runningPlay = null;\n\t},\n\tmethods: {\n\t\tonAnsiblePlayUpdate(data) {\n\t\t\tif (data.id === this.playName) {\n\t\t\t\tthis.runningPlay = data;\n\t\t\t}\n\t\t},\n\t\tisStepRunning(step) {\n\t\t\tif (!this.runningPlay) return false;\n\t\t\tlet runningStep = this.runningPlay.steps.find(\n\t\t\t\ts => s.name == step.step_name\n\t\t\t);\n\t\t\treturn runningStep?.status === 'Running';\n\t\t},\n\t\tisStepCompleted(step, index) {\n\t\t\tif (this.runningPlay) {\n\t\t\t\treturn this.runningPlay.current.index > index;\n\t\t\t}\n\t\t\treturn step.status === 'Success';\n\t\t}\n\t}\n};\n</script>\n","<template>\n\t<CardWithDetails :title=\"title\" :subtitle=\"subtitle\" :showDetails=\"playName\">\n\t\t<div>\n\t\t\t<router-link\n\t\t\t\tv-for=\"play in $resources.plays.data\"\n\t\t\t\tclass=\"block cursor-pointer rounded-md px-2.5\"\n\t\t\t\t:class=\"playName === play.name ? 'bg-gray-100' : 'hover:bg-gray-50'\"\n\t\t\t\t:key=\"play.name\"\n\t\t\t\t:to=\"playRoute(play)\"\n\t\t\t>\n\t\t\t\t<ListItem :title=\"play.play\" :description=\"formatDate(play.creation)\">\n\t\t\t\t\t<template v-slot:actions>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tv-if=\"\n\t\t\t\t\t\t\t\trunningPlay &&\n\t\t\t\t\t\t\t\trunningPlay.id == play.name &&\n\t\t\t\t\t\t\t\trunningPlay.status !== 'Success'\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t:label=\"runningPlay.status\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Badge v-else-if=\"play.status != 'Success'\" :label=\"play.status\" />\n\t\t\t\t\t</template>\n\t\t\t\t</ListItem>\n\t\t\t\t<div class=\"border-b\"></div>\n\t\t\t</router-link>\n\t\t\t<div class=\"py-3\" v-if=\"$resources.plays.hasNextPage\">\n\t\t\t\t<Button\n\t\t\t\t\t:loading=\"$resources.plays.list.loading\"\n\t\t\t\t\tloadingText=\"Loading...\"\n\t\t\t\t\t@click=\"$resources.plays.next()\"\n\t\t\t\t>\n\t\t\t\t\tLoad more\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t\t<template #details>\n\t\t\t<PlaysDetail :playName=\"playName\" />\n\t\t</template>\n\t</CardWithDetails>\n</template>\n<script>\nimport CardWithDetails from '@/components/CardWithDetails.vue';\nimport PlaysDetail from './PlaysDetail.vue';\nexport default {\n\tname: 'AnsiblePlays',\n\tprops: ['title', 'subtitle', 'resource', 'playName', 'playRoute'],\n\tcomponents: { PlaysDetail, CardWithDetails },\n\tdata() {\n\t\treturn {\n\t\t\trunningPlay: null\n\t\t};\n\t},\n\tresources: {\n\t\tplays() {\n\t\t\treturn this.resource();\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$socket.emit('doctype_subscribe', 'Ansible Play');\n\t\tthis.$socket.on('list_update', this.onAnsiblePlayUpdate);\n\t},\n\tunmounted() {\n\t\tthis.$socket.emit('doctype_unsubscribe', 'Ansible Play');\n\t\tthis.$socket.off('list_update', this.onAnsiblePlayUpdate);\n\t},\n\tmethods: {\n\t\tonAnsiblePlayUpdate(data) {\n\t\t\tif (data.id === this.playName) {\n\t\t\t\tthis.runningPlay = data;\n\t\t\t\tif (this.runningPlay.status === 'Success') {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t// calling reload immediately does not fetch the latest status\n\t\t\t\t\t\t// so adding 1 sec delay\n\t\t\t\t\t\tthis.$resources.plays.reset();\n\t\t\t\t\t\tthis.$resources.plays.reload();\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n</script>\n","<template>\n\t<AnsiblePlays\n\t\ttitle=\"Plays\"\n\t\tsubtitle=\"History of ansible plays that ran on your server\"\n\t\t:resource=\"plaResource\"\n\t\t:playName=\"playName\"\n\t\t:playRoute=\"playRoute\"\n\t/>\n</template>\n<script>\nimport AnsiblePlays from '@/views/general/AnsiblePlays.vue';\nexport default {\n\tname: 'ServerPlays',\n\tprops: ['serverName', 'playName'],\n\tcomponents: {\n\t\tAnsiblePlays\n\t},\n\tmethods: {\n\t\tplaResource() {\n\t\t\treturn {\n\t\t\t\ttype: 'list',\n\t\t\t\tdoctype: 'Ansible Play',\n\t\t\t\turl: 'press.api.server.plays',\n\t\t\t\tfilters: { server: this.serverName },\n\t\t\t\tpageLength: 10,\n\t\t\t\tstart: 0,\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tplayRoute(play) {\n\t\t\treturn `/servers/${this.serverName}/plays/${play.name}`;\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","step","index","data","runningStep","$options","_ctx","PlaysDetail","CardWithDetails","$props","_withCtx","play","$data","_createCommentVNode","_openBlock","_createElementBlock","_hoisted_1","_cache","$event","_createTextVNode"],"mappings":"49BAWA,MAAAA,EAAA,CACC,KAAA,cACA,MAAA,CAAA,UAAA,iEAMC,MAAA,CACC,MAAA,6BAEC,OAAA,CACC,KAAA,KAAA,+BAIH,GAED,MAAA,CACC,MAAA,CACC,YAAA,OAGF,SAAA,CACC,MAAA,CACC,OAAA,KAAA,WAAA,KAAA,iBAGA,GAAA,KAAA,KACA,OAAA,KAAA,KAAA,QAAA,iGAGE,KAAA,KAAA,SACA,UACD,CAAA,GAED,KAAA,KAAA,QAAA,2CAKD,OAAA,CACC,GAAA,KAAA,KACA,OAAA,KAAA,KAAA,MAAA,IAAA,CAAAC,EAAAC,KACC,CACC,KAAAD,EAAA,KACA,OAAAA,EAAA,OACA,OAAAA,EAAA,OACA,QAAA,KAAA,cAAAA,CAAA,EACA,UAAA,KAAA,gBAAAA,EAAAC,CAAA,GAEF,CACD,GAED,SAAA,CACC,KAAA,QAAA,KAAA,gBAAA,eAAA,KAAA,QAAA,EACA,KAAA,QAAA,GAAA,sBAAA,KAAA,mBAAA,eAGA,KAAA,QAAA,KAAA,kBAAA,eAAA,KAAA,QAAA,EACA,KAAA,QAAA,IAAA,sBAAA,KAAA,mBAAA,EACA,KAAA,YAAA,MAED,QAAA,+CAGG,KAAA,YAAAC,IAGF,cAAAF,EAAA,CACC,GAAA,CAAA,KAAA,YAAA,MAAA,GACA,IAAAG,EAAA,KAAA,YAAA,MAAA,6BAGA,OAAAA,GAAA,YAAAA,EAAA,UAAA,gCAGA,OAAA,KAAA,YACC,KAAA,YAAA,QAAA,MAAAF,sBAGF,CACD,CACD,mEA5FG,YAAAG,EAAA,KACA,QAAAC,EAAA,WAAA,KAAA,QACA,MAAAD,EAAA,KAAAA,EAAA,KAAA,KAAA,GACA,SAAAA,EAAA,SACA,MAAAA,EAAA,gGCuCHL,EAAA,CACC,KAAA,4EAEA,WAAA,CAAA,YAAAO,EAAA,gBAAAC,CAAA,EACA,MAAA,CACC,MAAA,CACC,YAAA,kBAID,OAAA,CACC,OAAA,KAAA,SAAA,CACD,GAED,SAAA,8OAQA,QAAA,+CAGG,KAAA,YAAAL,EACA,KAAA,YAAA,SAAA,WACC,WAAA,IAAA,+BAIC,KAAA,WAAA,MAAA,OAAA,CACD,EAAA,GAAA,EAGH,CACD,CACD,WAvDQ,MAAA,4GA1BW,MAAAM,EAAA,MAAe,SAAAA,EAAA,SAAqB,YAAAA,EAAA,WAoC1C,QAAAC,EAAA,IAAA,kDArCb,QAAAA,EAAA,IAAA,8MAAA,QAAAA,EAAA,IAAA,mBAUkC,YAAAJ,EAAA,WAAAK,EAAA,QAAA,IACZ,QAAAD,EAAA,IAAA,gBAEuBE,EAAA,YAAA,IAAAD,EAAA,MAAuCC,EAAA,YAAA,SAAA,yEAS5DD,EAAA,QAAA,6DAtBxBE,EAAA,GAAA,EAAA,4JA2BGC,IAAAC,EAAA,MAAAC,EAAA,MAEG,QAAAV,EAAA,WAAA,MAAA,KAAA,QACD,YAAA,aACC,QAAAW,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAZ,EAAA,WAAA,MAAA,KAAA,KA/BN,QAAAI,EAAA,IAAAO,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAAE,EAAA,aAAA,4BAAAN,EAAA,GAAA,EAAA,6ECWAb,EAAA,CACC,KAAA,cACA,MAAA,CAAA,aAAA,UAAA,8BAIA,QAAA,eAEE,MAAA,aAEC,QAAA,4CAEA,QAAA,CAAA,OAAA,KAAA,UAAA,gBAEA,MAAA,EACA,KAAA,KAGF,UAAAW,EAAA,oDAEA,CACD,CACD,oEA/BE,MAAA,QACA,SAAA,mDACC,SAAAN,EAAA,YACA,SAAAI,EAAA,SACA,UAAAJ,EAAA"}