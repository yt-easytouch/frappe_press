var O=Object.defineProperty,T=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var F=(e,s,n)=>s in e?O(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,h=(e,s)=>{for(var n in s||(s={}))I.call(s,n)&&F(e,n,s[n]);if(C)for(var n of C(s))D.call(s,n)&&F(e,n,s[n]);return e},y=(e,s)=>T(e,x(s));var w=(e,s,n)=>new Promise((p,o)=>{var t=g=>{try{m(n.next(g))}catch(v){o(v)}},f=g=>{try{m(n.throw(g))}catch(v){o(v)}},m=g=>g.done?p(g.value):Promise.resolve(g.value).then(t,f);m((n=n.apply(e,s)).next())});import{_ as A}from"./GoogleIconSolid-CpO1UNWZ.js";import{x as B,r as V,q as c,o as l,j as u,A as i,a6 as U,w as a,t as b,u as L,a7 as j,F as P,a8 as N,X as M,Y as d,a9 as K,h as q,n as z,V as k,aa as $}from"./main-Dpl-JOF2.js";import{L as W}from"./LoginBox-qd4moaUa.js";import"./YooltechLogo-DH5Linvn.js";import"./ETLogo-Ziye5dPH.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="b673765b-e096-4fc6-8f59-8bb0c9a16a02",e._sentryDebugIdIdentifier="sentry-dbid-b673765b-e096-4fc6-8f59-8bb0c9a16a02")}catch(n){}})();{var S=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};S._sentryModuleMetadata=S._sentryModuleMetadata||{},S._sentryModuleMetadata[new Error().stack]=Object.assign({},S._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const X={name:"Signup",components:{LoginBox:W,GoogleIconSolid:A},data(){return{email:"",account_request:"",otpRequested:!1,otp:"",otpSent:!1,twoFactorCode:"",password:null,otpResendCountdown:0,resetPasswordEmailSent:!1}},mounted(){this.email=localStorage.getItem("login_email"),setInterval(()=>{this.otpResendCountdown>0&&(this.otpResendCountdown-=1)},1e3)},watch:{email(){this.resetSignupState()}},resources:{signup(){return{url:"press.api.account.signup",params:{email:this.email,referrer:this.getReferrerIfAny(),product:this.$route.query.product},onSuccess(e){this.account_request=e,this.otpRequested=!0,this.otpResendCountdown=30,k.success("Verification code sent to your email")},onError:e=>{var n,p,o;if((e==null?void 0:e.exc_type)!=="ValidationError")return;let s="";((n=e==null?void 0:e.messages)!=null?n:[]).length&&(s=(p=e==null?void 0:e.messages)==null?void 0:p[0]),s.includes("is already registered")&&(localStorage.setItem("login_email",this.email),(o=this.$route.query)!=null&&o.product?this.$router.push({name:"Login",query:{redirect:`/dashboard/create-site/${this.$route.query.product}/setup`}}):this.$router.push({name:"Login"}))}}},verifyOTP(){return{url:"press.api.account.verify_otp",params:{account_request:this.account_request,otp:this.otp},onSuccess(e){window.open(`/dashboard/setup-account/${e}`,"_self")}}},resendOTP(){return{url:"press.api.account.resend_otp",params:{account_request:this.account_request},onSuccess(){this.otp="",this.otpResendCountdown=30,k.success("Verification code sent to your email")},onError(e){k.error($(e,"Failed to resend verification code"))}}},sendOTP(){return{url:"press.api.account.send_otp",params:{email:this.email},onSuccess(){this.otpSent=!0,this.otpResendCountdown=30,k.success("Verification code sent to your email")},onError(e){k.error($(e,"Failed to send verification code"))}}},verifyOTPAndLogin(){return{url:"press.api.account.verify_otp_and_login",params:{email:this.email,otp:this.otp},onSuccess(e){this.afterLogin(e)}}},oauthLogin(){return{url:"press.api.oauth.oauth_authorize_url",onSuccess(e){localStorage.setItem("login_email",this.email),window.location.href=e}}},googleLogin(){return{url:"press.api.google.login",makeParams(){return{product:this.$route.query.product}},onSuccess(e){window.location.href=e}}},resetPassword(){return{url:"press.api.account.send_reset_password_email",onSuccess(){this.resetPasswordEmailSent=!0}}},signupSettings(){return{url:"press.api.account.signup_settings",params:{product:this.$route.query.product},auto:!0}},is2FAEnabled(){return{url:"press.api.account.is_2fa_enabled"}},verify2FA(){return{url:"press.api.account.verify_2fa",onSuccess:()=>w(this,null,function*(){this.isLogin?this.usePassword?yield this.login():yield this.$resources.verifyOTPAndLogin.submit():this.hasForgotPassword&&(yield this.$resources.resetPassword.submit({email:this.email}))})}}},methods:{resetSignupState(){!this.isLogin&&!this.hasForgotPassword&&this.otpRequested&&(this.otpRequested=!1,this.account_request="",this.otp="")},submitForm(){return w(this,null,function*(){if(this.isLogin)if(this.isOauthLogin)this.$resources.oauthLogin.submit({provider:this.socialLoginKey});else if(this.usePassword)this.email&&this.password&&(yield this.checkTwoFactorAndLogin());else return;else this.hasForgotPassword?yield this.checkTwoFactorAndResetPassword():this.$resources.signup.submit()})},checkTwoFactorAndLogin(){return w(this,null,function*(){yield this.$resources.is2FAEnabled.submit({user:this.email},{onSuccess:e=>w(this,null,function*(){e?this.$router.push({name:"Login",query:y(h({},this.$route.query),{two_factor:1})}):yield this.login()})})})},checkTwoFactorAndResetPassword(){return w(this,null,function*(){yield this.$resources.is2FAEnabled.submit({user:this.email},{onSuccess:e=>w(this,null,function*(){e?this.$router.push({name:"Login",query:{two_factor:1,forgot:1}}):yield this.$resources.resetPassword.submit({email:this.email})})})})},verifyOTPAndLogin(){this.$resources.is2FAEnabled.submit({user:this.email},{onSuccess:e=>w(this,null,function*(){e?this.$router.push({name:"Login",query:y(h({},this.$route.query),{two_factor:1})}):yield this.$resources.verifyOTPAndLogin.submit()})})},getReferrerIfAny(){const e=location.search;return new URLSearchParams(e).get("referrer")},login(){return w(this,null,function*(){yield this.$session.login.submit({email:this.email,password:this.password},{onSuccess:e=>{this.afterLogin(e)},onError:e=>{this.$route.name==="Login"&&this.$route.query.two_factor&&(this.$router.push({name:"Login",query:{two_factor:void 0}}),this.twoFactorCode="")}})})},afterLogin(e){let s=`/dashboard${e.dashboard_route||"/"}`;this.$route.query.redirect&&(s=this.$route.query.redirect),localStorage.setItem("login_email",this.email),window.location.href=s}},computed:{error(){if(this.$resources.signup.error)return this.$resources.signup.error;if(this.$resources.resetPassword.error)return this.$resources.resetPassword.error},saasProduct(){var e;return(e=this.$resources.signupSettings.data)==null?void 0:e.product_trial},isLogin(){return this.$route.name=="Login"&&!this.$route.query.forgot},hasForgotPassword(){return this.$route.name=="Login"&&this.$route.query.forgot},is2FA(){return this.$route.name=="Login"&&this.$route.query.two_factor},emailDomain(){var e,s;return(e=this.email)!=null&&e.includes("@")?(s=this.email)==null?void 0:s.split("@").pop():""},isOauthLogin(){return this.oauthEmailDomains.has(this.emailDomain)&&this.emailDomain.length>0},usePassword(){return!!this.$route.query.use_password},oauthProviders(){var n;const e=(n=this.$resources.signupSettings.data)==null?void 0:n.oauth_domains;let s={};return e&&e.map(p=>s[p.email_domain]={social_login_key:p.social_login_key,provider_name:p.provider_name}),s},oauthEmailDomains(){return new Set(Object.keys(this.oauthProviders))},socialLoginKey(){return this.oauthProviders[this.emailDomain].social_login_key},oauthProviderName(){return this.oauthProviders[this.emailDomain].provider_name},title(){return this.hasForgotPassword?"Reset password":this.isLogin?this.saasProduct?`Log in to your account to start using ${this.saasProduct.title}`:"Log in to your account":this.saasProduct?`Sign up to create your ${this.saasProduct.title} site`:"Create a new account"}}},Y={class:"flex h-screen overflow-hidden sm:bg-gray-50"},G={class:"w-full overflow-auto"},H={key:0},J={class:"mt-2 flex flex-col gap-2"},Q={class:"mt-4 space-y-2"},Z={key:0,class:"flex flex-col"},ee={class:"flex flex-col gap-2"},se={class:"flex items-center"},oe={key:0,class:"mt-6 text-center"},te={key:1},re={class:"flex flex-col"},ie={class:"mt-6 text-center"},ne={key:2,class:"text-p-base text-gray-700"},ae={class:"font-semibold"},le={class:"mx-auto flex items-center space-x-2"},ue=["src"],de={class:"select-none text-xl font-semibold tracking-tight text-gray-900"};function me(e,s,n,p,o,t){const f=N,m=M,g=K,v=V("router-link"),R=A,E=V("LoginBox");return l(),c("div",Y,[u("div",G,[i(E,{title:t.title,class:z({"pointer-events-none":e.$resources.signup.loading})},U({default:a(()=>[o.resetPasswordEmailSent||o.otpRequested?o.otpRequested?(l(),c("div",te,[u("form",re,[i(f,{label:"Email",type:"email",placeholder:"johndoe@mail.com",autocomplete:"email",modelValue:o.email,"onUpdate:modelValue":s[11]||(s[11]=r=>o.email=r),required:""},null,8,["modelValue"]),i(f,{label:"Verification code",type:"text",class:"mt-4",placeholder:"123456",maxlength:"6",modelValue:o.otp,"onUpdate:modelValue":s[12]||(s[12]=r=>o.otp=r),required:""},null,8,["modelValue"]),i(g,{class:"mt-2",message:e.$resources.verifyOTP.error},null,8,["message"]),i(m,{class:"mt-4",variant:"solid",loading:e.$resources.verifyOTP.loading,onClick:s[13]||(s[13]=r=>e.$resources.verifyOTP.submit())},{default:a(()=>s[27]||(s[27]=[d(" Verify ")])),_:1},8,["loading"]),i(m,{class:"mt-2",variant:"outline",loading:e.$resources.resendOTP.loading,onClick:s[14]||(s[14]=r=>e.$resources.resendOTP.submit()),disabled:o.otpResendCountdown>0},{default:a(()=>[d(" Resend verification code "+b(o.otpResendCountdown>0?`in ${o.otpResendCountdown} seconds`:""),1)]),_:1},8,["loading","disabled"])]),u("div",ie,[i(v,{class:"text-center text-base font-medium text-gray-900 hover:text-gray-700",to:{name:e.$route.name=="Login"?"Signup":"Login",query:y(h({},e.$route.query),{forgot:void 0})}},{default:a(()=>[d(b(e.$route.name=="Login"?"New member? Create a new account.":"Already have an account? Log in."),1)]),_:1},8,["to"])])])):o.resetPasswordEmailSent?(l(),c("div",ne,[u("p",null,[s[28]||(s[28]=d(" We have sent an email to ")),u("span",ae,b(o.email),1),s[29]||(s[29]=d(". Please click on the link received to reset your password. "))])])):L("",!0):(l(),c("div",H,[u("form",{class:"flex flex-col",onSubmit:s[9]||(s[9]=j((...r)=>t.submitForm&&t.submitForm(...r),["prevent"]))},[t.is2FA?(l(),c(P,{key:0},[i(f,{label:"2FA Code from your Authenticator App",placeholder:"123456",modelValue:o.twoFactorCode,"onUpdate:modelValue":s[0]||(s[0]=r=>o.twoFactorCode=r),required:""},null,8,["modelValue"]),i(m,{class:"mt-4",loading:e.$resources.verify2FA.loading||e.$session.login.loading||e.$resources.resetPassword.loading,variant:"solid",onClick:s[1]||(s[1]=r=>e.$resources.verify2FA.submit({user:o.email,totp_code:o.twoFactorCode}))},{default:a(()=>s[15]||(s[15]=[d(" Verify ")])),_:1},8,["loading"]),i(g,{class:"mt-2",message:e.$resources.verify2FA.error},null,8,["message"])],64)):t.hasForgotPassword?(l(),c(P,{key:1},[i(f,{label:"Email",type:"email",placeholder:"johndoe@mail.com",autocomplete:"email",modelValue:o.email,"onUpdate:modelValue":s[2]||(s[2]=r=>o.email=r),required:""},null,8,["modelValue"]),t.hasForgotPassword?(l(),q(v,{key:0,class:"mt-2 text-sm",to:{name:"Login",query:y(h({},e.$route.query),{forgot:void 0})}},{default:a(()=>s[16]||(s[16]=[d(" I remember my password ")])),_:1},8,["to"])):L("",!0),i(m,{class:"mt-4",loading:e.$resources.resetPassword.loading,variant:"solid"},{default:a(()=>s[17]||(s[17]=[d(" Reset Password ")])),_:1},8,["loading"])],64)):t.isLogin?(l(),c(P,{key:2},[i(f,{label:"Email",placeholder:"johndoe@mail.com",autocomplete:"email",modelValue:o.email,"onUpdate:modelValue":s[3]||(s[3]=r=>o.email=r),disabled:o.otpSent&&!t.usePassword,required:""},null,8,["modelValue","disabled"]),!t.isOauthLogin&&t.usePassword?(l(),c(P,{key:0},[i(f,{class:"mt-4",label:"Password",type:"password",placeholder:"•••••",modelValue:o.password,"onUpdate:modelValue":s[4]||(s[4]=r=>o.password=r),name:"password",autocomplete:"current-password",required:""},null,8,["modelValue"]),u("div",J,[i(v,{class:"text-sm",to:{name:"Login",query:y(h({},e.$route.query),{forgot:1})}},{default:a(()=>s[18]||(s[18]=[d(" Forgot Password? ")])),_:1},8,["to"])]),i(m,{class:"mt-4",variant:"solid",loading:e.$session.login.loading},{default:a(()=>s[19]||(s[19]=[d(" Log In ")])),_:1},8,["loading"])],64)):t.usePassword?(l(),q(m,{key:2,class:"mt-4",variant:"solid"},{default:a(()=>[d(" Log in with "+b(t.oauthProviderName),1)]),_:1})):(l(),c(P,{key:1},[o.otpSent?(l(),c(P,{key:0},[i(f,{class:"mt-4",label:"Verification Code",placeholder:"123456",modelValue:o.otp,"onUpdate:modelValue":s[5]||(s[5]=r=>o.otp=r),required:""},null,8,["modelValue"]),u("div",Q,[i(m,{class:"w-full",loading:e.$resources.verifyOTPAndLogin.loading,variant:"solid",onClick:t.verifyOTPAndLogin},{default:a(()=>s[20]||(s[20]=[d(" Submit verification code ")])),_:1},8,["loading","onClick"]),i(m,{class:"w-full",loading:e.$resources.sendOTP.loading,variant:"outline",disabled:o.otpResendCountdown>0,onClick:s[6]||(s[6]=r=>e.$resources.sendOTP.submit())},{default:a(()=>[d(" Resend verification code "+b(o.otpResendCountdown>0?`in ${o.otpResendCountdown} seconds`:""),1)]),_:1},8,["loading","disabled"])])],64)):(l(),q(m,{key:1,class:"mt-4",loading:e.$resources.sendOTP.loading,variant:"solid",onClick:s[7]||(s[7]=r=>e.$resources.sendOTP.submit())},{default:a(()=>s[21]||(s[21]=[d(" Send verification code ")])),_:1},8,["loading"]))],64)),i(g,{class:"mt-2",message:e.$session.login.error||e.$resources.is2FAEnabled.error||e.$resources.sendOTP.error||e.$resources.verifyOTPAndLogin.error},null,8,["message"])],64)):(l(),c(P,{key:3},[i(f,{label:"Email",type:"email",placeholder:"johndoe@mail.com",autocomplete:"email",modelValue:o.email,"onUpdate:modelValue":s[8]||(s[8]=r=>o.email=r),required:""},null,8,["modelValue"]),i(m,{class:"mt-4",loading:e.$resources.signup.loading,variant:"solid"},{default:a(()=>s[22]||(s[22]=[d(" Sign up with email ")])),_:1},8,["loading"])],64)),i(g,{class:"mt-2",message:t.error},null,8,["message"])],32),!t.hasForgotPassword&&!t.isOauthLogin&&!t.is2FA?(l(),c("div",Z,[s[26]||(s[26]=u("div",{class:"-mb-2 mt-6 border-t text-center"},[u("div",{class:"-translate-y-1/2 transform"},[u("span",{class:"relative bg-white px-2 text-sm font-medium leading-8 text-gray-800"}," Or ")])],-1)),u("div",ee,[t.isLogin&&!t.usePassword?(l(),q(m,{key:0,route:{name:"Login",query:y(h({},e.$route.query),{use_password:1})},"icon-left":"key"},{default:a(()=>s[23]||(s[23]=[d(" Continue with password ")])),_:1},8,["route"])):t.isLogin&&t.usePassword?(l(),q(m,{key:1,route:{name:"Login",query:y(h({},e.$route.query),{use_password:void 0})},"icon-left":"mail"},{default:a(()=>s[24]||(s[24]=[d(" Continue with verification code ")])),_:1},8,["route"])):L("",!0),i(m,{loading:e.$resources.googleLogin.loading,onClick:s[10]||(s[10]=r=>e.$resources.googleLogin.submit())},{default:a(()=>[u("div",se,[i(R,{class:"w-4"}),s[25]||(s[25]=u("span",{class:"ml-2"},"Continue with Google",-1))])]),_:1},8,["loading"])]),o.otpRequested||o.resetPasswordEmailSent?L("",!0):(l(),c("div",oe,[i(v,{class:"text-center text-base font-medium text-gray-900 hover:text-gray-700",to:{name:e.$route.name=="Login"?"Signup":"Login",query:y(h({},e.$route.query),{forgot:void 0})}},{default:a(()=>[d(b(e.$route.name=="Login"?"New member? Create a new account.":"Already have an account? Log in."),1)]),_:1},8,["to"])]))])):L("",!0)]))]),_:2},[t.saasProduct?{name:"logo",fn:a(()=>{var r,_;return[u("div",le,[u("img",{class:"inline-block h-7 w-7 rounded-sm",src:(r=t.saasProduct)==null?void 0:r.logo},null,8,ue),u("span",de,b((_=t.saasProduct)==null?void 0:_.title),1)])]}),key:"0"}:void 0,t.saasProduct?{name:"footer",fn:a(()=>[s[30]||(s[30]=u("div",{class:"mt-2 flex w-full items-center justify-center text-sm text-gray-600"}," Powered by Easytouch Cloud ",-1))]),key:"1"}:void 0]),1032,["title","class"])])])}const we=B(X,[["render",me]]);export{we as default};
//# sourceMappingURL=LoginSignup-4acvh9J8.js.map
