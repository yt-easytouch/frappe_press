import{x as $,r as u,h as p,o as a,a6 as F,w as _,A as i,X as V,Y as b,t as M,q as c,u as h,j as l,a9 as N,B as I,n as v,aA as j,av as z,aJ as E,c7 as L}from"./main-Dpl-JOF2.js";import{_ as O}from"./badge-check-DXteVc7W.js";import{_ as w}from"./Progress.vue_vue_type_script_setup_true_lang-DREy3z5o.js";import{S as Y}from"./SitePlansCards-CxvpWJp2.js";import{_ as q}from"./CardForm-DBdGk3af.js";import{_ as R}from"./BillingDetails-D_ZOfa0J.js";import{_ as U}from"./PrepaidCreditsForm-DIaFhUMJ.js";import"./PlansCards-CiqqQthx.js";import"./stripe.esm-D4yu_pm0.js";import"./StripeLogo-De_iztuU.js";(function(){try{var n=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="80580032-0067-4c7c-ac71-4cbd8ddd0805",n._sentryDebugIdIdentifier="sentry-dbid-80580032-0067-4c7c-ac71-4cbd8ddd0805")}catch(d){}})();{var m=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};m._sentryModuleMetadata=m._sentryModuleMetadata||{},m._sentryModuleMetadata[new Error().stack]=Object.assign({},m._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const T={name:"ManageSitePlansDialog",components:{CardForm:q,Progress:w,SitePlansCards:Y,BillingDetails:R,PrepaidCreditsForm:U},props:{site:{type:String,required:!0}},data(){return{show:!0,plan:null,step:"site-plans",isAutomatedBilling:!0,showAddPaymentModeDialog:!1,showBillingDetailsDialog:!1}},watch:{site:{immediate:!0,handler(n){var e,d;n&&(d=(e=this.$site)==null?void 0:e.doc)!=null&&d.plan&&(this.plan=L(this.$site.doc.plan))}}},methods:{handleNext(){!this.$team.doc.billing_details||!Object.keys(this.$team.doc.billing_details).length?(this.step="billing-details",this.$team.reload()):this.$team.doc.payment_mode?this.changePlan():this.step="add-payment-mode"},changePlan(){return this.$site.setPlan.submit({plan:this.plan.name},{onSuccess:()=>{this.show=!1;let n=E().find(d=>d.name===this.$site.doc.plan),e=n?`${this.$format.planTitle(n)}/mo`:this.$site.doc.plan;this.$toast.success(`Plan changed to ${e}`)}})},paymentModeAdded(){this.$team.reload(),this.show=!1,this.$toast.success("Payment mode added and the plan has been changed successfully"),this.changePlan()}},computed:{$site(){return z("Site",this.site)},showSetupSubscription(){return!this.$team.doc.payment_mode||!this.$team.doc.billing_details||!Object.keys(this.$team.doc.billing_details).length},progressLabel(){if(this.step==="site-plans")return"Select a plan";if(this.step==="billing-details")return"Add billing details";if(this.step==="add-payment-mode")return"Add payment mode"}}},J={key:0},K={class:"mt-4 text-xs text-gray-700"},X={class:"flex items-center rounded bg-gray-50 p-2 text-p-base font-medium text-gray-800"},H={key:1},Q={class:"mb-5 inline-flex gap-1.5 text-base text-gray-700"},W={key:2},Z={class:"mb-5 flex w-full flex-row gap-2 rounded-md border p-1 text-p-base text-gray-800"},G={key:0,class:"mb-5 flex items-center gap-2 text-sm text-gray-700"},ee={key:1,class:"mb-5 flex items-center gap-2 text-sm text-gray-700"};function te(n,e,d,se,t,s){const g=w,S=u("SitePlansCards"),x=O,P=N,f=I,A=u("BillingDetails"),k=u("CardForm"),C=u("PrepaidCreditsForm"),B=V,D=j;return a(),p(D,{options:{title:s.showSetupSubscription?"Setup Subscription":"Change Plan",size:(t.step==="site-plans","3xl")},modelValue:t.show,"onUpdate:modelValue":e[5]||(e[5]=r=>t.show=r)},F({"body-content":_(()=>{var r;return[t.step==="site-plans"?(a(),c("div",J,[s.showSetupSubscription?(a(),p(g,{key:0,class:"my-8",size:"md",label:s.progressLabel,"interval-count":3,intervals:!0,value:32},null,8,["label"])):h("",!0),i(S,{modelValue:t.plan,"onUpdate:modelValue":e[0]||(e[0]=o=>t.plan=o),isPrivateBenchSite:!s.$site.doc.group_public,isDedicatedServerSite:s.$site.doc.is_dedicated_server},null,8,["modelValue","isPrivateBenchSite","isDedicatedServerSite"]),l("div",K,[l("div",X,[i(x,{class:"mr-2 h-5 w-12 text-gray-600"}),e[6]||(e[6]=l("span",null,[l("strong",null,"Support"),b(" covers only issues of Frappe apps and not functional queries. You can raise a support ticket for Frappe Cloud issues for all plans. ")],-1))])]),i(P,{class:"mt-2",message:s.$site.setPlan.error},null,8,["message"])])):t.step==="billing-details"?(a(),c("div",H,[i(g,{class:"my-8",size:"md",label:s.progressLabel,"interval-count":3,intervals:!0,value:65},null,8,["label"]),l("div",Q,[i(f,{class:"h-4",name:"info"}),e[7]||(e[7]=l("span",null," Add billing details to your account before proceeding.",-1))]),i(A,{ref:"billingRef",onSuccess:e[1]||(e[1]=o=>t.step="add-payment-mode")},null,512)])):t.step==="add-payment-mode"?(a(),c("div",W,[i(g,{class:"my-8",label:s.progressLabel,size:"md","interval-count":3,intervals:!0,value:99},null,8,["label"]),l("div",Z,[l("div",{class:v(["w-1/2 cursor-pointer rounded-[7px] py-1.5 text-center transition-all",{"bg-gray-100":t.isAutomatedBilling}]),onClick:e[2]||(e[2]=o=>t.isAutomatedBilling=!0)}," Add Card ",2),l("div",{class:v(["w-1/2 cursor-pointer rounded-sm py-1.5 text-center transition-all",{"bg-gray-100":!t.isAutomatedBilling}]),onClick:e[3]||(e[3]=o=>t.isAutomatedBilling=!1)}," Add Prepaid Credits ",2)]),l("div",null,[t.isAutomatedBilling?(a(),c("div",G,[i(f,{class:"h-4",name:"info"}),e[8]||(e[8]=l("span",null," Adding a card will enable automated billing for your account. You will be charged automatically at the end of your billing cycle. ",-1))])):(a(),c("div",ee,[i(f,{class:"h-4",name:"info"}),e[9]||(e[9]=l("span",null," Adding prepaid credits will allow you to manually recharge your account balance. You can use this balance to pay for your plan. ",-1))]))]),t.isAutomatedBilling?(a(),p(k,{key:0,onSuccess:s.paymentModeAdded,showAddressForm:!1},null,8,["onSuccess"])):(a(),p(C,{key:1,minimumAmount:((r=n.$team.doc)==null?void 0:r.currency)==="INR"?t.plan.price_inr:t.plan.price_usd,onSuccess:s.paymentModeAdded},null,8,["minimumAmount","onSuccess"]))])):h("",!0)]}),_:2},[t.step==="site-plans"?{name:"actions",fn:_(()=>{var r;return[i(B,{variant:"solid",disabled:!t.plan||((r=s.$site)==null?void 0:r.doc)&&t.plan===s.$site.doc.plan,onClick:e[4]||(e[4]=o=>s.handleNext()),class:"w-full"},{default:_(()=>{var o,y;return[b(M(!n.$team.doc.payment_mode||!n.$team.doc.billing_details||!Object.keys(this.$team.doc.billing_details).length?"Next":(y=(o=s.$site.doc)==null?void 0:o.current_plan)!=null&&y.is_trial_plan?"Upgrade Plan":"Change plan"),1)]}),_:1},8,["disabled"])]}),key:"0"}:void 0]),1032,["options","modelValue"])}const pe=$(T,[["render",te]]);export{pe as default};
//# sourceMappingURL=ManageSitePlansDialog-CtmFAF_o.js.map
