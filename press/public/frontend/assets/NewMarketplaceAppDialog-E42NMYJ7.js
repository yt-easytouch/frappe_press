var M=Object.defineProperty,U=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var V=(t,e,s)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_=(t,e)=>{for(var s in e||(e={}))I.call(e,s)&&V(t,s,e[s]);if(w)for(var s of w(e))R.call(e,s)&&V(t,s,e[s]);return t},f=(t,e)=>U(t,E(e));var y=(t,e,s)=>new Promise((d,o)=>{var a=i=>{try{c(s.next(i))}catch(p){o(p)}},r=i=>{try{c(s.throw(i))}catch(p){o(p)}},c=i=>i.done?d(i.value):Promise.resolve(i.value).then(a,r);c((s=s.apply(t,e)).next())});import{x as L,bw as N,c5 as S,r as k,h as A,o as n,w as v,A as l,u as g,j as x,q as u,Y as m,bp as $,B as F,t as B,af as P,a9 as T,aA as j,V as H,aa as q}from"./main-Dpl-JOF2.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="9b4c96b2-0950-476e-9258-92707ab928a1",t._sentryDebugIdIdentifier="sentry-dbid-9b4c96b2-0950-476e-9258-92707ab928a1")}catch(s){}})();{var b=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};b._sentryModuleMetadata=b._sentryModuleMetadata||{},b._sentryModuleMetadata[new Error().stack]=Object.assign({},b._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const z={components:{GitHubAppSelector:S,LinkControl:N},data(){return{show:!0,app:{},selectedBranch:"",selectedVersion:"",appValidated:!1,selectedGithubUser:null,selectedGithubRepository:null}},resources:{validateApp(){return{url:"press.api.github.app",onSuccess:t=>y(this,null,function*(){var a,r;if(this.appValidated=!0,!t)return;const e=(a=this.selectedGithubUser)==null?void 0:a.login,s=this.selectedGithubRepository||t.name,d=`https://github.com/${e}/${s}`;this.app={};const o=yield this.checkRepoVisibility(e,s);this.app={name:t.name,title:t.title,repository_url:d,github_installation_id:(r=this.selectedGithubUser)==null?void 0:r.id,branch:this.selectedBranch.value,is_public:o}})}},addApp(){return{url:"press.api.client.insert",makeParams(){return{doc:f(_({},this.app),{doctype:"Marketplace App",version:this.selectedVersion})}}}}},methods:{addApp(){H.promise(this.$resources.addApp.submit(),{loading:"Adding new app...",success:()=>(this.show=!1,this.$router.push({name:"Marketplace App Detail Listing",params:{name:this.app.name}}),"New app added"),error:t=>q(t)})},validateApp(t){this.selectedBranch={label:t.branch,value:t.branch},this.selectedGithubRepository=t.repository,this.selectedGithubUser=t.selectedGithubUser,this.$resources.validateApp.submit(f(_({},t),{installation:t.selectedGithubUser.id}))},checkRepoVisibility(t,e){return y(this,null,function*(){try{const s=yield fetch(`https://api.github.com/repos/${t}/${e}`);if(!s.ok)throw new Error("Repository not found or private");return!(yield s.json()).private}catch(s){return console.error(s),!1}})}}},K={class:"mt-4 space-y-2"},O={key:0,class:"flex text-base text-gray-700"},Y={key:1,class:"flex text-base text-gray-700"},J={key:0,class:"flex gap-1"},Q={key:1},W={class:"flex text-base text-gray-700 gap-1"},X={key:2,class:"h-4"};function Z(t,e,s,d,o,a){const r=k("GitHubAppSelector"),c=k("LinkControl"),i=$,p=F,D=P,G=T,C=j;return n(),A(C,{options:{title:"Add a new Marketplace App",size:"xl",actions:[{label:"Add App",variant:"solid",disabled:!o.appValidated&&!o.selectedVersion||!this.app.is_public,onClick:a.addApp}]},modelValue:o.show,"onUpdate:modelValue":[e[2]||(e[2]=h=>o.show=h),e[3]||(e[3]=()=>{o.show=!1})]},{"body-content":v(()=>[l(r,{class:"pt-2",onValidateApp:a.validateApp,onFieldChange:e[0]||(e[0]=h=>o.appValidated=!1)},null,8,["onValidateApp"]),o.selectedBranch?(n(),A(c,{key:0,class:"mt-4",type:"autocomplete",label:"Choose Version",options:{doctype:"Frappe Version",filters:{public:1}},modelValue:o.selectedVersion,"onUpdate:modelValue":e[1]||(e[1]=h=>o.selectedVersion=h)},null,8,["modelValue"])):g("",!0),x("div",K,[t.$resources.validateApp.loading&&!o.appValidated?(n(),u("div",O,[l(i,{class:"mr-2 w-4"}),e[4]||(e[4]=m(" Validating app... "))])):g("",!0),o.appValidated?(n(),u("div",Y,[this.app.is_public===!0?(n(),u("div",J,[l(p,{class:"w-4 p-0.5 text-white rounded bg-green-500",name:"check","stroke-width":3}),m(" Found "+B(this.app.title)+" ("+B(this.app.name)+") ",1)])):this.app.is_public===!1?(n(),u("div",Q,[x("div",W,[l(p,{class:"w-4 p-0.5 text-white rounded bg-red-500",name:"x"}),e[6]||(e[6]=m(" The Github Repository is private. ")),l(D,{href:"https://easytouch.cloud/marketplace/terms",class:"font-medium"},{default:v(()=>e[5]||(e[5]=[m(" Terms and Policy ")])),_:1})])])):(n(),u("div",X))])):g("",!0)]),l(G,{message:t.$resources.validateApp.error},null,8,["message"])]),_:1},8,["options","modelValue"])}const se=L(z,[["render",Z]]);export{se as default};
//# sourceMappingURL=NewMarketplaceAppDialog-E42NMYJ7.js.map
