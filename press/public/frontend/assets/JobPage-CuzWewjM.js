var E=Object.defineProperty;var g=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var y=(t,e,s)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,b=(t,e)=>{for(var s in e||(e={}))I.call(e,s)&&y(t,s,e[s]);if(g)for(var s of g(e))B.call(e,s)&&y(t,s,e[s]);return t};import{x as O,B as C,y as S,r as h,q as v,u as p,o as c,h as f,A as i,j as o,w as u,Y as N,X as P,t as d,a5 as V,bZ as F,C as T,F as L,v as M,bY as w,bD as Y}from"./main-Dpl-JOF2.js";import{J as q,_ as z}from"./JobStep-yl8qYLQg.js";import{_ as K}from"./arrow-left-DH4AOn6w.js";import{A as U}from"./AlertAddressableError-BvcXrI8s.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="27b58a73-d905-41a3-8029-89387a3c7d09",t._sentryDebugIdIdentifier="sentry-dbid-27b58a73-d905-41a3-8029-89387a3c7d09")}catch(s){}})();{var m=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};m._sentryModuleMetadata=m._sentryModuleMetadata||{},m._sentryModuleMetadata[new Error().stack]=Object.assign({},m._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const X={name:"JobPage",props:["id","objectType"],components:{Tooltip:S,FeatherIcon:C,JobStep:q,AlertAddressableError:U},resources:{job(){return{type:"document",doctype:"Agent Job",name:this.id,transform(t){var e,s,a;for(let r of t.steps)r.title=r.step_name,r.duration=w(r.duration),r.isOpen=((a=(s=(e=this.job)==null?void 0:e.steps)==null?void 0:s.find(n=>n.name===r.name))==null?void 0:a.isOpen)||!1;return t.status==="Delivery Failure"&&(t.steps[0].output=t.output),t},onSuccess(){this.lastLoaded=Date.now()}}},errors(){return{type:"list",cache:["Press Notification","Error","Agent Job",this.id],doctype:"Press Notification",auto:!0,fields:["title","name"],filters:{document_type:"Agent Job",document_name:this.id,is_actionable:!0,class:"Error"},limit:1,orderBy:"creation desc"}}},computed:{object(){return Y(this.objectType)},job(){return this.$resources.job.doc},error(){var t,e,s;return(s=(e=(t=this.$resources.errors)==null?void 0:t.data)==null?void 0:e[0])!=null?s:null},dropdownOptions(){return[{label:"View in Desk",icon:"external-link",condition:()=>{var t,e;return(e=(t=this.$team)==null?void 0:t.doc)==null?void 0:e.is_desk_user},onClick:()=>{window.open(`${window.location.protocol}//${window.location.host}/app/agent-job/${this.id}`,"_blank")}}].filter(t=>{var e,s;return(s=(e=t.condition)==null?void 0:e.call(t))!=null?s:!0})}},mounted(){this.$socket.emit("doc_subscribe","Agent Job",this.id),this.$socket.on("agent_job_update",t=>{t.id===this.id&&(t.steps=t.steps.map(e=>{var s,a,r;return e.title=e.step_name,e.duration=w(e.duration),e.isOpen=((r=(a=(s=this.job)==null?void 0:s.steps)==null?void 0:a.find(n=>n.name===e.name))==null?void 0:r.isOpen)||!1,e}),this.$resources.job.doc=b(b({},this.$resources.job.doc),t))}),this.reloadInterval=setInterval(()=>{this.reload()},1e3*60)},beforeUnmount(){this.$socket.emit("doc_unsubscribe","Agent Job",this.id),this.$socket.off("agent_job_update"),clearInterval(this.reloadInterval)},methods:{reload(){!this.$resources.job.loading&&Date.now()-this.lastLoaded>5e3&&this.$resources.job.reload()}}},Z={key:0,class:"p-5"},H={class:"mt-3"},Q={class:"flex items-center"},R={class:"text-lg font-medium text-gray-900"},W={class:"ml-auto flex items-center space-x-2"},G={class:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5"},ee={class:"mt-2 text-sm text-gray-900"},te={class:"mt-2 text-sm text-gray-900"},se={class:"mt-2 text-sm text-gray-900"},oe={class:"mt-2 text-sm text-gray-900"},ne={class:"mt-2 text-sm text-gray-900"},re={class:"mt-8 space-y-4"};function ie(t,e,s,a,r,n){const j=h("AlertAddressableError"),x=K,_=P,k=V,A=F,D=z,$=T,J=h("JobStep");return n.job?(c(),v("div",Z,[n.error?(c(),f(j,{key:0,class:"mb-5",name:n.error.name,title:n.error.title,onDone:e[0]||(e[0]=l=>t.$resources.errors.reload())},null,8,["name","title"])):p("",!0),i(_,{route:{name:n.object.doctype==="Site"?"Site Jobs":`${n.object.doctype} Detail Jobs`}},{prefix:u(()=>[i(x,{class:"inline-block h-4 w-4"})]),default:u(()=>[e[2]||(e[2]=N(" All jobs "))]),_:1},8,["route"]),o("div",H,[o("div",null,[o("div",Q,[o("h2",R,d(n.job.job_type),1),i(k,{class:"ml-2",label:n.job.status},null,8,["label"]),o("div",W,[i(_,{onClick:e[1]||(e[1]=l=>t.$resources.job.reload()),loading:t.$resources.job.get.loading},{icon:u(()=>[i(A,{class:"h-4 w-4"})]),_:1},8,["loading"]),n.dropdownOptions.length?(c(),f($,{key:0,options:n.dropdownOptions},{default:u(({open:l})=>[i(_,null,{icon:u(()=>[i(D,{class:"h-4 w-4"})]),_:1})]),_:1},8,["options"])):p("",!0)])]),o("div",null,[o("div",G,[o("div",null,[e[3]||(e[3]=o("div",{class:"text-sm font-medium text-gray-500"},"Creation",-1)),o("div",ee,d(t.$format.date(n.job.creation,"lll")),1)]),o("div",null,[e[4]||(e[4]=o("div",{class:"text-sm font-medium text-gray-500"},"Creator",-1)),o("div",te,d(n.job.owner),1)]),o("div",null,[e[5]||(e[5]=o("div",{class:"text-sm font-medium text-gray-500"},"Duration",-1)),o("div",se,d(n.job.end?t.$format.duration(n.job.duration):"-"),1)]),o("div",null,[e[6]||(e[6]=o("div",{class:"text-sm font-medium text-gray-500"},"Start",-1)),o("div",oe,d(t.$format.date(n.job.start,"lll")),1)]),o("div",null,[e[7]||(e[7]=o("div",{class:"text-sm font-medium text-gray-500"},"End",-1)),o("div",ne,d(n.job.end?t.$format.date(n.job.end,"lll"):"-"),1)])])])]),o("div",re,[(c(!0),v(L,null,M(n.job.steps,l=>(c(),f(J,{step:l,key:l.name},null,8,["step"]))),128))])])])):p("",!0)}const me=O(X,[["render",ie]]);export{me as default};
//# sourceMappingURL=JobPage-CuzWewjM.js.map
