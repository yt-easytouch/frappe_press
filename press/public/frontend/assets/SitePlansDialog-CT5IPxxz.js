var _=(e,a,n)=>new Promise((p,t)=>{var i=s=>{try{l(n.next(s))}catch(r){t(r)}},c=s=>{try{l(n.throw(s))}catch(r){t(r)}},l=s=>s.done?p(s.value):Promise.resolve(s.value).then(i,c);l((n=n.apply(e,a)).next())});import{x as b,h as d,o as u,w as g,u as f,A as y,Y as P,t as w,a9 as D,aA as $}from"./main-Dpl-JOF2.js";import{_ as m}from"./SitePlansTable-BtPUM3i9.js";import{_ as k}from"./Alert-COV4XS8q.js";import{n as v}from"./toast-Dk0nDfLL.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="bfa80ff2-7b71-47a7-b077-4a3261fc286a",e._sentryDebugIdIdentifier="sentry-dbid-bfa80ff2-7b71-47a7-b077-4a3261fc286a")}catch(n){}})();{var o=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};o._sentryModuleMetadata=o._sentryModuleMetadata||{},o._sentryModuleMetadata[new Error().stack]=Object.assign({},o._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const S={name:"SitePlansDialog",props:["site","plan"],components:{SitePlansTable:m},data(){return{selectedPlan:null,validationMessage:null}},watch:{selectedPlan(e){return _(this,null,function*(){if(e)try{let a=yield this.$call("validate_plan_change",{current_plan:this.plan.current_plan,new_plan:e,currency:this.$account.team.currency});this.validationMessage=a}catch(a){this.validationMessage=null}})}},resources:{plans(){var e;return{url:"press.api.site.get_plans",params:{name:(e=this.site)==null?void 0:e.name},initialData:[],auto:!0}},changePlan(){var e,a;return{url:"press.api.site.change_plan",params:{name:(e=this.site)==null?void 0:e.name,plan:(a=this.selectedPlan)==null?void 0:a.name},onSuccess(){v({title:`Plan changed to ${this.selectedPlan.plan_title}`,icon:"check",color:"green"}),this.showChangePlanDialog=!1,this.plan.current_plan=this.selectedPlan,this.selectedPlan=null,this.$resources.plans.reload(),this.$emit("plan-change")}}}},methods:{belowCurrentUsage(e){return this.plan.total_storage_usage>e.max_storage_usage||this.plan.total_database_usage>e.max_database_usage}},computed:{showChangePlanDialog:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},plans(){let e=this.$resources.plans.data.map(a=>(!a.dedicated_server_plan&&this.belowCurrentUsage(a)&&(a.disabled=!0),this.site.status==="Suspended"||this.plan.current_plan.name===a.name&&(a.disabled=!0),a));return this.site.status==="Suspended"&&(e=e.filter(a=>!a.disabled)),e}}};function C(e,a,n,p,t,i){const c=k,l=m,s=D,r=$;return u(),d(r,{options:{title:"Change Plan",size:"3xl",actions:[{label:"Submit",variant:"solid",loading:e.$resources.changePlan.loading,onClick:()=>e.$resources.changePlan.submit()}]}},{"body-content":g(()=>[t.validationMessage?(u(),d(c,{key:0,class:"mt-4",type:"warning",icon:"info"},{default:g(()=>[P(w(t.validationMessage),1)]),_:1})):f("",!0),i.plans?(u(),d(l,{key:1,class:"mt-6",plans:i.plans,selectedPlan:t.selectedPlan,"onUpdate:selectedPlan":a[0]||(a[0]=h=>t.selectedPlan=h)},null,8,["plans","selectedPlan"])):f("",!0),y(s,{class:"mt-4",message:e.$resources.changePlan.error},null,8,["message"])]),_:1},8,["options"])}const E=b(S,[["render",C]]);export{E as default};
//# sourceMappingURL=SitePlansDialog-CT5IPxxz.js.map
