{"version":3,"file":"JobPage-CuzWewjM.js","sources":["../../../../dashboard/src2/pages/JobPage.vue"],"sourcesContent":["<template>\n\t<div class=\"p-5\" v-if=\"job\">\n\t\t<AlertAddressableError\n\t\t\tv-if=\"error\"\n\t\t\tclass=\"mb-5\"\n\t\t\t:name=\"error.name\"\n\t\t\t:title=\"error.title\"\n\t\t\t@done=\"$resources.errors.reload()\"\n\t\t/>\n\t\t<Button\n\t\t\t:route=\"{\n\t\t\t\tname:\n\t\t\t\t\tobject.doctype === 'Site'\n\t\t\t\t\t\t? 'Site Jobs'\n\t\t\t\t\t\t: `${object.doctype} Detail Jobs`,\n\t\t\t}\"\n\t\t>\n\t\t\t<template #prefix>\n\t\t\t\t<i-lucide-arrow-left class=\"inline-block h-4 w-4\" />\n\t\t\t</template>\n\t\t\tAll jobs\n\t\t</Button>\n\n\t\t<div class=\"mt-3\">\n\t\t\t<div>\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<h2 class=\"text-lg font-medium text-gray-900\">{{ job.job_type }}</h2>\n\t\t\t\t\t<Badge class=\"ml-2\" :label=\"job.status\" />\n\t\t\t\t\t<div class=\"ml-auto flex items-center space-x-2\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t@click=\"$resources.job.reload()\"\n\t\t\t\t\t\t\t:loading=\"$resources.job.get.loading\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<i-lucide-refresh-ccw class=\"h-4 w-4\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Dropdown v-if=\"dropdownOptions.length\" :options=\"dropdownOptions\">\n\t\t\t\t\t\t\t<template v-slot=\"{ open }\">\n\t\t\t\t\t\t\t\t<Button>\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<i-lucide-more-horizontal class=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</Dropdown>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-500\">Creation</div>\n\t\t\t\t\t\t\t<div class=\"mt-2 text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t{{ $format.date(job.creation, 'lll') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-500\">Creator</div>\n\t\t\t\t\t\t\t<div class=\"mt-2 text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t{{ job.owner }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-500\">Duration</div>\n\t\t\t\t\t\t\t<div class=\"mt-2 text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t{{ job.end ? $format.duration(job.duration) : '-' }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-500\">Start</div>\n\t\t\t\t\t\t\t<div class=\"mt-2 text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t{{ $format.date(job.start, 'lll') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-500\">End</div>\n\t\t\t\t\t\t\t<div class=\"mt-2 text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t{{ job.end ? $format.date(job.end, 'lll') : '-' }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"mt-8 space-y-4\">\n\t\t\t\t<JobStep v-for=\"step in job.steps\" :step=\"step\" :key=\"step.name\" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script>\nimport { FeatherIcon, Tooltip } from 'frappe-ui';\nimport AlertAddressableError from '../components/AlertAddressableError.vue';\nimport { duration } from '../utils/format';\nimport { getObject } from '../objects';\nimport JobStep from '../components/JobStep.vue';\n\nexport default {\n\tname: 'JobPage',\n\tprops: ['id', 'objectType'],\n\tcomponents: { Tooltip, FeatherIcon, JobStep, AlertAddressableError },\n\tresources: {\n\t\tjob() {\n\t\t\treturn {\n\t\t\t\ttype: 'document',\n\t\t\t\tdoctype: 'Agent Job',\n\t\t\t\tname: this.id,\n\t\t\t\ttransform(job) {\n\t\t\t\t\tfor (let step of job.steps) {\n\t\t\t\t\t\tstep.title = step.step_name;\n\t\t\t\t\t\tstep.duration = duration(step.duration);\n\t\t\t\t\t\tstep.isOpen =\n\t\t\t\t\t\t\tthis.job?.steps?.find((s) => s.name === step.name)?.isOpen ||\n\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t}\n\n\t\t\t\t\t// on delivery failure, there'll be no output for any step\n\t\t\t\t\t// so show the job output (error) in the first step\n\t\t\t\t\tif (job.status === 'Delivery Failure') {\n\t\t\t\t\t\tjob.steps[0].output = job.output;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn job;\n\t\t\t\t},\n\t\t\t\tonSuccess() {\n\t\t\t\t\tthis.lastLoaded = Date.now();\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\terrors() {\n\t\t\treturn {\n\t\t\t\ttype: 'list',\n\t\t\t\tcache: ['Press Notification', 'Error', 'Agent Job', this.id],\n\t\t\t\tdoctype: 'Press Notification',\n\t\t\t\tauto: true,\n\t\t\t\tfields: ['title', 'name'],\n\t\t\t\tfilters: {\n\t\t\t\t\tdocument_type: 'Agent Job',\n\t\t\t\t\tdocument_name: this.id,\n\t\t\t\t\tis_actionable: true,\n\t\t\t\t\tclass: 'Error',\n\t\t\t\t},\n\t\t\t\tlimit: 1,\n\t\t\t\torderBy: 'creation desc',\n\t\t\t};\n\t\t},\n\t},\n\tcomputed: {\n\t\tobject() {\n\t\t\treturn getObject(this.objectType);\n\t\t},\n\t\tjob() {\n\t\t\treturn this.$resources.job.doc;\n\t\t},\n\t\terror() {\n\t\t\treturn this.$resources.errors?.data?.[0] ?? null;\n\t\t},\n\t\tdropdownOptions() {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'View in Desk',\n\t\t\t\t\ticon: 'external-link',\n\t\t\t\t\tcondition: () => this.$team?.doc?.is_desk_user,\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t`${window.location.protocol}//${window.location.host}/app/agent-job/${this.id}`,\n\t\t\t\t\t\t\t'_blank',\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter((option) => option.condition?.() ?? true);\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.$socket.emit('doc_subscribe', 'Agent Job', this.id);\n\t\tthis.$socket.on('agent_job_update', (data) => {\n\t\t\tif (data.id === this.id) {\n\t\t\t\tdata.steps = data.steps.map((step) => {\n\t\t\t\t\tstep.title = step.step_name;\n\t\t\t\t\tstep.duration = duration(step.duration);\n\t\t\t\t\tstep.isOpen =\n\t\t\t\t\t\tthis.job?.steps?.find((s) => s.name === step.name)?.isOpen || false;\n\t\t\t\t\treturn step;\n\t\t\t\t});\n\n\t\t\t\tthis.$resources.job.doc = {\n\t\t\t\t\t...this.$resources.job.doc,\n\t\t\t\t\t...data,\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// reload job every minute, in case socket is not working\n\t\tthis.reloadInterval = setInterval(() => {\n\t\t\tthis.reload();\n\t\t}, 1000 * 60);\n\t},\n\tbeforeUnmount() {\n\t\tthis.$socket.emit('doc_unsubscribe', 'Agent Job', this.id);\n\t\tthis.$socket.off('agent_job_update');\n\t\tclearInterval(this.reloadInterval);\n\t},\n\tmethods: {\n\t\treload() {\n\t\t\tif (\n\t\t\t\t!this.$resources.job.loading &&\n\t\t\t\t// reload if job was loaded more than 5 seconds ago\n\t\t\t\tDate.now() - this.lastLoaded > 5000\n\t\t\t) {\n\t\t\t\tthis.$resources.job.reload();\n\t\t\t}\n\t\t},\n\t},\n};\n</script>\n"],"names":["_sfc_main","Tooltip","FeatherIcon","JobStep","AlertAddressableError","job","step","duration","getObject","_c","_b","_a","data","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_openBlock","_createElementBlock","_hoisted_1","_cache","$event","_ctx","_createCommentVNode","$options","_withCtx","_createTextVNode","_createElementVNode","_toDisplayString","_Fragment","_renderList"],"mappings":"qzCAmGA,MAAAA,EAAA,CACC,KAAA,oCAEA,WAAA,CAAA,QAAAC,EAAA,YAAAC,EAAA,QAAAC,EAAA,sBAAAC,CAAA,mBAGE,MAAA,CACC,KAAA,WACA,QAAA,yBAEA,UAAAC,EAAA,oDAGEC,EAAA,SAAAC,EAAAD,EAAA,QAAA,yHAQD,OAAAD,EAAA,SAAA,qBACCA,EAAA,MAAA,CAAA,EAAA,OAAAA,EAAA,QAGDA,6CAOH,QAAA,CACC,MAAA,mGAIC,KAAA,2BAEA,QAAA,2BAEC,cAAA,KAAA,GACA,cAAA,kBAGD,MAAA,6BAKH,SAAA,CACC,QAAA,CACC,OAAAG,EAAA,KAAA,UAAA,yCAKD,OAAA,WACC,OAAAC,GAAAC,GAAAC,EAAA,KAAA,WAAA,SAAA,YAAAA,EAAA,OAAA,YAAAD,EAAA,KAAA,KAAAD,EAAA,MAED,iBAAA,CACC,MAAA,CACC,CACC,MAAA,eACA,KAAA,gBACA,UAAA,IAAA,SAAA,OAAAC,GAAAC,EAAA,KAAA,QAAA,YAAAA,EAAA,MAAA,YAAAD,EAAA,uCAGE,GAAA,OAAA,SAAA,QAAA,KAAA,OAAA,SAAA,IAAA,kBAAA,KAAA,EAAA,GACA,gGAON,SAAA,wDAEC,KAAA,QAAA,GAAA,mBAAAE,GAAA,CACCA,EAAA,KAAA,KAAA,KACCA,EAAA,MAAAA,EAAA,MAAA,IAAAN,GAAA,sCAECA,EAAA,SAAAC,EAAAD,EAAA,QAAA,0HAID,CAAA,0DAICM,GAGH,CAAA,EAEA,KAAA,eAAA,YAAA,IAAA,yBAID,eAAA,0DAEC,KAAA,QAAA,IAAA,kBAAA,EACA,cAAA,KAAA,cAAA,GAED,QAAA,CACC,QAAA,+BAIE,KAAA,IAAA,EAAA,KAAA,WAAA,mCAMJ,WArNM,MAAA,OAsBCC,EAAA,CAAA,MAAA,MAAA,EAEEC,EAAA,CAAA,MAAA,mBAAA,EACAC,EAAA,CAAA,MAAA,mCAAA,EAECC,EAAA,CAAA,MAAA,qCAAA,EAsBJC,EAAA,CAAA,MAAA,2DAAA,EAIMC,GAAA,CAAA,MAAA,4BAAA,EAMAC,GAAA,CAAA,MAAA,4BAAA,EAMAC,GAAA,CAAA,MAAA,4BAAA,EAMAC,GAAA,CAAA,MAAA,4BAAA,EAMAC,GAAA,CAAA,MAAA,4BAAA,EAQJC,GAAA,CAAA,MAAA,gBAAA,mHArFPC,IAAAC,EAAA,MAAAC,EAAA,yBAGE,MAAA,6CAGC,OAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAC,EAAA,WAAA,OAAA,OAAA,8BAPJC,EAAA,GAAA,EAAA,mBAU4BC,EAAA,OAAA,UAAA,mBAAyD,GAAAA,EAAA,OAAA,OAAA,kBAOvE,OAAAC,EAAA,IAAA,uCAjBd,QAAAA,EAAA,IAAA,CAAAL,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAM,EAAA,YAAA,uBAuBEC,EAAA,MAAArB,EAAA,eAEEqB,EAAA,MAAApB,EAAA,CACCoB,EAAA,KAAAnB,EAAAoB,EAAAJ,EAAA,IAAA,QAAA,EAAA,CAAA,OACO,MAAA,6CACPG,EAAA,MAAAlB,EAAA,MAEG,QAAAW,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAC,EAAA,WAAA,IAAA,OAAA,GACA,QAAAA,EAAA,WAAA,IAAA,IAAA,UAEU,KAAAG,EAAA,IAAA,8CAIID,EAAA,gBAAA,uBAAyB,QAAAA,EAAA,mDAG3B,KAAAC,EAAA,IAAA,uDAxCpBF,EAAA,GAAA,EAAA,oBAiDKI,EAAA,MAAAjB,EAAA,eAIEU,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAO,EAAA,MAAA,CAAA,MAAA,mCAAA,EAAA,WAAA,EAAA,yEAMAP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAO,EAAA,MAAA,CAAA,MAAA,mCAAA,EAAA,UAAA,EAAA,GACAA,EAAA,MAAAf,GAAAgB,EAAAJ,EAAA,IAAA,KAAA,EAAA,CAAA,kBAKAJ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAO,EAAA,MAAA,CAAA,MAAA,mCAAA,EAAA,WAAA,EAAA,GACAA,EAAA,MAAAd,GAAAe,EAAAJ,EAAA,IAAA,IAAAF,EAAA,QAAA,SAAAE,EAAA,IAAA,QAAA,EAAA,GAAA,EAAA,CAAA,kBAKAJ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAO,EAAA,MAAA,CAAA,MAAA,mCAAA,EAAA,QAAA,EAAA,sEAMAP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAO,EAAA,MAAA,CAAA,MAAA,mCAAA,EAAA,MAAA,EAAA,GACAA,EAAA,MAAAZ,GAAAa,EAAAJ,EAAA,IAAA,IAAAF,EAAA,QAAA,KAAAE,EAAA,IAAA,IAAA,KAAA,EAAA,GAAA,EAAA,CAAA,UAQJG,EAAA,MAAAX,GAAA,EACCC,EAAA,EAAA,EAAAC,EAAAW,EAAA,KAAAC,EAAAN,EAAA,IAAA,MAAAzB,aAAoC,KAAAA,8CAvFxCwB,EAAA,GAAA,EAAA"}