import{x as p,h as f,o as u,w as y,j as d,t as c,aA as g,an as _,r as m,q as h,A as D,u as b}from"./main-Dpl-JOF2.js";import{P as x}from"./PerformanceReport-uZO_IyE8.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0b716c25-d674-4ceb-ae29-c5d83762cbe1",e._sentryDebugIdIdentifier="sentry-dbid-0b716c25-d674-4ceb-ae29-c5d83762cbe1")}catch(s){}})();{var a=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};a._sentryModuleMetadata=a._sentryModuleMetadata||{},a._sentryModuleMetadata[new Error().stack]=Object.assign({},a._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const Q={props:["query","duration"]},S={class:"mt-2 whitespace-pre-wrap rounded-lg border-2 border-gray-200 bg-gray-100 p-3 text-sm text-gray-700"},T={class:"mt-2 flex text-sm"},q={class:"ml-auto"};function V(e,t,s,n,o,r){const i=g;return u(),f(i,{options:{title:"Normalized Query",size:"2xl"},modelValue:e.show,"onUpdate:modelValue":t[0]||(t[0]=l=>e.show=l)},{"body-content":y(()=>[d("pre",S,c(s.query),1),d("div",T,[d("span",q,"Duration: "+c(s.duration.toFixed(2))+" seconds",1)])]),_:1},8,["modelValue"])}const k=p(Q,[["render",V]]),R={props:["name","siteVersion"],components:{PerformanceReport:x,AlertBanner:_,SiteSlowQueryDialog:k},data(){return{show:!1,selectedQuery:"",selectedQueryDuration:0}},computed:{slowQueriesOptions(){return{experimental:!0,documentation:"https://easytouch.cloud/docs/performance-tuning",data:()=>this.$resources.slowQueries.data.data,onRowClick:e=>{this.selectedQuery=e.query,this.selectedQueryDuration=e.duration,this.show=!0},emptyStateMessage:"No slow queries found",columns:[{label:"Query",fieldname:"query",class:"font-mono",width:"600px"},{label:"Duration",fieldname:"duration",class:"text-gray-600",width:.3,align:"right",format:e=>e.toFixed(2)},{label:"Rows Examined",fieldname:"rows_examined",class:"text-gray-600",align:"right",width:.3},{label:"Rows Sent",fieldname:"rows_sent",class:"text-gray-600",align:"right",width:.3},{label:"Count",fieldname:"count",class:"text-gray-600",align:"right",width:.3}],actions:()=>[{label:"Refresh",icon:"refresh-ccw",loading:this.$resources.slowQueries.loading,onClick:()=>this.$resources.slowQueries.reload()}]}}},methods:{getDateTimeRange(){const e=r=>this.$dayjs(r).format("YYYY-MM-DD HH:mm:ss"),t=new Date,s=new Date(t.getTime()-24*60*60*1e3),n=e(t);return{startDateTime:e(s),endDateTime:n}}},resources:{slowQueries(){const{startDateTime:e,endDateTime:t}=this.getDateTimeRange();return{url:"press.api.analytics.mariadb_slow_queries",params:{name:this.name,start_datetime:e,stop_datetime:t,max_lines:10,search_pattern:".*",normalize_queries:!0,analyze:!1},auto:!0,initialData:{columns:[],data:[]}}}}};function B(e,t,s,n,o,r){const i=m("PerformanceReport"),l=m("SiteSlowQueryDialog");return u(),h("div",null,[D(i,{title:"Slow Queries",site:s.name,reportOptions:r.slowQueriesOptions},null,8,["site","reportOptions"]),o.show?(u(),f(l,{key:0,modelValue:o.show,"onUpdate:modelValue":t[0]||(t[0]=w=>o.show=w),query:o.selectedQuery,duration:o.selectedQueryDuration},null,8,["modelValue","query","duration"])):b("",!0)])}const v=p(R,[["render",B]]);export{v as default};
//# sourceMappingURL=SiteSlowQueries-De1_xzgx.js.map
