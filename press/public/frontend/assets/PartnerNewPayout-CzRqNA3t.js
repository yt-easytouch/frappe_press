var u=(t,e,l)=>new Promise((P,s)=>{var n=r=>{try{c(l.next(r))}catch(m){s(m)}},h=r=>{try{c(l.throw(r))}catch(m){s(m)}},c=r=>r.done?P(r.value):Promise.resolve(r.value).then(n,h);c((l=l.apply(t,e)).next())});import{x as T,ao as S,am as D,ar as V,X as x,B as G,r as _,q as g,o as b,j as a,A as o,w,u as v,a8 as F,Y as I,t as p,ai as y,V as f}from"./main-Dpl-JOF2.js";import{_ as N}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CH7TZuXP.js";import{_ as k}from"./Header-BNMc-OFG.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="6b5f52c0-cfee-44e5-92aa-d07a183dbe28",t._sentryDebugIdIdentifier="sentry-dbid-6b5f52c0-cfee-44e5-92aa-d07a183dbe28")}catch(l){}})();{var d=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};d._sentryModuleMetadata=d._sentryModuleMetadata||{},d._sentryModuleMetadata[new Error().stack]=Object.assign({},d._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const A={components:{FeatherIcon:G,Button:x,Autocomplete:V,Badge:D,ObjectList:S,FBreadcrumbs:N,Header:k},data(){return{partnerInput:"",paymentGateway:"",partnerCommission:0,from_date:new Date().toISOString().split("T")[0],to_date:new Date().toISOString().split("T")[0],reconciliationInProgress:!1,fetchPayoutTransactions:!1,partners:[],paymentGateways:[],transactions:[],paymentPayout:[]}},computed:{total_amount(){return this.transactions.reduce((t,e)=>t+e.amount,0)},commission(){return this.total_amount*this.partnerCommission/100},net_amount(){return this.total_amount-this.commission},transactionOptions(){return{columns:[{label:"Transaction ID",fieldname:"name"},{label:"Amount (USD)",fieldname:"amount",format:t=>this.formatCurrency(t)},{label:"Posting Date",fieldname:"posting_date",format:t=>Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(t))}],data:()=>this.transactions,emptyStateText:"No transactions fetched"}},breadcrumbs(){return[{label:"Partner Payment Payout",route:"/partners/payment-payout"},{label:"New Payment Payout",route:"/payment-payout/New"}]}},resources:{submitPaymentPayouts(){return{url:"press.press.doctype.partner_payment_payout.partner_payment_payout.submit_payment_payout",params:{partner:this.partnerInput.value,payment_gateway:this.paymentGateway.value,from_date:this.from_date,to_date:this.to_date,partner_commission:this.partnerCommission,transactions:this.transactions}}},fetchTransactions(){return{url:"press.api.partner.fetch_payment_transactions",debounce:300,onSuccess:t=>{t&&(this.docname=t.name,this.doc=t)}}},submitResource(){return{params:{doctype:"Partner Payment Payout",name:this.docname}}}},methods:{onSubmitPayout(){return u(this,null,function*(){this.reconciliationInProgress=!0;try{if(!this.partnerInput||!this.paymentGateway||this.transactions.length===0){f.error("Please select partner, payment gateway and fetch transactions first");return}(yield this.$resources.submitPaymentPayouts.submit({partner:this.partnerInput.value,payment_gateway:this.paymentGateway.value,from_date:this.from_date,to_date:this.to_date,partner_commission:this.partnerCommission,transactions:this.transactions}))&&f.success("Payout Submitted Successfully!",{duration:1e3,onAutoClose:()=>{this.$router.push({name:"PartnerPayout"})}})}catch(t){f.error(t.message||"Failed to submit payout")}finally{this.reconciliationInProgress=!1}})},fetchTransactions(){return u(this,null,function*(){if(this.fetchPayoutTransactions=!0,!this.partnerInput||!this.paymentGateway)return"Please fill required values";const t=yield y({url:"press.api.regional_payments.mpesa.utils.fetch_payments",method:"GET",params:{partner:this.partnerInput.value,payment_gateway:this.paymentGateway.value,from_date:this.from_date,to_date:this.to_date}});t.length>0?(this.transactions=t||[],this.fetchPayoutTransactions=!1):f.info("No transactions found")})},submitPayout(){this.submitResource.submit()},resetForm(){this.partnerInput="",this.paymentGateway="",this.transactions=[]},fetchPartners(){return u(this,null,function*(){try{const t=yield y({url:"press.api.regional_payments.mpesa.utils.display_mpesa_payment_partners",method:"GET"});Array.isArray(t)?this.partners=t:console.log("No Data")}catch(t){this.errorMessage=`Failed to fetch teams ${t.message}`}})},fetchPaymentGateways(){return u(this,null,function*(){try{const t=yield y({url:"press.api.regional_payments.mpesa.utils.display_payment_gateways",method:"GET",params:{payment_partner:this.partnerInput.value}});Array.isArray(t)?this.paymentGateways=t:console.log("No Data")}catch(t){this.errorMessage=`Failed to fetch teams ${t.message}`}})},fetchPercentageCommission(){return u(this,null,function*(){try{const t=yield y({url:"/api/method/press.api.regional_payments.mpesa.utils.fetch_percentage_commission",method:"GET",params:{partner:this.partnerInput.value}});t?this.partnerCommission=t:console.log("No Data")}catch(t){this.errorMessage=`Failed to fetch teams ${t.message}`}})},formatCurrency(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},formatDate(t){return new Date(t).toLocaleDateString()}},mounted(){this.fetchPartners()},watch:{partnerInput(){this.fetchPaymentGateways(),this.fetchPercentageCommission()}}},B={class:"sticky top-0 z-10 shrink-0"},E={class:"mx-5"},O={class:"pt-[20px]"},U={class:"bg-white rounded-lg shadow p-4 mb-6"},j={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},z={class:"flex justify-end mt-4 space-x-2"},M={key:0,class:"bg-white rounded-lg shadow p-4 mb-6"},L={key:1,class:"bg-white rounded-lg shadow p-4 mb-6"},q={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},H={class:"bg-gray-50 p-3 rounded"},R={class:"text-xl font-semibold"},K={class:"bg-gray-50 p-3 rounded"},X={class:"text-sm text-gray-500"},Y={class:"text-xl font-semibold"},J={class:"bg-gray-50 p-3 rounded"},Q={class:"text-xl font-semibold"};function W(t,e,l,P,s,n){const h=_("FBreadcrumbs"),c=_("Header"),r=F,m=x,C=_("ObjectList");return b(),g("div",null,[a("div",B,[o(c,null,{default:w(()=>[o(h,{items:n.breadcrumbs},null,8,["items"])]),_:1})]),a("div",E,[a("div",O,[a("div",U,[e[6]||(e[6]=a("h2",{class:"text-lg mb-4"},"Filters",-1)),a("div",j,[a("div",null,[o(r,{type:"autocomplete",options:s.partners,size:"sm",variant:"subtle",placeholder:"Select Partner",disabled:!1,label:"Partner",modelValue:s.partnerInput,"onUpdate:modelValue":e[0]||(e[0]=i=>s.partnerInput=i),class:"mb-5"},null,8,["options","modelValue"])]),a("div",null,[o(r,{type:"autocomplete",options:s.paymentGateways,size:"sm",variant:"subtle",placeholder:"Select Gateway",label:"Payment Gateway",modelValue:s.paymentGateway,"onUpdate:modelValue":e[1]||(e[1]=i=>s.paymentGateway=i),class:"mb-5"},null,8,["options","modelValue"])]),a("div",null,[o(r,{type:"date",size:"sm",variant:"subtle",label:"From date",modelValue:s.from_date,"onUpdate:modelValue":e[2]||(e[2]=i=>s.from_date=i),class:"mb-5"},null,8,["modelValue"])]),a("div",null,[o(r,{type:"date",size:"sm",variant:"subtle",label:"To date",modelValue:s.to_date,"onUpdate:modelValue":e[3]||(e[3]=i=>s.to_date=i),class:"mb-5"},null,8,["modelValue"])])]),a("div",z,[o(m,{variant:"solid",onClick:n.fetchTransactions,loading:s.fetchPayoutTransactions},{default:w(()=>e[4]||(e[4]=[I(" Fetch Transactions ")])),_:1},8,["onClick","loading"]),o(m,{variant:"subtle",onClick:n.onSubmitPayout,loading:s.reconciliationInProgress},{default:w(()=>e[5]||(e[5]=[I(" Submit Payout ")])),_:1},8,["onClick","loading"])])])]),s.transactions.length>0?(b(),g("div",M,[e[7]||(e[7]=a("h2",{class:"text-lg mb-4"},"Fetched Transactions",-1)),o(C,{options:n.transactionOptions},null,8,["options"])])):v("",!0),s.transactions.length>0?(b(),g("div",L,[e[10]||(e[10]=a("h2",{class:"text-lg mb-4"},"Summary",-1)),a("div",q,[a("div",H,[e[8]||(e[8]=a("div",{class:"text-sm text-gray-500"},"Total Amount",-1)),a("div",R,p(n.formatCurrency(n.total_amount)),1)]),a("div",K,[a("div",X," Commission ("+p(s.partnerCommission)+"%) ",1),a("div",Y,p(n.formatCurrency(n.commission)),1)]),a("div",J,[e[9]||(e[9]=a("div",{class:"text-sm text-gray-500"},"Net Amount",-1)),a("div",Q,p(n.formatCurrency(n.net_amount)),1)])])])):v("",!0)])])}const at=T(A,[["render",W]]);export{at as default};
//# sourceMappingURL=PartnerNewPayout-CzRqNA3t.js.map
