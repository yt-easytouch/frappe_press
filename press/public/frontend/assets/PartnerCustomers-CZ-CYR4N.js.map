{"version":3,"file":"PartnerCustomers-CZ-CYR4N.js","sources":["../../../../dashboard/src2/components/partners/PartnerCustomerInvoices.vue","../../../../dashboard/src2/components/partners/PartnerCustomers.vue"],"sourcesContent":["<template>\n\t<div>\n\t\t<ObjectList :options=\"options\" />\n\t</div>\n</template>\n<script>\nimport ObjectList from '../ObjectList.vue';\nimport { currency } from '../../utils/format';\nimport dayjs from '../../utils/dayjs';\n\nexport default {\n\tname: 'PartnerCustomerInvoices',\n\tprops: ['customerTeam', 'customerCurrency'],\n\tcomponents: {\n\t\tObjectList\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tteam: this.customerTeam,\n\t\t\tcurrency: this.customerCurrency\n\t\t};\n\t},\n\tcomputed: {\n\t\toptions() {\n\t\t\treturn {\n\t\t\t\tdoctype: 'Invoice',\n\t\t\t\tfields: ['type'],\n\t\t\t\tcolumns: [\n\t\t\t\t\t{ label: 'Invoice', fieldname: 'name' },\n\t\t\t\t\t{ label: 'Status', fieldname: 'status', type: 'Badge' },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Date',\n\t\t\t\t\t\tfieldname: 'due_date',\n\t\t\t\t\t\tformat(value) {\n\t\t\t\t\t\t\treturn Intl.DateTimeFormat('en-US', {\n\t\t\t\t\t\t\t\tyear: 'numeric',\n\t\t\t\t\t\t\t\tmonth: 'short',\n\t\t\t\t\t\t\t\tday: 'numeric'\n\t\t\t\t\t\t\t}).format(new Date(value));\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{ label: 'Total', fieldname: 'total', format: this.formatCurrency },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Amount Due',\n\t\t\t\t\t\tfieldname: 'amount_due',\n\t\t\t\t\t\tformat: this.formatCurrency\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tfilters: {\n\t\t\t\t\tteam: this.team,\n\t\t\t\t\tdue_date: [\n\t\t\t\t\t\t'>=',\n\t\t\t\t\t\tdayjs().subtract(5, 'month').endOf('month').format('YYYY-MM-DD')\n\t\t\t\t\t],\n\t\t\t\t\tpartner_customer: true\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\tmethods: {\n\t\tformatCurrency(value) {\n\t\t\tif (value === 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\treturn currency(value, this.currency);\n\t\t}\n\t}\n};\n</script>\n","<template>\n\t<div class=\"p-4\">\n\t\t<ObjectList :options=\"partnerCustomerList\" />\n\t\t<Dialog\n\t\t\tv-model=\"contributionDialog\"\n\t\t\t:options=\"{\n\t\t\t\tsize: '3xl',\n\t\t\t\ttitle: 'Last 6 Month\\'s Contribution'\n\t\t\t}\"\n\t\t>\n\t\t\t<template #body-content>\n\t\t\t\t<template v-if=\"showInvoice\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showInvoice.status === 'Empty'\"\n\t\t\t\t\t\tclass=\"text-base text-gray-600\"\n\t\t\t\t\t>\n\t\t\t\t\t\tNothing to show\n\t\t\t\t\t</div>\n\t\t\t\t\t<PartnerCustomerInvoices\n\t\t\t\t\t\t:customerTeam=\"showInvoice.name\"\n\t\t\t\t\t\t:customerCurrency=\"showInvoice.currency\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t</Dialog>\n\t\t<Dialog\n\t\t\tv-model=\"transferCreditsDialog\"\n\t\t\t:options=\"{ title: 'Transfer Credits' }\"\n\t\t>\n\t\t\t<template #body-content>\n\t\t\t\t<p class=\"pb-3 text-p-base\">\n\t\t\t\t\tEnter the equivalent amount of credits (in {{ $team.doc.currency }})\n\t\t\t\t\tyou wish to transfer.\n\t\t\t\t</p>\n\t\t\t\t<FormControl placeholder=\"Amount\" v-model=\"amount\" autocomplete=\"off\" />\n\t\t\t\t<ErrorMessage\n\t\t\t\t\tclass=\"mt-2\"\n\t\t\t\t\t:message=\"$resources.transferCredits.error\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #actions>\n\t\t\t\t<Button\n\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t:loading=\"$resources.transferCredits.loading\"\n\t\t\t\t\t@click=\"\n\t\t\t\t\t\t$resources.transferCredits.submit({\n\t\t\t\t\t\t\tamount: amount,\n\t\t\t\t\t\t\tcustomer: customerTeam.name,\n\t\t\t\t\t\t\tpartner: $team.doc.name\n\t\t\t\t\t\t})\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\tTransfer\n\t\t\t\t</Button>\n\t\t\t</template>\n\t\t</Dialog>\n\t\t<Dialog\n\t\t\tv-model=\"showConfirmationDialog\"\n\t\t\t:options=\"{ title: 'Credits Transferred Successfully' }\"\n\t\t>\n\t\t\t<template #body-content>\n\t\t\t\t<p class=\"text-p-base\">\n\t\t\t\t\t{{ formatCurrency(amount) }} credits have been transferred to\n\t\t\t\t\t<strong>{{ customerTeam.billing_name }}</strong>\n\t\t\t\t</p>\n\t\t\t\t<span class=\"text-base font-medium text-gray-700\"\n\t\t\t\t\t>Credits available: {{ creditBalance() }}</span\n\t\t\t\t>\n\t\t\t</template>\n\t\t</Dialog>\n\t</div>\n</template>\n<script>\nimport PartnerCustomerInvoices from './PartnerCustomerInvoices.vue';\nimport ObjectList from '../ObjectList.vue';\nimport { Dialog, ErrorMessage } from 'frappe-ui';\nimport { toast } from 'vue-sonner';\nimport { userCurrency } from '../../utils/format';\n\nexport default {\n\tname: 'PartnerCustomers',\n\tcomponents: {\n\t\tPartnerCustomerInvoices,\n\t\tDialog,\n\t\tErrorMessage,\n\t\tObjectList\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tcontributionDialog: false,\n\t\t\tshowInvoice: null,\n\t\t\ttransferCreditsDialog: false,\n\t\t\tcustomerTeam: null,\n\t\t\tamount: 0.0,\n\t\t\tshowConfirmationDialog: false\n\t\t};\n\t},\n\tresources: {\n\t\ttransferCredits() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.partner.transfer_credits',\n\t\t\t\tonSuccess(data) {\n\t\t\t\t\tthis.amount = data;\n\t\t\t\t\tthis.transferCreditsDialog = false;\n\t\t\t\t\tthis.showConfirmationDialog = true;\n\t\t\t\t\ttoast.success('Credits Transferred');\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tgetBalance: {\n\t\t\turl: 'press.api.billing.get_balance_credit',\n\t\t\tauto: true\n\t\t}\n\t},\n\tcomputed: {\n\t\tpartnerCustomerList() {\n\t\t\treturn {\n\t\t\t\tresource() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl: 'press.api.partner.get_partner_customers',\n\t\t\t\t\t\ttransform(data) {\n\t\t\t\t\t\t\treturn data.map(d => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\temail: d.user,\n\t\t\t\t\t\t\t\t\tbilling_name: d.billing_name || '',\n\t\t\t\t\t\t\t\t\tpayment_mode: d.payment_mode || '',\n\t\t\t\t\t\t\t\t\tcurrency: d.currency,\n\t\t\t\t\t\t\t\t\tname: d.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinitialData: [],\n\t\t\t\t\t\tauto: true\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcolumns: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Name',\n\t\t\t\t\t\tfieldname: 'billing_name'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Email',\n\t\t\t\t\t\tfieldname: 'email'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Payment Mode',\n\t\t\t\t\t\tfieldname: 'payment_mode'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Currency',\n\t\t\t\t\t\tfieldname: 'currency',\n\t\t\t\t\t\twidth: 0.5\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Contributions',\n\t\t\t\t\t\ttype: 'Button',\n\t\t\t\t\t\twidth: 0.5,\n\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\tButton: ({ row }) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tlabel: 'View',\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\tthis.showInvoice = row;\n\t\t\t\t\t\t\t\t\tthis.contributionDialog = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\ttype: 'Button',\n\t\t\t\t\t\twidth: 0.8,\n\t\t\t\t\t\talign: 'right',\n\t\t\t\t\t\tkey: 'actions',\n\t\t\t\t\t\tButton: ({ row }) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tlabel: 'Transfer Credits',\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\tthis.transferCreditsDialog = true;\n\t\t\t\t\t\t\t\t\tthis.customerTeam = row;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\t},\n\tmethods: {\n\t\tformatCurrency(value) {\n\t\t\tif (value === 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\treturn userCurrency(value);\n\t\t},\n\t\tcreditBalance() {\n\t\t\treturn this.formatCurrency(\n\t\t\t\tparseFloat(this.$resources.getBalance.data) - parseFloat(this.amount)\n\t\t\t);\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","ObjectList","dayjs","value","currency","Dialog","data","toast","d","row","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_openBlock","_createElementBlock","$data","_cache","$event","_withCtx","_Fragment","_createCommentVNode","_ctx","_createTextVNode","_createElementVNode","_toDisplayString","$options"],"mappings":"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"}