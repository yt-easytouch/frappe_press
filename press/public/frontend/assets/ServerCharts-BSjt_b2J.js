import{x as k,r as D,q as w,o as t,j as v,u as c,A as h,a8 as z,h as s,w as o,B,Y as T,bW as q,av as L,bg as $}from"./main-Dpl-JOF2.js";import{_ as C}from"./BarChart-CKiFk9xA.js";import{_ as A}from"./LineChart-BDXlcfBY.js";import{A as P}from"./AnalyticsCard-Cbt3l-Ja.js";import"./datetime-PXpIdgFA.js";import"./Card-BCzTSeNK.js";import"./tailwind.theme-XeumNAwU.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="7f970893-11c0-43a4-9bd7-2b455e99bb73",e._sentryDebugIdIdentifier="sentry-dbid-7f970893-11c0-43a4-9bd7-2b455e99bb73")}catch(d){}})();{var g=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};g._sentryModuleMetadata=g._sentryModuleMetadata||{},g._sentryModuleMetadata[new Error().stack]=Object.assign({},g._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const M={props:["serverName"],components:{AnalyticsCard:P,BarChart:C,LineChart:A},data(){var e;return{duration:"1 Hour",showAdvancedAnalytics:!1,localTimezone:$.tz.guess(),slowLogsDurationType:"Denormalized",slowLogsFrequencyType:"Denormalized",chosenServer:(e=this.$route.query.server)!=null?e:this.serverName,durationOptions:["1 Hour","6 Hour","24 Hour","7 Days","15 Days"],chartColors:[this.$theme.colors.green[500],this.$theme.colors.red[500],this.$theme.colors.yellow[500],this.$theme.colors.pink[500],this.$theme.colors.purple[500],this.$theme.colors.blue[500],this.$theme.colors.teal[500],this.$theme.colors.cyan[500],this.$theme.colors.gray[500],this.$theme.colors.orange[500]]}},watch:{chosenServer(){this.$router.push({query:{server:this.chosenServer}})}},resources:{loadavg(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"loadavg",duration:this.duration},auto:!0}},cpu(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"cpu",duration:this.duration},auto:!0}},memory(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"memory",duration:this.duration},auto:!0}},network(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"network",duration:this.duration},auto:!0}},iops(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"iops",duration:this.duration},auto:!0}},space(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"space",duration:this.duration},auto:!0}},requestCountBySite(){return{url:"press.api.server.get_request_by_site",params:{name:this.chosenServer,query:"count",timezone:this.localTimezone,duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Application Server")}},requestDurationBySite(){return{url:"press.api.server.get_request_by_site",params:{name:this.chosenServer,query:"duration",timezone:this.localTimezone,duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Application Server")}},slowLogsCount(){return{url:"press.api.server.get_slow_logs_by_site",params:{name:this.chosenServer,query:"count",timezone:this.localTimezone,duration:this.duration,normalize:this.slowLogsFrequencyType==="Normalized"},auto:this.showAdvancedAnalytics&&!this.isServerType("Application Server")}},slowLogsDuration(){return{url:"press.api.server.get_slow_logs_by_site",params:{name:this.chosenServer,query:"duration",timezone:this.localTimezone,duration:this.duration,normalize:this.slowLogsDurationType==="Normalized"},auto:this.showAdvancedAnalytics&&!this.isServerType("Application Server")}},databaseUptime(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"database_uptime",duration:this.duration},auto:this.isServerType("Database Server")}},databaseCommandsCount(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"database_commands_count",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}},databaseConnections(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"database_connections",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}},innodbBufferPoolSize(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"innodb_bp_size",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}},innodbBufferPoolSizeOfTotalRam(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"innodb_bp_size_of_total_ram",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}},innodbBufferPoolMissPercentage(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"innodb_bp_miss_percent",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}},innodbAvgRowLockTime(){return{url:"press.api.server.analytics",params:{name:this.chosenServer,timezone:this.localTimezone,query:"innodb_avg_row_lock_time",duration:this.duration},auto:this.showAdvancedAnalytics&&this.isServerType("Database Server")}}},computed:{$server(){return L("Server",this.serverName)},serverOptions(){return[{label:"Application Server",value:this.$server.doc.name},{label:"Database Server",value:this.$server.doc.database_server},{label:"Replication Server",value:this.$server.doc.replication_server}].filter(e=>e.value)},loadAverageData(){let e=this.$resources.loadavg.data;if(e)return e.datasets.sort((a,d)=>Number(a.name.split(" ")[2])-Number(d.name.split(" ")[2])),this.transformMultiLineChartData(e)},cpuData(){let e=this.$resources.cpu.data;if(!e)return;const a=["system","user","iowait","irq","softirq","nice","steal","idle"];return e.datasets=e.datasets.sort((d,p)=>a.indexOf(d.name)-a.indexOf(p.name)),this.transformMultiLineChartData(e,"cpu",!0)},memoryData(){let e=this.$resources.memory.data;if(e)return this.transformSingleLineChartData(e)},iopsData(){let e=this.$resources.iops.data;if(e)return this.transformMultiLineChartData(e)},spaceData(){let e=this.$resources.space.data;if(e)return this.transformMultiLineChartData(e)},networkData(){let e=this.$resources.network.data;if(e)return this.transformSingleLineChartData(e)},requestCountBySiteData(){const e=this.$resources.requestCountBySite.data;if(e)return e},requestDurationBySiteData(){const e=this.$resources.requestDurationBySite.data;if(e)return e},slowLogsDurationData(){const e=this.$resources.slowLogsDuration.data;if(e)return e},slowLogsCountData(){const e=this.$resources.slowLogsCount.data;if(e)return e},databaseUptimeData(){const e=this.$resources.databaseUptime.data;if(e)return this.transformSingleLineChartData(e)},databaseCommandsCountData(){const e=this.$resources.databaseCommandsCount.data;if(e)return this.transformMultiLineChartData(e,null,!1)},databaseConnectionsData(){const e=this.$resources.databaseConnections.data;if(e)return this.transformMultiLineChartData(e,null,!1)},innodbBufferPoolSizeData(){let e=this.$resources.innodbBufferPoolSize.data;if(e)return this.transformSingleLineChartData(e,!1)},innodbBufferPoolSizeOfTotalRamData(){let e=this.$resources.innodbBufferPoolSizeOfTotalRam.data;if(!e)return;let a=this.transformSingleLineChartData(e,!0);return a.markLine={data:[{name:"Too Low InnoDB Buffer Pool",yAxis:15,label:{formatter:"{b} ({c}%)",position:"middle"},lineStyle:{color:"#f5222d"}},{name:"Too High InnoDB Buffer Pool",yAxis:65,label:{formatter:"{b} ({c}%)",position:"middle"},lineStyle:{color:"#f5222d"}}],symbol:["none","none"]},a},innodbBufferPoolMissPercentageData(){let e=this.$resources.innodbBufferPoolMissPercentage.data;if(!e)return;let a=this.transformSingleLineChartData(e,!1);return a.markLine={data:[{name:"Accepted Range",yAxis:1,label:{formatter:"{b} < {c}%",position:"middle"},lineStyle:{color:"#f5222d"}}],symbol:["none","none"]},a},innodbAvgRowLockTimeData(){let e=this.$resources.innodbAvgRowLockTime.data;if(e)return this.transformSingleLineChartData(e,!1)}},methods:{transformSingleLineChartData(e,a=!1){var l,r;if(!((l=e.datasets)!=null&&l.length))return;let d=[];const p=e.datasets?(r=e.datasets[0])==null?void 0:r.name:null;for(let u=0;u<e.datasets[0].values.length;u++)d.push([+new Date(e.labels[u]),e.datasets[0].values[u]]);return{datasets:[{dataset:d,name:p}],yMax:a?100:null}},transformMultiLineChartData(e,a=null,d=!1){var r;if(!((r=e.datasets)!=null&&r.length))return;let p=[];if(d)for(let u=0;u<e.datasets[0].values.length;u++)for(let n=0;n<e.datasets.length;n++)p[u]||(p[u]=0),p[u]+=e.datasets[n].values[u];return{datasets:e.datasets.map(({name:u,values:n})=>{let i=[];for(let y=0;y<n.length;y++)i.push([+new Date(e.labels[y]),d?n[y]/p[y]*100:n[y]]);return{name:u,dataset:i,stack:a}}),yMax:d?100:null}},isServerType(e){var a;return this.chosenServer===((a=this.serverOptions.find(d=>d.label===e))==null?void 0:a.value)},toggleAdvancedAnalytics(){this.showAdvancedAnalytics=!this.showAdvancedAnalytics}}},_={class:"space-y-4"},R={class:"flex space-x-2"},N={class:"grid grid-cols-1 gap-5 sm:grid-cols-2"},O={key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2"};function V(e,a,d,p,l,r){const u=z,n=A,i=D("AnalyticsCard"),y=B,f=C,b=D("router-link"),S=q;return t(),w("div",_,[v("div",R,[h(u,{class:"w-40",label:"Server",type:"select",options:r.serverOptions,modelValue:l.chosenServer,"onUpdate:modelValue":a[0]||(a[0]=m=>l.chosenServer=m)},null,8,["options","modelValue"]),h(u,{class:"w-32",label:"Duration",type:"select",options:l.durationOptions.map(m=>({label:m,value:m})),modelValue:l.duration,"onUpdate:modelValue":a[1]||(a[1]=m=>l.duration=m)},null,8,["options","modelValue"])]),v("div",N,[r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:0,title:"Uptime"},{default:o(()=>[(t(),s(n,{type:"time",title:"Uptime",key:r.databaseUptimeData,data:r.databaseUptimeData,unit:"seconds",chartTheme:[e.$theme.colors.purple[500]],loading:e.$resources.databaseUptime.loading,error:e.$resources.databaseUptime.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),h(i,{title:"CPU"},{default:o(()=>[(t(),s(n,{type:"time",title:"CPU",key:r.cpuData,data:r.cpuData,unit:"%",chartTheme:[e.$theme.colors.yellow[500],e.$theme.colors.cyan[500],e.$theme.colors.red[500],e.$theme.colors.teal[500],e.$theme.colors.purple[500],e.$theme.colors.pink[500],e.$theme.colors.blue[500],e.$theme.colors.green[500]],loading:e.$resources.cpu.loading,error:e.$resources.cpu.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}),h(i,{title:"Load Average"},{default:o(()=>[(t(),s(n,{type:"time",title:"Load Average",key:r.loadAverageData,data:r.loadAverageData,chartTheme:[e.$theme.colors.green[500],e.$theme.colors.yellow[400],e.$theme.colors.red[500]],loading:e.$resources.loadavg.loading,error:e.$resources.loadavg.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}),h(i,{title:"Memory"},{default:o(()=>[(t(),s(n,{type:"time",title:"Memory",key:r.memoryData,data:r.memoryData,unit:"bytes",chartTheme:[e.$theme.colors.yellow[500]],loading:e.$resources.memory.loading,error:e.$resources.memory.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}),h(i,{title:"Disk Space"},{default:o(()=>[(t(),s(n,{type:"time",title:"Disk Space",key:r.spaceData,data:r.spaceData,unit:"%",chartTheme:[e.$theme.colors.red[500],e.$theme.colors.yellow[400]],loading:e.$resources.space.loading,error:e.$resources.space.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}),h(i,{title:"Network"},{default:o(()=>[(t(),s(n,{type:"time",title:"Network",key:r.networkData,data:r.networkData,unit:"bytes",chartTheme:[e.$theme.colors.blue[500]],loading:e.$resources.network.loading,error:e.$resources.network.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}),h(i,{title:"Disk I/O"},{default:o(()=>[(t(),s(n,{type:"time",title:"Disk I/O",key:r.iopsData,data:r.iopsData,unit:"I0ps",chartTheme:[e.$theme.colors.purple[500],e.$theme.colors.blue[500]],loading:e.$resources.iops.loading,error:e.$resources.iops.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})]),v("div",{class:"!mt-6 flex w-fit cursor-pointer space-x-2",onClick:a[2]||(a[2]=(...m)=>r.toggleAdvancedAnalytics&&r.toggleAdvancedAnalytics(...m))},[a[5]||(a[5]=v("h2",{class:"text-lg font-semibold"},"Advanced Analytics",-1)),h(y,{class:"h-5 w-5 text-gray-500 hover:text-gray-700",name:l.showAdvancedAnalytics?"chevron-down":"chevron-right"},null,8,["name"])]),l.showAdvancedAnalytics?(t(),w("div",O,[r.isServerType("Application Server")?(t(),s(i,{key:0,class:"sm:col-span-2",title:"Request frequency by site"},{default:o(()=>[(t(),s(f,{title:"Request frequency by site",key:r.requestCountBySiteData,data:r.requestCountBySiteData,unit:"requests",chartTheme:[this.$theme.colors.green[500],this.$theme.colors.red[500],this.$theme.colors.yellow[500],this.$theme.colors.pink[500],this.$theme.colors.purple[500],this.$theme.colors.blue[500],this.$theme.colors.teal[500],this.$theme.colors.cyan[500],this.$theme.colors.gray[500],this.$theme.colors.orange[500]],loading:e.$resources.requestCountBySite.loading,error:e.$resources.requestCountBySite.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})):c("",!0),r.isServerType("Application Server")?(t(),s(i,{key:1,class:"sm:col-span-2",title:"Slowest request by site"},{default:o(()=>[(t(),s(f,{title:"Slowest request by site",key:r.requestDurationBySiteData,data:r.requestDurationBySiteData,unit:"seconds",chartTheme:l.chartColors,loading:e.$resources.requestDurationBySite.loading,error:e.$resources.requestDurationBySite.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})):c("",!0),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:2,title:"Queries"},{default:o(()=>[(t(),s(n,{type:"time",title:"Queries",unit:"queries",key:r.databaseCommandsCountData,data:r.databaseCommandsCountData,chartTheme:[e.$theme.colors.green[500],e.$theme.colors.red[500],e.$theme.colors.yellow[500],e.$theme.colors.pink[500],e.$theme.colors.purple[500],e.$theme.colors.blue[500],e.$theme.colors.teal[500],e.$theme.colors.cyan[500]],loading:e.$resources.databaseCommandsCount.loading,error:e.$resources.databaseCommandsCount.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:3,title:"DB Connections"},{default:o(()=>[(t(),s(n,{type:"time",title:"DB Connections",key:r.databaseConnectionsData,data:r.databaseConnectionsData,unit:"connections",chartTheme:[this.$theme.colors.yellow[500],this.$theme.colors.green[500]],loading:e.$resources.databaseConnections.loading,error:e.$resources.databaseConnections.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:4,title:"Average Row Lock Time"},{default:o(()=>[(t(),s(n,{type:"time",title:"Average Row Lock Time",key:r.innodbAvgRowLockTimeData,data:r.innodbAvgRowLockTimeData,unit:"seconds",chartTheme:[e.$theme.colors.purple[500]],loading:e.$resources.innodbAvgRowLockTime.loading,error:e.$resources.innodbAvgRowLockTime.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:5,title:"Buffer Pool Size"},{default:o(()=>[(t(),s(n,{type:"time",title:"Buffer Pool Size",key:r.innodbBufferPoolSizeData,data:r.innodbBufferPoolSizeData,unit:"bytes",chartTheme:[e.$theme.colors.teal[500]],loading:e.$resources.innodbBufferPoolSize.loading,error:e.$resources.innodbBufferPoolSize.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:6,title:"Buffer Pool Size of Total Ram"},{action:o(()=>[h(b,{class:"text-base text-gray-600 hover:text-gray-700",to:{name:"Server Detail Actions",params:{name:this.serverName}}},{default:o(()=>a[6]||(a[6]=[T(" Manage InnoDB Buffer → ")])),_:1},8,["to"])]),default:o(()=>[(t(),s(n,{type:"time",title:"Buffer Pool Size of Total Ram",key:r.innodbBufferPoolSizeOfTotalRamData,data:r.innodbBufferPoolSizeOfTotalRamData,unit:"%",chartTheme:[e.$theme.colors.cyan[500]],loading:e.$resources.innodbBufferPoolSizeOfTotalRam.loading,error:e.$resources.innodbBufferPoolSizeOfTotalRam.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:7,title:"Buffer Pool Miss Percent"},{action:o(()=>[h(b,{class:"text-base text-gray-600 hover:text-gray-700",to:{name:"Server Detail Actions",params:{name:this.serverName}}},{default:o(()=>a[7]||(a[7]=[T(" Manage InnoDB Buffer → ")])),_:1},8,["to"])]),default:o(()=>[(t(),s(n,{type:"time",title:"Buffer Pool Miss Percent",key:r.innodbBufferPoolMissPercentageData,data:r.innodbBufferPoolMissPercentageData,unit:"%",chartTheme:[e.$theme.colors.orange[500]],loading:e.$resources.innodbBufferPoolMissPercentage.loading,error:e.$resources.innodbBufferPoolMissPercentage.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:8,class:"sm:col-span-2",title:"Frequent Slow queries"},{action:o(()=>[h(S,{buttons:[{label:"Denormalized"},{label:"Normalized"}],modelValue:l.slowLogsFrequencyType,"onUpdate:modelValue":a[3]||(a[3]=m=>l.slowLogsFrequencyType=m)},null,8,["modelValue"])]),default:o(()=>[(t(),s(f,{title:"Frequent Slow queries",key:r.slowLogsCountData,data:r.slowLogsCountData,unit:"queries",chartTheme:l.chartColors,loading:e.$resources.slowLogsCount.loading,error:e.$resources.slowLogsCount.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1})),r.isServerType("Application Server")?c("",!0):(t(),s(i,{key:9,class:"sm:col-span-2",title:"Slowest queries"},{action:o(()=>[h(S,{buttons:[{label:"Denormalized"},{label:"Normalized"}],modelValue:l.slowLogsDurationType,"onUpdate:modelValue":a[4]||(a[4]=m=>l.slowLogsDurationType=m)},null,8,["modelValue"])]),default:o(()=>[(t(),s(f,{title:"Slowest queries",key:r.slowLogsDurationData,data:r.slowLogsDurationData,unit:"seconds",chartTheme:l.chartColors,loading:e.$resources.slowLogsDuration.loading,error:e.$resources.slowLogsDuration.error,showCard:!1,class:"h-[15.55rem] p-2 pb-3"},null,8,["data","chartTheme","loading","error"]))]),_:1}))])):c("",!0)])}const K=k(M,[["render",V]]);export{K as default};
//# sourceMappingURL=ServerCharts-BSjt_b2J.js.map
