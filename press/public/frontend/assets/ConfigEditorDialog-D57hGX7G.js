var v=(s,e,t)=>new Promise((c,o)=>{var n=i=>{try{a(t.next(i))}catch(r){o(r)}},l=i=>{try{a(t.throw(i))}catch(r){o(r)}},a=i=>i.done?c(i.value):Promise.resolve(i.value).then(n,l);a((t=t.apply(s,e)).next())});import{x as N,a9 as V,a8 as D,ar as O,h as K,o as S,w as E,j as k,A as d,n as x,aT as I,aA as R,av as w}from"./main-Dpl-JOF2.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="dbae8f2a-c138-43fc-8752-aaeb6882f8bf",s._sentryDebugIdIdentifier="sentry-dbid-dbae8f2a-c138-43fc-8752-aaeb6882f8bf")}catch(t){}})();{var p=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};p._sentryModuleMetadata=p._sentryModuleMetadata||{},p._sentryModuleMetadata[new Error().stack]=Object.assign({},p._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const B={name:"ConfigEditorDialog",props:["site","group","config"],components:{Autocomplete:O,FormControl:D,ErrorMessage:V},data(){return{docResource:null,showDialog:!0,selectedConfig:null,key:null,type:null,value:null,error:null}},mounted(){return v(this,null,function*(){var s,e;this.config&&(yield this.$resources.standardKeys.promise,this.selectedConfig=this.keyOptions.find(t=>this.config.key===t.value),this.selectedConfig?(this.key=(s=this.selectedConfig)==null?void 0:s.value,this.type=(e=this.selectedConfig)==null?void 0:e.type):(this.selectedConfig=this.keyOptions.find(t=>t.value==="__custom_key"),this.key=this.config.key,this.type=this.config.type),this.value=this.config.type==="Password"?"":this.config.value)})},resources:{standardKeys(){return{url:"press.api.site.get_site_config_standard_keys",cache:"Site Config Standard Keys",initialData:[],auto:!0}}},methods:{addConfig(){var o,n,l;if(this.site?this.docResource=w("Site",this.site):this.group&&(this.docResource=w("Release Group",this.group)),!this.docResource)return;let s=((o=this.selectedConfig)==null?void 0:o.value)=="__custom_key"?this.key:(n=this.selectedConfig)==null?void 0:n.value,e=((l=this.selectedConfig)==null?void 0:l.type)||this.type,t=this.value;if(e==="JSON")try{t=JSON.parse(t)}catch(a){this.error="Invalid JSON";return}else e==="Boolean"?t=t==="1":e==="Number"&&(t=Number(t));let c={[s]:t};this.docResource.updateConfig.submit({config:c},{onSuccess:()=>{this.$emit("success"),this.showDialog=!1},onError:a=>{this.error=a}})}},computed:{keyOptions(){let s={label:"Custom Key",value:"__custom_key"},e=this.$resources.standardKeys.data.map(t=>({label:t.title,value:t.key,type:t.type}));return[s,...e]},valueInputProps(){var e;let s={String:"text",Number:"number",JSON:"textarea",Boolean:"select"}[((e=this.selectedConfig)==null?void 0:e.type)||this.type];return{type:s,options:s==="select"?["1","0"]:null}}}},A={class:"space-y-4"};function P(s,e,t,c,o,n){var r,g;const l=D,a=V,i=R;return S(),K(i,{options:{title:t.config?"Edit Config":"Add Config",actions:[{label:t.config?"Edit Key":"Add Key",variant:"solid",loading:(g=(r=o.docResource)==null?void 0:r.updateConfig)==null?void 0:g.loading,onClick:n.addConfig}]},modelValue:o.showDialog,"onUpdate:modelValue":e[4]||(e[4]=f=>o.showDialog=f)},{"body-content":E(()=>{var f,y,m,_,h,C;return[k("div",A,[k("div",{class:x({"pointer-events-none":t.config})},[d(l,{type:"autocomplete",label:"Config Name",options:n.keyOptions,modelValue:o.selectedConfig,"onUpdate:modelValue":e[0]||(e[0]=u=>o.selectedConfig=u)},null,8,["options","modelValue"])],2),d(l,{type:"text",label:"Key",modelValue:((f=o.selectedConfig)==null?void 0:f.value)==="__custom_key"?o.key:(y=o.selectedConfig)==null?void 0:y.value,"onUpdate:modelValue":e[1]||(e[1]=u=>{var b;return((b=o.selectedConfig)==null?void 0:b.value)==="__custom_key"?o.key=u:null}),disabled:((m=o.selectedConfig)==null?void 0:m.value)!=="__custom_key",autocomplete:"off"},null,8,["modelValue","disabled"]),d(l,{type:"select",label:"Type",modelValue:((_=o.selectedConfig)==null?void 0:_.type)||o.type,"onUpdate:modelValue":e[2]||(e[2]=u=>o.type=u),options:["String","Number","JSON","Boolean",((h=o.selectedConfig)==null?void 0:h.value)!=="__custom_key"?"Password":null],disabled:((C=o.selectedConfig)==null?void 0:C.value)!=="__custom_key",autocomplete:"off"},null,8,["modelValue","options","disabled"]),d(l,I(n.valueInputProps,{label:"Value",modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=u=>o.value=u),autocomplete:"off"}),null,16,["modelValue"]),d(a,{class:"mt-2",message:o.error},null,8,["message"])])]}),_:1},8,["options","modelValue"])}const M=N(B,[["render",P]]);export{M as default};
//# sourceMappingURL=ConfigEditorDialog-D57hGX7G.js.map
