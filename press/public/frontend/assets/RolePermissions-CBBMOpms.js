var V=Object.defineProperty,E=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var w=(o,e,t)=>e in o?V(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,x=(o,e)=>{for(var t in e||(e={}))O.call(e,t)&&w(o,t,e[t]);if(h)for(var t of h(e))$.call(e,t)&&w(o,t,e[t]);return o},k=(o,e)=>E(o,N(e));import{l as m,aP as F,ac as G,J as M,q as j,o as I,j as R,A as r,h as T,u as U,w as l,Z as d,X as A,y as q,t as D,B as L,C as z,Y as J,aQ as K,aN as Q,ao as W,F as X,ap as _,aF as Y,a2 as Z,V as P,aB as H,aa as ee}from"./main-Dpl-JOF2.js";import{_ as se}from"./arrow-left-DH4AOn6w.js";import{R as te}from"./RoleConfigureDialog-BifCIMlF.js";import"./Switch.vue_vue_type_script_setup_true_lang-5F9QrvuO.js";import"./UserWithAvatarCell-B71k87PQ.js";(function(){try{var o=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="bf8a0b21-f491-4e21-ae9f-e6cffab766b8",o._sentryDebugIdIdentifier="sentry-dbid-bf8a0b21-f491-4e21-ae9f-e6cffab766b8")}catch(t){}})();{var p=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};p._sentryModuleMetadata=p._sentryModuleMetadata||{},p._sentryModuleMetadata[new Error().stack]=Object.assign({},p._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const oe={class:"mb-5 flex items-center gap-2"},re={class:"text-lg font-medium text-gray-900"},ue={__name:"RolePermissions",props:{roleId:{type:String,required:!0}},setup(o){let e=m(new Set);const t=o,f=F({doctype:"Press Role",name:t.roleId,auto:!0,whitelistedMethods:{addUser:"add_user",removeUser:"remove_user",bulkDelete:"delete_permissions"}}),S=G({url:"press.api.client.insert"}),y=[{label:"Allowed Sites",doctype:"Site",fieldname:"site"},{label:"Allowed Bench Groups",doctype:"Release Group",fieldname:"release_group"},{label:"Allowed Servers",doctype:"Server",fieldname:"server"}],n=m(y[0]);function B(i){return y.map(s=>k(x({},s),{onClick:()=>{n.value=s;let a={role:t.roleId};s.doctype==="Site"&&(a.site=["is","set"]),s.doctype==="Release Group"&&(a.release_group=["is","set"]),s.doctype==="Server"&&(a.server=["is","set"]),i.update({filters:a}),i.reload()}}))}const C=m({doctype:"Press Role Permission",fields:["site","site.host_name as site_host_name","release_group","release_group.title as release_group_title","server","server.title as server_title"],filters:{role:t.roleId,site:["is","set"]},selectable:!0,columns:[{label:M(()=>n.value.doctype.replace("Release Group","Bench Group")),format(i,s){return s.site_host_name||s.site||s.release_group_title||s.server_title}}],actions({listResource:i}){return[{label:"Configure",slots:{prefix:_("settings")},onClick(){Y(Z(te,{roleId:t.roleId}))}},{label:"Delete",slots:{prefix:_("trash-2")},condition:()=>e.value.size>0,onClick(){f.bulkDelete.submit({permissions:Array.from(e.value)},{onSuccess:()=>{P.success("Items deleted successfully"),e.value.clear()}})}},{label:"Add",slots:{prefix:_("plus")},onClick(){H({title:"Add Permission",message:"",fields:[{label:`Select ${n.value.doctype.replace("Release Group","Bench Group")}`,type:"link",fieldname:"document_name",options:{doctype:n.value.doctype,filters:{name:["not in",i.data.map(s=>s[n.value.fieldname])||""],status:["!=","Archived"]}}}],primaryAction:{label:"Add",onClick({values:s}){let a=n.value.fieldname;P.promise(S.submit({doc:{doctype:"Press Role Permission",role:t.roleId,[a]:s.document_name}}),{loading:"Adding permission...",success(){return i.reload(),"Permission added successfully"},error:c=>ee(c)})}}})}}].filter(s=>s.condition?s.condition():!0)}});return(i,s)=>{var b,v;const a=se,c=q,g=L;return I(),j(X,null,[R("div",oe,[r(c,{text:"All Roles"},{default:l(()=>[r(d(A),{route:{name:"SettingsPermissionRoles"}},{icon:l(()=>[r(a,{class:"h-4 w-4 text-gray-700"})]),_:1})]),_:1}),R("h3",re,D((b=d(f).doc)==null?void 0:b.title),1),(v=d(f).doc)!=null&&v.admin_access?(I(),T(c,{key:0,text:"Admin Role"},{default:l(()=>[r(g,{name:"shield",class:"h-5 w-5 text-gray-700"})]),_:1})):U("",!0)]),r(W,{options:C.value,"onUpdate:selections":s[0]||(s[0]=u=>Q(e)?e.value=u:e=u)},{"header-left":l(({listResource:u})=>[r(d(z),{options:B(u)},{default:l(()=>[r(d(A),null,{prefix:l(()=>[r(d(K),{class:"h-4 w-4 text-gray-500"})]),suffix:l(()=>[r(g,{name:"chevron-down",class:"h-4 w-4 text-gray-500"})]),default:l(()=>[J(" "+D(n.value.label)+" ",1)]),_:1})]),_:2},1032,["options"])]),_:1},8,["options"])],64)}}};export{ue as default};
//# sourceMappingURL=RolePermissions-CBBMOpms.js.map
