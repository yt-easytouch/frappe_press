{"version":3,"file":"SiteDatabaseRestoreFromURLDialog-BFyX8bzt.js","sources":["../../../../dashboard/src2/components/site/SiteDatabaseRestoreFromURLDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\t:options=\"{\n\t\t\ttitle: 'Restore from an existing site'\n\t\t}\"\n\t\tv-model=\"showRestoreDialog\"\n\t>\n\t\t<template #body-content>\n\t\t\t<div\n\t\t\t\tclass=\"mb-6 flex items-center rounded border border-gray-200 bg-gray-100 p-4 text-sm text-gray-600\"\n\t\t\t>\n\t\t\t\t<i-lucide-alert-triangle class=\"mr-4 inline-block h-6 w-6\" />\n\t\t\t\t<div>\n\t\t\t\t\tThis operation will replace the current <b>data</b> & <b>apps</b> in\n\t\t\t\t\tyour site with those from the backup\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<FormControl label=\"Site URL\" v-model=\"siteURL\" />\n\t\t\t\t<FormControl label=\"Email\" v-model=\"email\" />\n\t\t\t\t<FormControl label=\"Password\" type=\"password\" v-model=\"password\" />\n\t\t\t\t<div class=\"flex text-base\" v-if=\"$resources.getBackupLinks.data\">\n\t\t\t\t\t<GreenCheckIcon class=\"mr-2 w-4\" />\n\t\t\t\t\tFound latest backups from {{ fetchedBackupFileTimestamp }}\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\tv-else\n\t\t\t\t\t@click=\"$resources.getBackupLinks.submit()\"\n\t\t\t\t\t:loading=\"$resources.getBackupLinks.loading\"\n\t\t\t\t>\n\t\t\t\t\tGet Backups\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t<div class=\"mt-3\">\n\t\t\t\t<FormControl\n\t\t\t\t\tlabel=\"Skip failing patches (if any patch fails)\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tv-model=\"skipFailingPatches\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ErrorMessage\n\t\t\t\tclass=\"mt-2\"\n\t\t\t\t:message=\"\n\t\t\t\t\t$resources.restoreBackup.error || $resources.getBackupLinks.error\n\t\t\t\t\"\n\t\t\t/>\n\t\t</template>\n\t\t<template #actions>\n\t\t\t<Button\n\t\t\t\tclass=\"w-full\"\n\t\t\t\tlabel=\"Restore\"\n\t\t\t\tvariant=\"solid\"\n\t\t\t\ttheme=\"red\"\n\t\t\t\t:loading=\"$resources.restoreBackup.loading\"\n\t\t\t\t:disabled=\"!$resources.getBackupLinks.data\"\n\t\t\t\t@click=\"$resources.restoreBackup.submit\"\n\t\t\t/>\n\t\t</template>\n\t</Dialog>\n</template>\n<script>\nimport { date } from '../../utils/format';\nimport { DashboardError } from '../../utils/error';\n\nexport default {\n\tname: 'SiteDatabaseRestoreDialog',\n\tprops: {\n\t\tsite: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tsiteURL: '',\n\t\t\temail: '',\n\t\t\tpassword: '',\n\t\t\tselectedFiles: {\n\t\t\t\tdatabase: null,\n\t\t\t\tpublic: null,\n\t\t\t\tprivate: null\n\t\t\t},\n\t\t\tshowRestoreDialog: true,\n\t\t\tskipFailingPatches: false\n\t\t};\n\t},\n\tresources: {\n\t\tgetBackupLinks() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.get_backup_links',\n\t\t\t\tparams: {\n\t\t\t\t\turl: this.siteURL,\n\t\t\t\t\temail: this.email,\n\t\t\t\t\tpassword: this.password\n\t\t\t\t},\n\t\t\t\tvalidate() {\n\t\t\t\t\tif (!this.siteURL) {\n\t\t\t\t\t\tthrow new DashboardError('Site URL is required');\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.email) {\n\t\t\t\t\t\tthrow new DashboardError('Email is required');\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.password) {\n\t\t\t\t\t\tthrow new DashboardError('Password is required');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonSuccess(remoteFiles) {\n\t\t\t\t\tfor (let file of remoteFiles) {\n\t\t\t\t\t\tthis.selectedFiles[file.type] = file.remote_file;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\trestoreBackup() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.restore',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.site,\n\t\t\t\t\tfiles: this.selectedFiles,\n\t\t\t\t\tskip_failing_patches: this.skipFailingPatches\n\t\t\t\t},\n\t\t\t\tvalidate() {\n\t\t\t\t\tif (!this.selectedFiles.database) {\n\t\t\t\t\t\tthrow new DashboardError(\n\t\t\t\t\t\t\t'Something went wrong while fetching the backups from the site'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonSuccess() {\n\t\t\t\t\tthis.siteURL = '';\n\t\t\t\t\tthis.email = '';\n\t\t\t\t\tthis.password = '';\n\t\t\t\t\tthis.showRestoreDialog = false;\n\n\t\t\t\t\tthis.$router.push({\n\t\t\t\t\t\tname: 'Site Jobs',\n\t\t\t\t\t\tparams: { name: this.site }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\tcomputed: {\n\t\tfetchedBackupFileTimestamp() {\n\t\t\tif (!this.$resources.getBackupLinks.data) return '';\n\n\t\t\tlet backup = this.$resources.getBackupLinks.data[0];\n\t\t\tlet timestamp_string = backup.file_name\n\t\t\t\t.split('-')[0]\n\t\t\t\t.split('_')\n\t\t\t\t.join('T');\n\n\t\t\treturn date(timestamp_string);\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","DashboardError","timestamp_string","_hoisted_1","_hoisted_2","_hoisted_4","$data","_cache","$event","_withCtx","_createElementVNode","_createTextVNode","_openBlock","_createElementBlock","_hoisted_3","_ctx"],"mappings":"6yBAgEA,MAAAA,EAAA,CACC,KAAA,4BACA,MAAA,8BAIC,GAED,MAAA,CACC,MAAA,YAEC,MAAA,eAEA,cAAA,iGAUD,gBAAA,CACC,MAAA,CACC,IAAA,kCACA,OAAA,CACC,IAAA,KAAA,QACA,MAAA,KAAA,MACA,SAAA,KAAA,qBAGA,GAAA,CAAA,KAAA,QACC,MAAA,IAAAC,EAAA,sBAAA,EAED,GAAA,CAAA,KAAA,MACC,MAAA,IAAAA,EAAA,mBAAA,EAED,GAAA,CAAA,KAAA,SACC,MAAA,IAAAA,EAAA,sBAAA,uEAOF,IAGF,eAAA,CACC,MAAA,8BAEC,OAAA,CACC,KAAA,KAAA,8BAEA,qBAAA,KAAA,+BAGA,GAAA,CAAA,KAAA,cAAA,mGAOA,KAAA,QAAA,iBAEA,KAAA,SAAA,6BAGA,KAAA,QAAA,KAAA,CACC,KAAA,mCAED,CAAA,CACD,EAEF,GAED,SAAA,+EAKE,IAAAC,yCAAA,wDAMD,CACD,CACD,EAlJIC,EAAA,CAAA,MAAA,6FAAA,EAQIC,EAAA,CAAA,MAAA,WAAA,WAIC,MAAA,kBAYDC,EAAA,CAAA,MAAA,MAAA,wEA/BL,QAAA,sCAEA,EAJH,WAAAC,EAAA,kBAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,kBAAAE,KAOa,eAAAC,EAAA,IAAA,CACVC,EAAA,MAAAP,EAAA,oEARHQ,EAAA,2CAAA,EAa6CD,EAAA,IAAA,KAAA,MAAA,EAb7CC,EAAA,KAAA,EAa2DD,EAAA,IAAA,KAAA,MAAA,EAb3DC,EAAA,2CAAA,UAiBGD,EAAA,MAAAN,EAAA,MACc,MAAA,WAlBjB,WAAAE,EAAA,QAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,QAAAE,gCAmBiB,MAAA,QAnBjB,WAAAF,EAAA,MAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,MAAAE,gCAoBiB,MAAA,WAAiB,KAAA,WApBlC,WAAAF,EAAA,SAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,SAAAE,6DAqBII,IAAAC,EAAA,MAAAC,EAAA,+GAME,QAAAP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAO,EAAA,WAAA,eAAA,OAAA,GACA,QAAAA,EAAA,WAAA,eAAA,UA5BN,QAAAN,EAAA,IAAAF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAAI,EAAA,eAAA,4BAiCGD,EAAA,MAAAL,EAAA,MAEE,MAAA,4CACA,KAAA,WApCL,WAAAC,EAAA,mBAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,mBAAAE,kCAyCI,MAAA,0GAMS,QAAAC,EAAA,IAAA,MAET,MAAA,SACA,MAAA,UACA,QAAA,QACA,MAAA,MACC,QAAAM,EAAA,WAAA,cAAA,QACA,SAAA,CAAAA,EAAA,WAAA,eAAA,KACA,QAAAA,EAAA,WAAA,cAAA"}