import{x as D,av as M,r as P,h as S,o as i,w as x,j as n,A as g,q as p,F as w,v as k,n as T,t as y,y as V,a9 as R,aA as G,bg as F,X as L,Y as j,u as b,aT as O,bq as B,aB as I,V as z,aa as q,aF as H,a2 as Y,z as K,D as X}from"./main-Dpl-JOF2.js";import{_ as J}from"./Progress.vue_vue_type_script_setup_true_lang-DREy3z5o.js";import{_ as N}from"./info-BXlf1Uhm.js";import{S as Q}from"./ServerPlansCards-Cc172p6H.js";import{_ as U}from"./LineChart-BDXlcfBY.js";import"./PlansCards-CiqqQthx.js";import"./badge-check-DXteVc7W.js";import"./Card-BCzTSeNK.js";import"./datetime-PXpIdgFA.js";import"./tailwind.theme-XeumNAwU.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="1720b08c-6b72-40ab-a8dd-9e70c01049ab",e._sentryDebugIdIdentifier="sentry-dbid-1720b08c-6b72-40ab-a8dd-9e70c01049ab")}catch(t){}})();{var C=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};C._sentryModuleMetadata=C._sentryModuleMetadata||{},C._sentryModuleMetadata[new Error().stack]=Object.assign({},C._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const W={components:{ServerPlansCards:Q},props:{server:{type:String,required:!0},serverType:{type:String,required:!0}},data(){return{show:!0,plan:null,planType:"Standard"}},watch:{server:{immediate:!0,handler(e){var s,t;e&&(t=(s=this.$server)==null?void 0:s.doc)!=null&&t.plan&&(this.plan=this.$server.doc.current_plan)}}},resources:{serverPlans(){return{url:"press.api.server.plans",params:{name:this.serverType,cluster:this.$server.doc.cluster,platform:this.$server.doc.current_plan.platform},auto:!0,initialData:[]}}},methods:{changePlan(){return this.$server.changePlan.submit({plan:this.plan.name},{onSuccess:()=>{this.show=!1;const e=this.$resources.serverPlans.data.find(t=>t.name===this.$server.doc.plan),s=e?`${this.$format.planTitle(e)}/mo`:this.$server.doc.plan;this.$toast.success(`Plan changed to ${s}`)}})}},computed:{$server(){return M(this.serverType,this.server)}}},Z={class:"mb-4 mt-2 w-full space-y-2"},ee={class:"grid grid-cols-2 gap-3"},re=["onClick"],te={class:"flex w-full items-center justify-between space-x-2"},se={class:"text-sm font-medium"};function ae(e,s,t,r,l,o){var f;const c=N,v=V,d=P("ServerPlansCards"),_=R,$=G;return i(),S($,{options:{title:"Change Plan",size:"5xl",actions:[{label:"Change plan",variant:"solid",onClick:o.changePlan,disabled:!l.plan||l.plan===((f=o.$server)==null?void 0:f.doc.plan)}]},modelValue:l.show,"onUpdate:modelValue":s[1]||(s[1]=u=>l.show=u)},{"body-content":x(()=>[n("div",Z,[n("div",ee,[(i(),p(w,null,k([{name:"Standard",description:"Includes standard support and SLAs"},{name:"Premium",description:"Includes enterprise support and SLAs"}],u=>n("button",{key:u.name,onClick:m=>l.planType=u.name,class:T([l.planType===u.name?"border-gray-900 ring-1 ring-gray-900 hover:bg-gray-100":"border-gray-400 bg-white text-gray-900 ring-gray-200 hover:bg-gray-50","flex w-full items-center rounded border p-3 text-left text-base text-gray-900"])},[n("div",te,[n("span",se,y(u.name),1),g(v,{text:u.description},{default:x(()=>[g(c,{class:"h-4 w-4 text-gray-500"})]),_:2},1032,["text"])])],10,re)),64))])]),g(d,{modelValue:l.plan,"onUpdate:modelValue":s[0]||(s[0]=u=>l.plan=u),plans:l.planType==="Premium"?e.$resources.serverPlans.data.filter(u=>u.premium===1):e.$resources.serverPlans.data.filter(u=>u.premium===0)},null,8,["modelValue","plans"]),g(_,{class:"mt-2",message:o.$server.changePlan.error},null,8,["message"])]),_:1},8,["options","modelValue"])}const E=D(W,[["render",ae]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"})),ne={name:"CPUUsage",props:["server"],components:{LineChart:U},resources:{loadavg(){let e=F.tz.guess();return{url:"press.api.server.analytics",params:{name:this.server,timezone:e,query:"loadavg",duration:"6 Hour"},auto:!0}}},computed:{loadAverageData(){let e=this.$resources.loadavg.data;if(e)return e.datasets.sort((s,t)=>Number(s.name.split(" ")[2])-Number(t.name.split(" ")[2])),this.transformMultiLineChartData(e)}},methods:{transformMultiLineChartData(e,s=null,t=!1){let r=[];if(t)for(let o=0;o<e.datasets[0].values.length;o++)for(let c=0;c<e.datasets.length;c++)r[o]||(r[o]=0),r[o]+=e.datasets[c].values[o];return{datasets:e.datasets.map(({name:o,values:c})=>{let v=[];for(let d=0;d<c.length;d++)v.push([+new Date(e.labels[d]),t?c[d]/r[d]*100:c[d]]);return{name:o,dataset:v,stack:s}}),yMax:t?100:null}}}},ie={class:"rounded-md border"},le={class:"flex h-12 items-center justify-between border-b px-5"},ce={class:"flex items-center space-x-2"};function de(e,s,t,r,l,o){const c=L,v=P("router-link"),d=U;return i(),p("div",ie,[n("div",le,[s[1]||(s[1]=n("h2",{class:"text-lg font-medium text-gray-900"},"Load Average",-1)),n("div",ce,[g(c,{icon:"help-circle",variant:"ghost",link:"https://easytouch.cloud/docs/server-analytics#load-average"}),g(v,{class:"text-base text-gray-600 hover:text-gray-700",to:{name:"Server Detail Analytics",params:{name:t.server}}},{default:x(()=>s[0]||(s[0]=[j(" All analytics â†’ ")])),_:1},8,["to"])])]),(i(),S(d,{class:"h-52 p-2",type:"time",title:"Load Average",key:o.loadAverageData,chartTheme:[e.$theme.colors.green[500],e.$theme.colors.yellow[400],e.$theme.colors.red[500]],data:o.loadAverageData,showCard:!1,loading:e.$resources.loadavg.loading,error:e.$resources.loadavg.error},null,8,["chartTheme","data","loading","error"]))])}const ue=D(ne,[["render",de]]),me={props:["server"],components:{ServerLoadAverage:ue,ServerPlansDialog:E},methods:{showPlanChangeDialog(e){let s=K(()=>X(()=>Promise.resolve().then(()=>oe),void 0));H(Y(s,{server:e==="Server"?this.$appServer.name:this.$dbServer.name,serverType:e}))},currentUsage(e){var $,f,u;if(!(($=this.$appServer)!=null&&$.doc))return[];if(!((f=this.$dbServer)!=null&&f.doc))return[];let s=m=>this.$format.bytes(m,0,2),t=e==="Server"?this.$appServer.doc:e==="Database Server"?this.$dbServer.doc:e==="Replication Server"?(u=this.$dbReplicaServer)==null?void 0:u.doc:null;if(!t)return[];let r=t.current_plan,l=t.usage,o=t.disk_size,c=o-((r==null?void 0:r.disk)||0),v=0,d=this.$team.doc.currency==="INR"?"price_inr":"price_usd",_="";return r!=null&&r.name?r.price_usd>0?(v=r[d],_=`${this.$format.userCurrency(v,0)}/mo`):_=r.plan_title:_="No plan selected",[{label:e==="Server"?"Application Server Plan":e==="Database Server"?"Database Server Plan":"Replication Server Plan",value:_,subValue:c>0?`${this.$format.userCurrency(t.storage_plan[d]*c,0)}/mo`:"",type:"header",isPremium:!!(r!=null&&r.premium),help:c>0?`Server Plan: ${this.$format.userCurrency(r[d])}/mo & Add-on Storage Plan: ${this.$format.userCurrency(t.storage_plan[d]*c)}/mo`:""},{label:"CPU",type:"progress",progress_value:r?l.vcpu/r.vcpu*100:0,value:r?`${((l.vcpu||0)/r.vcpu*100).toFixed(2)}% of ${r.vcpu} ${this.$format.plural(r.vcpu,"vCPU","vCPUs")}`:"0% vCPU"},{label:"Memory",type:"progress",progress_value:r?l.memory/r.memory*100:0,value:r?`${s(l.memory||0)} of ${s(r.memory)}`:s(l.memory||0)},{label:"Storage",type:"progress",progress_value:r?l.disk/(o||r.disk)*100:0,value:r?`${l.disk||0} GB of ${o||r.disk} GB`:`${l.disk||0} GB`,help:o-((r==null?void 0:r.disk)||0)>0?`Add-on storage: ${o-((r==null?void 0:r.disk)||0)} GB`:"",actions:[{label:"Increase Storage",icon:"plus",variant:"ghost",onClick:()=>{I({title:"Increase Storage",message:`Enter the disk size you want to increase to the server <b>${t.title||t.name}</b><div class="rounded mt-4 p-2 text-sm text-gray-700 bg-gray-100 border">You will be charged at the rate of <b>${this.$format.userCurrency(t.storage_plan[d])}/mo</b> for each additional GB of storage.</div><p class="mt-4 text-sm text-gray-700"><strong>Note</strong>: You can increase the storage size of the server only once in 6 hours.</div>`,fields:[{fieldname:"storage",type:"select",default:50,label:"Storage (GB)",variant:"outline",options:Array.from({length:100},(m,a)=>({label:`${(a+1)*5} GB`,value:(a+1)*5}))}],onSuccess:({hide:m,values:a})=>{z.promise(this.$appServer.increaseDiskSize.submit({server:t.name,increment:Number(a.storage)},{onSuccess:()=>{m(),this.$router.push({name:"Server Detail Plays",params:{name:this.$appServer.name}})},onError(h){console.error(h)}}),{loading:"Increasing disk size...",success:"Disk size is scheduled to increase",error:h=>q(h,"Failed to increase disk size")})}})}},{label:"Configure Auto Increase Storage",icon:"tool",variant:"ghost",onClick:()=>{I({title:"Configure Auto Increase Storage",message:`<div class="rounded my-4 p-2 text-sm text-gray-700 bg-gray-100 border">

									This feature automatically increases available storage as it reaches over <b>90%</b> of its capacity. It is enabled by default to avoid server/site downtime.

									<br><br>
									You can disable this entirely by setting minimum and maximum below to <b>0 GB</b>. But if you do, <strong>we may not be notified of incidents from this server</strong>.

									<br><br>
									<strong>Note</strong>: Storage can auto increase only once in 6 hours.


									</div>Enter the maximum and minimum storage to increase for the server <b>${t.title||t.name}</b>.`,fields:[{fieldname:"min",type:"select",default:String(t.auto_add_storage_min),label:"Minimum Storage Increase (GB)",variant:"outline",options:Array.from({length:51},(m,a)=>({label:`${a*5} GB`,value:a*5}))},{fieldname:"max",type:"select",default:String(t.auto_add_storage_max),label:"Maximum Storage Increase (GB)",variant:"outline",options:Array.from({length:51},(m,a)=>({label:`${a*5} GB`,value:a*5}))}],onSuccess:({hide:m,values:a})=>{z.promise(this.$appServer.configureAutoAddStorage.submit({server:t.name,min:Number(a.min),max:Number(a.max)},{onSuccess:()=>{m(),t.name===this.$appServer.name?this.$appServer.reload():t.name===this.$dbServer.name?this.$dbServer.reload():t.name===this.$replicationServer.name&&this.$replicationServer.reload()}}),{loading:"Configuring auto increase storage...",success:"Auto increase storage is configured",error:h=>h.messages.length?h.messages.join("/n"):h.message||"Failed to configure auto increase storage"})}})}}]}]}},computed:{serverInformation(){return[{label:"Application server",value:this.$appServer.doc.name},{label:"Database server",value:this.$appServer.doc.database_server},{label:"Replication server",value:this.$appServer.doc.replication_server},{label:"Owned by",value:this.$appServer.doc.owner_email||this.$appServer.doc.team},{label:"Created by",value:this.$appServer.doc.owner},{label:"Created on",value:this.$format.date(this.$appServer.doc.creation)}].filter(e=>e.value)},$appServer(){return M("Server",this.server)},$dbServer(){return B({doctype:"Database Server",name:this.$appServer.doc.database_server,whitelistedMethods:{changePlan:"change_plan",reboot:"reboot",rename:"rename"}})},$dbReplicaServer(){return B({doctype:"Database Server",name:this.$appServer.doc.replication_server,whitelistedMethods:{changePlan:"change_plan",reboot:"reboot",rename:"rename"}})}}},pe={key:0,class:"grid grid-cols-1 items-start gap-5 sm:grid-cols-2"},ve={class:"col-span-1 rounded-md border lg:col-span-2"},ge={class:"grid grid-cols-2 lg:grid-cols-4"},he={key:0,class:"m-auto flex h-full items-center justify-between"},_e={key:0,class:"mt-2 flex flex-col space-y-2"},fe={class:"text-base text-gray-700"},be={class:"space-y-1"},ye={class:"flex items-center text-base text-gray-900"},Se={class:"flex space-x-1"},$e=["innerHTML"],xe={key:1},we={class:"flex items-center justify-between space-x-2"},ke={class:"text-base text-gray-700"},Ce={key:0,class:"flex space-x-2"},De={key:1,class:"h-8"},Pe={class:"mt-2"},Ae={class:"flex space-x-2"},Be={class:"mt-2 flex justify-between"},Ie={class:"text-sm text-gray-600"},ze={class:"rounded-md border"},Me={class:"w-1/3 text-base text-gray-700"},Te={class:"w-2/3 text-base font-medium"};function Ve(e,s,t,r,l,o){var f,u;const c=V,v=N,d=L,_=J,$=P("ServerLoadAverage");return(f=o.$appServer)!=null&&f.doc?(i(),p("div",pe,[(i(!0),p(w,null,k((u=o.$dbReplicaServer)!=null&&u.doc?["Server","Database Server","Replication Server"]:["Server","Database Server"],m=>(i(),p("div",ve,[n("div",ge,[(i(!0),p(w,null,k(o.currentUsage(m),(a,h)=>(i(),p("div",{key:a.value,class:T(["border-b p-5 lg:border-b-0",{"border-r":h+1!=o.currentUsage(m).length}])},[a.type==="header"?(i(),p("div",he,[a.type==="header"?(i(),p("div",_e,[n("div",fe,y(a.label),1),n("div",be,[n("div",ye,[j(y(a.value)+" ",1),a.isPremium?(i(),S(c,{key:0,text:"Premium Server"},{default:x(()=>s[0]||(s[0]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-parking ml-2 h-4 w-4 text-gray-600"},[n("circle",{cx:"12",cy:"12",r:"10"}),n("path",{d:"M9 17V7h4a3 3 0 0 1 0 6H9"})],-1)])),_:1})):b("",!0)]),n("div",Se,[n("div",{class:"text-sm text-gray-600",innerHTML:a.subValue},null,8,$e),a.help?(i(),S(c,{key:0,text:a.help},{default:x(()=>[g(v,{class:"h-3.5 w-3.5 text-gray-500"})]),_:2},1032,["text"])):b("",!0)])])])):b("",!0),a.type==="header"&&!o.$appServer.doc.is_self_hosted?(i(),S(d,{key:1,onClick:A=>o.showPlanChangeDialog(m),label:"Change"},null,8,["onClick"])):b("",!0)])):a.type==="progress"?(i(),p("div",xe,[n("div",we,[n("div",ke,y(a.label),1),a.actions?(i(),p("div",Ce,[(i(!0),p(w,null,k(a.actions||[],A=>(i(),S(d,O({ref_for:!0},A),null,16))),256))])):(i(),p("div",De))]),n("div",Pe,[g(_,{size:"md",value:a.progress_value||0},null,8,["value"]),n("div",Ae,[n("div",Be,[n("div",Ie,y(a.value),1)]),a.help?(i(),S(c,{key:0,text:a.help},{default:x(()=>[g(v,{class:"mt-2 h-4 w-4 text-gray-500"})]),_:2},1032,["text"])):b("",!0)])])])):b("",!0)],2))),128))])]))),256)),n("div",ze,[s[1]||(s[1]=n("div",{class:"h-12 border-b px-5 py-4"},[n("h2",{class:"text-lg font-medium text-gray-900"},"Server Information")],-1)),n("div",null,[(i(!0),p(w,null,k(o.serverInformation,m=>(i(),p("div",{key:m.label,class:"flex items-center px-5 py-3 last:pb-5 even:bg-gray-50/70"},[n("div",Me,y(m.label),1),n("div",Te,y(m.value),1)]))),128))])]),g($,{server:t.server},null,8,["server"])])):b("",!0)}const He=D(me,[["render",Ve]]);export{He as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=ServerOverview-CbSmGhQc.js.map
