{"version":3,"file":"UninstallAppDialog-Cp9IjiZw.js","sources":["../../../../dashboard/src2/components/site/UninstallAppDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\tv-model=\"showDialog\"\n\t\t:options=\"{\n\t\t\ttitle: `Uninstall ${app.title}`,\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Uninstall',\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tonClick: handleConfirm,\n\t\t\t\t},\n\t\t\t],\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<p class=\"text-p-base text-gray-800\">\n\t\t\t\t\tAre you sure you want to uninstall the app\n\t\t\t\t\t<b>{{ app.title }}</b> from the site\n\t\t\t\t\t<b>{{ site.doc?.host_name || site.doc?.name }}</b>\n\t\t\t\t\t?\n\t\t\t\t\t<br />\n\t\t\t\t\tAll doctypes and modules related to this app will be removed.\n\t\t\t\t</p>\n\t\t\t\t<div v-if=\"app.collect_feedback\" class=\"space-y-4\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tlabel=\"Give feedback\"\n\t\t\t\t\t\tv-model=\"giveFeedback\"\n\t\t\t\t\t/>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-if=\"giveFeedback\"\n\t\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t\tlabel=\"Feedback\"\n\t\t\t\t\t\tv-model=\"feedback\"\n\t\t\t\t\t\t:options=\"feedbackOptions\"\n\t\t\t\t\t/>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-if=\"giveFeedback && feedback === 'Other'\"\n\t\t\t\t\t\ttype=\"textarea\"\n\t\t\t\t\t\tlabel=\"Specify feedback\"\n\t\t\t\t\t\tv-model=\"specifyFeedback\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { createResource } from 'frappe-ui';\nimport { toast } from 'vue-sonner';\nimport { useRouter } from 'vue-router';\nimport { DocumentResource } from '../../objects/common/types';\nimport { getToastErrorMessage } from '../../utils/toast';\nimport { PropType, ref } from 'vue';\n\nconst props = defineProps({\n\tsite: {\n\t\ttype: Object as PropType<DocumentResource>,\n\t\trequired: true,\n\t},\n\tapp: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n});\n\nconst router = useRouter();\n\nconst showDialog = defineModel<boolean>({ default: true });\nconst giveFeedback = ref(false);\nconst feedback = ref('');\nconst specifyFeedback = ref('');\nconst feedbackOptions = [\n\t'Switched to another tool',\n\t'Was just testing, not a long-term user',\n\t'Missing features I needed',\n\t'Setup and onboarding were too complex',\n\t'Prefer self-hosting over Easytouch Cloud',\n\t'Too expensive for my use case',\n\t'Other',\n].map((option) => ({ label: option, value: option }));\n\nconst uninstallApp = createResource({\n\turl: 'press.api.client.run_doc_method',\n\tmakeParams: () => ({\n\t\tdt: 'Site',\n\t\tdn: props.site.doc?.name,\n\t\tmethod: 'uninstall_app',\n\t\targs: {\n\t\t\tapp: props.app.app,\n\t\t\tfeedback:\n\t\t\t\tfeedback.value === 'Other' ? specifyFeedback.value : feedback.value,\n\t\t},\n\t}),\n});\n\nconst handleConfirm = () => {\n\tif (uninstallApp.loading) return;\n\n\ttoast.promise(uninstallApp.submit(), {\n\t\tloading: 'Scheduling app uninstall...',\n\t\tsuccess: (jobId: { message: string }) => {\n\t\t\tshowDialog.value = false;\n\t\t\trouter.push({\n\t\t\t\tname: 'Site Job',\n\t\t\t\tparams: {\n\t\t\t\t\tname: props.site.name,\n\t\t\t\t\tid: jobId.message,\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn 'App uninstall scheduled';\n\t\t},\n\t\terror: (e: Error) => getToastErrorMessage(e),\n\t});\n};\n</script>\n"],"names":["props","__props","router","useRouter","showDialog","_useModel","giveFeedback","ref","feedback","specifyFeedback","feedbackOptions","option","uninstallApp","createResource","_a","handleConfirm","toast","jobId","e","getToastErrorMessage"],"mappings":"umCAyDA,MAAAA,EAAAC,EAWAC,EAAAC,EAAA,EAEAC,EAAAC,EAAAJ,EAAA,YAAA,EACAK,EAAAC,EAAA,EAAA,EACAC,EAAAD,EAAA,EAAA,EACAE,EAAAF,EAAA,EAAA,EACAG,EAAA,CAAwB,2BACvB,yCACA,4BACA,wCACA,2CACA,gCACA,OACA,EAAA,IAAAC,IAAA,CAAA,MAAAA,EAAA,MAAAA,CAAA,EAAA,EAGDC,EAAAC,EAAA,CAAoC,IAAA,kCAC9B,WAAA,IAAA,OAAA,OACc,GAAA,OACd,IAAAC,EAAAd,EAAA,KAAA,MAAA,YAAAc,EAAA,KACgB,OAAA,gBACZ,KAAA,CACF,IAAAd,EAAA,IAAA,IACU,SAAAQ,EAAA,QAAA,QAAAC,EAAA,MAAAD,EAAA,KAEgD,CAChE,EACD,CAAA,EAGDO,EAAA,IAAA,CACCH,EAAA,SAEAI,EAAA,QAAAJ,EAAA,SAAA,CAAqC,QAAA,8BAC3B,QAAAK,IAERb,EAAA,MAAA,GACAF,EAAA,KAAA,CAAY,KAAA,WACL,OAAA,CACE,KAAAF,EAAA,KAAA,KACU,GAAAiB,EAAA,OACP,CACX,CAAA,EAED,2BACD,MAAAC,GAAAC,EAAAD,CAAA,CAC2C,CAAA,CAC3C"}