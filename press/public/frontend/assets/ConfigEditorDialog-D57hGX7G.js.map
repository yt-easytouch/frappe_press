{"version":3,"file":"ConfigEditorDialog-D57hGX7G.js","sources":["../../../../dashboard/src2/components/ConfigEditorDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\t:options=\"{\n\t\t\ttitle: config ? 'Edit Config' : 'Add Config',\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: config ? 'Edit Key' : 'Add Key',\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tloading: docResource?.updateConfig?.loading,\n\t\t\t\t\tonClick: addConfig\n\t\t\t\t}\n\t\t\t]\n\t\t}\"\n\t\tv-model=\"showDialog\"\n\t>\n\t\t<template v-slot:body-content>\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<div :class=\"{ 'pointer-events-none': config }\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\ttype=\"autocomplete\"\n\t\t\t\t\t\tlabel=\"Config Name\"\n\t\t\t\t\t\t:options=\"keyOptions\"\n\t\t\t\t\t\tv-model=\"selectedConfig\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tlabel=\"Key\"\n\t\t\t\t\t:modelValue=\"\n\t\t\t\t\t\tselectedConfig?.value === '__custom_key'\n\t\t\t\t\t\t\t? key\n\t\t\t\t\t\t\t: selectedConfig?.value\n\t\t\t\t\t\"\n\t\t\t\t\t@update:modelValue=\"\n\t\t\t\t\t\tselectedConfig?.value === '__custom_key' ? (key = $event) : null\n\t\t\t\t\t\"\n\t\t\t\t\t:disabled=\"selectedConfig?.value !== '__custom_key'\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"select\"\n\t\t\t\t\tlabel=\"Type\"\n\t\t\t\t\t:modelValue=\"selectedConfig?.type || type\"\n\t\t\t\t\t@update:modelValue=\"type = $event\"\n\t\t\t\t\t:options=\"[\n\t\t\t\t\t\t'String',\n\t\t\t\t\t\t'Number',\n\t\t\t\t\t\t'JSON',\n\t\t\t\t\t\t'Boolean',\n\t\t\t\t\t\tselectedConfig?.value !== '__custom_key' ? 'Password' : null\n\t\t\t\t\t]\"\n\t\t\t\t\t:disabled=\"selectedConfig?.value !== '__custom_key'\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\tv-bind=\"valueInputProps\"\n\t\t\t\t\tlabel=\"Value\"\n\t\t\t\t\tv-model=\"value\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t/>\n\t\t\t\t<ErrorMessage class=\"mt-2\" :message=\"error\" />\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n<script>\nimport {\n\tAutocomplete,\n\tErrorMessage,\n\tFormControl,\n\tgetCachedDocumentResource\n} from 'frappe-ui';\n\nexport default {\n\tname: 'ConfigEditorDialog',\n\tprops: ['site', 'group', 'config'],\n\tcomponents: {\n\t\tAutocomplete,\n\t\tFormControl,\n\t\tErrorMessage\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tdocResource: null,\n\t\t\tshowDialog: true,\n\t\t\tselectedConfig: null,\n\t\t\tkey: null,\n\t\t\ttype: null,\n\t\t\tvalue: null,\n\t\t\terror: null\n\t\t};\n\t},\n\tasync mounted() {\n\t\tif (this.config) {\n\t\t\tawait this.$resources.standardKeys.promise;\n\t\t\tthis.selectedConfig = this.keyOptions.find(\n\t\t\t\toption => this.config.key === option.value\n\t\t\t);\n\t\t\tif (this.selectedConfig) {\n\t\t\t\tthis.key = this.selectedConfig?.value;\n\t\t\t\tthis.type = this.selectedConfig?.type;\n\t\t\t} else {\n\t\t\t\tthis.selectedConfig = this.keyOptions.find(\n\t\t\t\t\toption => '__custom_key' === option.value\n\t\t\t\t);\n\t\t\t\tthis.key = this.config.key;\n\t\t\t\tthis.type = this.config.type;\n\t\t\t}\n\t\t\tthis.value = this.config.type === 'Password' ? '' : this.config.value;\n\t\t}\n\t},\n\tresources: {\n\t\tstandardKeys() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.get_site_config_standard_keys',\n\t\t\t\tcache: 'Site Config Standard Keys',\n\t\t\t\tinitialData: [],\n\t\t\t\tauto: true\n\t\t\t};\n\t\t}\n\t},\n\tmethods: {\n\t\taddConfig() {\n\t\t\tif (this.site) {\n\t\t\t\tthis.docResource = getCachedDocumentResource('Site', this.site);\n\t\t\t} else if (this.group) {\n\t\t\t\tthis.docResource = getCachedDocumentResource(\n\t\t\t\t\t'Release Group',\n\t\t\t\t\tthis.group\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (!this.docResource) return;\n\t\t\tlet key =\n\t\t\t\tthis.selectedConfig?.value == '__custom_key'\n\t\t\t\t\t? this.key\n\t\t\t\t\t: this.selectedConfig?.value;\n\t\t\tlet type = this.selectedConfig?.type || this.type;\n\t\t\tlet value = this.value;\n\t\t\tif (type === 'JSON') {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(value);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.error = 'Invalid JSON';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (type === 'Boolean') {\n\t\t\t\tvalue = value === '1' ? true : false;\n\t\t\t} else if (type === 'Number') {\n\t\t\t\tvalue = Number(value);\n\t\t\t}\n\n\t\t\tlet config = { [key]: value };\n\n\t\t\tthis.docResource.updateConfig.submit(\n\t\t\t\t{ config },\n\t\t\t\t{\n\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\tthis.$emit('success');\n\t\t\t\t\t\tthis.showDialog = false;\n\t\t\t\t\t},\n\t\t\t\t\tonError: error => {\n\t\t\t\t\t\tthis.error = error;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\tcomputed: {\n\t\tkeyOptions() {\n\t\t\tlet customKeyOption = {\n\t\t\t\tlabel: 'Custom Key',\n\t\t\t\tvalue: '__custom_key'\n\t\t\t};\n\t\t\tlet standardKeyOptions = this.$resources.standardKeys.data.map(key => ({\n\t\t\t\tlabel: key.title,\n\t\t\t\tvalue: key.key,\n\t\t\t\ttype: key.type\n\t\t\t}));\n\t\t\treturn [customKeyOption, ...standardKeyOptions];\n\t\t},\n\t\tvalueInputProps() {\n\t\t\tlet type = {\n\t\t\t\tString: 'text',\n\t\t\t\tNumber: 'number',\n\t\t\t\tJSON: 'textarea',\n\t\t\t\tBoolean: 'select'\n\t\t\t}[this.selectedConfig?.type || this.type];\n\n\t\t\treturn {\n\t\t\t\ttype,\n\t\t\t\toptions: type === 'select' ? ['1', '0'] : null\n\t\t\t};\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","__async","option","_a","_b","getCachedDocumentResource","key","type","_c","value","e","config","error","customKeyOption","standardKeyOptions","_hoisted_1","$data","_cache","$event","_withCtx","_createElementVNode","$options","_d","_e"],"mappings":"69BAyEA,MAAAA,EAAA,2BAEC,MAAA,CAAA,OAAA,QAAA,QAAA,2DAMA,MAAA,CACC,MAAA,CACC,YAAA,KACA,WAAA,GACA,eAAA,KACA,IAAA,KACA,KAAA,gBAEA,MAAA,OAGF,SAAA,QAAAC,EAAA,8BACC,KAAA,SACC,MAAA,KAAA,WAAA,aAAA,QACA,KAAA,eAAA,KAAA,WAAA,KACCC,GAAA,KAAA,OAAA,MAAAA,EAAA,4BAGA,KAAA,KAAAC,EAAA,KAAA,iBAAA,YAAAA,EAAA,MACA,KAAA,MAAAC,EAAA,KAAA,iBAAA,YAAAA,EAAA,OAEA,KAAA,eAAA,KAAA,WAAA,KACCF,GAAAA,EAAA,QAAA,kJASH,cAAA,CACC,MAAA,oDAEC,MAAA,4BACA,YAAA,CAAA,EACA,KAAA,GAEF,GAED,QAAA,yEAIE,KAAA,QACC,KAAA,YAAAG,EACC,gBACA,KAAA,iCAIF,IAAAC,IACCH,EAAA,KAAA,iBAAA,YAAAA,EAAA,QAAA,eACC,KAAA,iDAEFI,IAAAC,EAAA,KAAA,iBAAA,YAAAA,EAAA,OAAA,KAAA,KACAC,EAAA,KAAA,MACA,GAAAF,IAAA,OACC,GAAA,gBAEA,OAAAG,EAAA,2BAEC,MACD,6CAIAD,EAAA,OAAAA,CAAA,iBAKD,KAAA,YAAA,aAAA,OACC,CAAA,OAAAE,CAAA,EACA,CACC,UAAA,IAAA,CACC,KAAA,MAAA,SAAA,EACA,KAAA,WAAA,IAED,QAAAC,GAAA,CACC,KAAA,MAAAA,CACD,CACD,EAEF,GAED,SAAA,cAEE,IAAAC,EAAA,CACC,MAAA,aACA,MAAA,gBAEDC,EAAA,KAAA,WAAA,aAAA,KAAA,IAAAR,IAAA,CACC,MAAAA,EAAA,6BAGD,EAAA,EACA,MAAA,CAAAO,EAAA,GAAAC,CAAA,GAED,iBAAA,OACC,IAAAP,EAAA,eAEC,OAAA,SACA,KAAA,WACA,QAAA,QACD,IAAAJ,EAAA,KAAA,iBAAA,YAAAA,EAAA,OAAA,KAAA,IAAA,EAEA,MAAA,QAEC,QAAAI,IAAA,SAAA,CAAA,IAAA,GAAA,EAAA,KAEF,CACD,CACD,EAlLQQ,EAAA,CAAA,MAAA,WAAA,6RAhBR,WAAAC,EAAA,WAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,WAAAE,KAemB,eAAAC,EAAA,IAAA,iBAAA,OAChBC,EAAA,MAAAL,EAAA,2DAGG,KAAA,eACA,MAAA,cACC,QAAAM,EAAA,WArBP,WAAAL,EAAA,eAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,eAAAE,8CA0BK,KAAA,OACA,MAAA,mBACoBf,EAAAa,EAAA,iBAAA,YAAAb,EAAA,SAAA,sBAA+DC,EAAAY,EAAA,iBAAA,YAAAZ,EAAA,kDAKxD,QAAAD,EAAAa,EAAA,iBAAA,YAAAb,EAAA,SAAA,eAAAa,EAAA,IAAAE,EAAA,6EAI3B,aAAA,8CAGA,KAAA,SACA,MAAA,OACC,aAAAI,EAAAN,EAAA,iBAAA,YAAAM,EAAA,OAAAN,EAAA,kGAEgFO,EAAAP,EAAA,iBAAA,YAAAO,EAAA,SAAA,eAAA,WAAA,4EAQjF,aAAA,4EAIA,MAAA,QAxDL,WAAAP,EAAA,MAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,MAAAE,GA0DK,aAAA,qCAEa,MAAA,OAAc,QAAAF,EAAA"}