var h=(s,e,l)=>new Promise((m,n)=>{var i=r=>{try{p(l.next(r))}catch(c){n(c)}},f=r=>{try{p(l.throw(r))}catch(c){n(c)}},p=r=>r.done?m(r.value):Promise.resolve(r.value).then(i,f);p((l=l.apply(s,e)).next())});import{_}from"./WizardCard-D6pRuZbe.js";import{x as T,h as S,o as d,w as v,j as t,q as u,u as b,Y as y,t as k,A as a,ae as R,a8 as A,ag as C,c8 as F,a9 as D,X as I}from"./main-Dpl-JOF2.js";import{_ as x}from"./AppSourceSelector-BL6tcj2j.js";import{_ as V}from"./RichSelect-DPikL6tG.js";(function(){try{var s=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="713bb663-de30-4485-b2ad-a25a904262f1",s._sentryDebugIdIdentifier="sentry-dbid-713bb663-de30-4485-b2ad-a25a904262f1")}catch(l){}})();{var g=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};g._sentryModuleMetadata=g._sentryModuleMetadata||{},g._sentryModuleMetadata[new Error().stack]=Object.assign({},g._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const E={name:"NewBench",props:["saas_app","server"],components:{WizardCard:_,AppSourceSelector:x,RichSelect:V},data(){return{benchTitle:null,selectedVersionName:null,selectedApps:[],selectedRegion:null,serverTitle:null,agreedToRegionConsent:!1}},resources:{options(){return{url:"press.api.bench.options",initialData:{versions:[],clusters:[]},auto:!0,onSuccess(s){this.selectedVersionName||(this.selectedVersionName=this.options.versions.filter(e=>e.default==1)[0].name),this.selectedRegion||(this.selectedRegion=this.options.clusters[0].name)}}},createBench(){return{url:"press.api.bench.new",params:{bench:{title:this.benchTitle,version:this.selectedVersionName,cluster:this.selectedRegion,saas_app:this.saas_app||null,apps:this.selectedApps.map(s=>({name:s.app,source:s.source.name})),server:this.server||null}},validate(){if(!this.benchTitle)return"Bench Title cannot be blank";if(!this.selectedVersionName)return"Select a version to create bench";if(this.selectedApps.length<1)return"Select atleast one app to create bench";if(!this.agreedToRegionConsent)return document.getElementById("region-consent").focus(),"Please agree to the above consent to create bench"},onSuccess(s){this.$router.push(`/groups/${s}`)}}}},mounted(){return h(this,null,function*(){if(this.server){let{title:s,cluster:e}=yield this.$call("press.api.server.get_title_and_cluster",{name:this.server});this.serverTitle=s,this.selectedRegion=e}})},watch:{selectedVersionName(){this.$nextTick(()=>{let s=this.getFrappeApp(this.selectedVersion.apps);this.selectedApps=[{app:s.name,source:s.source}]})},selectedApps:{handler(s,e){!s.find(m=>m.app==="frappe")&&e&&(this.selectedApps=e)},deep:!0}},methods:{getFrappeApp(s){return s.find(e=>e.name==="frappe")}},computed:{options(){return this.$resources.options.data},selectedVersion(){return this.options.versions.find(s=>s.name===this.selectedVersionName)},versionOptions(){return this.options.versions.map(s=>({label:`${s.name} (${s.status})`,value:s.name}))},regionOptions(){let s=this.options.clusters;return this.server&&this.selectedRegion&&(s=s.filter(e=>e.name===this.selectedRegion)),s.map(e=>({label:e.title,value:e.name,image:e.image,beta:e.beta}))}}},O={class:"mb-6 text-center"},j={key:0,class:"text-base text-gray-700"},M={class:"font-medium"},U={key:0,class:"flex justify-center"},P={key:1,class:"space-y-8 sm:space-y-6"},W={key:0},z={class:"mt-2"},Y={key:1},$={class:"mt-4"},q={class:"my-6"},K={class:"flex justify-between"};function L(s,e,l,m,n,i){const f=R,p=A,r=V,c=x,w=D,B=I,N=_;return d(),S(N,null,{default:v(()=>[t("div",null,[t("div",O,[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold sm:text-center"},"New Bench",-1)),n.serverTitle?(d(),u("p",j,[e[6]||(e[6]=y(" Bench will be created on server ")),t("span",M,k(n.serverTitle.slice(0,-14)),1)])):b("",!0)]),s.$resources.options.loading?(d(),u("div",U,[a(f)])):(d(),u("div",P,[t("div",null,[e[8]||(e[8]=t("label",{class:"text-lg font-semibold"}," Choose a name for your bench ",-1)),e[9]||(e[9]=t("p",{class:"text-base text-gray-700"}," Name your bench based on its purpose. For e.g., Personal Websites, Staging Bench, etc. ",-1)),a(p,{class:"mt-2",modelValue:n.benchTitle,"onUpdate:modelValue":e[0]||(e[0]=o=>n.benchTitle=o)},null,8,["modelValue"])]),i.regionOptions.length>0?(d(),u("div",W,[e[10]||(e[10]=t("h2",{class:"text-lg font-semibold"},"Select Region",-1)),e[11]||(e[11]=t("p",{class:"text-base text-gray-700"}," Select the datacenter region where your bench should be created ",-1)),t("div",z,[a(r,{value:n.selectedRegion,onChange:e[1]||(e[1]=o=>n.selectedRegion=o),options:i.regionOptions},null,8,["value","options"])])])):b("",!0),t("div",null,[e[12]||(e[12]=t("label",{class:"text-lg font-semibold"}," Select a Frappe version ",-1)),e[13]||(e[13]=t("p",{class:"text-base text-gray-700"}," Select a Frappe version for your bench. ",-1)),a(p,{class:"mt-2",type:"select",modelValue:n.selectedVersionName,"onUpdate:modelValue":e[2]||(e[2]=o=>n.selectedVersionName=o),options:i.versionOptions},null,8,["modelValue","options"])]),n.selectedVersionName?(d(),u("div",Y,[e[14]||(e[14]=t("label",{class:"text-lg font-semibold"}," Select apps to install ",-1)),e[15]||(e[15]=t("p",{class:"text-base text-gray-700"}," These apps will be available for sites on your bench. You can also add apps to your bench later. ",-1)),t("div",$,[a(c,{apps:[...i.selectedVersion.apps.filter(o=>o.name==="frappe"),...i.selectedVersion.apps.filter(o=>o.name!=="frappe")],modelValue:n.selectedApps,"onUpdate:modelValue":e[3]||(e[3]=o=>n.selectedApps=o),multiple:!0},null,8,["apps","modelValue"])])])):b("",!0),t("div",q,[C(t("input",{id:"region-consent",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500","onUpdate:modelValue":e[4]||(e[4]=o=>n.agreedToRegionConsent=o)},null,512),[[F,n.agreedToRegionConsent]]),e[16]||(e[16]=t("label",{for:"region-consent",class:"ml-1 text-sm font-semibold text-gray-900"}," I agree that the laws of the region selected by me shall stand applicable to me and Frappe. ",-1))]),t("div",K,[a(w,{class:"mb-2",message:s.$resources.createBench.error},null,8,["message"]),a(B,{variant:"solid",class:"ml-auto",loading:s.$resources.createBench.loading,onClick:e[5]||(e[5]=o=>s.$resources.createBench.submit())},{default:v(()=>e[17]||(e[17]=[y(" Create Bench ")])),_:1},8,["loading"])])]))])]),_:1})}const G=T(E,[["render",L]]);export{G as default};
//# sourceMappingURL=NewBench-9gQ6k6UR.js.map
