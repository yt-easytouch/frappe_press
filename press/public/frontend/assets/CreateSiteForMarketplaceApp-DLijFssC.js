import{x as w,r as m,q as a,o,A as c,j as s,w as y,u as v,t as d,Y as _,F as B,v as S,h,bp as C,n as F,B as $}from"./main-Dpl-JOF2.js";import{_ as G}from"./alert-circle-DHphV4ie.js";import{_ as I}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CH7TZuXP.js";import{_ as N}from"./Header-BNMc-OFG.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="1a9721a5-be74-401b-9d0c-d0dfd387dde9",e._sentryDebugIdIdentifier="sentry-dbid-1a9721a5-be74-401b-9d0c-d0dfd387dde9")}catch(n){}})();{var l=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};l._sentryModuleMetadata=l._sentryModuleMetadata||{},l._sentryModuleMetadata[new Error().stack]=Object.assign({},l._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const V={props:{app:{type:String,required:!0}},pageMeta(){return{title:`Install ${this.appDoc.title} - Easytouch Cloud`}},components:{FBreadcrumbs:I,Header:N},data(){return{siteGroupDeployName:this.$route.query.siteGroupDeployName}},mounted(){this.$socket.emit("doc_subscribe","Site Group Deploy",this.siteGroupDeployName),this.$socket.on("doc_update",()=>{this.$resources.siteGroupDeploy.reload()})},resources:{app(){return{url:"press.api.marketplace.get",params:{app:this.app},auto:!0}},siteGroupDeploy(){return{type:"document",doctype:"Site Group Deploy",name:this.siteGroupDeployName,onSuccess:e=>{e.status==="Site Created"&&setTimeout(()=>{this.$router.push({name:"Site Detail Overview",params:{name:e.site}})},1e3)}}}},computed:{failure(){var e;return["Site Creation Failed","Bench Deploy Failed"].includes((e=this.$resources.siteGroupDeploy.doc)==null?void 0:e.status)},failureRoute(){var e,t;if(((e=this.$resources.siteGroupDeploy.doc)==null?void 0:e.status)==="Bench Deploy Failed")return{name:"Release Group Detail Deploys",params:{name:this.$resources.siteGroupDeploy.doc.release_group}};if(((t=this.$resources.siteGroupDeploy.doc)==null?void 0:t.status)==="Site Creation Failed")return{name:"Site Jobs",params:{name:this.$resources.siteGroupDeploy.doc.site}}},steps(){var n,u;const e=p=>p?["Pending","Deploying Bench","Bench Deployed","Bench Deploy Failed","Creating Site","Site Created","Site Creation Failed"].indexOf(p):-1,t=(u=(n=this.$resources.siteGroupDeploy)==null?void 0:n.doc)==null?void 0:u.status;return[{id:0,title:"Initializing",description:"Initializing the setup",status:"Pending",icon:()=>{if(e(t)===0)return"loading";if(e(t)>0)return"check"},message:"This should take a few minutes"},{id:1,title:e(t)<=1?"Deploying Bench":"Bench Deployed",description:"Deploying bench on the server",status:"Deploying Bench",icon:()=>t==="Bench Deploy Failed"?"x":e(t)===1?"loading":e(t)>1?"check":"clock",message:"This should take a few minutes"},{id:2,title:e(t)<=4?"Creating Site":"Site Created",description:"Creating site on the server",status:"Creating Site",icon:()=>t==="Site Creation Failed"?"x":e(t)===4?"loading":e(t)>4?"check":"clock",message:"This should take a few minutes"}]},appDoc(){return this.$resources.app.data||{}}}},A={class:"top-0 z-10 shrink-0"},E={class:"m-12 mx-auto max-w-2xl px-5"},T={key:0,class:"py-4 text-base text-gray-600"},z={key:1,class:"space-y-6"},M={class:"mb-12 flex"},P=["src","alt"],j={class:"my-1 ml-4 flex flex-col justify-between"},q={class:"text-lg font-semibold"},H={class:"text-sm text-gray-600"},L={key:0,class:"flex items-center space-x-2 rounded border border-gray-200 bg-gray-100 p-4 text-base text-gray-700"},O={class:"divide-y rounded-lg bg-gray-50 px-4"},R={class:"flex items-center space-x-4"},J={class:"flex flex-col space-y-1"},K={class:"text-base"};function Y(e,t,n,u,p,i){const f=m("FBreadcrumbs"),g=m("Header"),D=G,b=m("router-link"),x=C,k=$;return o(),a("div",A,[c(g,null,{default:y(()=>[c(f,{items:[{label:"Install App",route:{name:"InstallApp",params:{app:n.app}}}]},null,8,["items"])]),_:1}),s("div",E,[e.$resources.app.loading?(o(),a("div",T," Loading... ")):(o(),a("div",z,[s("div",M,[s("img",{src:i.appDoc.image,class:"h-12 w-12 rounded-lg border",alt:i.appDoc.name},null,8,P),s("div",j,[s("h1",q,d(i.appDoc.title),1),s("p",H,d(i.appDoc.description),1)])]),i.failure?(o(),a("div",L,[c(D,{class:"inline-block h-5 w-5"}),s("p",null,[t[0]||(t[0]=_(" Failed to install the app. ")),c(b,{class:"underline",to:i.failureRoute},{default:y(()=>{var r;return[_(d(((r=e.$resources.siteGroupDeploy.doc)==null?void 0:r.status)==="Bench Deploy Failed"?"View Deploy":"View Job"),1)]}),_:1},8,["to"]),t[1]||(t[1]=_(" . "))])])):v("",!0),s("div",O,[(o(!0),a(B,null,S(i.steps,r=>(o(),a("div",{key:r.id,class:"flex items-center border-gray-200 px-1 py-3"},[s("div",R,[r.icon()==="loading"?(o(),h(x,{key:0,class:"h-4 w-4 text-gray-900"})):(o(),h(k,{key:1,name:r.icon(),class:F(["h-5 w-5 rounded-full p-0.5 text-white",{"bg-green-500":r.icon()==="check","bg-red-500":r.icon()==="x","bg-gray-500":r.icon()==="clock"}]),"stroke-width":3},null,8,["name","class"])),s("div",J,[s("h5",K,d(r.title),1)])])]))),128))])]))])])}const Z=w(V,[["render",Y]]);export{Z as default};
//# sourceMappingURL=CreateSiteForMarketplaceApp-DLijFssC.js.map
