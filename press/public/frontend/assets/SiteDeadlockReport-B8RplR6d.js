import{_ as D}from"./Card-BCzTSeNK.js";import{x as w,q as s,o as a,A as r,ae as T,w as f,u as n,h as R,X as b,Y as $,j as v}from"./main-Dpl-JOF2.js";import{_}from"./Report-BW6SUxnb.js";import{D as x}from"./datetime-PXpIdgFA.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="276e2fae-92ca-4076-8d35-d17491d16fe6",e._sentryDebugIdIdentifier="sentry-dbid-276e2fae-92ca-4076-8d35-d17491d16fe6")}catch(d){}})();{var o=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};o._sentryModuleMetadata=o._sentryModuleMetadata||{},o._sentryModuleMetadata[new Error().stack]=Object.assign({},o._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const I={name:"SiteDeadlockReport",props:["site"],components:{Report:_},data(){return{filters:[{name:"start_datetime",label:"From:",type:"date",value:this.today},{name:"end_datetime",label:"To:",type:"date",value:this.today}],max_lines:20}},watch:{startTime(){this.reset()},endTime(){this.reset()}},resources:{deadlockReport(){var e;return{url:"press.api.analytics.deadlock_report",params:{site:(e=this.site)==null?void 0:e.name,start:this.startTime||this.today,end:this.endTime||this.today,max_lines:this.max_lines},auto:!0,pageLength:10,keepData:!0,initialData:[]}},getPlan(){var e;return{url:"press.api.site.current_plan",params:{name:(e=this.site)==null?void 0:e.name},auto:!0}}},methods:{reset(){this.$resources.deadlockReport.reset()}},computed:{today(){return x.local().toISODate()},startTime(){return this.filters[0].value},endTime(){return this.filters[1].value},formatDeadlockData(){let e=[];return this.$resources.deadlockReport.data.forEach(t=>{let i=[{name:"Timestamp",value:this.formatDate(t.timestamp,"TIME_24_WITH_SHORT_OFFSET"),class:"w-2/12"},{name:"Query",value:t.query,class:"w-10/12"}];e.push(i)}),e}}},B={key:0,class:"flex items-center justify-center"},E={key:1},N={key:0,class:"px-2 py-2 text-base text-gray-600"},P={key:1,class:"content-center py-2 text-base"},S={key:2,class:"flex justify-center"};function j(e,t,d,i,l,y){var c,p,m;const u=T,g=_,k=b,h=D;return(c=e.$resources.getPlan)!=null&&c.loading?(a(),s("div",B,[r(u)])):(m=(p=e.$resources.getPlan)==null?void 0:p.data)!=null&&m.monitor_access?(a(),s("div",E,[r(h,null,{default:f(()=>[r(g,{filters:l.filters,columns:[{label:"Timestamp",name:"timestamp",class:"w-2/12"},{label:"Query",name:"query",class:"w-10/12"}],data:y.formatDeadlockData,title:"MariaDB Deadlock Report"},null,8,["filters","data"]),e.$resources.deadlockReport.loading&&e.$resources.deadlockReport.data.length==0?(a(),s("div",N,[r(u)])):n("",!0),!e.$resources.deadlockReport.loading&&e.$resources.deadlockReport.data.length==0?(a(),s("div",P," No data ")):n("",!0),e.$resources.deadlockReport.data&&e.$resources.deadlockReport.data.length?(a(),R(k,{key:2,loading:e.$resources.deadlockReport.loading,loadingText:"Loading...",onClick:t[0]||(t[0]=C=>l.max_lines+=10)},{default:f(()=>t[1]||(t[1]=[$(" Load more ")])),_:1},8,["loading"])):n("",!0)]),_:1})])):(a(),s("div",S,t[2]||(t[2]=[v("span",{class:"mt-16 text-base text-gray-700"}," Your plan doesn't support this feature. Please upgrade your plan. ",-1)])))}const q=w(I,[["render",j]]);export{q as default};
//# sourceMappingURL=SiteDeadlockReport-B8RplR6d.js.map
