{"version":3,"file":"SiteChangeRegionDialog-DIZ6Jaew.js","sources":["../../../../dashboard/src2/components/site/SiteChangeRegionDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\t:options=\"{\n\t\t\ttitle: 'Change Region',\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Change Region',\n\t\t\t\t\tloading: $resources.changeRegion.loading,\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tdisabled: !selectedRegion,\n\t\t\t\t\tonClick: changeRegion\n\t\t\t\t}\n\t\t\t]\n\t\t}\"\n\t\tv-model=\"show\"\n\t\t@close=\"resetValues\"\n\t>\n\t\t<template #body-content>\n\t\t\t<LoadingIndicator\n\t\t\t\tclass=\"mx-auto h-4 w-4\"\n\t\t\t\tv-if=\"$resources.changeRegionOptions.loading\"\n\t\t\t/>\n\t\t\t<div v-else class=\"space-y-4\">\n\t\t\t\t<FormControl\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\ttype=\"autocomplete\"\n\t\t\t\t\tlabel=\"Choose Region\"\n\t\t\t\t\tv-model=\"selectedRegion\"\n\t\t\t\t\t:options=\"\n\t\t\t\t\t\t$resources.changeRegionOptions.data.regions.map(r => ({\n\t\t\t\t\t\t\tlabel: r.title || r.name,\n\t\t\t\t\t\t\tvalue: r.name,\n\t\t\t\t\t\t\timage: r.image\n\t\t\t\t\t\t}))\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<img :src=\"selectedRegion?.image\" class=\"mr-2 h-4\" />\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #item-prefix=\"{ active, selected, option }\">\n\t\t\t\t\t\t<img v-if=\"option?.image\" :src=\"option.image\" class=\"mr-2 h-4\" />\n\t\t\t\t\t</template>\n\t\t\t\t</FormControl>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"space-y-4\"\n\t\t\t\t\tv-if=\"\n\t\t\t\t\t\t$resources.changeRegionOptions.data?.regions?.length > 0 &&\n\t\t\t\t\t\tselectedRegion\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t<DateTimeControl v-model=\"targetDateTime\" label=\"Schedule Time\" />\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tlabel=\"Skip failing patches if any\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tv-model=\"skipFailingPatches\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<p\n\t\t\t\t\tv-else-if=\"!$site.doc.group_public\"\n\t\t\t\t\tclass=\"mt-4 text-sm text-gray-600\"\n\t\t\t\t>\n\t\t\t\t\tIf the region you're looking for isn't available, please add from the\n\t\t\t\t\tBench Group dashboard.\n\t\t\t\t</p>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"rounded border border-gray-200 bg-gray-100 p-2\"\n\t\t\t\t\tv-if=\"$resources.ARecords.data?.length == 0\"\n\t\t\t\t>\n\t\t\t\t\t<p class=\"text-sm text-gray-700\">\n\t\t\t\t\t\t<strong>Note</strong>: This site seems to have custom domains with\n\t\t\t\t\t\t<strong>A record</strong>. Please update the same after migration to\n\t\t\t\t\t\tavoid downtime. To know more, refer\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://easytouch.cloud/docs/sites/custom-domains\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\tclass=\"underline\"\n\t\t\t\t\t\t\t>the documentation.</a\n\t\t\t\t\t\t>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ErrorMessage class=\"mt-3\" :message=\"$resources.changeRegion.error\" />\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script>\nimport { getCachedDocumentResource } from 'frappe-ui';\nimport { toast } from 'vue-sonner';\nimport DateTimeControl from '../DateTimeControl.vue';\n\nexport default {\n\tprops: ['site'],\n\tdata() {\n\t\treturn {\n\t\t\tshow: true,\n\t\t\ttargetDateTime: null,\n\t\t\tselectedRegion: null,\n\t\t\tskipFailingPatches: false\n\t\t};\n\t},\n\tcomponents: {\n\t\tDateTimeControl\n\t},\n\tcomputed: {\n\t\tdatetimeInIST() {\n\t\t\tif (!this.targetDateTime) return null;\n\t\t\tconst datetimeInIST = this.$dayjs(this.targetDateTime)\n\t\t\t\t.tz('Asia/Kolkata')\n\t\t\t\t.format('YYYY-MM-DDTHH:mm');\n\n\t\t\treturn datetimeInIST;\n\t\t},\n\t\t$site() {\n\t\t\treturn getCachedDocumentResource('Site', this.site);\n\t\t}\n\t},\n\tresources: {\n\t\tARecords() {\n\t\t\treturn {\n\t\t\t\ttype: 'list',\n\t\t\t\tdoctype: 'Site Domain',\n\t\t\t\tfilters: {\n\t\t\t\t\tsite: this.site,\n\t\t\t\t\tdns_type: 'A',\n\t\t\t\t\tdomain: ['!=', this.site]\n\t\t\t\t},\n\t\t\t\tlimit: 1,\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tchangeRegionOptions() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.change_region_options',\n\t\t\t\tparams: {\n\t\t\t\t\tname: this.site\n\t\t\t\t},\n\t\t\t\tauto: true\n\t\t\t};\n\t\t},\n\t\tchangeRegion() {\n\t\t\treturn {\n\t\t\t\turl: 'press.api.site.change_region'\n\t\t\t};\n\t\t}\n\t},\n\tmethods: {\n\t\tchangeRegion() {\n\t\t\ttoast.promise(\n\t\t\t\tthis.$resources.changeRegion.submit({\n\t\t\t\t\tname: this.site,\n\t\t\t\t\tcluster: this.selectedRegion?.value,\n\t\t\t\t\tscheduled_datetime: this.datetimeInIST,\n\t\t\t\t\tskip_failing_patches: this.skipFailingPatches\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\tthis.show = false;\n\t\t\t\t\t\treturn `Site scheduled to be migrated to ${this.selectedRegion?.label}`;\n\t\t\t\t\t},\n\t\t\t\t\tloading: `Scheduling site to be migrated to ${this.selectedRegion?.label}...`,\n\t\t\t\t\terror: error =>\n\t\t\t\t\t\terror.messages?.length\n\t\t\t\t\t\t\t? error.messages.join('\\n')\n\t\t\t\t\t\t\t: error.message || 'Failed to schedule site migration'\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tresetValues() {\n\t\t\tthis.selectedRegion = null;\n\t\t\tthis.targetDateTime = null;\n\t\t}\n\t}\n};\n</script>\n"],"names":["_sfc_main","DateTimeControl","_a","_b","error","_hoisted_2","_hoisted_3","$data","_cache","$event","$options","_withCtx","_openBlock","_createElementBlock","_hoisted_1","r","active","selected","option","_createCommentVNode","_ctx","_hoisted_4","_c","_hoisted_6","_createElementVNode","_createTextVNode"],"mappings":"s1BA4FA,MAAAA,EAAA,CACC,MAAA,CAAA,MAAA,EACA,MAAA,CACC,MAAA,CACC,KAAA,GACA,eAAA,KACA,eAAA,yCAKD,gBAAAC,GAED,SAAA,CACC,eAAA,CACC,OAAA,KAAA,gDAEC,GAAA,cAAA,6BAFD,MAOD,OAAA,2BAEA,yBAIC,MAAA,aAEC,QAAA,cACA,QAAA,CACC,KAAA,KAAA,2CAID,MAAA,EACA,KAAA,KAGF,qBAAA,CACC,MAAA,CACC,IAAA,uCACA,OAAA,iBAGA,KAAA,KAGF,cAAA,CACC,MAAA,CACC,IAAA,+BAEF,GAED,QAAA,CACC,cAAA,mBAEE,KAAA,WAAA,aAAA,OAAA,CACC,KAAA,KAAA,KACA,SAAAC,EAAA,KAAA,iBAAA,YAAAA,EAAA,MACA,mBAAA,KAAA,cACA,qBAAA,KAAA,kBACD,CAAA,EACA,oBAEE,YAAA,KAAA,GACA,qCAAAA,EAAA,KAAA,iBAAA,YAAAA,EAAA,KAAA,IAED,QAAA,sCAAAC,EAAA,KAAA,iBAAA,YAAAA,EAAA,KAAA,sBAEC,OAAAD,EAAAE,EAAA,WAAA,MAAAF,EAAA;kDAGF,mEAMF,CACD,CACD,WAxJe,MAAA,aAtBfG,EAAA,CAAA,KAAA,EAAAC,EAAA,CAAA,KAAA,WA4CK,MAAA,sBAgBA,MAAA,uCAMA,MAAA,qTAlEL,WAAAC,EAAA,KAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,KAAAE,GAeG,QAAAC,EAAA,cAEU,eAAAC,EAAA,IAAA,WAAA,gEAET,MAAA,sBAGDC,IAAAC,EAAA,MAAAC,EAAA,MAEE,QAAA,UACA,KAAA,eACA,MAAA,gBA1BL,WAAAP,EAAA,eAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,eAAAE,kEA4B4F,MAAAM,EAAA,OAAAA,EAAA,KAAiC,MAAAA,EAAA,KAAsB,MAAAA,EAAA,WAQnI,OAAAJ,EAAA,IAAA,OAAA,8DACwB,MAAA,UArCxC,EAAA,KAAA,EAAAN,CAAA,KAuCgB,cAAAM,EAAA,CAAA,CAAA,OAAAK,EAAA,SAAAC,EAAA,OAAAC,CAAA,IAAA,CACCA,GAAA,MAAAA,EAAA,sCAAmC,MAAA,UAxCpD,EAAA,KAAA,EAAAZ,CAAA,GAAAa,EAAA,GAAA,EAAA,uCA6CkBhB,GAAAD,EAAAkB,EAAA,WAAA,oBAAA,OAAA,YAAAlB,EAAA,UAAA,YAAAC,EAAA,QAAA,qBAFdS,IAAAC,EAAA,MAAAQ,EAAA,MA3CJ,WAAAd,EAAA,eAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,eAAAE,GAmD+C,MAAA,6CAEzC,MAAA,8BACA,KAAA,WAtDN,WAAAF,EAAA,mBAAA,sBAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAF,EAAA,mBAAAE,uDAAAU,EAAA,GAAA,EAAA,oHAmEWG,EAAAF,EAAA,WAAA,SAAA,OAAA,YAAAE,EAAA,SAAA,GAFPV,EAAA,EAAAC,EAAA,MAAAU,EAAAf,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,wCAKEgB,EAAA,SAAA,KAAA,MAAA,EAtENC,EAAA,gDAAA,EAuEMD,EAAA,SAAA,KAAA,UAAA,EAvENC,EAAA,kFAAA,SA0EO,KAAA,oDACA,OAAA,SACA,MAAA,4CA5EPN,EAAA,GAAA,EAAA,UAkFiB,MAAA,OAAc,QAAAC,EAAA,WAAA,aAAA"}