import{x as I,q as l,o as r,F as $,v as B,j as o,t as v,n as D,ag as z,A as a,u,B as N,a7 as T,ah as E,w as g,X as x,Y as p,C as j,af as S,h as R,ae as q,a9 as F,ak as L}from"./main-Dpl-JOF2.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="5644dc7b-810c-4a8a-adda-085f11a896e4",t._sentryDebugIdIdentifier="sentry-dbid-5644dc7b-810c-4a8a-adda-085f11a896e4")}catch(i){}})();{var k=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};k._sentryModuleMetadata=k._sentryModuleMetadata||{},k._sentryModuleMetadata[new Error().stack]=Object.assign({},k._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const V={name:"NewAppRepositories",emits:["update:selectRepo","update:selectedBranch","update:selectedInstallation"],props:["options","repositoryResource","selectedRepo","selectedInstallation","selectedBranch"],methods:{selectRepo(t,e){t!==this.selectedRepo&&(this.$emit("update:selectedRepo",t),this.$emit("update:selectedInstallation",e),this.$emit("update:selectedBranch",null))}},computed:{branchOptions(){return this.repositoryResource.loading||!this.repositoryResource.data?[]:(this.repositoryResource.data.branches||[]).map(t=>({label:t.name,onClick:()=>this.$emit("update:selectedBranch",t.name)}))}}},H={class:"cursor-pointer"},M={class:"flex w-full select-none items-center space-x-2 rounded px-2 py-3 text-base hover:bg-gray-50"},O=["src","alt"],G={class:"mb-4 ml-4"},U=["onClick"],J={class:"flex w-full items-center"},K={class:"text-lg font-medium"},P={class:"mt-4 text-sm text-gray-700"};function X(t,e,i,m,n,s){const h=N,_=x,b=j,w=S;return r(),l("div",null,[(r(!0),l($,null,B(i.options.installations,d=>(r(),l("div",{key:d.id},[o("details",H,[o("summary",M,[o("img",{class:"h-6 w-6 rounded bg-blue-100 object-cover",src:d.image,alt:`${d.login} image`},null,8,O),o("span",null,v(d.login),1)]),o("div",G,[(r(!0),l($,null,B(d.repos,c=>(r(),l("button",{class:D(["w-full rounded-md border-2 px-3 py-2 text-base text-gray-900 focus:outline-none",i.selectedRepo===c?"border-blue-500 bg-blue-50":"border-transparent hover:bg-gray-50"]),key:c.id,onClick:y=>s.selectRepo(c,d)},[o("div",J,[a(h,{name:c.private?"lock":"book",class:"mr-2 h-4 w-4"},null,8,["name"]),o("span",K,v(c.name),1),i.selectedRepo===c?(r(),l("button",{key:0,class:"ml-auto",onClick:e[0]||(e[0]=T(y=>s.selectRepo(null,null),["stop"]))},[a(h,{name:"x",class:"h-4 w-4"})])):u("",!0)]),z(o("div",null,[a(b,{class:"ml-6 mt-2 text-left",options:s.branchOptions},{default:g(({open:y})=>[a(_,{type:"white",loading:i.repositoryResource.loading,loadingText:"Loading branches...","icon-right":"chevron-down"},{default:g(()=>[p(v(i.selectedBranch||"Select branch"),1)]),_:1},8,["loading"])]),_:1},8,["options"])],512),[[E,i.selectedRepo===c]])],10,U))),128)),o("p",P,[e[2]||(e[2]=p(" Don't see your repository here? ")),a(w,{href:d.url,class:"font-medium"},{default:g(()=>e[1]||(e[1]=[p(" Add from GitHub ")])),_:2},1032,["href"])])])])]))),128))])}const C=I(V,[["render",X]]),Y={name:"SelectAppFromGithub",components:{NewAppRepositories:C},data(){return{selectedRepo:null,selectedInstallation:null,selectedBranch:null,requiresReAuth:!1}},resources:{options(){return{url:"press.api.github.options",auto:!0,onError(t){t.messages.includes("Bad credentials")&&(this.requiresReAuth=!0)}}},repository(){var i,m,n;let t=this.selectedInstallation&&this.selectedRepo;return{url:"press.api.github.repository",params:{installation:(i=this.selectedInstallation)==null?void 0:i.id,owner:(m=this.selectedInstallation)==null?void 0:m.login,name:(n=this.selectedRepo)==null?void 0:n.name},auto:t,onSuccess(s){this.selectedBranch=s.default_branch}}},validateApp(){var e,i,m;return{url:"press.api.github.app",params:{installation:(e=this.selectedInstallation)==null?void 0:e.id,owner:(i=this.selectedInstallation)==null?void 0:i.login,repository:(m=this.selectedRepo)==null?void 0:m.name,branch:this.selectedBranch},onSuccess(n){var s,h;if(n){const _={name:n.name,title:n.title,repository_url:(s=this.selectedRepo)==null?void 0:s.url,branch:this.selectedBranch,github_installation_id:(h=this.selectedInstallation)==null?void 0:h.id};this.$emit("onSelect",_)}},onError(){this.$emit&&this.$emit("onSelect",null)}}},clearAccessToken(){return{url:"press.api.github.clear_token_and_get_installation_url",onSuccess(t){window.location.href=t+"?state="+this.state}}}},computed:{options(){return this.$resources.options.data},needsAuthorization(){return this.$resources.options.loading?!1:this.$resources.options.data&&(!this.$resources.options.data.authorized||this.$resources.options.data.installations.length===0)},state(){let t=window.location.href,e={team:this.$account.team.name,url:t};return btoa(JSON.stringify(e))},validatedApp(){return this.$resources.validateApp.loading||!this.$resources.validateApp.data?(this.$emit("onSelect",null),null):this.$resources.validateApp.data&&this.$resources.validateApp.data.name?this.$resources.validateApp.data:(this.$emit("onSelect",null),null)}}},Q={class:"flex justify-center"},W={class:"flex flex-col items-center gap-2"},Z={key:1},ee={key:0},te={key:0},se={class:"flex items-baseline justify-between border-b pb-1"},ne={class:"text-sm text-gray-600"},oe={class:"mt-2"},re={key:0,class:"text-medium mt-4 text-base"},ie={key:0,class:"flex"};function ae(t,e,i,m,n,s){var y,A;const h=q,_=F,b=x,w=S,d=C,c=L;return r(),l("div",null,[o("div",Q,[t.$resources.options.loading?(r(),R(h,{key:0})):u("",!0),o("div",W,[a(_,{message:(A=(y=t.$resources.options)==null?void 0:y.error)!=null&&A.messages&&t.$resources.options.error.messages.includes("Bad credentials")?"Access token expired, reauthorization required":t.$resources.options.error},null,8,["message"]),n.requiresReAuth?(r(),R(b,{key:0,variant:"solid","icon-left":"github",onClick:e[0]||(e[0]=f=>t.$resources.clearAccessToken.submit()),loading:t.$resources.clearAccessToken.loading},{default:g(()=>e[5]||(e[5]=[p(" Reauthorize GitHub")])),_:1},8,["loading"])):u("",!0),a(_,{message:t.$resources.clearAccessToken.error},null,8,["message"])]),s.needsAuthorization?(r(),l("div",Z,[a(b,{variant:"solid","icon-left":"github",link:s.options.installation_url+"?state="+s.state},{default:g(()=>e[6]||(e[6]=[p(" Connect To GitHub ")])),_:1},8,["link"])])):u("",!0)]),s.options?(r(),l("div",ee,[s.options.authorized&&s.options.installations.length>0?(r(),l("div",te,[o("div",se,[e[9]||(e[9]=o("label",{class:"text-lg font-semibold"}," Select a repository ",-1)),o("span",ne,[e[8]||(e[8]=p(" Don't see your organization? ")),a(w,{href:s.options.installation_url+"?state="+s.state,class:"font-medium"},{default:g(()=>e[7]||(e[7]=[p(" Add from GitHub ")])),_:1},8,["href"])])]),o("div",oe,[a(d,{options:s.options,repositoryResource:t.$resources.repository,selectedRepo:n.selectedRepo,"onUpdate:selectedRepo":e[1]||(e[1]=f=>n.selectedRepo=f),selectedInstallation:n.selectedInstallation,"onUpdate:selectedInstallation":e[2]||(e[2]=f=>n.selectedInstallation=f),selectedBranch:n.selectedBranch,"onUpdate:selectedBranch":e[3]||(e[3]=f=>n.selectedBranch=f)},null,8,["options","repositoryResource","selectedRepo","selectedInstallation","selectedBranch"]),t.$resources.validateApp.data?(r(),l("div",re,[s.validatedApp?(r(),l("div",ie,[a(c,{class:"mr-2 w-4"}),p(" Found "+v(s.validatedApp.title)+" ("+v(s.validatedApp.name)+") ",1)])):u("",!0)])):u("",!0)]),o("div",null,[a(_,{class:"mb-2",message:t.$resources.validateApp.error},null,8,["message"]),n.selectedRepo&&n.selectedBranch&&!s.validatedApp?(r(),R(b,{key:0,class:"mt-2",variant:"solid",onClick:e[4]||(e[4]=f=>t.$resources.validateApp.submit()),loading:t.$resources.validateApp.loading},{default:g(()=>e[10]||(e[10]=[p(" Validate App ")])),_:1},8,["loading"])):u("",!0)])])):u("",!0)])):u("",!0)])}const de=I(Y,[["render",ae]]);export{de as _};
//# sourceMappingURL=SelectAppFromGithub-O0_GyuCD.js.map
