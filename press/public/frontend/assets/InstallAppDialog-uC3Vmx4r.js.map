{"version":3,"mappings":"syBAuBA,MAAAA,EAAA,CACC,uCAMA,8CAIA,OACC,OACC,UAGF,UACC,oEAKE,8EAGC,qBAGC,kGAKC,IAAAC,EACA,sFAKG,KAAAC,EAAA,IACD,GACA,6BAEC,QAAAC,YAEE,gBACA,QACC,eACA,GAAAA,EAEF,2BAEA,aACA,iCAED,MAAAC,GAAAC,EAAAD,CAAA,IAIJ,0DAMA,GACA,6BAEC,QAAAD,YAEE,gBACA,QACC,eACA,GAAAA,EAEF,2BAEA,aACA,iCAED,MAAAC,GAAAC,EAAAD,CAAA,KAKJ,mBAEC,0CAEA,+EAGE,sCAEF,SACC,eAEC,kBACA,oBACA,QACA,QAAAE,EAAAL,IAAAK,GAAAL,EAAA,WAED,2CAGC,qCAGD,CACC,eACA,mBACA,qCAGD,CACC,+EAMC,OACC,6BAECM,EAAAN,CAAA,qBAOJ,CACC,oCACA,QACC,gBAED,YAMN,sEArKA,WAAAO,EAAA,2BAAAC,EAAA,KAAAA,EAAA,GAAAC,GAAAF,EAAA,KAAAE,GAGG,oDAGA,IAEU,eAAAC,EAAA","names":["_sfc_main","row","plan","jobId","e","getToastErrorMessage","value","handleInstall","$data","_cache","$event","_withCtx"],"sources":["../../../../dashboard/src2/components/site/InstallAppDialog.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\tv-model=\"show\"\n\t\t:options=\"{\n\t\t\ttitle: 'Install app on your site',\n\t\t\tsize: '4xl',\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<ObjectList :options=\"listOptions\" />\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script>\nimport { getCachedDocumentResource } from 'frappe-ui';\nimport { defineAsyncComponent, h } from 'vue';\nimport { toast } from 'vue-sonner';\nimport { renderDialog } from '../../utils/components';\nimport router from '../../router';\nimport ObjectList from '../ObjectList.vue';\nimport { getToastErrorMessage } from '../../utils/toast';\n\nexport default {\n\tprops: {\n\t\tsite: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['installed'],\n\tcomponents: {\n\t\tObjectList,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tshow: true,\n\t\t};\n\t},\n\tcomputed: {\n\t\t$site() {\n\t\t\treturn getCachedDocumentResource('Site', this.site);\n\t\t},\n\t\tlistOptions() {\n\t\t\tconst handleInstall = (row) => {\n\t\t\t\tif (this.$site.installApp.loading) return;\n\n\t\t\t\tif (row.plans && row.plans.some((plan) => plan.price_inr > 0)) {\n\t\t\t\t\tthis.show = false;\n\n\t\t\t\t\tlet SiteAppPlanSelectDialog = defineAsyncComponent(\n\t\t\t\t\t\t() => import('./SiteAppPlanSelectDialog.vue'),\n\t\t\t\t\t);\n\n\t\t\t\t\trenderDialog(\n\t\t\t\t\t\th(SiteAppPlanSelectDialog, {\n\t\t\t\t\t\t\tapp: row,\n\t\t\t\t\t\t\tcurrentPlan: null,\n\t\t\t\t\t\t\tonPlanSelected: (plan) => {\n\t\t\t\t\t\t\t\ttoast.promise(\n\t\t\t\t\t\t\t\t\tthis.$site.installApp.submit({\n\t\t\t\t\t\t\t\t\t\tapp: row.app,\n\t\t\t\t\t\t\t\t\t\tplan: plan.name,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tloading: 'Installing app...',\n\t\t\t\t\t\t\t\t\t\tsuccess: (jobId) => {\n\t\t\t\t\t\t\t\t\t\t\trouter.push({\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'Site Job',\n\t\t\t\t\t\t\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: this.site,\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: jobId,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tthis.$emit('installed');\n\t\t\t\t\t\t\t\t\t\t\tthis.show = false;\n\t\t\t\t\t\t\t\t\t\t\treturn 'App will be installed shortly';\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\terror: (e) => getToastErrorMessage(e),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.promise(\n\t\t\t\t\t\tthis.$site.installApp.submit({\n\t\t\t\t\t\t\tapp: row.app,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tloading: 'Installing app...',\n\t\t\t\t\t\t\tsuccess: (jobId) => {\n\t\t\t\t\t\t\t\trouter.push({\n\t\t\t\t\t\t\t\t\tname: 'Site Job',\n\t\t\t\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\t\t\t\tname: this.site,\n\t\t\t\t\t\t\t\t\t\tid: jobId,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.$emit('installed');\n\t\t\t\t\t\t\t\tthis.show = false;\n\t\t\t\t\t\t\t\treturn 'App will be installed shortly';\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror: (e) => getToastErrorMessage(e),\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tlabel: 'App',\n\t\t\t\tfieldname: 'app',\n\t\t\t\tfieldtype: 'ListSelection',\n\t\t\t\temptyStateMessage:\n\t\t\t\t\t'No apps found' +\n\t\t\t\t\t(!this.$site.doc?.group_public\n\t\t\t\t\t\t? '. Please add them from your bench.'\n\t\t\t\t\t\t: ''),\n\t\t\t\tcolumns: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Title',\n\t\t\t\t\t\tfieldname: 'title',\n\t\t\t\t\t\tclass: 'font-medium',\n\t\t\t\t\t\twidth: 2,\n\t\t\t\t\t\tformat: (value, row) => value || row.app_title,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Repo',\n\t\t\t\t\t\tfieldname: 'repository_owner',\n\t\t\t\t\t\tclass: 'text-gray-600',\n\t\t\t\t\t\twidth: '10rem',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Branch',\n\t\t\t\t\t\tfieldname: 'branch',\n\t\t\t\t\t\tclass: 'text-gray-600',\n\t\t\t\t\t\twidth: '20rem',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\tfieldname: '',\n\t\t\t\t\t\talign: 'right',\n\t\t\t\t\t\ttype: 'Button',\n\t\t\t\t\t\twidth: '5rem',\n\t\t\t\t\t\tButton({ row }) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tlabel: 'Install',\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\thandleInstall(row);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tresource: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl: 'press.api.site.available_apps',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: this.site,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tauto: true,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n};\n</script>\n"],"file":"assets/InstallAppDialog-uC3Vmx4r.js"}