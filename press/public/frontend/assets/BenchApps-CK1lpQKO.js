import{_ as R}from"./Card-BCzTSeNK.js";import{x as B,h as l,u as h,o as r,w as a,X as k,j as c,A as o,a8 as $,a9 as v,aA as C,q as y,F as M,v as q,y as P,B as j,a5 as z,C as H,t as b,Y as g,ae as K,n as W,af as X}from"./main-Dpl-JOF2.js";import{_ as D}from"./AppSourceSelector-BL6tcj2j.js";import{_ as Y}from"./ListItem-CkkFcC1t.js";import{F as J}from"./fuse.basic.esm-KoNXVm3X.js";import{n as Q}from"./toast-Dk0nDfLL.js";(function(){try{var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="baa58b79-5413-438d-85c7-8cea3d0ddcee",e._sentryDebugIdIdentifier="sentry-dbid-baa58b79-5413-438d-85c7-8cea3d0ddcee")}catch(i){}})();{var f=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};f._sentryModuleMetadata=f._sentryModuleMetadata||{},f._sentryModuleMetadata[new Error().stack]=Object.assign({},f._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const Z={name:"ChangeAppBranchDialog",emits:["update:app"],props:["bench","app"],data(){return{selectedBranch:null}},resources:{branches(){return{url:"press.api.bench.branch_list"}},changeBranch(){return{url:"press.api.bench.change_branch",onSuccess(){window.location.reload()},validate(){if(this.selectedBranch==this.app.branch)return"Please select a different branch"}}}},watch:{app(e){e&&(this.selectedBranch=e.branch,this.$resources.branches.submit({name:this.bench,app:e.name}))}},methods:{branchList(){return this.$resources.branches.loading||!this.$resources.branches.data?[]:this.$resources.branches.data.map(e=>e.name)},changeBranch(){this.$resources.changeBranch.submit({name:this.bench,app:this.app.name,to_branch:this.selectedBranch})},dialogClosed(){this.$emit("update:app",null),this.$resources.changeBranch.reset()}},computed:{show:{get(){return!!(this.app&&this.bench)},set(e){e||this.dialogClosed()}}}},G={class:"flex flex-col items-center"};function ee(e,s,i,x,t,p){const d=k,_=$,A=v,m=C;return i.app?(r(),l(m,{key:0,modelValue:p.show,"onUpdate:modelValue":s[2]||(s[2]=u=>p.show=u),options:{title:`Change branch for ${i.app.title}`}},{"body-content":a(()=>[c("div",G,[e.$resources.branches.loading?(r(),l(d,{key:0,class:"w-min",loading:!0,loadingText:"Loading..."})):(r(),l(_,{key:1,class:"w-full",label:"Select Branch",type:"select",options:p.branchList(),modelValue:t.selectedBranch,"onUpdate:modelValue":s[0]||(s[0]=u=>t.selectedBranch=u)},null,8,["options","modelValue"])),o(A,{class:"mt-2 w-full",message:e.$resources.changeBranch.error},null,8,["message"])])]),actions:a(()=>[e.$resources.branches.loading?h("",!0):(r(),l(d,{key:0,class:"w-full",variant:"solid",label:"Change Branch",loading:e.$resources.changeBranch.loading,onClick:s[1]||(s[1]=u=>p.changeBranch())},null,8,["loading"]))]),_:1},8,["modelValue","options"])):h("",!0)}const V=B(Z,[["render",ee]]),se={name:"BenchApps",components:{AppSourceSelector:D,ChangeAppBranchDialog:V},props:["benchName","bench"],data(){return{selectedApps:[],showAddAppDialog:!1,appToPatch:null,appToChangeBranchOf:null,searchTerm:"",filteredOptions:[]}},resources:{apps(){return{url:"press.api.bench.apps",params:{name:this.benchName},auto:!0}},installableApps(){return{url:"press.api.bench.installable_apps",params:{name:this.benchName},onSuccess(e){this.fuse=new J(e,{limit:20,keys:["title"]}),this.filteredOptions=e}}},fetchLatestAppUpdate(){return{url:"press.api.bench.fetch_latest_app_update",onSuccess(){window.location.reload()}}},addApps(){return{url:"press.api.bench.add_apps",onSuccess(){window.location.reload()}}},removeApp(){return{url:"press.api.bench.remove_app",onSuccess(e){this.$resources.apps.setData(s=>s.filter(i=>i.name!==e))},onError(e){Q({title:"Error",message:e,icon:"x",color:"red"})}}}},methods:{updateSearchTerm(e){e?this.filteredOptions=this.fuse.search(e).map(s=>s.item):this.filteredOptions=this.$resources.installableApps.data},dropdownItems(e){return[{label:"View in Desk",onClick:()=>window.open(`${window.location.protocol}//${window.location.host}/app/app/${e.name}`,"_blank"),condition:()=>this.$account.user.user_type=="System User"},{label:"Fetch Latest Update",onClick:()=>this.fetchLatestUpdate(e)},{label:"Remove App",onClick:()=>this.confirmRemoveApp(e),condition:()=>e.name!="frappe"},{label:"Change Branch",onClick:()=>{this.appToChangeBranchOf=e}},{label:"Visit Repo",onClick:()=>window.open(`${e.repository_url}/tree/${e.branch}`,"_blank")}].filter(Boolean)},fetchLatestUpdate(e){this.$resources.fetchLatestAppUpdate.submit({name:this.benchName,app:e.name})},confirmRemoveApp(e){this.$confirm({title:"Remove App",message:`Are you sure you want to remove app ${e.name} from this bench?`,actionLabel:"Remove App",actionColor:"red",action:s=>{this.$resources.removeApp.submit({name:this.benchName,app:e.name}),s()}})}}},ne={class:"space-y-5"},te={class:"max-h-96 divide-y"},oe={class:"mt-1 flex items-center space-x-2 text-gray-600"},ae={class:"truncate text-base hover:text-clip"},re={class:"ml-auto flex items-center space-x-2"},le={key:0,class:"flex flex-row items-center"},ie={href:"https://easytouch.cloud/docs/faq/app-installation-issue",target:"_blank"};function pe(e,s,i,x,t,p){const d=k,_=j,A=P,m=z,u=H,S=Y,L=v,N=$,U=K,T=D,O=X,I=C,E=V,F=R;return r(),y("div",ne,[o(F,{title:"Apps",subtitle:"Apps available on your bench",loading:e.$resources.apps.loading},{actions:a(()=>[o(d,{onClick:s[0]||(s[0]=n=>{e.$resources.installableApps.data||e.$resources.installableApps.fetch(),t.showAddAppDialog=!0})},{default:a(()=>s[7]||(s[7]=[g(" Add App ")])),_:1})]),default:a(()=>[c("div",te,[(r(!0),y(M,null,q(e.$resources.apps.data,n=>(r(),l(S,{key:n.name,title:n.title},{subtitle:a(()=>[c("div",oe,[o(_,{name:"git-branch",class:"h-4 w-4"}),c("div",ae,b(n.repository_owner)+"/"+b(n.repository)+":"+b(n.branch),1)])]),actions:a(()=>[c("div",re,[n.last_github_poll_failed?(r(),y("span",le,[o(A,{class:"mr-2 flex cursor-pointer items-center rounded-full bg-gray-100 p-1",text:"What's this?",placement:"top"},{default:a(()=>[c("a",ie,[o(_,{class:"h-[18px] w-[18px] text-gray-800",name:"help-circle"})])]),_:1}),o(m,{label:"Attention Required",theme:"red"})])):h("",!0),!n.last_github_poll_failed&&!n.deployed?(r(),l(m,{key:1,label:"Not Deployed",theme:"orange"})):h("",!0),!n.last_github_poll_failed&&n.update_available&&n.deployed?(r(),l(m,{key:2,label:"Update Available",theme:"blue"})):h("",!0),o(u,{options:p.dropdownItems(n),right:""},{default:a(({open:w})=>[o(d,{icon:"more-horizontal"})]),_:2},1032,["options"])])]),_:2},1032,["title"]))),128))]),o(L,{message:e.$resources.fetchLatestAppUpdate.error},null,8,["message"]),o(I,{options:{title:"Add apps to your bench",position:"top"},modelValue:t.showAddAppDialog,"onUpdate:modelValue":s[5]||(s[5]=n=>t.showAddAppDialog=n)},{"body-content":a(()=>[o(N,{class:"mb-2",placeholder:"Search for Apps",onInput:s[1]||(s[1]=n=>p.updateSearchTerm(n.target.value))}),e.$resources.installableApps.loading?(r(),l(U,{key:0,class:"py-2"})):(r(),l(T,{key:1,class:W(["max-h-96 overflow-auto p-1",t.filteredOptions.length>5?"pr-2":""]),apps:t.filteredOptions,modelValue:t.selectedApps,"onUpdate:modelValue":s[2]||(s[2]=n=>t.selectedApps=n),multiple:!0},null,8,["class","apps","modelValue"])),c("p",{class:"mt-4 text-base",onClick:s[3]||(s[3]=n=>t.showAddAppDialog=!1)},[s[9]||(s[9]=g(" Don't find your app here? ")),o(O,{to:`/groups/${i.benchName}/apps/new`},{default:a(()=>s[8]||(s[8]=[g(" Add from GitHub ")])),_:1},8,["to"])])]),actions:a(()=>[t.selectedApps.length>0?(r(),l(d,{key:0,variant:"solid",class:"w-full",loading:e.$resources.addApps.loading,onClick:s[4]||(s[4]=n=>e.$resources.addApps.submit({name:i.benchName,apps:t.selectedApps.map(w=>({app:w.app,source:w.source.name}))}))},{default:a(()=>[g(" Add App"+b(t.selectedApps.length>1?"s":""),1)]),_:1},8,["loading"])):h("",!0)]),_:1},8,["modelValue"]),o(E,{bench:i.benchName,app:t.appToChangeBranchOf,"onUpdate:app":s[6]||(s[6]=n=>t.appToChangeBranchOf=n)},null,8,["bench","app"])]),_:1},8,["loading"])])}const fe=B(se,[["render",pe]]);export{fe as default};
//# sourceMappingURL=BenchApps-CK1lpQKO.js.map
