var N=(n,e,c)=>new Promise((i,h)=>{var m=p=>{try{d(c.next(p))}catch(y){h(y)}},k=p=>{try{d(c.throw(p))}catch(y){h(y)}},d=p=>p.done?i(p.value):Promise.resolve(p.value).then(m,k);d((c=c.apply(n,e)).next())});import{q as s,o,j as l,J as L,l as j,m as W,A as S,w as _,t as R,aA as q,u as g,F as M,v as B,h as D,Z as b,n as A,aT as G,k as ee,Y as T,X as K,ag as te,bx as ne,by as oe,x as ae,ao as le,a8 as Y,V as Q,a2 as se,ap as U,r as re}from"./main-Dpl-JOF2.js";import{u as ie,F as H,g as ce,a as de}from"./index-C2jCZcKa.js";(function(){try{var n=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="14f564c3-899c-4044-b742-ebc87bc1e999",n._sentryDebugIdIdentifier="sentry-dbid-14f564c3-899c-4044-b742-ebc87bc1e999")}catch(c){}})();{var O=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};O._sentryModuleMetadata=O._sentryModuleMetadata||{},O._sentryModuleMetadata[new Error().stack]=Object.assign({},O._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},me=l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"},null,-1),pe=[me];function fe(n,e){return o(),s("svg",ue,pe)}const ge={name:"lucide-maximize-2",render:fe},he={class:"mt-2 whitespace-pre-wrap rounded-lg border-2 border-gray-200 bg-gray-100 p-3 text-sm text-gray-700"},be={class:"relative flex flex-1 flex-col overflow-auto text-base"},ye={key:0,class:"border-separate border-spacing-0"},we={class:"sticky top-0 bg-gray-50"},ve=["colSpan","width"],xe={class:"flex items-center gap-2 truncate px-3 py-2"},Se={key:0,class:"w-[10rem] border-b border-r text-center text-gray-800"},_e=["align"],ke={key:0,class:"w-[6rem] border-b border-r text-center text-gray-800"},Ce={key:1,class:"flex min-h-[20vh] items-center justify-center"},Le={key:0,class:"flex justify-between p-1"},De={key:1},Te={key:2,class:"flex flex-shrink-0 items-center justify-end gap-3"},Ve={class:"flex flex-shrink-0 items-center justify-end gap-3"},Re={class:"flex flex-shrink-0 items-center gap-2 border-r-2 pr-3"},Me={class:"tnum text-sm text-gray-600"},Fe={class:"flex gap-2"},Ne={__name:"ResultTable",props:{columns:{type:Array,required:!0},data:{type:Array,required:!0},alignColumns:{type:Object,default:{}},cellFormatters:{type:Object,default:{}},fullViewFormatters:{type:Object,default:{}},borderLess:{type:Boolean,default:!1},enableCSVExport:{type:Boolean,default:!0},actionHeaderLabel:{type:String},actionComponent:{type:Object},actionComponentProps:{type:Object,default:{}},isTruncateText:{type:Boolean,default:!1},truncateLength:{type:Number,default:70}},setup(n){const e=n,c=L(()=>{let a=[];for(let t=0;t<e.data.length;t++){let v={};for(let r=0;r<e.data[t].length;r++)v[e.columns[r]]=e.data[t][r];a.push(v)}return a}),i=ie({data:c,get columns(){var v;if(!((v=e.columns)!=null&&v.length))return[];const a={id:"__index",header:"#",accessorKey:"__index",cell:r=>r.row.index+1},t=e.columns.map(r=>({id:r,cell:f=>{const w=f.getValue();return e.isTruncateText&&w&&typeof w=="string"&&w.length>e.truncateLength?`${w.substring(0,e.truncateLength)}`:e.cellFormatters[f.column.columnDef.id]?e.cellFormatters[f.column.columnDef.id](w):w},header:r,accessorKey:r,enableSorting:!1,isNumber:!1,meta:{align:e.alignColumns[r]||"left"}}));return[a,...t]},initialState:{pagination:{pageSize:10,pageIndex:0}},filterFns:{},getCoreRowModel:de(),getPaginationRowModel:ce()}),h=a=>{const t=a.getValue();return e.isTruncateText&&t&&typeof t=="string"&&t.length>e.truncateLength},m=j(null),k=j(null),d=j(!1),p=a=>{const t=a.getValue();m.value=a.column.columnDef.header,k.value=t,e.fullViewFormatters[a.column.columnDef.id]&&(k.value=e.fullViewFormatters[a.column.columnDef.id](t)),d.value=!0},y=L(()=>i.getState().pagination.pageSize),V=L(()=>i.getState().pagination.pageIndex+1),J=L(()=>(V.value-1)*y.value+1),X=L(()=>{const a=V.value*y.value;return a>e.data.length?e.data.length:a}),E=L(()=>e.data.length),I=L(()=>{var a;return((a=e.data)==null?void 0:a.length)&&E.value>y.value}),F=j(10);W(F,()=>{V.value=1,i.setPageSize(F.value)});const Z=()=>N(this,null,function*(){let a=oe.unparse({fields:e.columns,data:e.data});a="\uFEFF"+a;const t=new Blob([a],{type:"text/csv;charset=utf-8"}),r=`${Math.random().toString(36).substring(2,10)}.csv`,f=document.createElement("a");f.href=URL.createObjectURL(t),f.download=r,f.click(),URL.revokeObjectURL(f.href)});return(a,t)=>{var f,w,P,$;const v=q,r=K;return o(),s(M,null,[S(v,{options:{title:m.value,size:"3xl"},modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=u=>d.value=u)},{"body-content":_(()=>[l("pre",he,R(k.value),1)]),_:1},8,["options","modelValue"]),l("div",{class:A(["flex h-full w-full flex-col overflow-hidden",{"rounded border":!n.borderLess}])},[l("div",be,[(f=e==null?void 0:e.columns)!=null&&f.length||(w=e.data)!=null&&w.length?(o(),s("table",ye,[l("thead",we,[(o(!0),s(M,null,B(b(i).getHeaderGroups(),u=>(o(),s("tr",{key:u.id},[(o(!0),s(M,null,B(u.headers,x=>(o(),s("td",{key:x.id,colSpan:x.colSpan,class:"border-b border-r text-gray-800",width:x.column.columnDef.id==="__index"?"6rem":"auto"},[l("div",xe,[x.isPlaceholder?g("",!0):(o(),D(b(H),{key:0,render:x.column.columnDef.header,props:x.getContext()},null,8,["render","props"]))])],8,ve))),128)),n.actionHeaderLabel?(o(),s("td",Se,R(n.actionHeaderLabel),1)):g("",!0)]))),128))]),l("tbody",null,[(o(!0),s(M,null,B(b(i).getRowModel().rows,(u,x)=>(o(),s("tr",{key:u.id},[(o(!0),s(M,null,B(u.getVisibleCells(),C=>{var z;return o(),s("td",{key:C.id,align:(z=C.column.columnDef.meta)==null?void 0:z.align,class:A(["truncate border-r px-3 py-2",{"border-b":!(x===b(i).getRowModel().rows.length-1&&n.borderLess),"min-w-[6rem] ":C.column.columnDef.id!=="index"}])},[S(b(H),{render:C.column.columnDef.cell,props:C.getContext()},null,8,["render","props"]),h(C)?(o(),D(b(ge),{key:0,onClick:Ie=>p(C),class:"!my-0 ml-2 inline-block !h-4 !w-4 cursor-pointer text-gray-700"},null,8,["onClick"])):g("",!0)],10,_e)}),128)),n.actionComponent?(o(),s("td",ke,[(o(),D(ee(n.actionComponent),G({row:u.original,ref_for:!0},n.actionComponentProps),null,16,["row"]))])):g("",!0)]))),128)),t[4]||(t[4]=l("tr",{height:"99%",class:"border-b"},null,-1))])])):g("",!0),((P=e.data)==null?void 0:P.length)==0?(o(),s("div",Ce,t[5]||(t[5]=[l("div",null,"No results to display",-1)]))):g("",!0)]),(($=e.data)==null?void 0:$.length)!=0&&(n.enableCSVExport||I.value)?(o(),s("div",Le,[n.enableCSVExport?(o(),D(r,{key:0,onClick:Z,iconLeft:"download",variant:"ghost"},{default:_(()=>t[6]||(t[6]=[T("Download as CSV")])),_:1})):(o(),s("div",De)),I.value?(o(),s("div",Te,[l("div",Ve,[l("div",Re,[t[8]||(t[8]=l("p",{class:"text-sm text-gray-600"},"Per Page",-1)),te(l("select",{class:"form-select block !py-0.5 text-sm","onUpdate:modelValue":t[1]||(t[1]=u=>F.value=u)},t[7]||(t[7]=[l("option",{value:"10"},"10      ",-1),l("option",{value:"50"},"50      ",-1),l("option",{value:"100"}," 100       ",-1),l("option",{value:"200"}," 200       ",-1)]),512),[[ne,F.value]])]),l("p",Me,R(J.value)+" - "+R(X.value)+" of "+R(E.value)+" rows ",1),l("div",Fe,[S(r,{variant:"ghost",onClick:t[2]||(t[2]=u=>b(i).previousPage()),disabled:!b(i).getCanPreviousPage(),iconLeft:"arrow-left"},{default:_(()=>t[9]||(t[9]=[T(" Prev ")])),_:1},8,["disabled"]),S(r,{variant:"ghost",onClick:t[3]||(t[3]=u=>b(i).nextPage()),disabled:!b(i).getCanNextPage(),iconRight:"arrow-right"},{default:_(()=>t[10]||(t[10]=[T(" Next ")])),_:1},8,["disabled"])])])])):g("",!0)])):g("",!0)],2)],64)}}},Oe={name:"DatabaseTableSchemaDialog",props:{site:{type:String,required:!0},tableSchemas:{type:Object,required:!0},showSQLActions:{type:Boolean,default:!1},preSelectedSchema:{type:String,default:null}},emits:["runSQLQuery"],components:{FormControl:Y,ObjectList:le},data(){return{selectedSchema:null}},mounted(){this.preSelectSchema()},watch:{preSelectedSchema(){this.preSelectSchema()}},computed:{autocompleteOptions(){return Object.keys(this.tableSchemas).map(n=>({label:this.tableSchemas[n].size.total_size>.01?`${n} (${this.bytesToMB(this.tableSchemas[n].size.total_size)}MB)`:n,value:n}))},listOptions(){return!this.selectedSchema||!this.selectedSchema.value?{}:{data:()=>{var n,e,c;return(c=(e=(n=this.tableSchemas)==null?void 0:n[this.selectedSchema.value])==null?void 0:e.columns)!=null?c:[]},hideControls:!0,columns:[{label:"Column",fieldname:"column",width:.5,type:"Component",component({row:n}){return se("div",{class:"truncate text-base cursor-copy",onClick(){"clipboard"in navigator&&(navigator.clipboard.writeText(n.column),Q.success("Copied to clipboard"))}},[n.column])}},{label:"Data Type",fieldname:"data_type",width:.2,align:"center"},{label:"Default",fieldname:"default",width:.3,align:"center"},{label:"Nullable",fieldname:"is_nullable",width:.15,type:"Icon",Icon(n){return n?"check":"x"},align:"center"},{label:"Is Indexed",width:.15,align:"center",type:"Component",component({row:n}){return n.index_info.is_indexed?U("check","w-4 w-4"):U("x","w-4 w-4")}}]}}},methods:{copyTableNameToClipboard(){"clipboard"in navigator&&(navigator.clipboard.writeText(this.selectedSchema.value),Q.success("Copied to clipboard"))},viewTop100Rows(){this.$emit("runSQLQuery",`SELECT * FROM \`${this.selectedSchema.value}\` LIMIT 100;`)},viewLast100Rows(){this.$emit("runSQLQuery",`SELECT * FROM \`${this.selectedSchema.value}\` ORDER BY name DESC LIMIT 100;`)},viewAllRows(){this.$emit("runSQLQuery",`SELECT * FROM \`${this.selectedSchema.value}\`;`)},bytesToMB(n){return(n/(1024*1024)).toFixed(2)},preSelectSchema(){this.preSelectedSchema&&this.tableSchemas&&this.autocompleteOptions.length!=0&&(this.selectedSchema={label:this.preSelectedSchema,value:this.preSelectedSchema})}}},je={class:"flex flex-row gap-2"},Be={key:0,class:"mt-3 flex flex-row gap-2"};function Ee(n,e,c,i,h,m){const k=Y,d=K,p=re("ObjectList"),y=q;return o(),D(y,{options:{title:"Browse Schema",size:"2xl"}},{"body-content":_(()=>[e[4]||(e[4]=l("p",{class:"mb-2 text-sm text-gray-700"},"Select Table",-1)),l("div",je,[S(k,{class:"w-full",type:"autocomplete",options:m.autocompleteOptions,modelValue:h.selectedSchema,"onUpdate:modelValue":e[0]||(e[0]=V=>h.selectedSchema=V)},null,8,["options","modelValue"]),h.selectedSchema?(o(),D(d,{key:0,icon:"copy",onClick:m.copyTableNameToClipboard},null,8,["onClick"])):g("",!0)]),h.selectedSchema&&c.showSQLActions?(o(),s("div",Be,[S(d,{iconLeft:"play",class:"grow",variant:"outline",onClick:m.viewTop100Rows},{default:_(()=>e[1]||(e[1]=[T("View Top 100 Rows")])),_:1},8,["onClick"]),S(d,{iconLeft:"play",class:"grow",variant:"outline",onClick:m.viewLast100Rows},{default:_(()=>e[2]||(e[2]=[T("View Last 100 Rows")])),_:1},8,["onClick"]),S(d,{iconLeft:"play",class:"grow",variant:"outline",onClick:m.viewAllRows},{default:_(()=>e[3]||(e[3]=[T("View All Rows")])),_:1},8,["onClick"])])):g("",!0),h.selectedSchema?(o(),D(p,{key:1,options:m.listOptions},null,8,["options"])):g("",!0)]),_:1})}const Ae=ae(Oe,[["render",Ee]]);export{Ae as D,Ne as _};
//# sourceMappingURL=DatabaseTableSchemaDialog-BbI1Ahkp.js.map
