import{x as C,h as L,o as a,w as V,j as r,q as d,u as m,A as _,t as i,a9 as K,X as B,Y as I,aA as E,r as S,V as O}from"./main-Dpl-JOF2.js";import{P as A}from"./PerformanceReport-uZO_IyE8.js";(function(){try{var o=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="c6e1e292-51fe-46d5-bf34-c051b23ae229",o._sentryDebugIdIdentifier="sentry-dbid-c6e1e292-51fe-46d5-bf34-c051b23ae229")}catch(s){}})();{var c=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};c._sentryModuleMetadata=c._sentryModuleMetadata||{},c._sentryModuleMetadata[new Error().stack]=Object.assign({},c._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const M={name:"SiteDatabaseProcess",props:["id","query","user","host","state","command","site"],emits:["process-killed"],data(){return{show:!0}},resources:{killDatabaseProcess(){return{url:"press.api.client.run_doc_method",makeParams(){return{dt:"Site",dn:this.site,method:"kill_database_process",args:{id:this.id}}},onSuccess:()=>{this.$emit("process-killed")}}}}},N={class:"flex flex-col gap-1"},T={class:"ml-1 font-mono text-sm"},U={class:"ml-1 font-mono text-sm"},j={key:0,class:"ml-1 font-mono text-sm"},Q={key:1,class:"ml-1 font-mono text-sm"},z={key:2},H={class:"mt-1 whitespace-pre-wrap rounded-lg border-2 border-gray-200 bg-gray-100 p-3 text-sm text-gray-700"},X={class:"mt-2 flex text-sm"};function Y(o,e,s,v,t,u){const f=K,p=B,l=E;return a(),L(l,{options:{title:"Database Process",size:"xl"},modelValue:t.show,"onUpdate:modelValue":e[1]||(e[1]=n=>t.show=n)},{"body-content":V(()=>[r("div",N,[r("p",T,"Host: "+i(s.host),1),r("p",U,"User: "+i(s.user),1),s.state?(a(),d("p",j,"State: "+i(s.state),1)):m("",!0),s.command?(a(),d("p",Q," Command: "+i(s.command),1)):m("",!0),s.query?(a(),d("div",z,[e[2]||(e[2]=r("p",{class:"ml-1 font-mono text-sm"},"Query:",-1)),r("pre",H,i(s.query),1)])):m("",!0),_(f,{class:"mt-2",message:o.$resources.killDatabaseProcess.error},null,8,["message"]),r("div",X,[_(p,{variant:"solid",theme:"red",class:"w-full",onClick:e[0]||(e[0]=n=>o.$resources.killDatabaseProcess.submit()),loading:o.$resources.killDatabaseProcess.loading,loadingText:"Killing Database Process"},{default:V(()=>e[3]||(e[3]=[I(" Kill Database Process ")])),_:1},8,["loading"])])])]),_:1},8,["modelValue"])}const F=C(M,[["render",Y]]),J={name:"SiteMariaDBProcessList",props:["name"],components:{PerformanceReport:A,SiteDatabaseProcess:F},data(){return{show:!1,selectedRow:null}},resources:{processList(){if(this.name)return{url:"press.api.analytics.mariadb_processlist",params:{site:this.name},auto:!0,initialData:[]}}},computed:{processListOptions(){return{data:()=>this.$resources.processList.data,columns:[{label:"ID",fieldname:"id",width:"4rem"},{label:"Time",fieldname:"time",width:"6rem",align:"right"},{label:"Command",fieldname:"command",width:"6rem"},{label:"State",fieldname:"state",width:"8rem"},{label:"Query",fieldname:"query",class:"font-mono"}],onRowClick:o=>{this.selectedRow=o,this.show=!0},secondaryAction:()=>({label:"Refresh",icon:"refresh-ccw",loading:this.$resources.processList.loading,onClick:()=>this.$resources.processList.reload()})}}},methods:{processKilledCallback(){O.success("Database Process Killed"),this.show=!1,this.$resources.processList.reload()}}};function W(o,e,s,v,t,u){var l,n,h,b,w,y,g,k,P,D,x,R;const f=S("PerformanceReport"),p=S("SiteDatabaseProcess");return a(),d("div",null,[_(f,{title:"Process List",site:s.name,reportOptions:u.processListOptions},null,8,["site","reportOptions"]),t.show?(a(),L(p,{key:0,modelValue:t.show,"onUpdate:modelValue":e[0]||(e[0]=q=>t.show=q),id:(n=(l=t.selectedRow)==null?void 0:l.id)!=null?n:"",query:(b=(h=t.selectedRow)==null?void 0:h.query)!=null?b:"",host:(y=(w=t.selectedRow)==null?void 0:w.db_user_host)!=null?y:"",user:(k=(g=t.selectedRow)==null?void 0:g.db_user)!=null?k:"",state:(D=(P=t.selectedRow)==null?void 0:P.state)!=null?D:"",command:(R=(x=t.selectedRow)==null?void 0:x.command)!=null?R:"",site:s.name,onProcessKilled:u.processKilledCallback},null,8,["modelValue","id","query","host","user","state","command","site","onProcessKilled"])):m("",!0)])}const G=C(J,[["render",W]]);export{G as default};
//# sourceMappingURL=SiteProcessList-CnTa4P9M.js.map
