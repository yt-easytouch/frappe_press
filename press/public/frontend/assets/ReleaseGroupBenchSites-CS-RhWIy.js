var j=Object.defineProperty,W=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var V=(t,e,s)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,R=(t,e)=>{for(var s in e||(e={}))Y.call(e,s)&&V(t,s,e[s]);if(D)for(var s of D(e))q.call(e,s)&&V(t,s,e[s]);return t},E=(t,e)=>W(t,z(e));var H=(t,e,s)=>new Promise((d,i)=>{var a=n=>{try{h(s.next(n))}catch(m){i(m)}},p=n=>{try{h(s.throw(n))}catch(m){i(m)}},h=n=>n.done?d(n.value):Promise.resolve(n.value).then(a,p);h((s=s.apply(t,e)).next())});import{x as O,r as C,h as I,o as c,a6 as J,w as u,q as _,u as M,j as r,A as o,t as T,B as K,Y as l,X as N,a9 as X,aA as P,av as U,bJ as Q,ao as Z,ac as ee,V as f,aF as k,a2 as S,z as F,aB as b,aa as w,c1 as te,c2 as se,c3 as ae,ap as A,y as $,a5 as oe,bE as re,D as L}from"./main-Dpl-JOF2.js";import{_ as ne}from"./ClickToCopyField-DpU9Eau5.js";(function(){try{var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="f83c5c2f-5f77-4195-a94d-ca276d2a664e",t._sentryDebugIdIdentifier="sentry-dbid-f83c5c2f-5f77-4195-a94d-ca276d2a664e")}catch(s){}})();{var y=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};y._sentryModuleMetadata=y._sentryModuleMetadata||{},y._sentryModuleMetadata[new Error().stack]=Object.assign({},y._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:press-dashboard":!0})}const ie={props:["bench","releaseGroup"],data(){return{show:!0}},resources:{bench(){return{type:"document",doctype:"Bench",name:this.bench,onSuccess(t){t.is_ssh_proxy_setup&&t.user_ssh_key&&this.$releaseGroup.getCertificate.reload()}}}},computed:{$bench(){return this.$resources.bench},$releaseGroup(){return U("Release Group",this.releaseGroup)},certificate(){return this.$releaseGroup.getCertificate.data},sshCommand(){if(this.$bench.doc)return`ssh ${this.$bench.doc.name}@${this.$bench.doc.proxy_server} -p 2222`},certificateCommand(){var t;return this.certificate?`echo '${(t=this.certificate.ssh_certificate)==null?void 0:t.trim()}' > ~/.ssh/id_${this.certificate.key_type}-cert.pub`:null},isWindows(){return navigator.userAgent.includes("Windows")}}},le={key:0,class:"space-y-4"},ce={key:0,class:"space-y-2"},ue={class:"space-y-2"},de={class:"space-y-2"},pe={class:"text-base font-semibold text-gray-700"},he={class:"space-y-2"},me={class:"space-y-2"},_e={class:"text-base font-semibold text-gray-700"},fe={class:"space-y-1"},ge={class:"flex items-center gap-2 rounded bg-gray-100 p-3"},ye={key:1,class:"space-y-2 text-p-base text-gray-700"},be={key:0},we={key:1},ve={key:2};function ke(t,e,s,d,i,a){var x,B;const p=ne,h=K,n=C("router-link"),m=N,g=X,v=P;return c(),I(v,{options:{title:"SSH Access",size:"xl"},modelValue:i.show,"onUpdate:modelValue":e[2]||(e[2]=G=>i.show=G)},J({default:u(()=>[o(g,{class:"mt-3",message:a.$releaseGroup.generateCertificate.error},null,8,["message"])]),_:2},[a.$bench.doc?{name:"body-content",fn:u(()=>[a.certificate?(c(),_("div",le,[a.isWindows?(c(),_("div",ce,[e[4]||(e[4]=r("h4",{class:"text-base font-semibold text-gray-700"},"Step 1",-1)),r("div",ue,[e[3]||(e[3]=r("p",{class:"text-base"}," Execute the following shell command to set the encoding to UTF-8. ",-1)),o(p,{textContent:"$PSDefaultParameterValues['*: Encoding'] = 'utf8'",breakLines:!1})])])):M("",!0),r("div",de,[r("h4",pe," Step "+T(a.isWindows?"2":"1"),1),r("div",he,[e[5]||(e[5]=r("p",{class:"text-base"}," Execute the following shell command to store the SSH certificate locally. ",-1)),o(p,{textContent:a.certificateCommand,breakLines:!1},null,8,["textContent"])])]),r("div",me,[r("h4",_e," Step "+T(a.isWindows?"3":"2"),1),r("div",fe,[e[6]||(e[6]=r("p",{class:"text-base"}," Execute the following shell command to SSH into your bench ",-1)),o(p,{textContent:a.sshCommand},null,8,["textContent"])])]),r("div",ge,[o(h,{name:"alert-triangle",class:"h-4 w-4"}),e[7]||(e[7]=r("div",{class:"space-y-1 text-base"},[r("p",null,[l(" Use wisely and only for "),r("a",{href:"/docs/benches/debugging",class:"underline",target:"_blank"},"debugging"),l(" purposes. ")]),r("p",null," Do not install/uninstall apps as you would on a local machine. Use the dashboard instead. ")],-1))])])):(c(),_("div",ye,[a.$bench.doc.user_ssh_key?a.$bench.doc.is_ssh_proxy_setup?(c(),_("p",ve," You will need an SSH certificate to get SSH access to your bench. This certificate will work only with your public-private key pair and will be valid for 6 hours. ")):(c(),_("p",we," SSH access is not enabled for this bench. Please contact support to enable access. ")):(c(),_("p",be,[e[9]||(e[9]=l(" It looks like you haven't added your SSH public key. Go to ")),o(n,{to:{name:"SettingsDeveloper"},class:"underline",onClick:e[0]||(e[0]=G=>i.show=!1)},{default:u(()=>e[8]||(e[8]=[l(" Developer Settings")])),_:1}),e[10]||(e[10]=l(" to add your SSH public key. "))])),e[11]||(e[11]=r("p",null,[l(" Please refer to the "),r("a",{href:"/docs/benches/ssh",class:"underline",target:"_blank"},"SSH Access documentation"),l(" for more details. ")],-1))]))]),key:"0"}:void 0,!a.certificate&&((x=a.$bench.doc)!=null&&x.is_ssh_proxy_setup)&&((B=a.$bench.doc)!=null&&B.user_ssh_key)?{name:"actions",fn:u(()=>[o(m,{loading:a.$releaseGroup.generateCertificate.loading,onClick:e[1]||(e[1]=()=>H(this,null,function*(){yield a.$releaseGroup.generateCertificate.fetch(),yield a.$releaseGroup.getCertificate.reload()})),variant:"solid",class:"w-full"},{default:u(()=>e[12]||(e[12]=[l("Generate SSH Certificate")])),_:1},8,["loading"])]),key:"1"}:void 0]),1032,["modelValue"])}const Se=O(ie,[["render",ke]]),Ae={name:"ReleaseGroupBenchSites",props:["releaseGroup"],components:{ObjectList:Z,DismissableBanner:Q},data(){return{showAppVersionDialog:!1,sitesGroupedByBench:[]}},resources:{benches(){return{type:"list",doctype:"Bench",filters:{group:this.$releaseGroup.name,skip_team_filter_for_system_user_and_support_agent:!0},fields:["name","status"],orderBy:"creation desc",pageLength:99999,auto:!0,onSuccess(){this.$resources.sites.fetch()}}},sites(){return{type:"list",doctype:"Site",filters:{group:this.$releaseGroup.name,skip_team_filter_for_system_user_and_support_agent:!0},fields:["name","status","bench","host_name","plan.plan_title as plan_title","plan.price_usd as price_usd","plan.price_inr as price_inr","cluster.image as cluster_image","cluster.title as cluster_title"],orderBy:"creation desc, bench desc",pageLength:99999,transform(t){return this.groupSitesByBench(t)},auto:!1}}},computed:{listOptions(){return{list:this.$resources.sites,groupHeader:({group:t})=>{if(!(t!=null&&t.status))return;const e=this.benchOptions(t),s=A("hash","w-3 h-3"),d=A("star","w-3 h-3");return o("div",{class:"flex items-center"},[o($,{text:"View bench details"},{default:()=>[o("a",{class:"cursor-pointer text-base font-medium leading-6 text-gray-900",href:`/dashboard/benches/${t.name}`},[t.group])]}),t.status!="Active"?o(oe,{class:"ml-4",label:t.status},null):null,t.has_app_patch_applied&&o($,{text:"Apps in this bench may have been patched"},{default:()=>[o("a",{class:"ml-2 rounded bg-gray-100 p-1 text-gray-700",href:"https://easytouch.cloud/docs/benches/app-patches",target:"_blank"},[o(s,null,null)])]}),t.has_updated_inplace&&o($,{text:"This bench has been updated in place"},{default:()=>[o("a",{class:"ml-2 rounded bg-gray-100 p-1 text-gray-700",href:"https://easytouch.cloud/docs/in-place-updates",target:"_blank"},[o(d,null,null)])]}),o(re,{class:"ml-auto",options:e},null)])},emptyStateMessage:this.$releaseGroup.doc.deploy_information.last_deploy?"No sites found":"Create a deploy first to start creating sites",columns:ae(!1),filterControls:se,route:te,primaryAction:()=>{var t,e;return{label:"New Site",slots:{prefix:A("plus","w-4 h-4")},disabled:!((e=(t=this.$releaseGroup.doc)==null?void 0:t.deploy_information)!=null&&e.last_deploy),route:{name:"Release Group New Site",params:{bench:this.releaseGroup}}}}}},appVersionOptions(){return{columns:[{label:"App",fieldname:"app"},{label:"Repo",fieldname:"repository",format(t,e){return`${e.repository_owner}/${e.repository}`},link:(t,e)=>e.repository_url},{label:"Branch",fieldname:"branch",type:"Badge"},{label:"Commit",fieldname:"hash",type:"Badge",format(t,e){return t.slice(0,7)},link:(t,e)=>`https://github.com/${e.repository_owner}/${e.repository}/commit/${t}`},{label:"Tag",fieldname:"tag",type:"Badge"}],data:()=>this.$releaseGroup.getAppVersions.data}},$releaseGroup(){return U("Release Group",this.releaseGroup)}},methods:{groupSitesByBench(t){return this.$resources.benches.data?this.$resources.benches.data.map(e=>{let s=(t||[]).filter(d=>d.bench===e.name);return E(R({},e),{collapsed:!1,group:e.name,rows:s})}):[]},benchOptions(t){return t?[{label:"View in Desk",condition:()=>{var e,s;return(s=(e=this.$team)==null?void 0:e.doc)==null?void 0:s.is_desk_user},onClick:()=>window.open(`${window.location.protocol}//${window.location.host}/app/bench/${t.name}`,"_blank")},{label:"Show Apps",onClick:()=>{f.promise(this.$releaseGroup.getAppVersions.submit({bench:t.name}).then(()=>{this.showAppVersionDialog=!0}),{loading:"Fetching apps...",success:"Fetched apps with versions",error:"Failed to fetch apps",duration:1e3})}},{label:"SSH Access",condition:()=>t.status==="Active",onClick:()=>{k(S(Se,{bench:t.name,releaseGroup:this.$releaseGroup.name}))}},{label:"View Logs",condition:()=>t.status==="Active",onClick:()=>{let e=F(()=>L(()=>import("./BenchLogsDialog-FHxF99ma.js"),__vite__mapDeps([0,1,2,3,4])));k(S(e,{bench:t.name}))}},{label:"Update All Sites",condition:()=>t.status==="Active"&&t.rows.length>0,onClick:()=>{b({title:"Update All Sites",message:`Are you sure you want to update all sites in the bench <b>${t.name}</b> to the latest bench?`,primaryAction:{label:"Update",variant:"solid",onClick:({hide:e})=>{f.promise(this.runBenchMethod(t.name,"update_all_sites"),{loading:"Scheduling updates for the sites...",success:()=>(e(),"Sites have been scheduled for update"),error:s=>(e(),w(s,"Failed to update sites")),duration:1e3})}}})}},{label:"Restart Bench",condition:()=>t.status==="Active",onClick:()=>{b({title:"Restart Bench",message:`Are you sure you want to restart the bench <b>${t.name}</b>?`,primaryAction:{label:"Restart",variant:"solid",theme:"red",onClick:({hide:e})=>{f.promise(this.runBenchMethod(t.name,"restart"),{loading:"Restarting bench...",success:()=>(e(),"Bench will restart shortly"),error:s=>(e(),w(s,"Failed to restart bench")),duration:1e3})}}})}},{label:"Rebuild Assets",condition:()=>t.status==="Active"&&!t.on_public_server&&(Number(this.$releaseGroup.doc.version.split(" ")[1])>13||this.$releaseGroup.doc.version==="Nightly"),onClick:()=>{b({title:"Rebuild Assets",message:`Are you sure you want to rebuild assets for the bench <b>${t.name}</b>?`,primaryAction:{label:"Rebuild",variant:"solid",theme:"red",onClick:({hide:e})=>{f.promise(this.runBenchMethod(t.name,"rebuild"),{loading:"Rebuilding assets...",success:()=>(e(),"Assets will be rebuilt in the background. This may take a few minutes."),error:s=>(e(),w(s,"Failed to rebuild assets")),duration:1e3})}}})}},{label:"Archive Bench",onClick:()=>{b({title:"Archive Bench",message:`Are you sure you want to archive the bench <b>${t.name}</b>?`,primaryAction:{label:"Archive",variant:"solid",theme:"red",onClick:({hide:e})=>{f.promise(this.runBenchMethod(t.name,"archive"),{loading:"Scheduling bench for archival...",success:()=>(e(),"Bench is scheduled for archival"),error:s=>w(s,"Failed to archive bench")})}}})}},{label:"View Processes",condition:()=>t.status==="Active",onClick:()=>{let e=F(()=>L(()=>import("./SupervisorProcessesDialog-O1QH_Dvr.js"),__vite__mapDeps([5,1,2])));k(S(e,{bench:t.name}))}}]:[]},runBenchMethod(t,e){return ee({url:"press.api.client.run_doc_method"}).submit({dt:"Bench",dn:t,method:e})}}};function $e(t,e,s,d,i,a){var g;const p=N,h=C("DismissableBanner"),n=C("ObjectList"),m=P;return c(),_("div",null,[a.$releaseGroup.doc.eol_versions.includes(a.$releaseGroup.doc.version)?(c(),I(h,{key:0,class:"col-span-1 lg:col-span-2",title:"Your sites are on an End of Life version. Upgrade to the latest version to get the latest features and security updates.",id:`${a.$releaseGroup.name}-eol`,type:"gray"},{default:u(()=>[o(p,{class:"ml-auto",variant:"outline",link:"https://easytouch.cloud/docs/sites/version-upgrade"},{default:u(()=>e[1]||(e[1]=[l(" Upgrade Now ")])),_:1})]),_:1},8,["id"])):M("",!0),o(n,{class:"mt-3",options:a.listOptions},null,8,["options"]),o(m,{modelValue:i.showAppVersionDialog,"onUpdate:modelValue":e[0]||(e[0]=v=>i.showAppVersionDialog=v),options:{title:`Apps in ${(g=a.$releaseGroup.getAppVersions.params)==null?void 0:g.args.bench}`,size:"6xl"}},{"body-content":u(()=>[o(n,{options:a.appVersionOptions},null,8,["options"])]),_:1},8,["modelValue","options"])])}const Ge=O(Ae,[["render",$e]]);export{Ge as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/BenchLogsDialog-FHxF99ma.js","assets/main-Dpl-JOF2.js","assets/main-B0ZLDivw.css","assets/sparkle-Bm7NguED.js","assets/arrow-left-DH4AOn6w.js","assets/SupervisorProcessesDialog-O1QH_Dvr.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=ReleaseGroupBenchSites-CS-RhWIy.js.map
